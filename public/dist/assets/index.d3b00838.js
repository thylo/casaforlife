/*!
 * lightgallery | 2.7.1 | January 11th 2023
 * http://www.lightgalleryjs.com/
 * Copyright (c) 2020 Sachin Neravath;
 * @license GPLv3
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Un=function(){return Un=Object.assign||function(E){for(var O,q=1,X=arguments.length;q<X;q++){O=arguments[q];for(var ie in O)Object.prototype.hasOwnProperty.call(O,ie)&&(E[ie]=O[ie])}return E},Un.apply(this,arguments)};function Id(){for(var Q=0,E=0,O=arguments.length;E<O;E++)Q+=arguments[E].length;for(var q=Array(Q),X=0,E=0;E<O;E++)for(var ie=arguments[E],fe=0,h=ie.length;fe<h;fe++,X++)q[X]=ie[fe];return q}var Lt={afterAppendSlide:"lgAfterAppendSlide",init:"lgInit",hasVideo:"lgHasVideo",containerResize:"lgContainerResize",updateSlides:"lgUpdateSlides",afterAppendSubHtml:"lgAfterAppendSubHtml",beforeOpen:"lgBeforeOpen",afterOpen:"lgAfterOpen",slideItemLoad:"lgSlideItemLoad",beforeSlide:"lgBeforeSlide",afterSlide:"lgAfterSlide",posterClick:"lgPosterClick",dragStart:"lgDragStart",dragMove:"lgDragMove",dragEnd:"lgDragEnd",beforeNextSlide:"lgBeforeNextSlide",beforePrevSlide:"lgBeforePrevSlide",beforeClose:"lgBeforeClose",afterClose:"lgAfterClose",rotateLeft:"lgRotateLeft",rotateRight:"lgRotateRight",flipHorizontal:"lgFlipHorizontal",flipVertical:"lgFlipVertical",autoplay:"lgAutoplay",autoplayStart:"lgAutoplayStart",autoplayStop:"lgAutoplayStop"},Ed={mode:"lg-slide",easing:"ease",speed:400,licenseKey:"0000-0000-000-0000",height:"100%",width:"100%",addClass:"",startClass:"lg-start-zoom",backdropDuration:300,container:"",startAnimationDuration:400,zoomFromOrigin:!0,hideBarsDelay:0,showBarsAfter:1e4,slideDelay:0,supportLegacyBrowser:!0,allowMediaOverlap:!1,videoMaxSize:"1280-720",loadYouTubePoster:!0,defaultCaptionHeight:0,ariaLabelledby:"",ariaDescribedby:"",resetScrollPosition:!0,hideScrollbar:!1,closable:!0,swipeToClose:!0,closeOnTap:!0,showCloseIcon:!0,showMaximizeIcon:!1,loop:!0,escKey:!0,keyPress:!0,trapFocus:!0,controls:!0,slideEndAnimation:!0,hideControlOnEnd:!1,mousewheel:!1,getCaptionFromTitleOrAlt:!0,appendSubHtmlTo:".lg-sub-html",subHtmlSelectorRelative:!1,preload:2,numberOfSlideItemsInDom:10,selector:"",selectWithin:"",nextHtml:"",prevHtml:"",index:0,iframeWidth:"100%",iframeHeight:"100%",iframeMaxWidth:"100%",iframeMaxHeight:"100%",download:!0,counter:!0,appendCounterTo:".lg-toolbar",swipeThreshold:50,enableSwipe:!0,enableDrag:!0,dynamic:!1,dynamicEl:[],extraProps:[],exThumbImage:"",isMobile:void 0,mobileSettings:{controls:!1,showCloseIcon:!1,download:!1},plugins:[],strings:{closeGallery:"Close gallery",toggleMaximize:"Toggle maximize",previousSlide:"Previous slide",nextSlide:"Next slide",download:"Download",playVideo:"Play video"}};function Sd(){(function(){if(typeof window.CustomEvent=="function")return!1;function Q(E,O){O=O||{bubbles:!1,cancelable:!1,detail:null};var q=document.createEvent("CustomEvent");return q.initCustomEvent(E,O.bubbles,O.cancelable,O.detail),q}window.CustomEvent=Q})(),function(){Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector)}()}var Dh=function(){function Q(E){return this.cssVenderPrefixes=["TransitionDuration","TransitionTimingFunction","Transform","Transition"],this.selector=this._getSelector(E),this.firstElement=this._getFirstEl(),this}return Q.generateUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(E){var O=Math.random()*16|0,q=E=="x"?O:O&3|8;return q.toString(16)})},Q.prototype._getSelector=function(E,O){if(O===void 0&&(O=document),typeof E!="string")return E;O=O||document;var q=E.substring(0,1);return q==="#"?O.querySelector(E):O.querySelectorAll(E)},Q.prototype._each=function(E){return this.selector?(this.selector.length!==void 0?[].forEach.call(this.selector,E):E(this.selector,0),this):this},Q.prototype._setCssVendorPrefix=function(E,O,q){var X=O.replace(/-([a-z])/gi,function(ie,fe){return fe.toUpperCase()});this.cssVenderPrefixes.indexOf(X)!==-1?(E.style[X.charAt(0).toLowerCase()+X.slice(1)]=q,E.style["webkit"+X]=q,E.style["moz"+X]=q,E.style["ms"+X]=q,E.style["o"+X]=q):E.style[X]=q},Q.prototype._getFirstEl=function(){return this.selector&&this.selector.length!==void 0?this.selector[0]:this.selector},Q.prototype.isEventMatched=function(E,O){var q=O.split(".");return E.split(".").filter(function(X){return X}).every(function(X){return q.indexOf(X)!==-1})},Q.prototype.attr=function(E,O){return O===void 0?this.firstElement?this.firstElement.getAttribute(E):"":(this._each(function(q){q.setAttribute(E,O)}),this)},Q.prototype.find=function(E){return We(this._getSelector(E,this.selector))},Q.prototype.first=function(){return this.selector&&this.selector.length!==void 0?We(this.selector[0]):We(this.selector)},Q.prototype.eq=function(E){return We(this.selector[E])},Q.prototype.parent=function(){return We(this.selector.parentElement)},Q.prototype.get=function(){return this._getFirstEl()},Q.prototype.removeAttr=function(E){var O=E.split(" ");return this._each(function(q){O.forEach(function(X){return q.removeAttribute(X)})}),this},Q.prototype.wrap=function(E){if(!this.firstElement)return this;var O=document.createElement("div");return O.className=E,this.firstElement.parentNode.insertBefore(O,this.firstElement),this.firstElement.parentNode.removeChild(this.firstElement),O.appendChild(this.firstElement),this},Q.prototype.addClass=function(E){return E===void 0&&(E=""),this._each(function(O){E.split(" ").forEach(function(q){q&&O.classList.add(q)})}),this},Q.prototype.removeClass=function(E){return this._each(function(O){E.split(" ").forEach(function(q){q&&O.classList.remove(q)})}),this},Q.prototype.hasClass=function(E){return this.firstElement?this.firstElement.classList.contains(E):!1},Q.prototype.hasAttribute=function(E){return this.firstElement?this.firstElement.hasAttribute(E):!1},Q.prototype.toggleClass=function(E){return this.firstElement?(this.hasClass(E)?this.removeClass(E):this.addClass(E),this):this},Q.prototype.css=function(E,O){var q=this;return this._each(function(X){q._setCssVendorPrefix(X,E,O)}),this},Q.prototype.on=function(E,O){var q=this;return this.selector?(E.split(" ").forEach(function(X){Array.isArray(Q.eventListeners[X])||(Q.eventListeners[X]=[]),Q.eventListeners[X].push(O),q.selector.addEventListener(X.split(".")[0],O)}),this):this},Q.prototype.once=function(E,O){var q=this;return this.on(E,function(){q.off(E),O(E)}),this},Q.prototype.off=function(E){var O=this;return this.selector?(Object.keys(Q.eventListeners).forEach(function(q){O.isEventMatched(E,q)&&(Q.eventListeners[q].forEach(function(X){O.selector.removeEventListener(q.split(".")[0],X)}),Q.eventListeners[q]=[])}),this):this},Q.prototype.trigger=function(E,O){if(!this.firstElement)return this;var q=new CustomEvent(E.split(".")[0],{detail:O||null});return this.firstElement.dispatchEvent(q),this},Q.prototype.load=function(E){var O=this;return fetch(E).then(function(q){return q.text()}).then(function(q){O.selector.innerHTML=q}),this},Q.prototype.html=function(E){return E===void 0?this.firstElement?this.firstElement.innerHTML:"":(this._each(function(O){O.innerHTML=E}),this)},Q.prototype.append=function(E){return this._each(function(O){typeof E=="string"?O.insertAdjacentHTML("beforeend",E):O.appendChild(E)}),this},Q.prototype.prepend=function(E){return this._each(function(O){O.insertAdjacentHTML("afterbegin",E)}),this},Q.prototype.remove=function(){return this._each(function(E){E.parentNode.removeChild(E)}),this},Q.prototype.empty=function(){return this._each(function(E){E.innerHTML=""}),this},Q.prototype.scrollTop=function(E){return E!==void 0?(document.body.scrollTop=E,document.documentElement.scrollTop=E,this):window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0},Q.prototype.scrollLeft=function(E){return E!==void 0?(document.body.scrollLeft=E,document.documentElement.scrollLeft=E,this):window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0},Q.prototype.offset=function(){if(!this.firstElement)return{left:0,top:0};var E=this.firstElement.getBoundingClientRect(),O=We("body").style().marginLeft;return{left:E.left-parseFloat(O)+this.scrollLeft(),top:E.top+this.scrollTop()}},Q.prototype.style=function(){return this.firstElement?this.firstElement.currentStyle||window.getComputedStyle(this.firstElement):{}},Q.prototype.width=function(){var E=this.style();return this.firstElement.clientWidth-parseFloat(E.paddingLeft)-parseFloat(E.paddingRight)},Q.prototype.height=function(){var E=this.style();return this.firstElement.clientHeight-parseFloat(E.paddingTop)-parseFloat(E.paddingBottom)},Q.eventListeners={},Q}();function We(Q){return Sd(),new Dh(Q)}var Cd=["src","sources","subHtml","subHtmlUrl","html","video","poster","slideName","responsive","srcset","sizes","iframe","downloadUrl","download","width","facebookShareUrl","tweetText","iframeTitle","twitterShareUrl","pinterestShareUrl","pinterestText","fbHtml","disqusIdentifier","disqusUrl"];function Ad(Q){return Q==="href"?"src":(Q=Q.replace("data-",""),Q=Q.charAt(0).toLowerCase()+Q.slice(1),Q=Q.replace(/-([a-z])/g,function(E){return E[1].toUpperCase()}),Q)}var yi={getSize:function(Q,E,O,q){O===void 0&&(O=0);var X=We(Q),ie=X.attr("data-lg-size")||q;if(!!ie){var fe=ie.split(",");if(fe[1])for(var h=window.innerWidth,Pe=0;Pe<fe.length;Pe++){var Ze=fe[Pe],Je=parseInt(Ze.split("-")[2],10);if(Je>h){ie=Ze;break}Pe===fe.length-1&&(ie=Ze)}var Re=ie.split("-"),re=parseInt(Re[0],10),Bt=parseInt(Re[1],10),_t=E.width(),dt=E.height()-O,si=Math.min(_t,re),ti=Math.min(dt,Bt),qt=Math.min(si/re,ti/Bt);return{width:re*qt,height:Bt*qt}}},getTransform:function(Q,E,O,q,X){if(!!X){var ie=We(Q).find("img").first();if(!!ie.get()){var fe=E.get().getBoundingClientRect(),h=fe.width,Pe=E.height()-(O+q),Ze=ie.width(),Je=ie.height(),Re=ie.style(),re=(h-Ze)/2-ie.offset().left+(parseFloat(Re.paddingLeft)||0)+(parseFloat(Re.borderLeft)||0)+We(window).scrollLeft()+fe.left,Bt=(Pe-Je)/2-ie.offset().top+(parseFloat(Re.paddingTop)||0)+(parseFloat(Re.borderTop)||0)+We(window).scrollTop()+O,_t=Ze/X.width,dt=Je/X.height,si="translate3d("+(re*=-1)+"px, "+(Bt*=-1)+"px, 0) scale3d("+_t+", "+dt+", 1)";return si}}},getIframeMarkup:function(Q,E,O,q,X,ie){var fe=ie?'title="'+ie+'"':"";return'<div class="lg-video-cont lg-has-iframe" style="width:'+Q+"; max-width:"+O+"; height: "+E+"; max-height:"+q+`">
                    <iframe class="lg-object" frameborder="0" `+fe+' src="'+X+`"  allowfullscreen="true"></iframe>
                </div>`},getImgMarkup:function(Q,E,O,q,X,ie){var fe=q?'srcset="'+q+'"':"",h=X?'sizes="'+X+'"':"",Pe="<img "+O+" "+fe+"  "+h+' class="lg-object lg-image" data-index="'+Q+'" src="'+E+'" />',Ze="";if(ie){var Je=typeof ie=="string"?JSON.parse(ie):ie;Ze=Je.map(function(Re){var re="";return Object.keys(Re).forEach(function(Bt){re+=" "+Bt+'="'+Re[Bt]+'"'}),"<source "+re+"></source>"})}return""+Ze+Pe},getResponsiveSrc:function(Q){for(var E=[],O=[],q="",X=0;X<Q.length;X++){var ie=Q[X].split(" ");ie[0]===""&&ie.splice(0,1),O.push(ie[0]),E.push(ie[1])}for(var fe=window.innerWidth,h=0;h<E.length;h++)if(parseInt(E[h],10)>fe){q=O[h];break}return q},isImageLoaded:function(Q){return!(!Q||!Q.complete||Q.naturalWidth===0)},getVideoPosterMarkup:function(Q,E,O,q,X){var ie="";return X&&X.youtube?ie="lg-has-youtube":X&&X.vimeo?ie="lg-has-vimeo":ie="lg-has-html5",'<div class="lg-video-cont '+ie+'" style="'+O+`">
                <div class="lg-video-play-button">
                <svg
                    viewBox="0 0 20 20"
                    preserveAspectRatio="xMidYMid"
                    focusable="false"
                    aria-labelledby="`+q+`"
                    role="img"
                    class="lg-video-play-icon"
                >
                    <title>`+q+`</title>
                    <polygon class="lg-video-play-icon-inner" points="1,0 20,10 1,20"></polygon>
                </svg>
                <svg class="lg-video-play-icon-bg" viewBox="0 0 50 50" focusable="false">
                    <circle cx="50%" cy="50%" r="20"></circle></svg>
                <svg class="lg-video-play-icon-circle" viewBox="0 0 50 50" focusable="false">
                    <circle cx="50%" cy="50%" r="20"></circle>
                </svg>
            </div>
            `+(E||"")+`
            <img class="lg-object lg-video-poster" src="`+Q+`" />
        </div>`},getFocusableElements:function(Q){var E=Q.querySelectorAll('a[href]:not([disabled]), button:not([disabled]), textarea:not([disabled]), input[type="text"]:not([disabled]), input[type="radio"]:not([disabled]), input[type="checkbox"]:not([disabled]), select:not([disabled])'),O=[].filter.call(E,function(q){var X=window.getComputedStyle(q);return X.display!=="none"&&X.visibility!=="hidden"});return O},getDynamicOptions:function(Q,E,O,q){var X=[],ie=Id(Cd,E);return[].forEach.call(Q,function(fe){for(var h={},Pe=0;Pe<fe.attributes.length;Pe++){var Ze=fe.attributes[Pe];if(Ze.specified){var Je=Ad(Ze.name),Re="";ie.indexOf(Je)>-1&&(Re=Je),Re&&(h[Re]=Ze.value)}}var re=We(fe),Bt=re.find("img").first().attr("alt"),_t=re.attr("title"),dt=q?re.attr(q):re.find("img").first().attr("src");h.thumb=dt,O&&!h.subHtml&&(h.subHtml=_t||Bt||""),h.alt=Bt||_t||"",X.push(h)}),X},isMobile:function(){return/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)},isVideo:function(Q,E,O){if(!Q){if(E)return{html5:!0};console.error("lightGallery :- data-src is not provided on slide item "+(O+1)+". Please make sure the selector property is properly configured. More info - https://www.lightgalleryjs.com/demos/html-markup/");return}var q=Q.match(/\/\/(?:www\.)?youtu(?:\.be|be\.com|be-nocookie\.com)\/(?:watch\?v=|embed\/)?([a-z0-9\-\_\%]+)([\&|?][\S]*)*/i),X=Q.match(/\/\/(?:www\.)?(?:player\.)?vimeo.com\/(?:video\/)?([0-9a-z\-_]+)(.*)?/i),ie=Q.match(/https?:\/\/(.+)?(wistia\.com|wi\.st)\/(medias|embed)\/([0-9a-z\-_]+)(.*)/);if(q)return{youtube:q};if(X)return{vimeo:X};if(ie)return{wistia:ie}}},Mh=0,zd=function(){function Q(E,O){if(this.lgOpened=!1,this.index=0,this.plugins=[],this.lGalleryOn=!1,this.lgBusy=!1,this.currentItemsInDom=[],this.prevScrollTop=0,this.bodyPaddingRight=0,this.isDummyImageRemoved=!1,this.dragOrSwipeEnabled=!1,this.mediaContainerPosition={top:0,bottom:0},!E)return this;if(Mh++,this.lgId=Mh,this.el=E,this.LGel=We(E),this.generateSettings(O),this.buildModules(),this.settings.dynamic&&this.settings.dynamicEl!==void 0&&!Array.isArray(this.settings.dynamicEl))throw"When using dynamic mode, you must also define dynamicEl as an Array.";return this.galleryItems=this.getItems(),this.normalizeSettings(),this.init(),this.validateLicense(),this}return Q.prototype.generateSettings=function(E){if(this.settings=Un(Un({},Ed),E),this.settings.isMobile&&typeof this.settings.isMobile=="function"?this.settings.isMobile():yi.isMobile()){var O=Un(Un({},this.settings.mobileSettings),this.settings.mobileSettings);this.settings=Un(Un({},this.settings),O)}},Q.prototype.normalizeSettings=function(){this.settings.slideEndAnimation&&(this.settings.hideControlOnEnd=!1),this.settings.closable||(this.settings.swipeToClose=!1),this.zoomFromOrigin=this.settings.zoomFromOrigin,this.settings.dynamic&&(this.zoomFromOrigin=!1),this.settings.container||(this.settings.container=document.body),this.settings.preload=Math.min(this.settings.preload,this.galleryItems.length)},Q.prototype.init=function(){var E=this;this.addSlideVideoInfo(this.galleryItems),this.buildStructure(),this.LGel.trigger(Lt.init,{instance:this}),this.settings.keyPress&&this.keyPress(),setTimeout(function(){E.enableDrag(),E.enableSwipe(),E.triggerPosterClick()},50),this.arrow(),this.settings.mousewheel&&this.mousewheel(),this.settings.dynamic||this.openGalleryOnItemClick()},Q.prototype.openGalleryOnItemClick=function(){for(var E=this,O=function(ie){var fe=q.items[ie],h=We(fe),Pe=Dh.generateUUID();h.attr("data-lg-id",Pe).on("click.lgcustom-item-"+Pe,function(Ze){Ze.preventDefault();var Je=E.settings.index||ie;E.openGallery(Je,fe)})},q=this,X=0;X<this.items.length;X++)O(X)},Q.prototype.buildModules=function(){var E=this;this.settings.plugins.forEach(function(O){E.plugins.push(new O(E,We))})},Q.prototype.validateLicense=function(){this.settings.licenseKey?this.settings.licenseKey==="0000-0000-000-0000"&&console.warn("lightGallery: "+this.settings.licenseKey+" license key is not valid for production use"):console.error("Please provide a valid license key")},Q.prototype.getSlideItem=function(E){return We(this.getSlideItemId(E))},Q.prototype.getSlideItemId=function(E){return"#lg-item-"+this.lgId+"-"+E},Q.prototype.getIdName=function(E){return E+"-"+this.lgId},Q.prototype.getElementById=function(E){return We("#"+this.getIdName(E))},Q.prototype.manageSingleSlideClassName=function(){this.galleryItems.length<2?this.outer.addClass("lg-single-item"):this.outer.removeClass("lg-single-item")},Q.prototype.buildStructure=function(){var E=this,O=this.$container&&this.$container.get();if(!O){var q="",X="";this.settings.controls&&(q='<button type="button" id="'+this.getIdName("lg-prev")+'" aria-label="'+this.settings.strings.previousSlide+'" class="lg-prev lg-icon"> '+this.settings.prevHtml+` </button>
                <button type="button" id="`+this.getIdName("lg-next")+'" aria-label="'+this.settings.strings.nextSlide+'" class="lg-next lg-icon"> '+this.settings.nextHtml+" </button>"),this.settings.appendSubHtmlTo!==".lg-item"&&(X='<div class="lg-sub-html" role="status" aria-live="polite"></div>');var ie="";this.settings.allowMediaOverlap&&(ie+="lg-media-overlap ");var fe=this.settings.ariaLabelledby?'aria-labelledby="'+this.settings.ariaLabelledby+'"':"",h=this.settings.ariaDescribedby?'aria-describedby="'+this.settings.ariaDescribedby+'"':"",Pe="lg-container "+this.settings.addClass+" "+(document.body!==this.settings.container?"lg-inline":""),Ze=this.settings.closable&&this.settings.showCloseIcon?'<button type="button" aria-label="'+this.settings.strings.closeGallery+'" id="'+this.getIdName("lg-close")+'" class="lg-close lg-icon"></button>':"",Je=this.settings.showMaximizeIcon?'<button type="button" aria-label="'+this.settings.strings.toggleMaximize+'" id="'+this.getIdName("lg-maximize")+'" class="lg-maximize lg-icon"></button>':"",Re=`
        <div class="`+Pe+'" id="'+this.getIdName("lg-container")+'" tabindex="-1" aria-modal="true" '+fe+" "+h+` role="dialog"
        >
            <div id="`+this.getIdName("lg-backdrop")+`" class="lg-backdrop"></div>

            <div id="`+this.getIdName("lg-outer")+'" class="lg-outer lg-use-css3 lg-css3 lg-hide-items '+ie+` ">

              <div id="`+this.getIdName("lg-content")+`" class="lg-content">
                <div id="`+this.getIdName("lg-inner")+`" class="lg-inner">
                </div>
                `+q+`
              </div>
                <div id="`+this.getIdName("lg-toolbar")+`" class="lg-toolbar lg-group">
                    `+Je+`
                    `+Ze+`
                    </div>
                    `+(this.settings.appendSubHtmlTo===".lg-outer"?X:"")+`
                <div id="`+this.getIdName("lg-components")+`" class="lg-components">
                    `+(this.settings.appendSubHtmlTo===".lg-sub-html"?X:"")+`
                </div>
            </div>
        </div>
        `;We(this.settings.container).append(Re),document.body!==this.settings.container&&We(this.settings.container).css("position","relative"),this.outer=this.getElementById("lg-outer"),this.$lgComponents=this.getElementById("lg-components"),this.$backdrop=this.getElementById("lg-backdrop"),this.$container=this.getElementById("lg-container"),this.$inner=this.getElementById("lg-inner"),this.$content=this.getElementById("lg-content"),this.$toolbar=this.getElementById("lg-toolbar"),this.$backdrop.css("transition-duration",this.settings.backdropDuration+"ms");var re=this.settings.mode+" ";this.manageSingleSlideClassName(),this.settings.enableDrag&&(re+="lg-grab "),this.outer.addClass(re),this.$inner.css("transition-timing-function",this.settings.easing),this.$inner.css("transition-duration",this.settings.speed+"ms"),this.settings.download&&this.$toolbar.append('<a id="'+this.getIdName("lg-download")+'" target="_blank" rel="noopener" aria-label="'+this.settings.strings.download+'" download class="lg-download lg-icon"></a>'),this.counter(),We(window).on("resize.lg.global"+this.lgId+" orientationchange.lg.global"+this.lgId,function(){E.refreshOnResize()}),this.hideBars(),this.manageCloseGallery(),this.toggleMaximize(),this.initModules()}},Q.prototype.refreshOnResize=function(){if(this.lgOpened){var E=this.galleryItems[this.index],O=E.__slideVideoInfo;this.mediaContainerPosition=this.getMediaContainerPosition();var q=this.mediaContainerPosition,X=q.top,ie=q.bottom;if(this.currentImageSize=yi.getSize(this.items[this.index],this.outer,X+ie,O&&this.settings.videoMaxSize),O&&this.resizeVideoSlide(this.index,this.currentImageSize),this.zoomFromOrigin&&!this.isDummyImageRemoved){var fe=this.getDummyImgStyles(this.currentImageSize);this.outer.find(".lg-current .lg-dummy-img").first().attr("style",fe)}this.LGel.trigger(Lt.containerResize)}},Q.prototype.resizeVideoSlide=function(E,O){var q=this.getVideoContStyle(O),X=this.getSlideItem(E);X.find(".lg-video-cont").attr("style",q)},Q.prototype.updateSlides=function(E,O){if(this.index>E.length-1&&(this.index=E.length-1),E.length===1&&(this.index=0),!E.length){this.closeGallery();return}var q=this.galleryItems[O].src;this.galleryItems=E,this.updateControls(),this.$inner.empty(),this.currentItemsInDom=[];var X=0;this.galleryItems.some(function(ie,fe){return ie.src===q?(X=fe,!0):!1}),this.currentItemsInDom=this.organizeSlideItems(X,-1),this.loadContent(X,!0),this.getSlideItem(X).addClass("lg-current"),this.index=X,this.updateCurrentCounter(X),this.LGel.trigger(Lt.updateSlides)},Q.prototype.getItems=function(){if(this.items=[],this.settings.dynamic)return this.settings.dynamicEl||[];if(this.settings.selector==="this")this.items.push(this.el);else if(this.settings.selector)if(typeof this.settings.selector=="string")if(this.settings.selectWithin){var E=We(this.settings.selectWithin);this.items=E.find(this.settings.selector).get()}else this.items=this.el.querySelectorAll(this.settings.selector);else this.items=this.settings.selector;else this.items=this.el.children;return yi.getDynamicOptions(this.items,this.settings.extraProps,this.settings.getCaptionFromTitleOrAlt,this.settings.exThumbImage)},Q.prototype.shouldHideScrollbar=function(){return this.settings.hideScrollbar&&document.body===this.settings.container},Q.prototype.hideScrollbar=function(){if(!!this.shouldHideScrollbar()){this.bodyPaddingRight=parseFloat(We("body").style().paddingRight);var E=document.documentElement.getBoundingClientRect(),O=window.innerWidth-E.width;We(document.body).css("padding-right",O+this.bodyPaddingRight+"px"),We(document.body).addClass("lg-overlay-open")}},Q.prototype.resetScrollBar=function(){!this.shouldHideScrollbar()||(We(document.body).css("padding-right",this.bodyPaddingRight+"px"),We(document.body).removeClass("lg-overlay-open"))},Q.prototype.openGallery=function(E,O){var q=this;if(E===void 0&&(E=this.settings.index),!this.lgOpened){this.lgOpened=!0,this.outer.removeClass("lg-hide-items"),this.hideScrollbar(),this.$container.addClass("lg-show");var X=this.getItemsToBeInsertedToDom(E,E);this.currentItemsInDom=X;var ie="";X.forEach(function(re){ie=ie+('<div id="'+re+'" class="lg-item"></div>')}),this.$inner.append(ie),this.addHtml(E);var fe="";this.mediaContainerPosition=this.getMediaContainerPosition();var h=this.mediaContainerPosition,Pe=h.top,Ze=h.bottom;this.settings.allowMediaOverlap||this.setMediaContainerPosition(Pe,Ze);var Je=this.galleryItems[E].__slideVideoInfo;this.zoomFromOrigin&&O&&(this.currentImageSize=yi.getSize(O,this.outer,Pe+Ze,Je&&this.settings.videoMaxSize),fe=yi.getTransform(O,this.outer,Pe,Ze,this.currentImageSize)),(!this.zoomFromOrigin||!fe)&&(this.outer.addClass(this.settings.startClass),this.getSlideItem(E).removeClass("lg-complete"));var Re=this.settings.zoomFromOrigin?100:this.settings.backdropDuration;setTimeout(function(){q.outer.addClass("lg-components-open")},Re),this.index=E,this.LGel.trigger(Lt.beforeOpen),this.getSlideItem(E).addClass("lg-current"),this.lGalleryOn=!1,this.prevScrollTop=We(window).scrollTop(),setTimeout(function(){if(q.zoomFromOrigin&&fe){var re=q.getSlideItem(E);re.css("transform",fe),setTimeout(function(){re.addClass("lg-start-progress lg-start-end-progress").css("transition-duration",q.settings.startAnimationDuration+"ms"),q.outer.addClass("lg-zoom-from-image")}),setTimeout(function(){re.css("transform","translate3d(0, 0, 0)")},100)}setTimeout(function(){q.$backdrop.addClass("in"),q.$container.addClass("lg-show-in")},10),setTimeout(function(){q.settings.trapFocus&&document.body===q.settings.container&&q.trapFocus()},q.settings.backdropDuration+50),(!q.zoomFromOrigin||!fe)&&setTimeout(function(){q.outer.addClass("lg-visible")},q.settings.backdropDuration),q.slide(E,!1,!1,!1),q.LGel.trigger(Lt.afterOpen)}),document.body===this.settings.container&&We("html").addClass("lg-on")}},Q.prototype.getMediaContainerPosition=function(){if(this.settings.allowMediaOverlap)return{top:0,bottom:0};var E=this.$toolbar.get().clientHeight||0,O=this.outer.find(".lg-components .lg-sub-html").get(),q=this.settings.defaultCaptionHeight||O&&O.clientHeight||0,X=this.outer.find(".lg-thumb-outer").get(),ie=X?X.clientHeight:0,fe=ie+q;return{top:E,bottom:fe}},Q.prototype.setMediaContainerPosition=function(E,O){E===void 0&&(E=0),O===void 0&&(O=0),this.$content.css("top",E+"px").css("bottom",O+"px")},Q.prototype.hideBars=function(){var E=this;setTimeout(function(){E.outer.removeClass("lg-hide-items"),E.settings.hideBarsDelay>0&&(E.outer.on("mousemove.lg click.lg touchstart.lg",function(){E.outer.removeClass("lg-hide-items"),clearTimeout(E.hideBarTimeout),E.hideBarTimeout=setTimeout(function(){E.outer.addClass("lg-hide-items")},E.settings.hideBarsDelay)}),E.outer.trigger("mousemove.lg"))},this.settings.showBarsAfter)},Q.prototype.initPictureFill=function(E){if(this.settings.supportLegacyBrowser)try{picturefill({elements:[E.get()]})}catch{console.warn("lightGallery :- If you want srcset or picture tag to be supported for older browser please include picturefil javascript library in your document.")}},Q.prototype.counter=function(){if(this.settings.counter){var E=`<div class="lg-counter" role="status" aria-live="polite">
                <span id="`+this.getIdName("lg-counter-current")+'" class="lg-counter-current">'+(this.index+1)+` </span> /
                <span id="`+this.getIdName("lg-counter-all")+'" class="lg-counter-all">'+this.galleryItems.length+" </span></div>";this.outer.find(this.settings.appendCounterTo).append(E)}},Q.prototype.addHtml=function(E){var O,q;if(this.galleryItems[E].subHtmlUrl?q=this.galleryItems[E].subHtmlUrl:O=this.galleryItems[E].subHtml,!q)if(O){var X=O.substring(0,1);(X==="."||X==="#")&&(this.settings.subHtmlSelectorRelative&&!this.settings.dynamic?O=We(this.items).eq(E).find(O).first().html():O=We(O).first().html())}else O="";if(this.settings.appendSubHtmlTo!==".lg-item")q?this.outer.find(".lg-sub-html").load(q):this.outer.find(".lg-sub-html").html(O);else{var ie=We(this.getSlideItemId(E));q?ie.load(q):ie.append('<div class="lg-sub-html">'+O+"</div>")}typeof O<"u"&&O!==null&&(O===""?this.outer.find(this.settings.appendSubHtmlTo).addClass("lg-empty-html"):this.outer.find(this.settings.appendSubHtmlTo).removeClass("lg-empty-html")),this.LGel.trigger(Lt.afterAppendSubHtml,{index:E})},Q.prototype.preload=function(E){for(var O=1;O<=this.settings.preload&&!(O>=this.galleryItems.length-E);O++)this.loadContent(E+O,!1);for(var q=1;q<=this.settings.preload&&!(E-q<0);q++)this.loadContent(E-q,!1)},Q.prototype.getDummyImgStyles=function(E){return E?"width:"+E.width+`px;
                margin-left: -`+E.width/2+`px;
                margin-top: -`+E.height/2+`px;
                height:`+E.height+"px":""},Q.prototype.getVideoContStyle=function(E){return E?"width:"+E.width+`px;
                height:`+E.height+"px":""},Q.prototype.getDummyImageContent=function(E,O,q){var X;if(this.settings.dynamic||(X=We(this.items).eq(O)),X){var ie=void 0;if(this.settings.exThumbImage?ie=X.attr(this.settings.exThumbImage):ie=X.find("img").first().attr("src"),!ie)return"";var fe=this.getDummyImgStyles(this.currentImageSize),h="<img "+q+' style="'+fe+'" class="lg-dummy-img" src="'+ie+'" />';return E.addClass("lg-first-slide"),this.outer.addClass("lg-first-slide-loading"),h}return""},Q.prototype.setImgMarkup=function(E,O,q){var X=this.galleryItems[q],ie=X.alt,fe=X.srcset,h=X.sizes,Pe=X.sources,Ze="",Je=ie?'alt="'+ie+'"':"";this.isFirstSlideWithZoomAnimation()?Ze=this.getDummyImageContent(O,q,Je):Ze=yi.getImgMarkup(q,E,Je,fe,h,Pe);var Re='<picture class="lg-img-wrap"> '+Ze+"</picture>";O.prepend(Re)},Q.prototype.onSlideObjectLoad=function(E,O,q,X){var ie=E.find(".lg-object").first();yi.isImageLoaded(ie.get())||O?q():(ie.on("load.lg error.lg",function(){q&&q()}),ie.on("error.lg",function(){X&&X()}))},Q.prototype.onLgObjectLoad=function(E,O,q,X,ie,fe){var h=this;this.onSlideObjectLoad(E,fe,function(){h.triggerSlideItemLoad(E,O,q,X,ie)},function(){E.addClass("lg-complete lg-complete_"),E.html('<span class="lg-error-msg">Oops... Failed to load content...</span>')})},Q.prototype.triggerSlideItemLoad=function(E,O,q,X,ie){var fe=this,h=this.galleryItems[O],Pe=ie&&this.getSlideType(h)==="video"&&!h.poster?X:0;setTimeout(function(){E.addClass("lg-complete lg-complete_"),fe.LGel.trigger(Lt.slideItemLoad,{index:O,delay:q||0,isFirstSlide:ie})},Pe)},Q.prototype.isFirstSlideWithZoomAnimation=function(){return!!(!this.lGalleryOn&&this.zoomFromOrigin&&this.currentImageSize)},Q.prototype.addSlideVideoInfo=function(E){var O=this;E.forEach(function(q,X){q.__slideVideoInfo=yi.isVideo(q.src,!!q.video,X),q.__slideVideoInfo&&O.settings.loadYouTubePoster&&!q.poster&&q.__slideVideoInfo.youtube&&(q.poster="//img.youtube.com/vi/"+q.__slideVideoInfo.youtube[1]+"/maxresdefault.jpg")})},Q.prototype.loadContent=function(E,O){var q=this,X=this.galleryItems[E],ie=We(this.getSlideItemId(E)),fe=X.poster,h=X.srcset,Pe=X.sizes,Ze=X.sources,Je=X.src,Re=X.video,re=Re&&typeof Re=="string"?JSON.parse(Re):Re;if(X.responsive){var Bt=X.responsive.split(",");Je=yi.getResponsiveSrc(Bt)||Je}var _t=X.__slideVideoInfo,dt="",si=!!X.iframe,ti=!this.lGalleryOn,qt=0;if(ti&&(this.zoomFromOrigin&&this.currentImageSize?qt=this.settings.startAnimationDuration+10:qt=this.settings.backdropDuration+10),!ie.hasClass("lg-loaded")){if(_t){var oi=this.mediaContainerPosition,Gr=oi.top,Rt=oi.bottom,Fi=yi.getSize(this.items[E],this.outer,Gr+Rt,_t&&this.settings.videoMaxSize);dt=this.getVideoContStyle(Fi)}if(si){var _i=yi.getIframeMarkup(this.settings.iframeWidth,this.settings.iframeHeight,this.settings.iframeMaxWidth,this.settings.iframeMaxHeight,Je,X.iframeTitle);ie.prepend(_i)}else if(fe){var di="",hn=ti&&this.zoomFromOrigin&&this.currentImageSize;hn&&(di=this.getDummyImageContent(ie,E,""));var _i=yi.getVideoPosterMarkup(fe,di||"",dt,this.settings.strings.playVideo,_t);ie.prepend(_i)}else if(_t){var _i='<div class="lg-video-cont " style="'+dt+'"></div>';ie.prepend(_i)}else if(this.setImgMarkup(Je,ie,E),h||Ze){var qi=ie.find(".lg-object");this.initPictureFill(qi)}(fe||_t)&&this.LGel.trigger(Lt.hasVideo,{index:E,src:Je,html5Video:re,hasPoster:!!fe}),this.LGel.trigger(Lt.afterAppendSlide,{index:E}),this.lGalleryOn&&this.settings.appendSubHtmlTo===".lg-item"&&this.addHtml(E)}var Ei=0;qt&&!We(document.body).hasClass("lg-from-hash")&&(Ei=qt),this.isFirstSlideWithZoomAnimation()&&(setTimeout(function(){ie.removeClass("lg-start-end-progress lg-start-progress").removeAttr("style")},this.settings.startAnimationDuration+100),ie.hasClass("lg-loaded")||setTimeout(function(){if(q.getSlideType(X)==="image"){var Oi=X.alt,Ir=Oi?'alt="'+Oi+'"':"";if(ie.find(".lg-img-wrap").append(yi.getImgMarkup(E,Je,Ir,h,Pe,X.sources)),h||Ze){var er=ie.find(".lg-object");q.initPictureFill(er)}}(q.getSlideType(X)==="image"||q.getSlideType(X)==="video"&&fe)&&(q.onLgObjectLoad(ie,E,qt,Ei,!0,!1),q.onSlideObjectLoad(ie,!!(_t&&_t.html5&&!fe),function(){q.loadContentOnFirstSlideLoad(E,ie,Ei)},function(){q.loadContentOnFirstSlideLoad(E,ie,Ei)}))},this.settings.startAnimationDuration+100)),ie.addClass("lg-loaded"),(!this.isFirstSlideWithZoomAnimation()||this.getSlideType(X)==="video"&&!fe)&&this.onLgObjectLoad(ie,E,qt,Ei,ti,!!(_t&&_t.html5&&!fe)),(!this.zoomFromOrigin||!this.currentImageSize)&&ie.hasClass("lg-complete_")&&!this.lGalleryOn&&setTimeout(function(){ie.addClass("lg-complete")},this.settings.backdropDuration),this.lGalleryOn=!0,O===!0&&(ie.hasClass("lg-complete_")?this.preload(E):ie.find(".lg-object").first().on("load.lg error.lg",function(){q.preload(E)}))},Q.prototype.loadContentOnFirstSlideLoad=function(E,O,q){var X=this;setTimeout(function(){O.find(".lg-dummy-img").remove(),O.removeClass("lg-first-slide"),X.outer.removeClass("lg-first-slide-loading"),X.isDummyImageRemoved=!0,X.preload(E)},q+300)},Q.prototype.getItemsToBeInsertedToDom=function(E,O,q){var X=this;q===void 0&&(q=0);var ie=[],fe=Math.max(q,3);fe=Math.min(fe,this.galleryItems.length);var h="lg-item-"+this.lgId+"-"+O;if(this.galleryItems.length<=3)return this.galleryItems.forEach(function(Je,Re){ie.push("lg-item-"+X.lgId+"-"+Re)}),ie;if(E<(this.galleryItems.length-1)/2){for(var Pe=E;Pe>E-fe/2&&Pe>=0;Pe--)ie.push("lg-item-"+this.lgId+"-"+Pe);for(var Ze=ie.length,Pe=0;Pe<fe-Ze;Pe++)ie.push("lg-item-"+this.lgId+"-"+(E+Pe+1))}else{for(var Pe=E;Pe<=this.galleryItems.length-1&&Pe<E+fe/2;Pe++)ie.push("lg-item-"+this.lgId+"-"+Pe);for(var Ze=ie.length,Pe=0;Pe<fe-Ze;Pe++)ie.push("lg-item-"+this.lgId+"-"+(E-Pe-1))}return this.settings.loop&&(E===this.galleryItems.length-1?ie.push("lg-item-"+this.lgId+"-"+0):E===0&&ie.push("lg-item-"+this.lgId+"-"+(this.galleryItems.length-1))),ie.indexOf(h)===-1&&ie.push("lg-item-"+this.lgId+"-"+O),ie},Q.prototype.organizeSlideItems=function(E,O){var q=this,X=this.getItemsToBeInsertedToDom(E,O,this.settings.numberOfSlideItemsInDom);return X.forEach(function(ie){q.currentItemsInDom.indexOf(ie)===-1&&q.$inner.append('<div id="'+ie+'" class="lg-item"></div>')}),this.currentItemsInDom.forEach(function(ie){X.indexOf(ie)===-1&&We("#"+ie).remove()}),X},Q.prototype.getPreviousSlideIndex=function(){var E=0;try{var O=this.outer.find(".lg-current").first().attr("id");E=parseInt(O.split("-")[3])||0}catch{E=0}return E},Q.prototype.setDownloadValue=function(E){if(this.settings.download){var O=this.galleryItems[E],q=O.downloadUrl===!1||O.downloadUrl==="false";if(q)this.outer.addClass("lg-hide-download");else{var X=this.getElementById("lg-download");this.outer.removeClass("lg-hide-download"),X.attr("href",O.downloadUrl||O.src),O.download&&X.attr("download",O.download)}}},Q.prototype.makeSlideAnimation=function(E,O,q){var X=this;this.lGalleryOn&&q.addClass("lg-slide-progress"),setTimeout(function(){X.outer.addClass("lg-no-trans"),X.outer.find(".lg-item").removeClass("lg-prev-slide lg-next-slide"),E==="prev"?(O.addClass("lg-prev-slide"),q.addClass("lg-next-slide")):(O.addClass("lg-next-slide"),q.addClass("lg-prev-slide")),setTimeout(function(){X.outer.find(".lg-item").removeClass("lg-current"),O.addClass("lg-current"),X.outer.removeClass("lg-no-trans")},50)},this.lGalleryOn?this.settings.slideDelay:0)},Q.prototype.slide=function(E,O,q,X){var ie=this,fe=this.getPreviousSlideIndex();if(this.currentItemsInDom=this.organizeSlideItems(E,fe),!(this.lGalleryOn&&fe===E)){var h=this.galleryItems.length;if(!this.lgBusy){this.settings.counter&&this.updateCurrentCounter(E);var Pe=this.getSlideItem(E),Ze=this.getSlideItem(fe),Je=this.galleryItems[E],Re=Je.__slideVideoInfo;if(this.outer.attr("data-lg-slide-type",this.getSlideType(Je)),this.setDownloadValue(E),Re){var re=this.mediaContainerPosition,Bt=re.top,_t=re.bottom,dt=yi.getSize(this.items[E],this.outer,Bt+_t,Re&&this.settings.videoMaxSize);this.resizeVideoSlide(E,dt)}if(this.LGel.trigger(Lt.beforeSlide,{prevIndex:fe,index:E,fromTouch:!!O,fromThumb:!!q}),this.lgBusy=!0,clearTimeout(this.hideBarTimeout),this.arrowDisable(E),X||(E<fe?X="prev":E>fe&&(X="next")),!O)this.makeSlideAnimation(X,Pe,Ze);else{this.outer.find(".lg-item").removeClass("lg-prev-slide lg-current lg-next-slide");var si=void 0,ti=void 0;h>2?(si=E-1,ti=E+1,(E===0&&fe===h-1||E===h-1&&fe===0)&&(ti=0,si=h-1)):(si=0,ti=1),X==="prev"?this.getSlideItem(ti).addClass("lg-next-slide"):this.getSlideItem(si).addClass("lg-prev-slide"),Pe.addClass("lg-current")}this.lGalleryOn?setTimeout(function(){ie.loadContent(E,!0),ie.settings.appendSubHtmlTo!==".lg-item"&&ie.addHtml(E)},this.settings.speed+50+(O?0:this.settings.slideDelay)):this.loadContent(E,!0),setTimeout(function(){ie.lgBusy=!1,Ze.removeClass("lg-slide-progress"),ie.LGel.trigger(Lt.afterSlide,{prevIndex:fe,index:E,fromTouch:O,fromThumb:q})},(this.lGalleryOn?this.settings.speed+100:100)+(O?0:this.settings.slideDelay))}this.index=E}},Q.prototype.updateCurrentCounter=function(E){this.getElementById("lg-counter-current").html(E+1+"")},Q.prototype.updateCounterTotal=function(){this.getElementById("lg-counter-all").html(this.galleryItems.length+"")},Q.prototype.getSlideType=function(E){return E.__slideVideoInfo?"video":E.iframe?"iframe":"image"},Q.prototype.touchMove=function(E,O,q){var X=O.pageX-E.pageX,ie=O.pageY-E.pageY,fe=!1;if(this.swipeDirection?fe=!0:Math.abs(X)>15?(this.swipeDirection="horizontal",fe=!0):Math.abs(ie)>15&&(this.swipeDirection="vertical",fe=!0),!!fe){var h=this.getSlideItem(this.index);if(this.swipeDirection==="horizontal"){q==null||q.preventDefault(),this.outer.addClass("lg-dragging"),this.setTranslate(h,X,0);var Pe=h.get().offsetWidth,Ze=Pe*15/100,Je=Ze-Math.abs(X*10/100);this.setTranslate(this.outer.find(".lg-prev-slide").first(),-Pe+X-Je,0),this.setTranslate(this.outer.find(".lg-next-slide").first(),Pe+X+Je,0)}else if(this.swipeDirection==="vertical"&&this.settings.swipeToClose){q==null||q.preventDefault(),this.$container.addClass("lg-dragging-vertical");var Re=1-Math.abs(ie)/window.innerHeight;this.$backdrop.css("opacity",Re);var re=1-Math.abs(ie)/(window.innerWidth*2);this.setTranslate(h,0,ie,re,re),Math.abs(ie)>100&&this.outer.addClass("lg-hide-items").removeClass("lg-components-open")}}},Q.prototype.touchEnd=function(E,O,q){var X=this,ie;this.settings.mode!=="lg-slide"&&this.outer.addClass("lg-slide"),setTimeout(function(){X.$container.removeClass("lg-dragging-vertical"),X.outer.removeClass("lg-dragging lg-hide-items").addClass("lg-components-open");var fe=!0;if(X.swipeDirection==="horizontal"){ie=E.pageX-O.pageX;var h=Math.abs(E.pageX-O.pageX);ie<0&&h>X.settings.swipeThreshold?(X.goToNextSlide(!0),fe=!1):ie>0&&h>X.settings.swipeThreshold&&(X.goToPrevSlide(!0),fe=!1)}else if(X.swipeDirection==="vertical")if(ie=Math.abs(E.pageY-O.pageY),X.settings.closable&&X.settings.swipeToClose&&ie>100){X.closeGallery();return}else X.$backdrop.css("opacity",1);if(X.outer.find(".lg-item").removeAttr("style"),fe&&Math.abs(E.pageX-O.pageX)<5){var Pe=We(q.target);X.isPosterElement(Pe)&&X.LGel.trigger(Lt.posterClick)}X.swipeDirection=void 0}),setTimeout(function(){!X.outer.hasClass("lg-dragging")&&X.settings.mode!=="lg-slide"&&X.outer.removeClass("lg-slide")},this.settings.speed+100)},Q.prototype.enableSwipe=function(){var E=this,O={},q={},X=!1,ie=!1;this.settings.enableSwipe&&(this.$inner.on("touchstart.lg",function(fe){E.dragOrSwipeEnabled=!0;var h=E.getSlideItem(E.index);(We(fe.target).hasClass("lg-item")||h.get().contains(fe.target))&&!E.outer.hasClass("lg-zoomed")&&!E.lgBusy&&fe.touches.length===1&&(ie=!0,E.touchAction="swipe",E.manageSwipeClass(),O={pageX:fe.touches[0].pageX,pageY:fe.touches[0].pageY})}),this.$inner.on("touchmove.lg",function(fe){ie&&E.touchAction==="swipe"&&fe.touches.length===1&&(q={pageX:fe.touches[0].pageX,pageY:fe.touches[0].pageY},E.touchMove(O,q,fe),X=!0)}),this.$inner.on("touchend.lg",function(fe){if(E.touchAction==="swipe"){if(X)X=!1,E.touchEnd(q,O,fe);else if(ie){var h=We(fe.target);E.isPosterElement(h)&&E.LGel.trigger(Lt.posterClick)}E.touchAction=void 0,ie=!1}}))},Q.prototype.enableDrag=function(){var E=this,O={},q={},X=!1,ie=!1;this.settings.enableDrag&&(this.outer.on("mousedown.lg",function(fe){E.dragOrSwipeEnabled=!0;var h=E.getSlideItem(E.index);(We(fe.target).hasClass("lg-item")||h.get().contains(fe.target))&&!E.outer.hasClass("lg-zoomed")&&!E.lgBusy&&(fe.preventDefault(),E.lgBusy||(E.manageSwipeClass(),O={pageX:fe.pageX,pageY:fe.pageY},X=!0,E.outer.get().scrollLeft+=1,E.outer.get().scrollLeft-=1,E.outer.removeClass("lg-grab").addClass("lg-grabbing"),E.LGel.trigger(Lt.dragStart)))}),We(window).on("mousemove.lg.global"+this.lgId,function(fe){X&&E.lgOpened&&(ie=!0,q={pageX:fe.pageX,pageY:fe.pageY},E.touchMove(O,q),E.LGel.trigger(Lt.dragMove))}),We(window).on("mouseup.lg.global"+this.lgId,function(fe){if(!!E.lgOpened){var h=We(fe.target);ie?(ie=!1,E.touchEnd(q,O,fe),E.LGel.trigger(Lt.dragEnd)):E.isPosterElement(h)&&E.LGel.trigger(Lt.posterClick),X&&(X=!1,E.outer.removeClass("lg-grabbing").addClass("lg-grab"))}}))},Q.prototype.triggerPosterClick=function(){var E=this;this.$inner.on("click.lg",function(O){!E.dragOrSwipeEnabled&&E.isPosterElement(We(O.target))&&E.LGel.trigger(Lt.posterClick)})},Q.prototype.manageSwipeClass=function(){var E=this.index+1,O=this.index-1;this.settings.loop&&this.galleryItems.length>2&&(this.index===0?O=this.galleryItems.length-1:this.index===this.galleryItems.length-1&&(E=0)),this.outer.find(".lg-item").removeClass("lg-next-slide lg-prev-slide"),O>-1&&this.getSlideItem(O).addClass("lg-prev-slide"),this.getSlideItem(E).addClass("lg-next-slide")},Q.prototype.goToNextSlide=function(E){var O=this,q=this.settings.loop;E&&this.galleryItems.length<3&&(q=!1),this.lgBusy||(this.index+1<this.galleryItems.length?(this.index++,this.LGel.trigger(Lt.beforeNextSlide,{index:this.index}),this.slide(this.index,!!E,!1,"next")):q?(this.index=0,this.LGel.trigger(Lt.beforeNextSlide,{index:this.index}),this.slide(this.index,!!E,!1,"next")):this.settings.slideEndAnimation&&!E&&(this.outer.addClass("lg-right-end"),setTimeout(function(){O.outer.removeClass("lg-right-end")},400)))},Q.prototype.goToPrevSlide=function(E){var O=this,q=this.settings.loop;E&&this.galleryItems.length<3&&(q=!1),this.lgBusy||(this.index>0?(this.index--,this.LGel.trigger(Lt.beforePrevSlide,{index:this.index,fromTouch:E}),this.slide(this.index,!!E,!1,"prev")):q?(this.index=this.galleryItems.length-1,this.LGel.trigger(Lt.beforePrevSlide,{index:this.index,fromTouch:E}),this.slide(this.index,!!E,!1,"prev")):this.settings.slideEndAnimation&&!E&&(this.outer.addClass("lg-left-end"),setTimeout(function(){O.outer.removeClass("lg-left-end")},400)))},Q.prototype.keyPress=function(){var E=this;We(window).on("keydown.lg.global"+this.lgId,function(O){E.lgOpened&&E.settings.escKey===!0&&O.keyCode===27&&(O.preventDefault(),E.settings.allowMediaOverlap&&E.outer.hasClass("lg-can-toggle")&&E.outer.hasClass("lg-components-open")?E.outer.removeClass("lg-components-open"):E.closeGallery()),E.lgOpened&&E.galleryItems.length>1&&(O.keyCode===37&&(O.preventDefault(),E.goToPrevSlide()),O.keyCode===39&&(O.preventDefault(),E.goToNextSlide()))})},Q.prototype.arrow=function(){var E=this;this.getElementById("lg-prev").on("click.lg",function(){E.goToPrevSlide()}),this.getElementById("lg-next").on("click.lg",function(){E.goToNextSlide()})},Q.prototype.arrowDisable=function(E){if(!this.settings.loop&&this.settings.hideControlOnEnd){var O=this.getElementById("lg-prev"),q=this.getElementById("lg-next");E+1===this.galleryItems.length?q.attr("disabled","disabled").addClass("disabled"):q.removeAttr("disabled").removeClass("disabled"),E===0?O.attr("disabled","disabled").addClass("disabled"):O.removeAttr("disabled").removeClass("disabled")}},Q.prototype.setTranslate=function(E,O,q,X,ie){X===void 0&&(X=1),ie===void 0&&(ie=1),E.css("transform","translate3d("+O+"px, "+q+"px, 0px) scale3d("+X+", "+ie+", 1)")},Q.prototype.mousewheel=function(){var E=this,O=0;this.outer.on("wheel.lg",function(q){if(!(!q.deltaY||E.galleryItems.length<2)){q.preventDefault();var X=new Date().getTime();X-O<1e3||(O=X,q.deltaY>0?E.goToNextSlide():q.deltaY<0&&E.goToPrevSlide())}})},Q.prototype.isSlideElement=function(E){return E.hasClass("lg-outer")||E.hasClass("lg-item")||E.hasClass("lg-img-wrap")},Q.prototype.isPosterElement=function(E){var O=this.getSlideItem(this.index).find(".lg-video-play-button").get();return E.hasClass("lg-video-poster")||E.hasClass("lg-video-play-button")||O&&O.contains(E.get())},Q.prototype.toggleMaximize=function(){var E=this;this.getElementById("lg-maximize").on("click.lg",function(){E.$container.toggleClass("lg-inline"),E.refreshOnResize()})},Q.prototype.invalidateItems=function(){for(var E=0;E<this.items.length;E++){var O=this.items[E],q=We(O);q.off("click.lgcustom-item-"+q.attr("data-lg-id"))}},Q.prototype.trapFocus=function(){var E=this;this.$container.get().focus({preventScroll:!0}),We(window).on("keydown.lg.global"+this.lgId,function(O){if(!!E.lgOpened){var q=O.key==="Tab"||O.keyCode===9;if(!!q){var X=yi.getFocusableElements(E.$container.get()),ie=X[0],fe=X[X.length-1];O.shiftKey?document.activeElement===ie&&(fe.focus(),O.preventDefault()):document.activeElement===fe&&(ie.focus(),O.preventDefault())}}})},Q.prototype.manageCloseGallery=function(){var E=this;if(!!this.settings.closable){var O=!1;this.getElementById("lg-close").on("click.lg",function(){E.closeGallery()}),this.settings.closeOnTap&&(this.outer.on("mousedown.lg",function(q){var X=We(q.target);E.isSlideElement(X)?O=!0:O=!1}),this.outer.on("mousemove.lg",function(){O=!1}),this.outer.on("mouseup.lg",function(q){var X=We(q.target);E.isSlideElement(X)&&O&&(E.outer.hasClass("lg-dragging")||E.closeGallery())}))}},Q.prototype.closeGallery=function(E){var O=this;if(!this.lgOpened||!this.settings.closable&&!E)return 0;this.LGel.trigger(Lt.beforeClose),this.settings.resetScrollPosition&&!this.settings.hideScrollbar&&We(window).scrollTop(this.prevScrollTop);var q=this.items[this.index],X;if(this.zoomFromOrigin&&q){var ie=this.mediaContainerPosition,fe=ie.top,h=ie.bottom,Pe=this.galleryItems[this.index],Ze=Pe.__slideVideoInfo,Je=Pe.poster,Re=yi.getSize(q,this.outer,fe+h,Ze&&Je&&this.settings.videoMaxSize);X=yi.getTransform(q,this.outer,fe,h,Re)}this.zoomFromOrigin&&X?(this.outer.addClass("lg-closing lg-zoom-from-image"),this.getSlideItem(this.index).addClass("lg-start-end-progress").css("transition-duration",this.settings.startAnimationDuration+"ms").css("transform",X)):(this.outer.addClass("lg-hide-items"),this.outer.removeClass("lg-zoom-from-image")),this.destroyModules(),this.lGalleryOn=!1,this.isDummyImageRemoved=!1,this.zoomFromOrigin=this.settings.zoomFromOrigin,clearTimeout(this.hideBarTimeout),this.hideBarTimeout=!1,We("html").removeClass("lg-on"),this.outer.removeClass("lg-visible lg-components-open"),this.$backdrop.removeClass("in").css("opacity",0);var re=this.zoomFromOrigin&&X?Math.max(this.settings.startAnimationDuration,this.settings.backdropDuration):this.settings.backdropDuration;return this.$container.removeClass("lg-show-in"),setTimeout(function(){O.zoomFromOrigin&&X&&O.outer.removeClass("lg-zoom-from-image"),O.$container.removeClass("lg-show"),O.resetScrollBar(),O.$backdrop.removeAttr("style").css("transition-duration",O.settings.backdropDuration+"ms"),O.outer.removeClass("lg-closing "+O.settings.startClass),O.getSlideItem(O.index).removeClass("lg-start-end-progress"),O.$inner.empty(),O.lgOpened&&O.LGel.trigger(Lt.afterClose,{instance:O}),O.$container.get()&&O.$container.get().blur(),O.lgOpened=!1},re+100),re+100},Q.prototype.initModules=function(){this.plugins.forEach(function(E){try{E.init()}catch{console.warn("lightGallery:- make sure lightGallery module is properly initiated")}})},Q.prototype.destroyModules=function(E){this.plugins.forEach(function(O){try{E?O.destroy():O.closeGallery&&O.closeGallery()}catch{console.warn("lightGallery:- make sure lightGallery module is properly destroyed")}})},Q.prototype.refresh=function(E){this.settings.dynamic||this.invalidateItems(),E?this.galleryItems=E:this.galleryItems=this.getItems(),this.updateControls(),this.openGalleryOnItemClick(),this.LGel.trigger(Lt.updateSlides)},Q.prototype.updateControls=function(){this.addSlideVideoInfo(this.galleryItems),this.updateCounterTotal(),this.manageSingleSlideClassName()},Q.prototype.destroyGallery=function(){this.destroyModules(!0),this.settings.dynamic||this.invalidateItems(),We(window).off(".lg.global"+this.lgId),this.LGel.off(".lg"),this.$container.remove()},Q.prototype.destroy=function(){var E=this.closeGallery(!0);return E?setTimeout(this.destroyGallery.bind(this),E):this.destroyGallery(),E},Q}();function Md(Q,E){return new zd(Q,E)}var kd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Lh={exports:{}};(function(Q,E){(function(O,q){Q.exports=q()})(kd,function(){var O,q,X;function ie(h,Pe){if(!O)O=Pe;else if(!q)q=Pe;else{var Ze="var sharedChunk = {}; ("+O+")(sharedChunk); ("+q+")(sharedChunk);",Je={};O(Je),X=Pe(Je),typeof window<"u"&&(X.workerUrl=window.URL.createObjectURL(new Blob([Ze],{type:"text/javascript"})))}}ie(["exports"],function(h){var Pe=Ze;function Ze(i,e,r,s){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(s-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=e,this.p2x=r,this.p2y=s}function Je(i,e,r,s){const l=new Pe(i,e,r,s);return function(u){return l.solve(u)}}Ze.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,e){if(e===void 0&&(e=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,s=0;s<8;s++){var l=this.sampleCurveX(r)-i;if(Math.abs(l)<e)return r;var u=this.sampleCurveDerivativeX(r);if(Math.abs(u)<1e-6)break;r-=l/u}var p=0,f=1;for(r=i,s=0;s<20&&(l=this.sampleCurveX(r),!(Math.abs(l-i)<e));s++)i>l?p=r:f=r,r=.5*(f-p)+p;return r},solve:function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))}};const Re=Je(.25,.1,.25,1);function re(i,e,r){return Math.min(r,Math.max(e,i))}function Bt(i,e,r){const s=r-e,l=((i-e)%s+s)%s+e;return l===e?r:l}function _t(i,...e){for(const r of e)for(const s in r)i[s]=r[s];return i}let dt=1;function si(i,e){i.forEach(r=>{e[r]&&(e[r]=e[r].bind(e))})}function ti(i,e,r){const s={};for(const l in i)s[l]=e.call(r||this,i[l],l,i);return s}function qt(i,e,r){const s={};for(const l in i)e.call(r||this,i[l],l,i)&&(s[l]=i[l]);return s}function oi(i){return Array.isArray(i)?i.map(oi):typeof i=="object"&&i?ti(i,oi):i}const Gr={};function Rt(i){Gr[i]||(typeof console<"u"&&console.warn(i),Gr[i]=!0)}function Fi(i,e,r){return(r.y-i.y)*(e.x-i.x)>(e.y-i.y)*(r.x-i.x)}function _i(i){let e=0;for(let r,s,l=0,u=i.length,p=u-1;l<u;p=l++)r=i[l],s=i[p],e+=(s.x-r.x)*(r.y+s.y);return e}function di(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function hn(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,s,l,u)=>{const p=l||u;return e[s]=!p||p.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let qi,Ei,Oi=null;function Ir(i){if(Oi==null){const e=i.navigator?i.navigator.userAgent:null;Oi=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Oi}function er(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const Er={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(i){const e=requestAnimationFrame(i);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(i,e=0){const r=window.document.createElement("canvas"),s=r.getContext("2d");if(!s)throw new Error("failed to create canvas 2d context");return r.width=i.width,r.height=i.height,s.drawImage(i,0,0,i.width,i.height),s.getImageData(-e,-e,i.width+2*e,i.height+2*e)},resolveURL:i=>(qi||(qi=document.createElement("a")),qi.href=i,qi.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Ei==null&&(Ei=matchMedia("(prefers-reduced-motion: reduce)")),Ei.matches)}};var je=hr;function hr(i,e){this.x=i,this.y=e}hr.prototype={clone:function(){return new hr(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,r=i.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),r=Math.sin(i),s=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=s,this},_rotateAround:function(i,e){var r=Math.cos(i),s=Math.sin(i),l=e.y+s*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-s*(this.y-e.y),this.y=l,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},hr.convert=function(i){return i instanceof hr?i:Array.isArray(i)?new hr(i[0],i[1]):i};const ur={MAX_PARALLEL_IMAGE_REQUESTS:16,REGISTERED_PROTOCOLS:{}},ji="mapbox-tiles";let Zi,qr,un=500,dn=50;function pn(){typeof caches>"u"||Zi||(Zi=caches.open(ji))}let tr=1/0;const Sr={supported:!1,testSupport:function(i){!xi&&Ar&&(mn?Vn(i):Cr=i)}};let Cr,Ar,xi=!1,mn=!1;function Vn(i){const e=i.createTexture();i.bindTexture(i.TEXTURE_2D,e);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,Ar),i.isContextLost())return;Sr.supported=!0}catch{}i.deleteTexture(e),xi=!0}typeof document<"u"&&(Ar=document.createElement("img"),Ar.onload=function(){Cr&&Vn(Cr),Cr=null,mn=!0},Ar.onerror=function(){xi=!0,Cr=null},Ar.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const dr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(dr);class Si extends Error{constructor(e,r,s,l){super(`AJAXError: ${r} (${e}): ${s}`),this.status=e,this.statusText=r,this.url=s,this.body=l}}const Nn=di()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href;function zr(i,e){const r=new AbortController,s=new Request(i.url,{method:i.method||"GET",body:i.body,credentials:i.credentials,headers:i.headers,referrer:Nn(),signal:r.signal});let l=!1,u=!1;return i.type==="json"&&s.headers.set("Accept","application/json"),((p,f,g)=>{if(u)return;const x=Date.now();fetch(s).then(w=>w.ok?((I,A,M)=>{(i.type==="arrayBuffer"?I.arrayBuffer():i.type==="json"?I.json():I.text()).then(k=>{u||(A&&M&&function(N,V,J){if(pn(),!Zi)return;const oe={status:V.status,statusText:V.statusText,headers:new Headers};V.headers.forEach((ne,me)=>oe.headers.set(me,ne));const Y=hn(V.headers.get("Cache-Control")||"");Y["no-store"]||(Y["max-age"]&&oe.headers.set("Expires",new Date(J+1e3*Y["max-age"]).toUTCString()),new Date(oe.headers.get("Expires")).getTime()-J<42e4||function(ne,me){if(qr===void 0)try{new Response(new ReadableStream),qr=!0}catch{qr=!1}qr?me(ne.body):ne.blob().then(me)}(V,ne=>{const me=new Response(ne,oe);pn(),Zi&&Zi.then(pe=>pe.put(function(ke){const Be=ke.indexOf("?");return Be<0?ke:ke.slice(0,Be)}(N.url),me)).catch(pe=>Rt(pe.message))}))}(s,A,M),l=!0,e(null,k,I.headers.get("Cache-Control"),I.headers.get("Expires")))}).catch(k=>{u||e(new Error(k.message))})})(w,null,x):w.blob().then(I=>e(new Si(w.status,w.statusText,i.url,I)))).catch(w=>{w.code!==20&&e(new Error(w.message))})})(),{cancel:()=>{u=!0,l||r.abort()}}}const fn=function(i,e){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){if(di()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e);if(!di()){const s=i.url.substring(0,i.url.indexOf("://"));return(ur.REGISTERED_PROTOCOLS[s]||zr)(i,e)}}if(!(/^file:/.test(r=i.url)||/^file:/.test(Nn())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return zr(i,e);if(di()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var r;return function(s,l){const u=new XMLHttpRequest;u.open(s.method||"GET",s.url,!0),s.type==="arrayBuffer"&&(u.responseType="arraybuffer");for(const p in s.headers)u.setRequestHeader(p,s.headers[p]);return s.type==="json"&&(u.responseType="text",u.setRequestHeader("Accept","application/json")),u.withCredentials=s.credentials==="include",u.onerror=()=>{l(new Error(u.statusText))},u.onload=()=>{if((u.status>=200&&u.status<300||u.status===0)&&u.response!==null){let p=u.response;if(s.type==="json")try{p=JSON.parse(u.response)}catch(f){return l(f)}l(null,p,u.getResponseHeader("Cache-Control"),u.getResponseHeader("Expires"))}else{const p=new Blob([u.response],{type:u.getResponseHeader("Content-Type")});l(new Si(u.status,u.statusText,s.url,p))}},u.send(s.body),{cancel:()=>u.abort()}}(i,e)},gn=function(i,e){return fn(_t(i,{type:"arrayBuffer"}),e)};function $n(i){const e=window.document.createElement("a");return e.href=i,e.protocol===window.document.location.protocol&&e.host===window.document.location.host}const at="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let ir,Mr;ir=[],Mr=0;const kr=function(i,e){if(Sr.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),Mr>=ur.MAX_PARALLEL_IMAGE_REQUESTS){const u={requestParameters:i,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return ir.push(u),u}Mr++;let r=!1;const s=()=>{if(!r)for(r=!0,Mr--;ir.length&&Mr<ur.MAX_PARALLEL_IMAGE_REQUESTS;){const u=ir.shift(),{requestParameters:p,callback:f,cancelled:g}=u;g||(u.cancel=kr(p,f).cancel)}},l=gn(i,(u,p,f,g)=>{s(),u?e(u):p&&function(x,w){typeof createImageBitmap=="function"?function(I,A){const M=new Blob([new Uint8Array(I)],{type:"image/png"});createImageBitmap(M).then(k=>{A(null,k)}).catch(k=>{A(new Error(`Could not load image because of ${k.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(x,w):function(I,A){const M=new Image;M.onload=()=>{A(null,M),URL.revokeObjectURL(M.src),M.onload=null,window.requestAnimationFrame(()=>{M.src=at})},M.onerror=()=>A(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const k=new Blob([new Uint8Array(I)],{type:"image/png"});M.src=I.byteLength?URL.createObjectURL(k):at}(x,w)}(p,(x,w)=>{x!=null?e(x):w!=null&&e(null,w,{cacheControl:f,expires:g})})});return{cancel:()=>{l.cancel(),s()}}};function Gn(i,e,r){r[i]&&r[i].indexOf(e)!==-1||(r[i]=r[i]||[],r[i].push(e))}function pr(i,e,r){if(r&&r[i]){const s=r[i].indexOf(e);s!==-1&&r[i].splice(s,1)}}class mr{constructor(e,r={}){_t(this,r),this.type=e}}class yn extends mr{constructor(e,r={}){super("error",_t({error:e},r))}}class fr{on(e,r){return this._listeners=this._listeners||{},Gn(e,r,this._listeners),this}off(e,r){return pr(e,r,this._listeners),pr(e,r,this._oneTimeListeners),this}once(e,r){return this._oneTimeListeners=this._oneTimeListeners||{},Gn(e,r,this._oneTimeListeners),this}fire(e,r){typeof e=="string"&&(e=new mr(e,r||{}));const s=e.type;if(this.listens(s)){e.target=this;const l=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const f of l)f.call(this,e);const u=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const f of u)pr(s,f,this._oneTimeListeners),f.call(this,e);const p=this._eventedParent;p&&(_t(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),p.fire(e))}else e instanceof yn&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var de={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1},elevationOffset:{type:"number",default:450}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class Te{constructor(e,r,s,l){this.message=(e?`${e}: `:"")+s,l&&(this.identifier=l),r!=null&&r.__line__&&(this.line=r.__line__)}}function jr(i){const e=i.value;return e?[new Te(i.key,e,"constants have been deprecated as of v8")]:[]}function Xi(i,...e){for(const r of e)for(const s in r)i[s]=r[s];return i}function lt(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Ui(i){if(Array.isArray(i))return i.map(Ui);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const r in i)e[r]=Ui(i[r]);return e}return lt(i)}class Ci extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class Ai{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[s,l]of r)this.bindings[s]=l}concat(e){return new Ai(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Pr={kind:"null"},ve={kind:"number"},Qe={kind:"string"},Ke={kind:"boolean"},ii={kind:"color"},Dr={kind:"object"},He={kind:"value"},gr={kind:"collator"},Ht={kind:"formatted"},_n={kind:"padding"},Vt={kind:"resolvedImage"};function pi(i,e){return{kind:"array",itemType:i,N:e}}function xt(i){if(i.kind==="array"){const e=xt(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const xn=[Pr,ve,Qe,Ke,ii,Ht,Dr,pi(He),_n,Vt];function rr(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!rr(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const r of xn)if(!rr(r,e))return null}}return`Expected ${xt(i)} but found ${xt(e)} instead.`}function Zr(i,e){return e.some(r=>r.kind===i.kind)}function Xr(i,e){return e.some(r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i)}var vn,Hr={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function L(i){return(i=Math.round(i))<0?0:i>255?255:i}function b(i){return L(i[i.length-1]==="%"?parseFloat(i)/100*255:parseInt(i))}function S(i){return(e=i[i.length-1]==="%"?parseFloat(i)/100:parseFloat(i))<0?0:e>1?1:e;var e}function P(i,e,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?i+(e-i)*r*6:2*r<1?e:3*r<2?i+(e-i)*(2/3-r)*6:i}try{vn={}.parseCSSColor=function(i){var e,r=i.replace(/ /g,"").toLowerCase();if(r in Hr)return Hr[r].slice();if(r[0]==="#")return r.length===4?(e=parseInt(r.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:r.length===7&&(e=parseInt(r.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var s=r.indexOf("("),l=r.indexOf(")");if(s!==-1&&l+1===r.length){var u=r.substr(0,s),p=r.substr(s+1,l-(s+1)).split(","),f=1;switch(u){case"rgba":if(p.length!==4)return null;f=S(p.pop());case"rgb":return p.length!==3?null:[b(p[0]),b(p[1]),b(p[2]),f];case"hsla":if(p.length!==4)return null;f=S(p.pop());case"hsl":if(p.length!==3)return null;var g=(parseFloat(p[0])%360+360)%360/360,x=S(p[1]),w=S(p[2]),I=w<=.5?w*(x+1):w+x-w*x,A=2*w-I;return[L(255*P(A,I,g+1/3)),L(255*P(A,I,g)),L(255*P(A,I,g-1/3)),f];default:return null}}return null}}catch{}class D{constructor(e,r,s,l=1){this.r=e,this.g=r,this.b=s,this.a=l}static parse(e){if(!e)return;if(e instanceof D)return e;if(typeof e!="string")return;const r=vn(e);return r?new D(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){const[e,r,s,l]=this.toArray();return`rgba(${Math.round(e)},${Math.round(r)},${Math.round(s)},${l})`}toArray(){const{r:e,g:r,b:s,a:l}=this;return l===0?[0,0,0,0]:[255*e/l,255*r/l,255*s/l,l]}}D.black=new D(0,0,0,1),D.white=new D(1,1,1,1),D.transparent=new D(0,0,0,0),D.red=new D(1,0,0,1);class ${constructor(e,r,s){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class H{constructor(e,r,s,l,u){this.text=e,this.image=r,this.scale=s,this.fontStack=l,this.textColor=u}}class j{constructor(e){this.sections=e}static fromString(e){return new j([new H(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof j?e:j.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class G{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof G)return e;if(typeof e=="number")return new G([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const r of e)if(typeof r!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new G(e)}}toString(){return JSON.stringify(this.values)}}class W{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new W({name:e,available:!1}):null}}function le(i,e,r,s){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[i,e,r,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[i,e,r,s]:[i,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ge(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof D||i instanceof $||i instanceof j||i instanceof G||i instanceof W)return!0;if(Array.isArray(i)){for(const e of i)if(!ge(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!ge(i[e]))return!1;return!0}return!1}function ae(i){if(i===null)return Pr;if(typeof i=="string")return Qe;if(typeof i=="boolean")return Ke;if(typeof i=="number")return ve;if(i instanceof D)return ii;if(i instanceof $)return gr;if(i instanceof j)return Ht;if(i instanceof G)return _n;if(i instanceof W)return Vt;if(Array.isArray(i)){const e=i.length;let r;for(const s of i){const l=ae(s);if(r){if(r===l)continue;r=He;break}r=l}return pi(r||He,e)}return Dr}function Le(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof D||i instanceof j||i instanceof G||i instanceof W?i.toString():JSON.stringify(i)}class Fe{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!ge(e[1]))return r.error("invalid value");const s=e[1];let l=ae(s);const u=r.expectedType;return l.kind!=="array"||l.N!==0||!u||u.kind!=="array"||typeof u.N=="number"&&u.N!==0||(l=u),new Fe(l,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Ae{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const $e={string:Qe,number:ve,boolean:Ke,object:Dr};class qe{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let s,l=1;const u=e[0];if(u==="array"){let f,g;if(e.length>2){const x=e[1];if(typeof x!="string"||!(x in $e)||x==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);f=$e[x],l++}else f=He;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);g=e[2],l++}s=pi(f,g)}else{if(!$e[u])throw new Error(`Types doesn't contain name = ${u}`);s=$e[u]}const p=[];for(;l<e.length;l++){const f=r.parse(e[l],l,He);if(!f)return null;p.push(f)}return new qe(s,p)}evaluate(e){for(let r=0;r<this.args.length;r++){const s=this.args[r].evaluate(e);if(!rr(this.type,ae(s)))return s;if(r===this.args.length-1)throw new Ae(`Expected value to be of type ${xt(this.type)}, but found ${xt(ae(s))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const ct={"to-boolean":Ke,"to-color":ii,"to-number":ve,"to-string":Qe};class Xe{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const s=e[0];if(!ct[s])throw new Error(`Can't parse ${s} as it is not part of the known types`);if((s==="to-boolean"||s==="to-string")&&e.length!==2)return r.error("Expected one argument.");const l=ct[s],u=[];for(let p=1;p<e.length;p++){const f=r.parse(e[p],p,He);if(!f)return null;u.push(f)}return new Xe(l,u)}evaluate(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){let r,s;for(const l of this.args){if(r=l.evaluate(e),s=null,r instanceof D)return r;if(typeof r=="string"){const u=e.parseColor(r);if(u)return u}else if(Array.isArray(r)&&(s=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:le(r[0],r[1],r[2],r[3]),!s))return new D(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Ae(s||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}if(this.type.kind==="padding"){let r;for(const s of this.args){r=s.evaluate(e);const l=G.parse(r);if(l)return l}throw new Ae(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}if(this.type.kind==="number"){let r=null;for(const s of this.args){if(r=s.evaluate(e),r===null)return 0;const l=Number(r);if(!isNaN(l))return l}throw new Ae(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?j.fromString(Le(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?W.fromString(Le(this.args[0].evaluate(e))):Le(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const et=["Unknown","Point","LineString","Polygon"];class ht{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?et[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=D.parse(e)),r}}class bt{constructor(e,r,s,l){this.name=e,this.type=r,this._evaluate=s,this.args=l}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,r){const s=e[0],l=bt.definitions[s];if(!l)return r.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const u=Array.isArray(l)?l[0]:l.type,p=Array.isArray(l)?[[l[1],l[2]]]:l.overloads,f=p.filter(([x])=>!Array.isArray(x)||x.length===e.length-1);let g=null;for(const[x,w]of f){g=new Tn(r.registry,r.path,null,r.scope);const I=[];let A=!1;for(let M=1;M<e.length;M++){const k=e[M],N=Array.isArray(x)?x[M-1]:x.type,V=g.parse(k,1+I.length,N);if(!V){A=!0;break}I.push(V)}if(!A)if(Array.isArray(x)&&x.length!==I.length)g.error(`Expected ${x.length} arguments, but found ${I.length} instead.`);else{for(let M=0;M<I.length;M++){const k=Array.isArray(x)?x[M]:x.type,N=I[M];g.concat(M+1).checkSubtype(k,N.type)}if(g.errors.length===0)return new bt(s,u,w,I)}}if(f.length===1)r.errors.push(...g.errors);else{const x=(f.length?f:p).map(([I])=>{return A=I,Array.isArray(A)?`(${A.map(xt).join(", ")})`:`(${xt(A.type)}...)`;var A}).join(" | "),w=[];for(let I=1;I<e.length;I++){const A=r.parse(e[I],1+w.length);if(!A)return null;w.push(xt(A.type))}r.error(`Expected arguments of type ${x}, but found (${w.join(", ")}) instead.`)}return null}static register(e,r){bt.definitions=r;for(const s in r)e[s]=bt}}class Wt{constructor(e,r,s){this.type=gr,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const s=e[1];if(typeof s!="object"||Array.isArray(s))return r.error("Collator options argument must be an object.");const l=r.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,Ke);if(!l)return null;const u=r.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,Ke);if(!u)return null;let p=null;return s.locale&&(p=r.parse(s.locale,1,Qe),!p)?null:new Wt(l,u,p)}evaluate(e){return new $(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}const Ct=8192;function ai(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function bn(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function qn(i,e){const r=(180+i[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,l=Math.pow(2,e.z);return[Math.round(r*l*Ct),Math.round(s*l*Ct)]}function wt(i,e,r){const s=i[0]-e[0],l=i[1]-e[1],u=i[0]-r[0],p=i[1]-r[1];return s*p-u*l==0&&s*u<=0&&l*p<=0}function Ws(i,e){let r=!1;for(let p=0,f=e.length;p<f;p++){const g=e[p];for(let x=0,w=g.length;x<w-1;x++){if(wt(i,g[x],g[x+1]))return!1;(l=g[x])[1]>(s=i)[1]!=(u=g[x+1])[1]>s[1]&&s[0]<(u[0]-l[0])*(s[1]-l[1])/(u[1]-l[1])+l[0]&&(r=!r)}}var s,l,u;return r}function Ks(i,e){for(let r=0;r<e.length;r++)if(Ws(i,e[r]))return!0;return!1}function Ho(i,e,r,s){const l=s[0]-r[0],u=s[1]-r[1],p=(i[0]-r[0])*u-l*(i[1]-r[1]),f=(e[0]-r[0])*u-l*(e[1]-r[1]);return p>0&&f<0||p<0&&f>0}function Wo(i,e,r){for(const x of r)for(let w=0;w<x.length-1;++w)if((f=[(p=x[w+1])[0]-(u=x[w])[0],p[1]-u[1]])[0]*(g=[(l=e)[0]-(s=i)[0],l[1]-s[1]])[1]-f[1]*g[0]!=0&&Ho(s,l,u,p)&&Ho(u,p,s,l))return!0;var s,l,u,p,f,g;return!1}function Ys(i,e){for(let r=0;r<i.length;++r)if(!Ws(i[r],e))return!1;for(let r=0;r<i.length-1;++r)if(Wo(i[r],i[r+1],e))return!1;return!0}function rl(i,e){for(let r=0;r<e.length;r++)if(Ys(i,e[r]))return!0;return!1}function xs(i,e,r){const s=[];for(let l=0;l<i.length;l++){const u=[];for(let p=0;p<i[l].length;p++){const f=qn(i[l][p],r);ai(e,f),u.push(f)}s.push(u)}return s}function Js(i,e,r){const s=[];for(let l=0;l<i.length;l++){const u=xs(i[l],e,r);s.push(u)}return s}function Ko(i,e,r,s){if(i[0]<r[0]||i[0]>r[2]){const l=.5*s;let u=i[0]-r[0]>l?-s:r[0]-i[0]>l?s:0;u===0&&(u=i[0]-r[2]>l?-s:r[2]-i[0]>l?s:0),i[0]+=u}ai(e,i)}function Yo(i,e,r,s){const l=Math.pow(2,s.z)*Ct,u=[s.x*Ct,s.y*Ct],p=[];for(const f of i)for(const g of f){const x=[g.x+u[0],g.y+u[1]];Ko(x,e,r,l),p.push(x)}return p}function Jo(i,e,r,s){const l=Math.pow(2,s.z)*Ct,u=[s.x*Ct,s.y*Ct],p=[];for(const g of i){const x=[];for(const w of g){const I=[w.x+u[0],w.y+u[1]];ai(e,I),x.push(I)}p.push(x)}if(e[2]-e[0]<=l/2){(f=e)[0]=f[1]=1/0,f[2]=f[3]=-1/0;for(const g of p)for(const x of g)Ko(x,e,r,l)}var f;return p}class Wr{constructor(e,r){this.type=Ke,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ge(e[1])){const s=e[1];if(s.type==="FeatureCollection")for(let l=0;l<s.features.length;++l){const u=s.features[l].geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new Wr(s,s.features[l].geometry)}else if(s.type==="Feature"){const l=s.geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new Wr(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new Wr(s,s)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,s){const l=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],p=r.canonicalID();if(s.type==="Polygon"){const f=xs(s.coordinates,u,p),g=Yo(r.geometry(),l,u,p);if(!bn(l,u))return!1;for(const x of g)if(!Ws(x,f))return!1}if(s.type==="MultiPolygon"){const f=Js(s.coordinates,u,p),g=Yo(r.geometry(),l,u,p);if(!bn(l,u))return!1;for(const x of g)if(!Ks(x,f))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,s){const l=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],p=r.canonicalID();if(s.type==="Polygon"){const f=xs(s.coordinates,u,p),g=Jo(r.geometry(),l,u,p);if(!bn(l,u))return!1;for(const x of g)if(!Ys(x,f))return!1}if(s.type==="MultiPolygon"){const f=Js(s.coordinates,u,p),g=Jo(r.geometry(),l,u,p);if(!bn(l,u))return!1;for(const x of g)if(!rl(x,f))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}function jn(i){if(i instanceof bt&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Wr)return!1;let e=!0;return i.eachChild(r=>{e&&!jn(r)&&(e=!1)}),e}function wn(i){if(i instanceof bt&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(r=>{e&&!wn(r)&&(e=!1)}),e}function vs(i,e){if(i instanceof bt&&e.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild(s=>{r&&!vs(s,e)&&(r=!1)}),r}class bs{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const s=e[1];return r.scope.has(s)?new bs(s,r.scope.get(s)):r.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class Tn{constructor(e,r=[],s,l=new Ai,u=[]){this.registry=e,this.path=r,this.key=r.map(p=>`[${p}]`).join(""),this.scope=l,this.errors=u,this.expectedType=s}parse(e,r,s,l,u={}){return r?this.concat(r,s,l)._parse(e,u):this._parse(e,u)}_parse(e,r){function s(l,u,p){return p==="assert"?new qe(u,[l]):p==="coerce"?new Xe(u,[l]):l}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const l=e[0];if(typeof l!="string")return this.error(`Expression name must be a string, but found ${typeof l} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const u=this.registry[l];if(u){let p=u.parse(e,this);if(!p)return null;if(this.expectedType){const f=this.expectedType,g=p.type;if(f.kind!=="string"&&f.kind!=="number"&&f.kind!=="boolean"&&f.kind!=="object"&&f.kind!=="array"||g.kind!=="value")if(f.kind!=="color"&&f.kind!=="formatted"&&f.kind!=="resolvedImage"||g.kind!=="value"&&g.kind!=="string")if(f.kind!=="padding"||g.kind!=="value"&&g.kind!=="number"&&g.kind!=="array"){if(this.checkSubtype(f,g))return null}else p=s(p,f,r.typeAnnotation||"coerce");else p=s(p,f,r.typeAnnotation||"coerce");else p=s(p,f,r.typeAnnotation||"assert")}if(!(p instanceof Fe)&&p.type.kind!=="resolvedImage"&&Qs(p)){const f=new ht;try{p=new Fe(p.type,p.evaluate(f))}catch(g){return this.error(g.message),null}}return p}return this.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,s){const l=typeof e=="number"?this.path.concat(e):this.path,u=s?this.scope.concat(s):this.scope;return new Tn(this.registry,l,r||null,u,this.errors)}error(e,...r){const s=`${this.key}${r.map(l=>`[${l}]`).join("")}`;this.errors.push(new Ci(s,e))}checkSubtype(e,r){const s=rr(e,r);return s&&this.error(s),s}}function Qs(i){if(i instanceof bs)return Qs(i.boundExpression);if(i instanceof bt&&i.name==="error"||i instanceof Wt||i instanceof Wr)return!1;const e=i instanceof Xe||i instanceof qe;let r=!0;return i.eachChild(s=>{r=e?r&&Qs(s):r&&s instanceof Fe}),!!r&&jn(i)&&vs(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function ws(i,e){const r=i.length-1;let s,l,u=0,p=r,f=0;for(;u<=p;)if(f=Math.floor((u+p)/2),s=i[f],l=i[f+1],s<=e){if(f===r||e<l)return f;u=f+1}else{if(!(s>e))throw new Ae("Input is not a number.");p=f-1}return 0}class Zn{constructor(e,r,s){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[l,u]of s)this.labels.push(l),this.outputs.push(u)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const s=r.parse(e[1],1,ve);if(!s)return null;const l=[];let u=null;r.expectedType&&r.expectedType.kind!=="value"&&(u=r.expectedType);for(let p=1;p<e.length;p+=2){const f=p===1?-1/0:e[p],g=e[p+1],x=p,w=p+1;if(typeof f!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',x);if(l.length&&l[l.length-1][0]>=f)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',x);const I=r.parse(g,w,u);if(!I)return null;u=u||I.type,l.push([f,I])}return new Zn(u,s,l)}evaluate(e){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(e);const l=this.input.evaluate(e);if(l<=r[0])return s[0].evaluate(e);const u=r.length;return l>=r[u-1]?s[u-1].evaluate(e):s[ws(r,l)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function At(i,e,r){return i*(1-r)+e*r}var Xn=Object.freeze({__proto__:null,number:At,color:function(i,e,r){return new D(At(i.r,e.r,r),At(i.g,e.g,r),At(i.b,e.b,r),At(i.a,e.a,r))},array:function(i,e,r){return i.map((s,l)=>At(s,e[l],r))},padding:function(i,e,r){const s=i.values,l=e.values;return new G([At(s[0],l[0],r),At(s[1],l[1],r),At(s[2],l[2],r),At(s[3],l[3],r)])}});const Qo=.95047,ea=1.08883,eo=4/29,Ts=6/29,ta=3*Ts*Ts,nl=Math.PI/180,sl=180/Math.PI;function to(i){return i>.008856451679035631?Math.pow(i,1/3):i/ta+eo}function io(i){return i>Ts?i*i*i:ta*(i-eo)}function ro(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function no(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function pt(i){const e=no(i.r),r=no(i.g),s=no(i.b),l=to((.4124564*e+.3575761*r+.1804375*s)/Qo),u=to((.2126729*e+.7151522*r+.072175*s)/1);return{l:116*u-16,a:500*(l-u),b:200*(u-to((.0193339*e+.119192*r+.9503041*s)/ea)),alpha:i.a}}function ia(i){let e=(i.l+16)/116,r=isNaN(i.a)?e:e+i.a/500,s=isNaN(i.b)?e:e-i.b/200;return e=1*io(e),r=Qo*io(r),s=ea*io(s),new D(ro(3.2404542*r-1.5371385*e-.4985314*s),ro(-.969266*r+1.8760108*e+.041556*s),ro(.0556434*r-.2040259*e+1.0572252*s),i.alpha)}function ol(i,e,r){const s=e-i;return i+r*(s>180||s<-180?s-360*Math.round(s/360):s)}const Hn={forward:pt,reverse:ia,interpolate:function(i,e,r){return{l:At(i.l,e.l,r),a:At(i.a,e.a,r),b:At(i.b,e.b,r),alpha:At(i.alpha,e.alpha,r)}}},Wn={forward:function(i){const{l:e,a:r,b:s}=pt(i),l=Math.atan2(s,r)*sl;return{h:l<0?l+360:l,c:Math.sqrt(r*r+s*s),l:e,alpha:i.a}},reverse:function(i){const e=i.h*nl,r=i.c;return ia({l:i.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:i.alpha})},interpolate:function(i,e,r){return{h:ol(i.h,e.h,r),c:At(i.c,e.c,r),l:At(i.l,e.l,r),alpha:At(i.alpha,e.alpha,r)}}};var ra=Object.freeze({__proto__:null,lab:Hn,hcl:Wn});class zi{constructor(e,r,s,l,u){this.type=e,this.operator=r,this.interpolation=s,this.input=l,this.labels=[],this.outputs=[];for(const[p,f]of u)this.labels.push(p),this.outputs.push(f)}static interpolationFactor(e,r,s,l){let u=0;if(e.name==="exponential")u=so(r,e.base,s,l);else if(e.name==="linear")u=so(r,1,s,l);else if(e.name==="cubic-bezier"){const p=e.controlPoints;u=new Pe(p[0],p[1],p[2],p[3]).solve(so(r,1,s,l))}return u}static parse(e,r){let[s,l,u,...p]=e;if(!Array.isArray(l)||l.length===0)return r.error("Expected an interpolation type expression.",1);if(l[0]==="linear")l={name:"linear"};else if(l[0]==="exponential"){const x=l[1];if(typeof x!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);l={name:"exponential",base:x}}else{if(l[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(l[0])}`,1,0);{const x=l.slice(1);if(x.length!==4||x.some(w=>typeof w!="number"||w<0||w>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);l={name:"cubic-bezier",controlPoints:x}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(u=r.parse(u,2,ve),!u)return null;const f=[];let g=null;s==="interpolate-hcl"||s==="interpolate-lab"?g=ii:r.expectedType&&r.expectedType.kind!=="value"&&(g=r.expectedType);for(let x=0;x<p.length;x+=2){const w=p[x],I=p[x+1],A=x+3,M=x+4;if(typeof w!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(f.length&&f[f.length-1][0]>=w)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',A);const k=r.parse(I,M,g);if(!k)return null;g=g||k.type,f.push([w,k])}return g.kind==="number"||g.kind==="color"||g.kind==="padding"||g.kind==="array"&&g.itemType.kind==="number"&&typeof g.N=="number"?new zi(g,s,l,u,f):r.error(`Type ${xt(g)} is not interpolatable.`)}evaluate(e){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(e);const l=this.input.evaluate(e);if(l<=r[0])return s[0].evaluate(e);const u=r.length;if(l>=r[u-1])return s[u-1].evaluate(e);const p=ws(r,l),f=zi.interpolationFactor(this.interpolation,l,r[p],r[p+1]),g=s[p].evaluate(e),x=s[p+1].evaluate(e);return this.operator==="interpolate"?Xn[this.type.kind.toLowerCase()](g,x,f):this.operator==="interpolate-hcl"?Wn.reverse(Wn.interpolate(Wn.forward(g),Wn.forward(x),f)):Hn.reverse(Hn.interpolate(Hn.forward(g),Hn.forward(x),f))}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function so(i,e,r,s){const l=s-r,u=i-r;return l===0?0:e===1?u/l:(Math.pow(e,u)-1)/(Math.pow(e,l)-1)}class Is{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let s=null;const l=r.expectedType;l&&l.kind!=="value"&&(s=l);const u=[];for(const f of e.slice(1)){const g=r.parse(f,1+u.length,s,void 0,{typeAnnotation:"omit"});if(!g)return null;s=s||g.type,u.push(g)}if(!s)throw new Error("No output type");const p=l&&u.some(f=>rr(l,f.type));return new Is(p?He:s,u)}evaluate(e){let r,s=null,l=0;for(const u of this.args)if(l++,s=u.evaluate(e),s&&s instanceof W&&!s.available&&(r||(r=s.name),s=null,l===this.args.length&&(s=r)),s!==null)break;return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}class Es{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let u=1;u<e.length-1;u+=2){const p=e[u];if(typeof p!="string")return r.error(`Expected string, but found ${typeof p} instead.`,u);if(/[^a-zA-Z0-9_]/.test(p))return r.error("Variable names must contain only alphanumeric characters or '_'.",u);const f=r.parse(e[u+1],u+1);if(!f)return null;s.push([p,f])}const l=r.parse(e[e.length-1],e.length-1,r.expectedType,s);return l?new Es(s,l):null}outputDefined(){return this.result.outputDefined()}}class oo{constructor(e,r,s){this.type=e,this.index=r,this.input=s}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,ve),l=r.parse(e[2],2,pi(r.expectedType||He));return s&&l?new oo(l.type.itemType,s,l):null}evaluate(e){const r=this.index.evaluate(e),s=this.input.evaluate(e);if(r<0)throw new Ae(`Array index out of bounds: ${r} < 0.`);if(r>=s.length)throw new Ae(`Array index out of bounds: ${r} > ${s.length-1}.`);if(r!==Math.floor(r))throw new Ae(`Array index must be an integer, but found ${r} instead.`);return s[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class ao{constructor(e,r){this.type=Ke,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,He),l=r.parse(e[2],2,He);return s&&l?Zr(s.type,[Ke,Qe,ve,Pr,He])?new ao(s,l):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${xt(s.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!s)return!1;if(!Xr(r,["boolean","string","number","null"]))throw new Ae(`Expected first argument to be of type boolean, string, number or null, but found ${xt(ae(r))} instead.`);if(!Xr(s,["string","array"]))throw new Ae(`Expected second argument to be of type array or string, but found ${xt(ae(s))} instead.`);return s.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class Ss{constructor(e,r,s){this.type=ve,this.needle=e,this.haystack=r,this.fromIndex=s}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,He),l=r.parse(e[2],2,He);if(!s||!l)return null;if(!Zr(s.type,[Ke,Qe,ve,Pr,He]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${xt(s.type)} instead`);if(e.length===4){const u=r.parse(e[3],3,ve);return u?new Ss(s,l,u):null}return new Ss(s,l)}evaluate(e){const r=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!Xr(r,["boolean","string","number","null"]))throw new Ae(`Expected first argument to be of type boolean, string, number or null, but found ${xt(ae(r))} instead.`);if(!Xr(s,["string","array"]))throw new Ae(`Expected second argument to be of type array or string, but found ${xt(ae(s))} instead.`);if(this.fromIndex){const l=this.fromIndex.evaluate(e);return s.indexOf(r,l)}return s.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class lo{constructor(e,r,s,l,u,p){this.inputType=e,this.type=r,this.input=s,this.cases=l,this.outputs=u,this.otherwise=p}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let s,l;r.expectedType&&r.expectedType.kind!=="value"&&(l=r.expectedType);const u={},p=[];for(let x=2;x<e.length-1;x+=2){let w=e[x];const I=e[x+1];Array.isArray(w)||(w=[w]);const A=r.concat(x);if(w.length===0)return A.error("Expected at least one branch label.");for(const k of w){if(typeof k!="number"&&typeof k!="string")return A.error("Branch labels must be numbers or strings.");if(typeof k=="number"&&Math.abs(k)>Number.MAX_SAFE_INTEGER)return A.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof k=="number"&&Math.floor(k)!==k)return A.error("Numeric branch labels must be integer values.");if(s){if(A.checkSubtype(s,ae(k)))return null}else s=ae(k);if(u[String(k)]!==void 0)return A.error("Branch labels must be unique.");u[String(k)]=p.length}const M=r.parse(I,x,l);if(!M)return null;l=l||M.type,p.push(M)}const f=r.parse(e[1],1,He);if(!f)return null;const g=r.parse(e[e.length-1],e.length-1,l);return g?f.type.kind!=="value"&&r.concat(1).checkSubtype(s,f.type)?null:new lo(s,l,f,u,p,g):null}evaluate(e){const r=this.input.evaluate(e);return(ae(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class co{constructor(e,r,s){this.type=e,this.branches=r,this.otherwise=s}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let s;r.expectedType&&r.expectedType.kind!=="value"&&(s=r.expectedType);const l=[];for(let p=1;p<e.length-1;p+=2){const f=r.parse(e[p],p,Ke);if(!f)return null;const g=r.parse(e[p+1],p+1,s);if(!g)return null;l.push([f,g]),s=s||g.type}const u=r.parse(e[e.length-1],e.length-1,s);if(!u)return null;if(!s)throw new Error("Can't infer output type");return new co(s,l,u)}evaluate(e){for(const[r,s]of this.branches)if(r.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,s]of this.branches)e(r),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class Cs{constructor(e,r,s,l){this.type=e,this.input=r,this.beginIndex=s,this.endIndex=l}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,He),l=r.parse(e[2],2,ve);if(!s||!l)return null;if(!Zr(s.type,[pi(He),Qe,He]))return r.error(`Expected first argument to be of type array or string, but found ${xt(s.type)} instead`);if(e.length===4){const u=r.parse(e[3],3,ve);return u?new Cs(s.type,s,l,u):null}return new Cs(s.type,s,l)}evaluate(e){const r=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!Xr(r,["string","array"]))throw new Ae(`Expected first argument to be of type array or string, but found ${xt(ae(r))} instead.`);if(this.endIndex){const l=this.endIndex.evaluate(e);return r.slice(s,l)}return r.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function na(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function sa(i,e,r,s){return s.compare(e,r)===0}function In(i,e,r){const s=i!=="=="&&i!=="!=";return class Bh{constructor(u,p,f){this.type=Ke,this.lhs=u,this.rhs=p,this.collator=f,this.hasUntypedArgument=u.type.kind==="value"||p.type.kind==="value"}static parse(u,p){if(u.length!==3&&u.length!==4)return p.error("Expected two or three arguments.");const f=u[0];let g=p.parse(u[1],1,He);if(!g)return null;if(!na(f,g.type))return p.concat(1).error(`"${f}" comparisons are not supported for type '${xt(g.type)}'.`);let x=p.parse(u[2],2,He);if(!x)return null;if(!na(f,x.type))return p.concat(2).error(`"${f}" comparisons are not supported for type '${xt(x.type)}'.`);if(g.type.kind!==x.type.kind&&g.type.kind!=="value"&&x.type.kind!=="value")return p.error(`Cannot compare types '${xt(g.type)}' and '${xt(x.type)}'.`);s&&(g.type.kind==="value"&&x.type.kind!=="value"?g=new qe(x.type,[g]):g.type.kind!=="value"&&x.type.kind==="value"&&(x=new qe(g.type,[x])));let w=null;if(u.length===4){if(g.type.kind!=="string"&&x.type.kind!=="string"&&g.type.kind!=="value"&&x.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(w=p.parse(u[3],3,gr),!w)return null}return new Bh(g,x,w)}evaluate(u){const p=this.lhs.evaluate(u),f=this.rhs.evaluate(u);if(s&&this.hasUntypedArgument){const g=ae(p),x=ae(f);if(g.kind!==x.kind||g.kind!=="string"&&g.kind!=="number")throw new Ae(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${g.kind}, ${x.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const g=ae(p),x=ae(f);if(g.kind!=="string"||x.kind!=="string")return e(u,p,f)}return this.collator?r(u,p,f,this.collator.evaluate(u)):e(u,p,f)}eachChild(u){u(this.lhs),u(this.rhs),this.collator&&u(this.collator)}outputDefined(){return!0}}}const al=In("==",function(i,e,r){return e===r},sa),ll=In("!=",function(i,e,r){return e!==r},function(i,e,r,s){return!sa(0,e,r,s)}),cl=In("<",function(i,e,r){return e<r},function(i,e,r,s){return s.compare(e,r)<0}),hl=In(">",function(i,e,r){return e>r},function(i,e,r,s){return s.compare(e,r)>0}),ul=In("<=",function(i,e,r){return e<=r},function(i,e,r,s){return s.compare(e,r)<=0}),dl=In(">=",function(i,e,r){return e>=r},function(i,e,r,s){return s.compare(e,r)>=0});class ho{constructor(e,r,s,l,u){this.type=Qe,this.number=e,this.locale=r,this.currency=s,this.minFractionDigits=l,this.maxFractionDigits=u}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const s=r.parse(e[1],1,ve);if(!s)return null;const l=e[2];if(typeof l!="object"||Array.isArray(l))return r.error("NumberFormat options argument must be an object.");let u=null;if(l.locale&&(u=r.parse(l.locale,1,Qe),!u))return null;let p=null;if(l.currency&&(p=r.parse(l.currency,1,Qe),!p))return null;let f=null;if(l["min-fraction-digits"]&&(f=r.parse(l["min-fraction-digits"],1,ve),!f))return null;let g=null;return l["max-fraction-digits"]&&(g=r.parse(l["max-fraction-digits"],1,ve),!g)?null:new ho(s,u,p,f,g)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class As{constructor(e){this.type=Ht,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&typeof s=="object")return r.error("First argument must be an image or text section.");const l=[];let u=!1;for(let p=1;p<=e.length-1;++p){const f=e[p];if(u&&typeof f=="object"&&!Array.isArray(f)){u=!1;let g=null;if(f["font-scale"]&&(g=r.parse(f["font-scale"],1,ve),!g))return null;let x=null;if(f["text-font"]&&(x=r.parse(f["text-font"],1,pi(Qe)),!x))return null;let w=null;if(f["text-color"]&&(w=r.parse(f["text-color"],1,ii),!w))return null;const I=l[l.length-1];I.scale=g,I.font=x,I.textColor=w}else{const g=r.parse(e[p],1,He);if(!g)return null;const x=g.type.kind;if(x!=="string"&&x!=="value"&&x!=="null"&&x!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");u=!0,l.push({content:g,scale:null,font:null,textColor:null})}}return new As(l)}evaluate(e){return new j(this.sections.map(r=>{const s=r.content.evaluate(e);return ae(s)===Vt?new H("",s,null,null,null):new H(Le(s),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}}class uo{constructor(e){this.type=Vt,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const s=r.parse(e[1],1,Qe);return s?new uo(s):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),s=W.fromString(r);return s&&e.availableImages&&(s.available=e.availableImages.indexOf(r)>-1),s}eachChild(e){e(this.input)}outputDefined(){return!1}}class po{constructor(e){this.type=ve,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=r.parse(e[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${xt(s.type)} instead.`):new po(s):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new Ae(`Expected value to be of type string or array, but found ${xt(ae(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const En={"==":al,"!=":ll,">":hl,"<":cl,">=":dl,"<=":ul,array:qe,at:oo,boolean:qe,case:co,coalesce:Is,collator:Wt,format:As,image:uo,in:ao,"index-of":Ss,interpolate:zi,"interpolate-hcl":zi,"interpolate-lab":zi,length:po,let:Es,literal:Fe,match:lo,number:qe,"number-format":ho,object:qe,slice:Cs,step:Zn,string:qe,"to-boolean":Xe,"to-color":Xe,"to-number":Xe,"to-string":Xe,var:bs,within:Wr};function oa(i,[e,r,s,l]){e=e.evaluate(i),r=r.evaluate(i),s=s.evaluate(i);const u=l?l.evaluate(i):1,p=le(e,r,s,u);if(p)throw new Ae(p);return new D(e/255*u,r/255*u,s/255*u,u)}function aa(i,e){return i in e}function zs(i,e){const r=e[i];return r===void 0?null:r}function Kr(i){return{type:i}}function la(i){return{result:"success",value:i}}function Sn(i){return{result:"error",value:i}}function Et(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function ca(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function st(i){return!!i.expression&&i.expression.interpolated}function mt(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function It(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function zt(i){return i}function Kn(i,e){const r=e.type==="color",s=i.stops&&typeof i.stops[0][0]=="object",l=s||!(s||i.property!==void 0),u=i.type||(st(e)?"exponential":"interval");if(r||e.type==="padding"){const x=r?D.parse:G.parse;(i=Xi({},i)).stops&&(i.stops=i.stops.map(w=>[w[0],x(w[1])])),i.default=x(i.default?i.default:e.default)}if(i.colorSpace&&i.colorSpace!=="rgb"&&!ra[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let p,f,g;if(u==="exponential")p=ha;else if(u==="interval")p=ml;else if(u==="categorical"){p=pl,f=Object.create(null);for(const x of i.stops)f[x[0]]=x[1];g=typeof i.stops[0][0]}else{if(u!=="identity")throw new Error(`Unknown function type "${u}"`);p=fl}if(s){const x={},w=[];for(let M=0;M<i.stops.length;M++){const k=i.stops[M],N=k[0].zoom;x[N]===void 0&&(x[N]={zoom:N,type:i.type,property:i.property,default:i.default,stops:[]},w.push(N)),x[N].stops.push([k[0].value,k[1]])}const I=[];for(const M of w)I.push([x[M].zoom,Kn(x[M],e)]);const A={name:"linear"};return{kind:"composite",interpolationType:A,interpolationFactor:zi.interpolationFactor.bind(void 0,A),zoomStops:I.map(M=>M[0]),evaluate:({zoom:M},k)=>ha({stops:I,base:i.base},e,M).evaluate(M,k)}}if(l){const x=u==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:x,interpolationFactor:zi.interpolationFactor.bind(void 0,x),zoomStops:i.stops.map(w=>w[0]),evaluate:({zoom:w})=>p(i,e,w,f,g)}}return{kind:"source",evaluate(x,w){const I=w&&w.properties?w.properties[i.property]:void 0;return I===void 0?Cn(i.default,e.default):p(i,e,I,f,g)}}}function Cn(i,e,r){return i!==void 0?i:e!==void 0?e:r!==void 0?r:void 0}function pl(i,e,r,s,l){return Cn(typeof r===l?s[r]:void 0,i.default,e.default)}function ml(i,e,r){if(mt(r)!=="number")return Cn(i.default,e.default);const s=i.stops.length;if(s===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[s-1][0])return i.stops[s-1][1];const l=ws(i.stops.map(u=>u[0]),r);return i.stops[l][1]}function ha(i,e,r){const s=i.base!==void 0?i.base:1;if(mt(r)!=="number")return Cn(i.default,e.default);const l=i.stops.length;if(l===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[l-1][0])return i.stops[l-1][1];const u=ws(i.stops.map(w=>w[0]),r),p=function(w,I,A,M){const k=M-A,N=w-A;return k===0?0:I===1?N/k:(Math.pow(I,N)-1)/(Math.pow(I,k)-1)}(r,s,i.stops[u][0],i.stops[u+1][0]),f=i.stops[u][1],g=i.stops[u+1][1];let x=Xn[e.type]||zt;if(i.colorSpace&&i.colorSpace!=="rgb"){const w=ra[i.colorSpace];x=(I,A)=>w.reverse(w.interpolate(w.forward(I),w.forward(A),p))}return typeof f.evaluate=="function"?{evaluate(...w){const I=f.evaluate.apply(void 0,w),A=g.evaluate.apply(void 0,w);if(I!==void 0&&A!==void 0)return x(I,A,p)}}:x(f,g,p)}function fl(i,e,r){switch(e.type){case"color":r=D.parse(r);break;case"formatted":r=j.fromString(r.toString());break;case"resolvedImage":r=W.fromString(r.toString());break;case"padding":r=G.parse(r);break;default:mt(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0)}return Cn(r,i.default,e.default)}bt.register(En,{error:[{kind:"error"},[Qe],(i,[e])=>{throw new Ae(e.evaluate(i))}],typeof:[Qe,[He],(i,[e])=>xt(ae(e.evaluate(i)))],"to-rgba":[pi(ve,4),[ii],(i,[e])=>e.evaluate(i).toArray()],rgb:[ii,[ve,ve,ve],oa],rgba:[ii,[ve,ve,ve,ve],oa],has:{type:Ke,overloads:[[[Qe],(i,[e])=>aa(e.evaluate(i),i.properties())],[[Qe,Dr],(i,[e,r])=>aa(e.evaluate(i),r.evaluate(i))]]},get:{type:He,overloads:[[[Qe],(i,[e])=>zs(e.evaluate(i),i.properties())],[[Qe,Dr],(i,[e,r])=>zs(e.evaluate(i),r.evaluate(i))]]},"feature-state":[He,[Qe],(i,[e])=>zs(e.evaluate(i),i.featureState||{})],properties:[Dr,[],i=>i.properties()],"geometry-type":[Qe,[],i=>i.geometryType()],id:[He,[],i=>i.id()],zoom:[ve,[],i=>i.globals.zoom],"heatmap-density":[ve,[],i=>i.globals.heatmapDensity||0],"line-progress":[ve,[],i=>i.globals.lineProgress||0],accumulated:[He,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[ve,Kr(ve),(i,e)=>{let r=0;for(const s of e)r+=s.evaluate(i);return r}],"*":[ve,Kr(ve),(i,e)=>{let r=1;for(const s of e)r*=s.evaluate(i);return r}],"-":{type:ve,overloads:[[[ve,ve],(i,[e,r])=>e.evaluate(i)-r.evaluate(i)],[[ve],(i,[e])=>-e.evaluate(i)]]},"/":[ve,[ve,ve],(i,[e,r])=>e.evaluate(i)/r.evaluate(i)],"%":[ve,[ve,ve],(i,[e,r])=>e.evaluate(i)%r.evaluate(i)],ln2:[ve,[],()=>Math.LN2],pi:[ve,[],()=>Math.PI],e:[ve,[],()=>Math.E],"^":[ve,[ve,ve],(i,[e,r])=>Math.pow(e.evaluate(i),r.evaluate(i))],sqrt:[ve,[ve],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[ve,[ve],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[ve,[ve],(i,[e])=>Math.log(e.evaluate(i))],log2:[ve,[ve],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[ve,[ve],(i,[e])=>Math.sin(e.evaluate(i))],cos:[ve,[ve],(i,[e])=>Math.cos(e.evaluate(i))],tan:[ve,[ve],(i,[e])=>Math.tan(e.evaluate(i))],asin:[ve,[ve],(i,[e])=>Math.asin(e.evaluate(i))],acos:[ve,[ve],(i,[e])=>Math.acos(e.evaluate(i))],atan:[ve,[ve],(i,[e])=>Math.atan(e.evaluate(i))],min:[ve,Kr(ve),(i,e)=>Math.min(...e.map(r=>r.evaluate(i)))],max:[ve,Kr(ve),(i,e)=>Math.max(...e.map(r=>r.evaluate(i)))],abs:[ve,[ve],(i,[e])=>Math.abs(e.evaluate(i))],round:[ve,[ve],(i,[e])=>{const r=e.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[ve,[ve],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[ve,[ve],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[Ke,[Qe,He],(i,[e,r])=>i.properties()[e.value]===r.value],"filter-id-==":[Ke,[He],(i,[e])=>i.id()===e.value],"filter-type-==":[Ke,[Qe],(i,[e])=>i.geometryType()===e.value],"filter-<":[Ke,[Qe,He],(i,[e,r])=>{const s=i.properties()[e.value],l=r.value;return typeof s==typeof l&&s<l}],"filter-id-<":[Ke,[He],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r<s}],"filter->":[Ke,[Qe,He],(i,[e,r])=>{const s=i.properties()[e.value],l=r.value;return typeof s==typeof l&&s>l}],"filter-id->":[Ke,[He],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r>s}],"filter-<=":[Ke,[Qe,He],(i,[e,r])=>{const s=i.properties()[e.value],l=r.value;return typeof s==typeof l&&s<=l}],"filter-id-<=":[Ke,[He],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r<=s}],"filter->=":[Ke,[Qe,He],(i,[e,r])=>{const s=i.properties()[e.value],l=r.value;return typeof s==typeof l&&s>=l}],"filter-id->=":[Ke,[He],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r>=s}],"filter-has":[Ke,[He],(i,[e])=>e.value in i.properties()],"filter-has-id":[Ke,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[Ke,[pi(Qe)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[Ke,[pi(He)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[Ke,[Qe,pi(He)],(i,[e,r])=>r.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[Ke,[Qe,pi(He)],(i,[e,r])=>function(s,l,u,p){for(;u<=p;){const f=u+p>>1;if(l[f]===s)return!0;l[f]>s?p=f-1:u=f+1}return!1}(i.properties()[e.value],r.value,0,r.value.length-1)],all:{type:Ke,overloads:[[[Ke,Ke],(i,[e,r])=>e.evaluate(i)&&r.evaluate(i)],[Kr(Ke),(i,e)=>{for(const r of e)if(!r.evaluate(i))return!1;return!0}]]},any:{type:Ke,overloads:[[[Ke,Ke],(i,[e,r])=>e.evaluate(i)||r.evaluate(i)],[Kr(Ke),(i,e)=>{for(const r of e)if(r.evaluate(i))return!0;return!1}]]},"!":[Ke,[Ke],(i,[e])=>!e.evaluate(i)],"is-supported-script":[Ke,[Qe],(i,[e])=>{const r=i.globals&&i.globals.isSupportedScript;return!r||r(e.evaluate(i))}],upcase:[Qe,[Qe],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[Qe,[Qe],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[Qe,Kr(He),(i,e)=>e.map(r=>Le(r.evaluate(i))).join("")],"resolved-locale":[Qe,[gr],(i,[e])=>e.evaluate(i).resolvedLocale()]});class Ms{constructor(e,r){this.expression=e,this._warningHistory={},this._evaluator=new ht,this._defaultValue=r?function(s){return s.type==="color"&&It(s.default)?new D(0,0,0,0):s.type==="color"?D.parse(s.default)||null:s.type==="padding"?G.parse(s.default)||null:s.default===void 0?null:s.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,s,l,u,p){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=s,this._evaluator.canonical=l,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=p,this.expression.evaluate(this._evaluator)}evaluate(e,r,s,l,u,p){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=s||null,this._evaluator.canonical=l,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=p||null;try{const f=this.expression.evaluate(this._evaluator);if(f==null||typeof f=="number"&&f!=f)return this._defaultValue;if(this._enumValues&&!(f in this._enumValues))throw new Ae(`Expected value to be one of ${Object.keys(this._enumValues).map(g=>JSON.stringify(g)).join(", ")}, but found ${JSON.stringify(f)} instead.`);return f}catch(f){return this._warningHistory[f.message]||(this._warningHistory[f.message]=!0,typeof console<"u"&&console.warn(f.message)),this._defaultValue}}}function Yn(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in En}function Jn(i,e){const r=new Tn(En,[],e?function(l){const u={color:ii,string:Qe,number:ve,enum:Qe,boolean:Ke,formatted:Ht,padding:_n,resolvedImage:Vt};return l.type==="array"?pi(u[l.value]||He,l.length):u[l.type]}(e):void 0),s=r.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return s?la(new Ms(s,e)):Sn(r.errors)}class Qn{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!wn(r.expression)}evaluateWithoutErrorHandling(e,r,s,l,u,p){return this._styleExpression.evaluateWithoutErrorHandling(e,r,s,l,u,p)}evaluate(e,r,s,l,u,p){return this._styleExpression.evaluate(e,r,s,l,u,p)}}class mo{constructor(e,r,s,l){this.kind=e,this.zoomStops=s,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!wn(r.expression),this.interpolationType=l}evaluateWithoutErrorHandling(e,r,s,l,u,p){return this._styleExpression.evaluateWithoutErrorHandling(e,r,s,l,u,p)}evaluate(e,r,s,l,u,p){return this._styleExpression.evaluate(e,r,s,l,u,p)}interpolationFactor(e,r,s){return this.interpolationType?zi.interpolationFactor(this.interpolationType,e,r,s):0}}function ua(i,e){const r=Jn(i,e);if(r.result==="error")return r;const s=r.value.expression,l=jn(s);if(!l&&!Et(e))return Sn([new Ci("","data expressions not supported")]);const u=vs(s,["zoom"]);if(!u&&!ca(e))return Sn([new Ci("","zoom expressions not supported")]);const p=Ps(s);return p||u?p instanceof Ci?Sn([p]):p instanceof zi&&!st(e)?Sn([new Ci("",'"interpolate" expressions cannot be used with this property')]):la(p?new mo(l?"camera":"composite",r.value,p.labels,p instanceof zi?p.interpolation:void 0):new Qn(l?"constant":"source",r.value)):Sn([new Ci("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ks{constructor(e,r){this._parameters=e,this._specification=r,Xi(this,Kn(this._parameters,this._specification))}static deserialize(e){return new ks(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Ps(i){let e=null;if(i instanceof Es)e=Ps(i.result);else if(i instanceof Is){for(const r of i.args)if(e=Ps(r),e)break}else(i instanceof Zn||i instanceof zi)&&i.input instanceof bt&&i.input.name==="zoom"&&(e=i);return e instanceof Ci||i.eachChild(r=>{const s=Ps(r);s instanceof Ci?e=s:!e&&s?e=new Ci("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&s&&e!==s&&(e=new Ci("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function Hi(i){const e=i.key,r=i.value,s=i.valueSpec||{},l=i.objectElementValidators||{},u=i.style,p=i.styleSpec;let f=[];const g=mt(r);if(g!=="object")return[new Te(e,r,`object expected, ${g} found`)];for(const x in r){const w=x.split(".")[0],I=s[w]||s["*"];let A;if(l[w])A=l[w];else if(s[w])A=ki;else if(l["*"])A=l["*"];else{if(!s["*"]){f.push(new Te(e,r[x],`unknown property "${x}"`));continue}A=ki}f=f.concat(A({key:(e&&`${e}.`)+x,value:r[x],valueSpec:I,style:u,styleSpec:p,object:r,objectKey:x},r))}for(const x in s)l[x]||s[x].required&&s[x].default===void 0&&r[x]===void 0&&f.push(new Te(e,r,`missing required property "${x}"`));return f}function da(i){const e=i.value,r=i.valueSpec,s=i.style,l=i.styleSpec,u=i.key,p=i.arrayElementValidator||ki;if(mt(e)!=="array")return[new Te(u,e,`array expected, ${mt(e)} found`)];if(r.length&&e.length!==r.length)return[new Te(u,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new Te(u,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let f={type:r.value,values:r.values};l.$version<7&&(f.function=r.function),mt(r.value)==="object"&&(f=r.value);let g=[];for(let x=0;x<e.length;x++)g=g.concat(p({array:e,arrayIndex:x,value:e[x],valueSpec:f,style:s,styleSpec:l,key:`${u}[${x}]`}));return g}function fo(i){const e=i.key,r=i.value,s=i.valueSpec;let l=mt(r);return l==="number"&&r!=r&&(l="NaN"),l!=="number"?[new Te(e,r,`number expected, ${l} found`)]:"minimum"in s&&r<s.minimum?[new Te(e,r,`${r} is less than the minimum value ${s.minimum}`)]:"maximum"in s&&r>s.maximum?[new Te(e,r,`${r} is greater than the maximum value ${s.maximum}`)]:[]}function pa(i){const e=i.valueSpec,r=lt(i.value.type);let s,l,u,p={};const f=r!=="categorical"&&i.value.property===void 0,g=!f,x=mt(i.value.stops)==="array"&&mt(i.value.stops[0])==="array"&&mt(i.value.stops[0][0])==="object",w=Hi({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(M){if(r==="identity")return[new Te(M.key,M.value,'identity function may not have a "stops" property')];let k=[];const N=M.value;return k=k.concat(da({key:M.key,value:N,valueSpec:M.valueSpec,style:M.style,styleSpec:M.styleSpec,arrayElementValidator:I})),mt(N)==="array"&&N.length===0&&k.push(new Te(M.key,N,"array must have at least one stop")),k},default:function(M){return ki({key:M.key,value:M.value,valueSpec:e,style:M.style,styleSpec:M.styleSpec})}}});return r==="identity"&&f&&w.push(new Te(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||w.push(new Te(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!st(i.valueSpec)&&w.push(new Te(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(g&&!Et(i.valueSpec)?w.push(new Te(i.key,i.value,"property functions not supported")):f&&!ca(i.valueSpec)&&w.push(new Te(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!x||i.value.property!==void 0||w.push(new Te(i.key,i.value,'"property" property is required')),w;function I(M){let k=[];const N=M.value,V=M.key;if(mt(N)!=="array")return[new Te(V,N,`array expected, ${mt(N)} found`)];if(N.length!==2)return[new Te(V,N,`array length 2 expected, length ${N.length} found`)];if(x){if(mt(N[0])!=="object")return[new Te(V,N,`object expected, ${mt(N[0])} found`)];if(N[0].zoom===void 0)return[new Te(V,N,"object stop key must have zoom")];if(N[0].value===void 0)return[new Te(V,N,"object stop key must have value")];if(u&&u>lt(N[0].zoom))return[new Te(V,N[0].zoom,"stop zoom values must appear in ascending order")];lt(N[0].zoom)!==u&&(u=lt(N[0].zoom),l=void 0,p={}),k=k.concat(Hi({key:`${V}[0]`,value:N[0],valueSpec:{zoom:{}},style:M.style,styleSpec:M.styleSpec,objectElementValidators:{zoom:fo,value:A}}))}else k=k.concat(A({key:`${V}[0]`,value:N[0],valueSpec:{},style:M.style,styleSpec:M.styleSpec},N));return Yn(Ui(N[1]))?k.concat([new Te(`${V}[1]`,N[1],"expressions are not allowed in function stops.")]):k.concat(ki({key:`${V}[1]`,value:N[1],valueSpec:e,style:M.style,styleSpec:M.styleSpec}))}function A(M,k){const N=mt(M.value),V=lt(M.value),J=M.value!==null?M.value:k;if(s){if(N!==s)return[new Te(M.key,J,`${N} stop domain type must match previous stop domain type ${s}`)]}else s=N;if(N!=="number"&&N!=="string"&&N!=="boolean")return[new Te(M.key,J,"stop domain value must be a number, string, or boolean")];if(N!=="number"&&r!=="categorical"){let oe=`number expected, ${N} found`;return Et(e)&&r===void 0&&(oe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Te(M.key,J,oe)]}return r!=="categorical"||N!=="number"||isFinite(V)&&Math.floor(V)===V?r!=="categorical"&&N==="number"&&l!==void 0&&V<l?[new Te(M.key,J,"stop domain values must appear in ascending order")]:(l=V,r==="categorical"&&V in p?[new Te(M.key,J,"stop domain values must be unique")]:(p[V]=!0,[])):[new Te(M.key,J,`integer expected, found ${V}`)]}}function Yr(i){const e=(i.expressionContext==="property"?ua:Jn)(Ui(i.value),i.valueSpec);if(e.result==="error")return e.value.map(s=>new Te(`${i.key}${s.key}`,i.value,s.message));const r=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new Te(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!wn(r))return[new Te(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!wn(r))return[new Te(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!vs(r,["zoom","feature-state"]))return[new Te(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!jn(r))return[new Te(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function es(i){const e=i.key,r=i.value,s=i.valueSpec,l=[];return Array.isArray(s.values)?s.values.indexOf(lt(r))===-1&&l.push(new Te(e,r,`expected one of [${s.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(s.values).indexOf(lt(r))===-1&&l.push(new Te(e,r,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(r)} found`)),l}function An(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!An(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const gl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ds(i){if(i==null)return{filter:()=>!0,needGeometry:!1};An(i)||(i=ts(i));const e=Jn(i,gl);if(e.result==="error")throw new Error(e.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,s,l)=>e.value.evaluate(r,s,{},l),needGeometry:fa(i)}}function ma(i,e){return i<e?-1:i>e?1:0}function fa(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(fa(i[e]))return!0;return!1}function ts(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?go(i[1],i[2],"=="):e==="!="?zn(go(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?go(i[1],i[2],e):e==="any"?(r=i.slice(1),["any"].concat(r.map(ts))):e==="all"?["all"].concat(i.slice(1).map(ts)):e==="none"?["all"].concat(i.slice(1).map(ts).map(zn)):e==="in"?Ls(i[1],i.slice(2)):e==="!in"?zn(Ls(i[1],i.slice(2))):e==="has"?is(i[1]):e==="!has"?zn(is(i[1])):e!=="within"||i;var r}function go(i,e,r){switch(i){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,i,e]}}function Ls(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",i,["literal",e.sort(ma)]]:["filter-in-small",i,["literal",e]]}}function is(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function zn(i){return["!",i]}function rs(i){return An(Ui(i.value))?Yr(Xi({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):ga(i)}function ga(i){const e=i.value,r=i.key;if(mt(e)!=="array")return[new Te(r,e,`array expected, ${mt(e)} found`)];const s=i.styleSpec;let l,u=[];if(e.length<1)return[new Te(r,e,"filter array must have at least 1 element")];switch(u=u.concat(es({key:`${r}[0]`,value:e[0],valueSpec:s.filter_operator,style:i.style,styleSpec:i.styleSpec})),lt(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&lt(e[1])==="$type"&&u.push(new Te(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&u.push(new Te(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(l=mt(e[1]),l!=="string"&&u.push(new Te(`${r}[1]`,e[1],`string expected, ${l} found`)));for(let p=2;p<e.length;p++)l=mt(e[p]),lt(e[1])==="$type"?u=u.concat(es({key:`${r}[${p}]`,value:e[p],valueSpec:s.geometry_type,style:i.style,styleSpec:i.styleSpec})):l!=="string"&&l!=="number"&&l!=="boolean"&&u.push(new Te(`${r}[${p}]`,e[p],`string, number, or boolean expected, ${l} found`));break;case"any":case"all":case"none":for(let p=1;p<e.length;p++)u=u.concat(ga({key:`${r}[${p}]`,value:e[p],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":l=mt(e[1]),e.length!==2?u.push(new Te(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):l!=="string"&&u.push(new Te(`${r}[1]`,e[1],`string expected, ${l} found`));break;case"within":l=mt(e[1]),e.length!==2?u.push(new Te(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):l!=="object"&&u.push(new Te(`${r}[1]`,e[1],`object expected, ${l} found`))}return u}function ns(i,e){const r=i.key,s=i.style,l=i.styleSpec,u=i.value,p=i.objectKey,f=l[`${e}_${i.layerType}`];if(!f)return[];const g=p.match(/^(.*)-transition$/);if(e==="paint"&&g&&f[g[1]]&&f[g[1]].transition)return ki({key:r,value:u,valueSpec:l.transition,style:s,styleSpec:l});const x=i.valueSpec||f[p];if(!x)return[new Te(r,u,`unknown property "${p}"`)];let w;if(mt(u)==="string"&&Et(x)&&!x.tokens&&(w=/^{([^}]+)}$/.exec(u)))return[new Te(r,u,`"${p}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(w[1])} }\`.`)];const I=[];return i.layerType==="symbol"&&(p==="text-field"&&s&&!s.glyphs&&I.push(new Te(r,u,'use of "text-field" requires a style "glyphs" property')),p==="text-font"&&It(Ui(u))&&lt(u.type)==="identity"&&I.push(new Te(r,u,'"text-font" does not support identity functions'))),I.concat(ki({key:i.key,value:u,valueSpec:x,style:s,styleSpec:l,expressionContext:"property",propertyType:e,propertyKey:p}))}function ya(i){return ns(i,"paint")}function _a(i){return ns(i,"layout")}function xa(i){let e=[];const r=i.value,s=i.key,l=i.style,u=i.styleSpec;r.type||r.ref||e.push(new Te(s,r,'either "type" or "ref" is required'));let p=lt(r.type);const f=lt(r.ref);if(r.id){const g=lt(r.id);for(let x=0;x<i.arrayIndex;x++){const w=l.layers[x];lt(w.id)===g&&e.push(new Te(s,r.id,`duplicate layer id "${r.id}", previously used at line ${w.id.__line__}`))}}if("ref"in r){let g;["type","source","source-layer","filter","layout"].forEach(x=>{x in r&&e.push(new Te(s,r[x],`"${x}" is prohibited for ref layers`))}),l.layers.forEach(x=>{lt(x.id)===f&&(g=x)}),g?g.ref?e.push(new Te(s,r.ref,"ref cannot reference another ref layer")):p=lt(g.type):e.push(new Te(s,r.ref,`ref layer "${f}" not found`))}else if(p!=="background")if(r.source){const g=l.sources&&l.sources[r.source],x=g&&lt(g.type);g?x==="vector"&&p==="raster"?e.push(new Te(s,r.source,`layer "${r.id}" requires a raster source`)):x==="raster"&&p!=="raster"?e.push(new Te(s,r.source,`layer "${r.id}" requires a vector source`)):x!=="vector"||r["source-layer"]?x==="raster-dem"&&p!=="hillshade"?e.push(new Te(s,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):p!=="line"||!r.paint||!r.paint["line-gradient"]||x==="geojson"&&g.lineMetrics||e.push(new Te(s,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Te(s,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new Te(s,r.source,`source "${r.source}" not found`))}else e.push(new Te(s,r,'missing required property "source"'));return e=e.concat(Hi({key:s,value:r,valueSpec:u.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ki({key:`${s}.type`,value:r.type,valueSpec:u.layer.type,style:i.style,styleSpec:i.styleSpec,object:r,objectKey:"type"}),filter:rs,layout:g=>Hi({layer:r,key:g.key,value:g.value,style:g.style,styleSpec:g.styleSpec,objectElementValidators:{"*":x=>_a(Xi({layerType:p},x))}}),paint:g=>Hi({layer:r,key:g.key,value:g.value,style:g.style,styleSpec:g.styleSpec,objectElementValidators:{"*":x=>ya(Xi({layerType:p},x))}})}})),e}function Mn(i){const e=i.value,r=i.key,s=mt(e);return s!=="string"?[new Te(r,e,`string expected, ${s} found`)]:[]}const va={promoteId:function({key:i,value:e}){if(mt(e)==="string")return Mn({key:i,value:e});{const r=[];for(const s in e)r.push(...Mn({key:`${i}.${s}`,value:e[s]}));return r}}};function ss(i){const e=i.value,r=i.key,s=i.styleSpec,l=i.style;if(!e.type)return[new Te(r,e,'"type" is required')];const u=lt(e.type);let p;switch(u){case"vector":case"raster":case"raster-dem":return p=Hi({key:r,value:e,valueSpec:s[`source_${u.replace("-","_")}`],style:i.style,styleSpec:s,objectElementValidators:va}),p;case"geojson":if(p=Hi({key:r,value:e,valueSpec:s.source_geojson,style:l,styleSpec:s,objectElementValidators:va}),e.cluster)for(const f in e.clusterProperties){const[g,x]=e.clusterProperties[f],w=typeof g=="string"?[g,["accumulated"],["get",f]]:g;p.push(...Yr({key:`${r}.${f}.map`,value:x,expressionContext:"cluster-map"})),p.push(...Yr({key:`${r}.${f}.reduce`,value:w,expressionContext:"cluster-reduce"}))}return p;case"video":return Hi({key:r,value:e,valueSpec:s.source_video,style:l,styleSpec:s});case"image":return Hi({key:r,value:e,valueSpec:s.source_image,style:l,styleSpec:s});case"canvas":return[new Te(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return es({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:l,styleSpec:s})}}function os(i){const e=i.value,r=i.styleSpec,s=r.light,l=i.style;let u=[];const p=mt(e);if(e===void 0)return u;if(p!=="object")return u=u.concat([new Te("light",e,`object expected, ${p} found`)]),u;for(const f in e){const g=f.match(/^(.*)-transition$/);u=u.concat(g&&s[g[1]]&&s[g[1]].transition?ki({key:f,value:e[f],valueSpec:r.transition,style:l,styleSpec:r}):s[f]?ki({key:f,value:e[f],valueSpec:s[f],style:l,styleSpec:r}):[new Te(f,e[f],`unknown property "${f}"`)])}return u}function Mi(i){const e=i.value,r=i.styleSpec,s=r.terrain,l=i.style;let u=[];const p=mt(e);if(e===void 0)return u;if(p!=="object")return u=u.concat([new Te("terrain",e,`object expected, ${p} found`)]),u;for(const f in e)u=u.concat(s[f]?ki({key:f,value:e[f],valueSpec:s[f],style:l,styleSpec:r}):[new Te(f,e[f],`unknown property "${f}"`)]);return u}const as={"*":()=>[],array:da,boolean:function(i){const e=i.value,r=i.key,s=mt(e);return s!=="boolean"?[new Te(r,e,`boolean expected, ${s} found`)]:[]},number:fo,color:function(i){const e=i.key,r=i.value,s=mt(r);return s!=="string"?[new Te(e,r,`color expected, ${s} found`)]:vn(r)===null?[new Te(e,r,`color expected, "${r}" found`)]:[]},constants:jr,enum:es,filter:rs,function:pa,layer:xa,object:Hi,source:ss,light:os,terrain:Mi,string:Mn,formatted:function(i){return Mn(i).length===0?[]:Yr(i)},resolvedImage:function(i){return Mn(i).length===0?[]:Yr(i)},padding:function(i){const e=i.key,r=i.value;if(mt(r)==="array"){if(r.length<1||r.length>4)return[new Te(e,r,`padding requires 1 to 4 values; ${r.length} values found`)];const s={type:"number"};let l=[];for(let u=0;u<r.length;u++)l=l.concat(ki({key:`${e}[${u}]`,value:r[u],valueSpec:s}));return l}return fo({key:e,value:r,valueSpec:{}})}};function ki(i){const e=i.value,r=i.valueSpec,s=i.styleSpec;return r.expression&&It(lt(e))?pa(i):r.expression&&Yn(Ui(e))?Yr(i):r.type&&as[r.type]?as[r.type](i):Hi(Xi({},i,{valueSpec:r.type?s[r.type]:r}))}function yl(i){const e=i.value,r=i.key,s=Mn(i);return s.length||(e.indexOf("{fontstack}")===-1&&s.push(new Te(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&s.push(new Te(r,e,'"glyphs" url must include a "{range}" token'))),s}function Lr(i,e=de){let r=[];return r=r.concat(ki({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,objectElementValidators:{glyphs:yl,"*":()=>[]}})),i.constants&&(r=r.concat(jr({key:"constants",value:i.constants,style:i,styleSpec:e}))),ba(r)}function ba(i){return[].concat(i).sort((e,r)=>e.line-r.line)}function yr(i){return function(...e){return ba(i.apply(this,e))}}Lr.source=yr(ss),Lr.light=yr(os),Lr.terrain=yr(Mi),Lr.layer=yr(xa),Lr.filter=yr(rs),Lr.paintProperty=yr(ya),Lr.layoutProperty=yr(_a);const ls=Lr,yo=ls.light,_l=ls.paintProperty,xl=ls.layoutProperty;function Bs(i,e){let r=!1;if(e&&e.length)for(const s of e)i.fire(new yn(new Error(s.message))),r=!0;return r}class cs{constructor(e,r,s){const l=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const p=new Int32Array(this.arrayBuffer);e=p[0],this.d=(r=p[1])+2*(s=p[2]);for(let g=0;g<this.d*this.d;g++){const x=p[3+g],w=p[3+g+1];l.push(x===w?null:p.subarray(x,w))}const f=p[3+l.length+1];this.keys=p.subarray(p[3+l.length],f),this.bboxes=p.subarray(f),this.insert=this._insertReadonly}else{this.d=r+2*s;for(let p=0;p<this.d*this.d;p++)l.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=e,this.padding=s,this.scale=r/e,this.uid=0;const u=s/r*e;this.min=-u,this.max=e+u}insert(e,r,s,l,u){this._forEachCell(r,s,l,u,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(r),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(u)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,r,s,l,u,p){this.cells[u].push(p)}query(e,r,s,l,u){const p=this.min,f=this.max;if(e<=p&&r<=p&&f<=s&&f<=l&&!u)return Array.prototype.slice.call(this.keys);{const g=[];return this._forEachCell(e,r,s,l,this._queryCell,g,{},u),g}}_queryCell(e,r,s,l,u,p,f,g){const x=this.cells[u];if(x!==null){const w=this.keys,I=this.bboxes;for(let A=0;A<x.length;A++){const M=x[A];if(f[M]===void 0){const k=4*M;(g?g(I[k+0],I[k+1],I[k+2],I[k+3]):e<=I[k+2]&&r<=I[k+3]&&s>=I[k+0]&&l>=I[k+1])?(f[M]=!0,p.push(w[M])):f[M]=!1}}}}_forEachCell(e,r,s,l,u,p,f,g){const x=this._convertToCellCoord(e),w=this._convertToCellCoord(r),I=this._convertToCellCoord(s),A=this._convertToCellCoord(l);for(let M=x;M<=I;M++)for(let k=w;k<=A;k++){const N=this.d*k+M;if((!g||g(this._convertFromCellCoord(M),this._convertFromCellCoord(k),this._convertFromCellCoord(M+1),this._convertFromCellCoord(k+1)))&&u.call(this,e,r,s,l,N,p,f,g))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,r=3+this.cells.length+1+1;let s=0;for(let p=0;p<this.cells.length;p++)s+=this.cells[p].length;const l=new Int32Array(r+s+this.keys.length+this.bboxes.length);l[0]=this.extent,l[1]=this.n,l[2]=this.padding;let u=r;for(let p=0;p<e.length;p++){const f=e[p];l[3+p]=u,l.set(f,u),u+=f.length}return l[3+e.length]=u,l.set(this.keys,u),u+=this.keys.length,l[3+e.length+1]=u,l.set(this.bboxes,u),u+=this.bboxes.length,l.buffer}static serialize(e,r){const s=e.toArrayBuffer();return r&&r.push(s),{buffer:s}}static deserialize(e){return new cs(e.buffer)}}const _r={};function De(i,e,r={}){if(_r[i])throw new Error(`${i} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),_r[i]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}De("Object",Object),De("TransferableGridIndex",cs),De("Color",D),De("Error",Error),De("AJAXError",Si),De("ResolvedImage",W),De("StylePropertyFunction",ks),De("StyleExpression",Ms,{omit:["_evaluator"]}),De("ZoomDependentExpression",mo),De("ZoomConstantExpression",Qn),De("CompoundExpression",bt,{omit:["_evaluate"]});for(const i in En)En[i]._classRegistryKey||De(`Expression_${i}`,En[i]);function wa(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Jr(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob)return i;if(wa(i)||er(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const r=i;return e&&e.push(r.buffer),r}if(i instanceof ImageData)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const r=[];for(const s of i)r.push(Jr(s,e));return r}if(typeof i=="object"){const r=i.constructor,s=r._classRegistryKey;if(!s)throw new Error("can't serialize object of unregistered class");if(!_r[s])throw new Error(`${s} is not registered.`);const l=r.serialize?r.serialize(i,e):{};if(r.serialize){if(e&&l===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const u in i){if(!i.hasOwnProperty(u)||_r[s].omit.indexOf(u)>=0)continue;const p=i[u];l[u]=_r[s].shallow.indexOf(u)>=0?p:Jr(p,e)}i instanceof Error&&(l.message=i.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(l.$name=s),l}throw new Error("can't serialize object of type "+typeof i)}function Br(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||wa(i)||er(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(Br);if(typeof i=="object"){const e=i.$name||"Object";if(!_r[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:r}=_r[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(i);const s=Object.create(r.prototype);for(const l of Object.keys(i)){if(l==="$name")continue;const u=i[l];s[l]=_r[e].shallow.indexOf(l)>=0?u:Br(u)}return s}throw new Error("can't deserialize object of type "+typeof i)}class _o{constructor(){this.first=!0}update(e,r){const s=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=s,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=s,!0):(this.lastFloorZoom>s?(this.lastIntegerZoom=s+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<s&&(this.lastIntegerZoom=s,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=s,!0))}}const Ee={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function Rs(i){for(const e of i)if(vo(e.charCodeAt(0)))return!0;return!1}function vl(i){for(const e of i)if(!xo(e.charCodeAt(0)))return!1;return!0}function xo(i){return!(Ee.Arabic(i)||Ee["Arabic Supplement"](i)||Ee["Arabic Extended-A"](i)||Ee["Arabic Presentation Forms-A"](i)||Ee["Arabic Presentation Forms-B"](i))}function vo(i){return!(i!==746&&i!==747&&(i<4352||!(Ee["Bopomofo Extended"](i)||Ee.Bopomofo(i)||Ee["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||Ee["CJK Compatibility Ideographs"](i)||Ee["CJK Compatibility"](i)||Ee["CJK Radicals Supplement"](i)||Ee["CJK Strokes"](i)||!(!Ee["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||Ee["CJK Unified Ideographs Extension A"](i)||Ee["CJK Unified Ideographs"](i)||Ee["Enclosed CJK Letters and Months"](i)||Ee["Hangul Compatibility Jamo"](i)||Ee["Hangul Jamo Extended-A"](i)||Ee["Hangul Jamo Extended-B"](i)||Ee["Hangul Jamo"](i)||Ee["Hangul Syllables"](i)||Ee.Hiragana(i)||Ee["Ideographic Description Characters"](i)||Ee.Kanbun(i)||Ee["Kangxi Radicals"](i)||Ee["Katakana Phonetic Extensions"](i)||Ee.Katakana(i)&&i!==12540||!(!Ee["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!Ee["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||Ee["Unified Canadian Aboriginal Syllabics"](i)||Ee["Unified Canadian Aboriginal Syllabics Extended"](i)||Ee["Vertical Forms"](i)||Ee["Yijing Hexagram Symbols"](i)||Ee["Yi Syllables"](i)||Ee["Yi Radicals"](i))))}function Ta(i){return!(vo(i)||function(e){return!!(Ee["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Ee["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Ee["Letterlike Symbols"](e)||Ee["Number Forms"](e)||Ee["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Ee["Control Pictures"](e)&&e!==9251||Ee["Optical Character Recognition"](e)||Ee["Enclosed Alphanumerics"](e)||Ee["Geometric Shapes"](e)||Ee["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Ee["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Ee["CJK Symbols and Punctuation"](e)||Ee.Katakana(e)||Ee["Private Use Area"](e)||Ee["CJK Compatibility Forms"](e)||Ee["Small Form Variants"](e)||Ee["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function Ia(i){return i>=1424&&i<=2303||Ee["Arabic Presentation Forms-A"](i)||Ee["Arabic Presentation Forms-B"](i)}function bl(i,e){return!(!e&&Ia(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||Ee.Khmer(i))}function Ea(i){for(const e of i)if(Ia(e.charCodeAt(0)))return!0;return!1}const bo="deferred",wo="loading",To="loaded";let Io=null,vi="unavailable",Rr=null;const Sa=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(vi="error"),Io&&Io(i)};function kn(){Eo.fire(new mr("pluginStateChange",{pluginStatus:vi,pluginURL:Rr}))}const Eo=new fr,hs=function(){return vi},Ca=function(){if(vi!==bo||!Rr)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");vi=wo,kn(),Rr&&gn({url:Rr},i=>{i?Sa(i):(vi=To,kn())})},Vi={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>vi===To||Vi.applyArabicShaping!=null,isLoading:()=>vi===wo,setState(i){if(!di())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");vi=i.pluginStatus,Rr=i.pluginURL},isParsed(){if(!di())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return Vi.applyArabicShaping!=null&&Vi.processBidirectionalText!=null&&Vi.processStyledBidirectionalText!=null},getPluginURL(){if(!di())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Rr}};class Mt{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new _o,this.transition={})}isSupportedScript(e){return function(r,s){for(const l of r)if(!bl(l.charCodeAt(0),s))return!1;return!0}(e,Vi.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,r=e-Math.floor(e),s=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*s}:{fromScale:.5,toScale:1,t:1-(1-s)*r}}}class us{constructor(e,r){this.property=e,this.value=r,this.expression=function(s,l){if(It(s))return new ks(s,l);if(Yn(s)){const u=ua(s,l);if(u.result==="error")throw new Error(u.value.map(p=>`${p.key}: ${p.message}`).join(", "));return u.value}{let u=s;return l.type==="color"&&typeof s=="string"?u=D.parse(s):l.type!=="padding"||typeof s!="number"&&!Array.isArray(s)||(u=G.parse(s)),{kind:"constant",evaluate:()=>u}}}(r===void 0?e.specification.default:r,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,s){return this.property.possiblyEvaluate(this,e,r,s)}}class Fs{constructor(e){this.property=e,this.value=new us(e,void 0)}transitioned(e,r){return new za(this.property,this.value,r,_t({},e.transition,this.transition),e.now)}untransitioned(){return new za(this.property,this.value,null,{},0)}}class Aa{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return oi(this._values[e].value.value)}setValue(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Fs(this._values[e].property)),this._values[e].value=new us(this._values[e].property,r===null?void 0:oi(r))}getTransition(e){return oi(this._values[e].transition)}setTransition(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Fs(this._values[e].property)),this._values[e].transition=oi(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(e[r]=s);const l=this.getTransition(r);l!==void 0&&(e[`${r}-transition`]=l)}return e}transitioned(e,r){const s=new Ma(this._properties);for(const l of Object.keys(this._values))s._values[l]=this._values[l].transitioned(e,r._values[l]);return s}untransitioned(){const e=new Ma(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class za{constructor(e,r,s,l,u){this.property=e,this.value=r,this.begin=u+l.delay||0,this.end=this.begin+l.duration||0,e.specification.transition&&(l.delay||l.duration)&&(this.prior=s)}possiblyEvaluate(e,r,s){const l=e.now||0,u=this.value.possiblyEvaluate(e,r,s),p=this.prior;if(p){if(l>this.end)return this.prior=null,u;if(this.value.isDataDriven())return this.prior=null,u;if(l<this.begin)return p.possiblyEvaluate(e,r,s);{const f=(l-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,r,s),u,function(g){if(g<=0)return 0;if(g>=1)return 1;const x=g*g,w=x*g;return 4*(g<.5?w:3*(g-x)+w-.75)}(f))}}return u}}class Ma{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,s){const l=new ds(this._properties);for(const u of Object.keys(this._values))l._values[u]=this._values[u].possiblyEvaluate(e,r,s);return l}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class wl{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return oi(this._values[e].value)}setValue(e,r){this._values[e]=new us(this._values[e].property,r===null?void 0:oi(r))}serialize(){const e={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(e[r]=s)}return e}possiblyEvaluate(e,r,s){const l=new ds(this._properties);for(const u of Object.keys(this._values))l._values[u]=this._values[u].possiblyEvaluate(e,r,s);return l}}class nr{constructor(e,r,s){this.property=e,this.value=r,this.parameters=s}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,s,l){return this.property.evaluate(this.value,this.parameters,e,r,s,l)}}class ds{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Oe{constructor(e){this.specification=e}possiblyEvaluate(e,r){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(r)}interpolate(e,r,s){const l=Xn[this.specification.type];return l?l(e,r,s):e}}class Ge{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,s,l){return new nr(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},s,l)}:e.expression,r)}interpolate(e,r,s){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new nr(this,{kind:"constant",value:void 0},e.parameters);const l=Xn[this.specification.type];return l?new nr(this,{kind:"constant",value:l(e.value.value,r.value.value,s)},e.parameters):e}evaluate(e,r,s,l,u,p){return e.kind==="constant"?e.value:e.evaluate(r,s,l,u,p)}}class Pn extends Ge{possiblyEvaluate(e,r,s,l){if(e.value===void 0)return new nr(this,{kind:"constant",value:void 0},r);if(e.expression.kind==="constant"){const u=e.expression.evaluate(r,null,{},s,l),p=e.property.specification.type==="resolvedImage"&&typeof u!="string"?u.name:u,f=this._calculate(p,p,p,r);return new nr(this,{kind:"constant",value:f},r)}if(e.expression.kind==="camera"){const u=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new nr(this,{kind:"constant",value:u},r)}return new nr(this,e.expression,r)}evaluate(e,r,s,l,u,p){if(e.kind==="source"){const f=e.evaluate(r,s,l,u,p);return this._calculate(f,f,f,r)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},s,l),e.evaluate({zoom:Math.floor(r.zoom)},s,l),e.evaluate({zoom:Math.floor(r.zoom)+1},s,l),r):e.value}_calculate(e,r,s,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:s,to:r}}interpolate(e){return e}}class So{constructor(e){this.specification=e}possiblyEvaluate(e,r,s,l){if(e.value!==void 0){if(e.expression.kind==="constant"){const u=e.expression.evaluate(r,null,{},s,l);return this._calculate(u,u,u,r)}return this._calculate(e.expression.evaluate(new Mt(Math.floor(r.zoom-1),r)),e.expression.evaluate(new Mt(Math.floor(r.zoom),r)),e.expression.evaluate(new Mt(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,s,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:s,to:r}}interpolate(e){return e}}class Fr{constructor(e){this.specification=e}possiblyEvaluate(e,r,s,l){return!!e.expression.evaluate(r,null,{},s,l)}interpolate(){return!1}}class ri{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in e){const s=e[r];s.specification.overridable&&this.overridableProperties.push(r);const l=this.defaultPropertyValues[r]=new us(s,void 0),u=this.defaultTransitionablePropertyValues[r]=new Fs(s);this.defaultTransitioningPropertyValues[r]=u.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=l.possiblyEvaluate({})}}}De("DataDrivenProperty",Ge),De("DataConstantProperty",Oe),De("CrossFadedDataDrivenProperty",Pn),De("CrossFadedProperty",So),De("ColorRampProperty",Fr);const Or="-transition";class sr extends fr{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new wl(r.layout)),r.paint)){this._transitionablePaint=new Aa(r.paint);for(const s in e.paint)this.setPaintProperty(s,e.paint[s],{validate:!1});for(const s in e.layout)this.setLayoutProperty(s,e.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ds(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,s={}){r!=null&&this._validate(xl,`layers.${this.id}.layout.${e}`,e,r,s)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return e.endsWith(Or)?this._transitionablePaint.getTransition(e.slice(0,-Or.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,s={}){if(r!=null&&this._validate(_l,`layers.${this.id}.paint.${e}`,e,r,s))return!1;if(e.endsWith(Or))return this._transitionablePaint.setTransition(e.slice(0,-Or.length),r||void 0),!1;{const l=this._transitionablePaint._values[e],u=l.property.specification["property-type"]==="cross-faded-data-driven",p=l.value.isDataDriven(),f=l.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const g=this._transitionablePaint._values[e].value;return g.isDataDriven()||p||u||this._handleOverridablePaintPropertyUpdate(e,f,g)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,r,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),qt(e,(r,s)=>!(r===void 0||s==="layout"&&!Object.keys(r).length||s==="paint"&&!Object.keys(r).length))}_validate(e,r,s,l,u={}){return(!u||u.validate!==!1)&&Bs(this,e.call(ls,{key:r,layerType:this.type,objectKey:s,value:l,styleSpec:de,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof nr&&Et(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const ka={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ur{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ft{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Nt(i,e=1){let r=0,s=0;return{members:i.map(l=>{const u=ka[l.type].BYTES_PER_ELEMENT,p=r=Co(r,Math.max(e,u)),f=l.components||1;return s=Math.max(s,u),r+=u*f,{name:l.name,type:l.type,components:f,offset:p}}),size:Co(r,Math.max(s,e)),alignment:e}}function Co(i,e){return Math.ceil(i/e)*e}class Qr extends Ft{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const l=2*e;return this.int16[l+0]=r,this.int16[l+1]=s,e}}Qr.prototype.bytesPerElement=4,De("StructArrayLayout2i4",Qr);class a extends Ft{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,s,l)}emplace(e,r,s,l,u){const p=4*e;return this.int16[p+0]=r,this.int16[p+1]=s,this.int16[p+2]=l,this.int16[p+3]=u,e}}a.prototype.bytesPerElement=8,De("StructArrayLayout4i8",a);class t extends Ft{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,l,u,p){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,s,l,u,p)}emplace(e,r,s,l,u,p,f){const g=6*e;return this.int16[g+0]=r,this.int16[g+1]=s,this.int16[g+2]=l,this.int16[g+3]=u,this.int16[g+4]=p,this.int16[g+5]=f,e}}t.prototype.bytesPerElement=12,De("StructArrayLayout2i4i12",t);class n extends Ft{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,l,u,p){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,s,l,u,p)}emplace(e,r,s,l,u,p,f){const g=4*e,x=8*e;return this.int16[g+0]=r,this.int16[g+1]=s,this.uint8[x+4]=l,this.uint8[x+5]=u,this.uint8[x+6]=p,this.uint8[x+7]=f,e}}n.prototype.bytesPerElement=8,De("StructArrayLayout2i4ub8",n);class o extends Ft{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const l=2*e;return this.float32[l+0]=r,this.float32[l+1]=s,e}}o.prototype.bytesPerElement=8,De("StructArrayLayout2f8",o);class c extends Ft{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,l,u,p,f,g,x,w){const I=this.length;return this.resize(I+1),this.emplace(I,e,r,s,l,u,p,f,g,x,w)}emplace(e,r,s,l,u,p,f,g,x,w,I){const A=10*e;return this.uint16[A+0]=r,this.uint16[A+1]=s,this.uint16[A+2]=l,this.uint16[A+3]=u,this.uint16[A+4]=p,this.uint16[A+5]=f,this.uint16[A+6]=g,this.uint16[A+7]=x,this.uint16[A+8]=w,this.uint16[A+9]=I,e}}c.prototype.bytesPerElement=20,De("StructArrayLayout10ui20",c);class d extends Ft{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,l,u,p,f,g,x,w,I,A){const M=this.length;return this.resize(M+1),this.emplace(M,e,r,s,l,u,p,f,g,x,w,I,A)}emplace(e,r,s,l,u,p,f,g,x,w,I,A,M){const k=12*e;return this.int16[k+0]=r,this.int16[k+1]=s,this.int16[k+2]=l,this.int16[k+3]=u,this.uint16[k+4]=p,this.uint16[k+5]=f,this.uint16[k+6]=g,this.uint16[k+7]=x,this.int16[k+8]=w,this.int16[k+9]=I,this.int16[k+10]=A,this.int16[k+11]=M,e}}d.prototype.bytesPerElement=24,De("StructArrayLayout4i4ui4i24",d);class m extends Ft{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,s)}emplace(e,r,s,l){const u=3*e;return this.float32[u+0]=r,this.float32[u+1]=s,this.float32[u+2]=l,e}}m.prototype.bytesPerElement=12,De("StructArrayLayout3f12",m);class y extends Ft{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}y.prototype.bytesPerElement=4,De("StructArrayLayout1ul4",y);class _ extends Ft{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,l,u,p,f,g,x){const w=this.length;return this.resize(w+1),this.emplace(w,e,r,s,l,u,p,f,g,x)}emplace(e,r,s,l,u,p,f,g,x,w){const I=10*e,A=5*e;return this.int16[I+0]=r,this.int16[I+1]=s,this.int16[I+2]=l,this.int16[I+3]=u,this.int16[I+4]=p,this.int16[I+5]=f,this.uint32[A+3]=g,this.uint16[I+8]=x,this.uint16[I+9]=w,e}}_.prototype.bytesPerElement=20,De("StructArrayLayout6i1ul2ui20",_);class v extends Ft{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,l,u,p){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,s,l,u,p)}emplace(e,r,s,l,u,p,f){const g=6*e;return this.int16[g+0]=r,this.int16[g+1]=s,this.int16[g+2]=l,this.int16[g+3]=u,this.int16[g+4]=p,this.int16[g+5]=f,e}}v.prototype.bytesPerElement=12,De("StructArrayLayout2i2i2i12",v);class T extends Ft{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,l,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,s,l,u)}emplace(e,r,s,l,u,p){const f=4*e,g=8*e;return this.float32[f+0]=r,this.float32[f+1]=s,this.float32[f+2]=l,this.int16[g+6]=u,this.int16[g+7]=p,e}}T.prototype.bytesPerElement=16,De("StructArrayLayout2f1f2i16",T);class C extends Ft{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,s,l)}emplace(e,r,s,l,u){const p=12*e,f=3*e;return this.uint8[p+0]=r,this.uint8[p+1]=s,this.float32[f+1]=l,this.float32[f+2]=u,e}}C.prototype.bytesPerElement=12,De("StructArrayLayout2ub2f12",C);class z extends Ft{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,s)}emplace(e,r,s,l){const u=3*e;return this.uint16[u+0]=r,this.uint16[u+1]=s,this.uint16[u+2]=l,e}}z.prototype.bytesPerElement=6,De("StructArrayLayout3ui6",z);class F extends Ft{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,l,u,p,f,g,x,w,I,A,M,k,N,V,J){const oe=this.length;return this.resize(oe+1),this.emplace(oe,e,r,s,l,u,p,f,g,x,w,I,A,M,k,N,V,J)}emplace(e,r,s,l,u,p,f,g,x,w,I,A,M,k,N,V,J,oe){const Y=24*e,ne=12*e,me=48*e;return this.int16[Y+0]=r,this.int16[Y+1]=s,this.uint16[Y+2]=l,this.uint16[Y+3]=u,this.uint32[ne+2]=p,this.uint32[ne+3]=f,this.uint32[ne+4]=g,this.uint16[Y+10]=x,this.uint16[Y+11]=w,this.uint16[Y+12]=I,this.float32[ne+7]=A,this.float32[ne+8]=M,this.uint8[me+36]=k,this.uint8[me+37]=N,this.uint8[me+38]=V,this.uint32[ne+10]=J,this.int16[Y+22]=oe,e}}F.prototype.bytesPerElement=48,De("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",F);class B extends Ft{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,l,u,p,f,g,x,w,I,A,M,k,N,V,J,oe,Y,ne,me,pe,ke,Be,Se,we,xe,Ce){const Ie=this.length;return this.resize(Ie+1),this.emplace(Ie,e,r,s,l,u,p,f,g,x,w,I,A,M,k,N,V,J,oe,Y,ne,me,pe,ke,Be,Se,we,xe,Ce)}emplace(e,r,s,l,u,p,f,g,x,w,I,A,M,k,N,V,J,oe,Y,ne,me,pe,ke,Be,Se,we,xe,Ce,Ie){const _e=34*e,Ne=17*e;return this.int16[_e+0]=r,this.int16[_e+1]=s,this.int16[_e+2]=l,this.int16[_e+3]=u,this.int16[_e+4]=p,this.int16[_e+5]=f,this.int16[_e+6]=g,this.int16[_e+7]=x,this.uint16[_e+8]=w,this.uint16[_e+9]=I,this.uint16[_e+10]=A,this.uint16[_e+11]=M,this.uint16[_e+12]=k,this.uint16[_e+13]=N,this.uint16[_e+14]=V,this.uint16[_e+15]=J,this.uint16[_e+16]=oe,this.uint16[_e+17]=Y,this.uint16[_e+18]=ne,this.uint16[_e+19]=me,this.uint16[_e+20]=pe,this.uint16[_e+21]=ke,this.uint16[_e+22]=Be,this.uint32[Ne+12]=Se,this.float32[Ne+13]=we,this.float32[Ne+14]=xe,this.float32[Ne+15]=Ce,this.float32[Ne+16]=Ie,e}}B.prototype.bytesPerElement=68,De("StructArrayLayout8i15ui1ul4f68",B);class R extends Ft{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}R.prototype.bytesPerElement=4,De("StructArrayLayout1f4",R);class Z extends Ft{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,s)}emplace(e,r,s,l){const u=3*e;return this.int16[u+0]=r,this.int16[u+1]=s,this.int16[u+2]=l,e}}Z.prototype.bytesPerElement=6,De("StructArrayLayout3i6",Z);class K extends Ft{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,s)}emplace(e,r,s,l){const u=4*e;return this.uint32[2*e+0]=r,this.uint16[u+2]=s,this.uint16[u+3]=l,e}}K.prototype.bytesPerElement=8,De("StructArrayLayout1ul2ui8",K);class ee extends Ft{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const l=2*e;return this.uint16[l+0]=r,this.uint16[l+1]=s,e}}ee.prototype.bytesPerElement=4,De("StructArrayLayout2ui4",ee);class U extends Ft{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}U.prototype.bytesPerElement=2,De("StructArrayLayout1ui2",U);class se extends Ft{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,s,l)}emplace(e,r,s,l,u){const p=4*e;return this.float32[p+0]=r,this.float32[p+1]=s,this.float32[p+2]=l,this.float32[p+3]=u,e}}se.prototype.bytesPerElement=16,De("StructArrayLayout4f16",se);class te extends Ur{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new je(this.anchorPointX,this.anchorPointY)}}te.prototype.size=20;class he extends _{get(e){return new te(this,e)}}De("CollisionBoxArray",he);class ue extends Ur{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}ue.prototype.size=48;class ye extends F{get(e){return new ue(this,e)}}De("PlacedSymbolArray",ye);class ce extends Ur{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}ce.prototype.size=68;class ze extends B{get(e){return new ce(this,e)}}De("SymbolInstanceArray",ze);class be extends R{getoffsetX(e){return this.float32[1*e+0]}}De("GlyphOffsetArray",be);class Me extends Z{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}De("SymbolLineVertexArray",Me);class Ye extends Ur{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Ye.prototype.size=8;class tt extends K{get(e){return new Ye(this,e)}}De("FeatureIndexArray",tt);class Ve extends Qr{}class gt extends Qr{}class yt extends Qr{}class ot extends t{}class ut extends n{}class vt extends o{}class Kt extends c{}class or extends d{}class Wi extends m{}class ar extends y{}class Vr extends v{}class Ni extends C{}class bi extends z{}class xr extends ee{}const Os=Nt([{name:"a_pos",components:2,type:"Int16"}],4),{members:jt}=Os;class rt{constructor(e=[]){this.segments=e}prepareSegment(e,r,s,l){let u=this.segments[this.segments.length-1];return e>rt.MAX_VERTEX_ARRAY_LENGTH&&Rt(`Max vertices per segment is ${rt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!u||u.vertexLength+e>rt.MAX_VERTEX_ARRAY_LENGTH||u.sortKey!==l)&&(u={vertexOffset:r.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},l!==void 0&&(u.sortKey=l),this.segments.push(u)),u}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,s,l){return new rt([{vertexOffset:e,primitiveOffset:r,vertexLength:s,primitiveLength:l,vaos:{},sortKey:0}])}}function ft(i,e){return 256*(i=re(Math.floor(i),0,255))+re(Math.floor(e),0,255)}rt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,De("SegmentVector",rt);const Yt=Nt([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Jt={exports:{}},kt={exports:{}};kt.exports=function(i,e){var r,s,l,u,p,f,g,x;for(s=i.length-(r=3&i.length),l=e,p=3432918353,f=461845907,x=0;x<s;)g=255&i.charCodeAt(x)|(255&i.charCodeAt(++x))<<8|(255&i.charCodeAt(++x))<<16|(255&i.charCodeAt(++x))<<24,++x,l=27492+(65535&(u=5*(65535&(l=(l^=g=(65535&(g=(g=(65535&g)*p+(((g>>>16)*p&65535)<<16)&4294967295)<<15|g>>>17))*f+(((g>>>16)*f&65535)<<16)&4294967295)<<13|l>>>19))+((5*(l>>>16)&65535)<<16)&4294967295))+((58964+(u>>>16)&65535)<<16);switch(g=0,r){case 3:g^=(255&i.charCodeAt(x+2))<<16;case 2:g^=(255&i.charCodeAt(x+1))<<8;case 1:l^=g=(65535&(g=(g=(65535&(g^=255&i.charCodeAt(x)))*p+(((g>>>16)*p&65535)<<16)&4294967295)<<15|g>>>17))*f+(((g>>>16)*f&65535)<<16)&4294967295}return l^=i.length,l=2246822507*(65535&(l^=l>>>16))+((2246822507*(l>>>16)&65535)<<16)&4294967295,l=3266489909*(65535&(l^=l>>>13))+((3266489909*(l>>>16)&65535)<<16)&4294967295,(l^=l>>>16)>>>0};var $i={exports:{}};$i.exports=function(i,e){for(var r,s=i.length,l=e^s,u=0;s>=4;)r=1540483477*(65535&(r=255&i.charCodeAt(u)|(255&i.charCodeAt(++u))<<8|(255&i.charCodeAt(++u))<<16|(255&i.charCodeAt(++u))<<24))+((1540483477*(r>>>16)&65535)<<16),l=1540483477*(65535&l)+((1540483477*(l>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),s-=4,++u;switch(s){case 3:l^=(255&i.charCodeAt(u+2))<<16;case 2:l^=(255&i.charCodeAt(u+1))<<8;case 1:l=1540483477*(65535&(l^=255&i.charCodeAt(u)))+((1540483477*(l>>>16)&65535)<<16)}return l=1540483477*(65535&(l^=l>>>13))+((1540483477*(l>>>16)&65535)<<16),(l^=l>>>15)>>>0};var en=kt.exports,Ao=$i.exports;Jt.exports=en,Jt.exports.murmur3=en,Jt.exports.murmur2=Ao;class Dn{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,s,l){this.ids.push(Pa(e)),this.positions.push(r,s,l)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=Pa(e);let s=0,l=this.ids.length-1;for(;s<l;){const p=s+l>>1;this.ids[p]>=r?l=p:s=p+1}const u=[];for(;this.ids[s]===r;)u.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return u}static serialize(e,r){const s=new Float64Array(e.ids),l=new Uint32Array(e.positions);return zo(s,l,0,s.length-1),r&&r.push(s.buffer,l.buffer),{ids:s,positions:l}}static deserialize(e){const r=new Dn;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function Pa(i){const e=+i;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:Jt.exports(String(i))}function zo(i,e,r,s){for(;r<s;){const l=i[r+s>>1];let u=r-1,p=s+1;for(;;){do u++;while(i[u]<l);do p--;while(i[p]>l);if(u>=p)break;Nr(i,u,p),Nr(e,3*u,3*p),Nr(e,3*u+1,3*p+1),Nr(e,3*u+2,3*p+2)}p-r<s-p?(zo(i,e,r,p),r=p+1):(zo(i,e,p+1,s),s=p)}}function Nr(i,e,r){const s=i[e];i[e]=i[r],i[r]=s}De("FeaturePositionMap",Dn);class tn{constructor(e,r){this.gl=e.gl,this.location=r}}class rn extends tn{constructor(e,r){super(e,r),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Us extends tn{constructor(e,r){super(e,r),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class lc extends tn{constructor(e,r){super(e,r),this.current=D.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Rh=new Float32Array(16);function Tl(i){return[ft(255*i.r,255*i.g),ft(255*i.b,255*i.a)]}class Mo{constructor(e,r,s){this.value=e,this.uniformNames=r.map(l=>`u_${l}`),this.type=s}setUniform(e,r,s){e.set(s.constantOr(this.value))}getBinding(e,r,s){return this.type==="color"?new lc(e,r):new rn(e,r)}}class Vs{constructor(e,r){this.uniformNames=r.map(s=>`u_${s}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=e.tlbr}setUniform(e,r,s,l){const u=l==="u_pattern_to"?this.patternTo:l==="u_pattern_from"?this.patternFrom:l==="u_pixel_ratio_to"?this.pixelRatioTo:l==="u_pixel_ratio_from"?this.pixelRatioFrom:null;u&&e.set(u)}getBinding(e,r,s){return s.substr(0,9)==="u_pattern"?new Us(e,r):new rn(e,r)}}class nn{constructor(e,r,s,l){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=r.map(u=>({name:`a_${u}`,type:"Float32",components:s==="color"?2:1,offset:0})),this.paintVertexArray=new l}populatePaintArray(e,r,s,l,u){const p=this.paintVertexArray.length,f=this.expression.evaluate(new Mt(0),r,{},l,[],u);this.paintVertexArray.resize(e),this._setPaintValue(p,e,f)}updatePaintArray(e,r,s,l){const u=this.expression.evaluate({zoom:0},s,l);this._setPaintValue(e,r,u)}_setPaintValue(e,r,s){if(this.type==="color"){const l=Tl(s);for(let u=e;u<r;u++)this.paintVertexArray.emplace(u,l[0],l[1])}else{for(let l=e;l<r;l++)this.paintVertexArray.emplace(l,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class vr{constructor(e,r,s,l,u,p){this.expression=e,this.uniformNames=r.map(f=>`u_${f}_t`),this.type=s,this.useIntegerZoom=l,this.zoom=u,this.maxValue=0,this.paintVertexAttributes=r.map(f=>({name:`a_${f}`,type:"Float32",components:s==="color"?4:2,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,r,s,l,u){const p=this.expression.evaluate(new Mt(this.zoom),r,{},l,[],u),f=this.expression.evaluate(new Mt(this.zoom+1),r,{},l,[],u),g=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(g,e,p,f)}updatePaintArray(e,r,s,l){const u=this.expression.evaluate({zoom:this.zoom},s,l),p=this.expression.evaluate({zoom:this.zoom+1},s,l);this._setPaintValue(e,r,u,p)}_setPaintValue(e,r,s,l){if(this.type==="color"){const u=Tl(s),p=Tl(l);for(let f=e;f<r;f++)this.paintVertexArray.emplace(f,u[0],u[1],p[0],p[1])}else{for(let u=e;u<r;u++)this.paintVertexArray.emplace(u,s,l);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r){const s=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,l=re(this.expression.interpolationFactor(s,this.zoom,this.zoom+1),0,1);e.set(l)}getBinding(e,r,s){return new rn(e,r)}}class Ln{constructor(e,r,s,l,u,p){this.expression=e,this.type=r,this.useIntegerZoom=s,this.zoom=l,this.layerId=p,this.zoomInPaintVertexArray=new u,this.zoomOutPaintVertexArray=new u}populatePaintArray(e,r,s){const l=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(l,e,r.patterns&&r.patterns[this.layerId],s)}updatePaintArray(e,r,s,l,u){this._setPaintValues(e,r,s.patterns&&s.patterns[this.layerId],u)}_setPaintValues(e,r,s,l){if(!l||!s)return;const{min:u,mid:p,max:f}=s,g=l[u],x=l[p],w=l[f];if(g&&x&&w)for(let I=e;I<r;I++)this.zoomInPaintVertexArray.emplace(I,x.tl[0],x.tl[1],x.br[0],x.br[1],g.tl[0],g.tl[1],g.br[0],g.br[1],x.pixelRatio,g.pixelRatio),this.zoomOutPaintVertexArray.emplace(I,x.tl[0],x.tl[1],x.br[0],x.br[1],w.tl[0],w.tl[1],w.br[0],w.br[1],x.pixelRatio,w.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,Yt.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,Yt.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class cc{constructor(e,r,s){this.binders={},this._buffers=[];const l=[];for(const u in e.paint._values){if(!s(u))continue;const p=e.paint.get(u);if(!(p instanceof nr&&Et(p.property.specification)))continue;const f=Fh(u,e.type),g=p.value,x=p.property.specification.type,w=p.property.useIntegerZoom,I=p.property.specification["property-type"],A=I==="cross-faded"||I==="cross-faded-data-driven";if(g.kind==="constant")this.binders[u]=A?new Vs(g.value,f):new Mo(g.value,f,x),l.push(`/u_${u}`);else if(g.kind==="source"||A){const M=hc(u,x,"source");this.binders[u]=A?new Ln(g,x,w,r,M,e.id):new nn(g,f,x,M),l.push(`/a_${u}`)}else{const M=hc(u,x,"composite");this.binders[u]=new vr(g,f,x,w,r,M),l.push(`/z_${u}`)}}this.cacheKey=l.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof nn||r instanceof vr?r.maxValue:0}populatePaintArrays(e,r,s,l,u){for(const p in this.binders){const f=this.binders[p];(f instanceof nn||f instanceof vr||f instanceof Ln)&&f.populatePaintArray(e,r,s,l,u)}}setConstantPatternPositions(e,r){for(const s in this.binders){const l=this.binders[s];l instanceof Vs&&l.setConstantPatternPositions(e,r)}}updatePaintArrays(e,r,s,l,u){let p=!1;for(const f in e){const g=r.getPositions(f);for(const x of g){const w=s.feature(x.index);for(const I in this.binders){const A=this.binders[I];if((A instanceof nn||A instanceof vr||A instanceof Ln)&&A.expression.isStateDependent===!0){const M=l.paint.get(I);A.expression=M.value,A.updatePaintArray(x.start,x.end,w,e[f],u),p=!0}}}}return p}defines(){const e=[];for(const r in this.binders){const s=this.binders[r];(s instanceof Mo||s instanceof Vs)&&e.push(...s.uniformNames.map(l=>`#define HAS_UNIFORM_${l}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof nn||s instanceof vr)for(let l=0;l<s.paintVertexAttributes.length;l++)e.push(s.paintVertexAttributes[l].name);else if(s instanceof Ln)for(let l=0;l<Yt.members.length;l++)e.push(Yt.members[l].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof Mo||s instanceof Vs||s instanceof vr)for(const l of s.uniformNames)e.push(l)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,r){const s=[];for(const l in this.binders){const u=this.binders[l];if(u instanceof Mo||u instanceof Vs||u instanceof vr){for(const p of u.uniformNames)if(r[p]){const f=u.getBinding(e,r[p],p);s.push({name:p,property:l,binding:f})}}}return s}setUniforms(e,r,s,l){for(const{name:u,property:p,binding:f}of r)this.binders[p].setUniform(f,l,s.get(p),u)}updatePaintBuffers(e){this._buffers=[];for(const r in this.binders){const s=this.binders[r];if(e&&s instanceof Ln){const l=e.fromScale===2?s.zoomInPaintVertexBuffer:s.zoomOutPaintVertexBuffer;l&&this._buffers.push(l)}else(s instanceof nn||s instanceof vr)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(e){for(const r in this.binders){const s=this.binders[r];(s instanceof nn||s instanceof vr||s instanceof Ln)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof nn||r instanceof vr||r instanceof Ln)&&r.destroy()}}}class ps{constructor(e,r,s=()=>!0){this.programConfigurations={};for(const l of e)this.programConfigurations[l.id]=new cc(l,r,s);this.needsUpload=!1,this._featureMap=new Dn,this._bufferOffset=0}populatePaintArrays(e,r,s,l,u,p){for(const f in this.programConfigurations)this.programConfigurations[f].populatePaintArrays(e,r,l,u,p);r.id!==void 0&&this._featureMap.add(r.id,s,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,s,l){for(const u of s)this.needsUpload=this.programConfigurations[u.id].updatePaintArrays(e,this._featureMap,r,u,l)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function Fh(i,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}function hc(i,e,r){const s={color:{source:o,composite:se},number:{source:R,composite:o}},l=function(u){return{"line-pattern":{source:Kt,composite:Kt},"fill-pattern":{source:Kt,composite:Kt},"fill-extrusion-pattern":{source:Kt,composite:Kt}}[u]}(i);return l&&l[r]||s[e][r]}De("ConstantBinder",Mo),De("CrossFadedConstantBinder",Vs),De("SourceExpressionBinder",nn),De("CrossFadedCompositeBinder",Ln),De("CompositeExpressionBinder",vr),De("ProgramConfiguration",cc,{omit:["_buffers"]}),De("ProgramConfigurationSet",ps);var Zt=8192;const Il=Math.pow(2,14)-1,uc=-Il-1;function ms(i){const e=Zt/i.extent,r=i.loadGeometry();for(let s=0;s<r.length;s++){const l=r[s];for(let u=0;u<l.length;u++){const p=l[u],f=Math.round(p.x*e),g=Math.round(p.y*e);p.x=re(f,uc,Il),p.y=re(g,uc,Il),(f<p.x||f>p.x+1||g<p.y||g>p.y+1)&&Rt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function fs(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?ms(i):[]}}function Da(i,e,r,s,l){i.emplaceBack(2*e+(s+1)/2,2*r+(l+1)/2)}class El{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new gt,this.indexArray=new bi,this.segments=new rt,this.programConfigurations=new ps(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s){const l=this.layers[0],u=[];let p=null,f=!1;l.type==="circle"&&(p=l.layout.get("circle-sort-key"),f=!p.isConstant());for(const{feature:g,id:x,index:w,sourceLayerIndex:I}of e){const A=this.layers[0]._featureFilter.needGeometry,M=fs(g,A);if(!this.layers[0]._featureFilter.filter(new Mt(this.zoom),M,s))continue;const k=f?p.evaluate(M,{},s):void 0,N={id:x,properties:g.properties,type:g.type,sourceLayerIndex:I,index:w,geometry:A?M.geometry:ms(g),patterns:{},sortKey:k};u.push(N)}f&&u.sort((g,x)=>g.sortKey-x.sortKey);for(const g of u){const{geometry:x,index:w,sourceLayerIndex:I}=g,A=e[w].feature;this.addFeature(g,x,w,s),r.featureIndex.insert(A,x,w,I,this.index)}}update(e,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,jt),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,s,l){for(const u of r)for(const p of u){const f=p.x,g=p.y;if(f<0||f>=Zt||g<0||g>=Zt)continue;const x=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),w=x.vertexLength;Da(this.layoutVertexArray,f,g,-1,-1),Da(this.layoutVertexArray,f,g,1,-1),Da(this.layoutVertexArray,f,g,1,1),Da(this.layoutVertexArray,f,g,-1,1),this.indexArray.emplaceBack(w,w+1,w+2),this.indexArray.emplaceBack(w,w+3,w+2),x.vertexLength+=4,x.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},l)}}function dc(i,e){for(let r=0;r<i.length;r++)if(Ns(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(Ns(i,e[r]))return!0;return!!Sl(i,e)}function Oh(i,e,r){return!!Ns(i,e)||!!Cl(e,i,r)}function pc(i,e){if(i.length===1)return fc(e,i[0]);for(let r=0;r<e.length;r++){const s=e[r];for(let l=0;l<s.length;l++)if(Ns(i,s[l]))return!0}for(let r=0;r<i.length;r++)if(fc(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(Sl(i,e[r]))return!0;return!1}function Uh(i,e,r){if(i.length>1){if(Sl(i,e))return!0;for(let s=0;s<e.length;s++)if(Cl(e[s],i,r))return!0}for(let s=0;s<i.length;s++)if(Cl(i[s],e,r))return!0;return!1}function Sl(i,e){if(i.length===0||e.length===0)return!1;for(let r=0;r<i.length-1;r++){const s=i[r],l=i[r+1];for(let u=0;u<e.length-1;u++)if(Vh(s,l,e[u],e[u+1]))return!0}return!1}function Vh(i,e,r,s){return Fi(i,r,s)!==Fi(e,r,s)&&Fi(i,e,r)!==Fi(i,e,s)}function Cl(i,e,r){const s=r*r;if(e.length===1)return i.distSqr(e[0])<s;for(let l=1;l<e.length;l++)if(mc(i,e[l-1],e[l])<s)return!0;return!1}function mc(i,e,r){const s=e.distSqr(r);if(s===0)return i.distSqr(e);const l=((i.x-e.x)*(r.x-e.x)+(i.y-e.y)*(r.y-e.y))/s;return i.distSqr(l<0?e:l>1?r:r.sub(e)._mult(l)._add(e))}function fc(i,e){let r,s,l,u=!1;for(let p=0;p<i.length;p++){r=i[p];for(let f=0,g=r.length-1;f<r.length;g=f++)s=r[f],l=r[g],s.y>e.y!=l.y>e.y&&e.x<(l.x-s.x)*(e.y-s.y)/(l.y-s.y)+s.x&&(u=!u)}return u}function Ns(i,e){let r=!1;for(let s=0,l=i.length-1;s<i.length;l=s++){const u=i[s],p=i[l];u.y>e.y!=p.y>e.y&&e.x<(p.x-u.x)*(e.y-u.y)/(p.y-u.y)+u.x&&(r=!r)}return r}function Nh(i,e,r){const s=r[0],l=r[2];if(i.x<s.x&&e.x<s.x||i.x>l.x&&e.x>l.x||i.y<s.y&&e.y<s.y||i.y>l.y&&e.y>l.y)return!1;const u=Fi(i,e,r[0]);return u!==Fi(i,e,r[1])||u!==Fi(i,e,r[2])||u!==Fi(i,e,r[3])}function ko(i,e,r){const s=e.paint.get(i).value;return s.kind==="constant"?s.value:r.programConfigurations.get(e.id).getMaxValue(i)}function La(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function Ba(i,e,r,s,l){if(!e[0]&&!e[1])return i;const u=je.convert(e)._mult(l);r==="viewport"&&u._rotate(-s);const p=[];for(let f=0;f<i.length;f++)p.push(i[f].sub(u));return p}De("CircleBucket",El,{omit:["layers"]});const $h=new ri({"circle-sort-key":new Ge(de.layout_circle["circle-sort-key"])});var Gh={paint:new ri({"circle-radius":new Ge(de.paint_circle["circle-radius"]),"circle-color":new Ge(de.paint_circle["circle-color"]),"circle-blur":new Ge(de.paint_circle["circle-blur"]),"circle-opacity":new Ge(de.paint_circle["circle-opacity"]),"circle-translate":new Oe(de.paint_circle["circle-translate"]),"circle-translate-anchor":new Oe(de.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Oe(de.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Oe(de.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ge(de.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ge(de.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ge(de.paint_circle["circle-stroke-opacity"])}),layout:$h},wi=1e-6,Ti=typeof Float32Array<"u"?Float32Array:Array;function gc(){var i=new Ti(9);return Ti!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function Al(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function yc(i,e,r){var s=e[0],l=e[1],u=e[2],p=e[3],f=e[4],g=e[5],x=e[6],w=e[7],I=e[8],A=e[9],M=e[10],k=e[11],N=e[12],V=e[13],J=e[14],oe=e[15],Y=r[0],ne=r[1],me=r[2],pe=r[3];return i[0]=Y*s+ne*f+me*I+pe*N,i[1]=Y*l+ne*g+me*A+pe*V,i[2]=Y*u+ne*x+me*M+pe*J,i[3]=Y*p+ne*w+me*k+pe*oe,i[4]=(Y=r[4])*s+(ne=r[5])*f+(me=r[6])*I+(pe=r[7])*N,i[5]=Y*l+ne*g+me*A+pe*V,i[6]=Y*u+ne*x+me*M+pe*J,i[7]=Y*p+ne*w+me*k+pe*oe,i[8]=(Y=r[8])*s+(ne=r[9])*f+(me=r[10])*I+(pe=r[11])*N,i[9]=Y*l+ne*g+me*A+pe*V,i[10]=Y*u+ne*x+me*M+pe*J,i[11]=Y*p+ne*w+me*k+pe*oe,i[12]=(Y=r[12])*s+(ne=r[13])*f+(me=r[14])*I+(pe=r[15])*N,i[13]=Y*l+ne*g+me*A+pe*V,i[14]=Y*u+ne*x+me*M+pe*J,i[15]=Y*p+ne*w+me*k+pe*oe,i}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var Po,qh=yc;function _c(){var i=new Ti(3);return Ti!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function xc(i,e,r){var s=new Ti(3);return s[0]=i,s[1]=e,s[2]=r,s}function Ra(i,e,r){var s=e[0],l=e[1],u=e[2],p=e[3];return i[0]=r[0]*s+r[4]*l+r[8]*u+r[12]*p,i[1]=r[1]*s+r[5]*l+r[9]*u+r[13]*p,i[2]=r[2]*s+r[6]*l+r[10]*u+r[14]*p,i[3]=r[3]*s+r[7]*l+r[11]*u+r[15]*p,i}function vc(){var i=new Ti(4);return Ti!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function bc(i,e){const r=Ra([],[i.x,i.y,0,1],e);return new je(r[0]/r[3],r[1]/r[3])}_c(),Po=new Ti(4),Ti!=Float32Array&&(Po[0]=0,Po[1]=0,Po[2]=0,Po[3]=0),_c(),xc(1,0,0),xc(0,1,0),vc(),vc(),gc(),function(){var i;i=new Ti(2),Ti!=Float32Array&&(i[0]=0,i[1]=0)}();class wc extends El{}De("HeatmapBucket",wc,{omit:["layers"]});var jh={paint:new ri({"heatmap-radius":new Ge(de.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ge(de.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Oe(de.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Fr(de.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Oe(de.paint_heatmap["heatmap-opacity"])})};function zl(i,{width:e,height:r},s,l){if(l){if(l instanceof Uint8ClampedArray)l=new Uint8Array(l.buffer);else if(l.length!==e*r*s)throw new RangeError(`mismatched image size. expected: ${l.length} but got: ${e*r*s}`)}else l=new Uint8Array(e*r*s);return i.width=e,i.height=r,i.data=l,i}function Tc(i,{width:e,height:r},s){if(e===i.width&&r===i.height)return;const l=zl({},{width:e,height:r},s);Ml(i,l,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,r)},s),i.width=e,i.height=r,i.data=l.data}function Ml(i,e,r,s,l,u){if(l.width===0||l.height===0)return e;if(l.width>i.width||l.height>i.height||r.x>i.width-l.width||r.y>i.height-l.height)throw new RangeError("out of range source coordinates for image copy");if(l.width>e.width||l.height>e.height||s.x>e.width-l.width||s.y>e.height-l.height)throw new RangeError("out of range destination coordinates for image copy");const p=i.data,f=e.data;if(p===f)throw new Error("srcData equals dstData, so image is already copied");for(let g=0;g<l.height;g++){const x=((r.y+g)*i.width+r.x)*u,w=((s.y+g)*e.width+s.x)*u;for(let I=0;I<l.width*u;I++)f[w+I]=p[x+I]}return e}class Do{constructor(e,r){zl(this,e,1,r)}resize(e){Tc(this,e,1)}clone(){return new Do({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,s,l,u){Ml(e,r,s,l,u,1)}}class Ki{constructor(e,r){zl(this,e,4,r)}resize(e){Tc(this,e,4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Ki({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,s,l,u){Ml(e,r,s,l,u,4)}}function Ic(i){const e={},r=i.resolution||256,s=i.clips?i.clips.length:1,l=i.image||new Ki({width:r,height:s});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const u=(p,f,g)=>{e[i.evaluationKey]=g;const x=i.expression.evaluate(e);l.data[p+f+0]=Math.floor(255*x.r/x.a),l.data[p+f+1]=Math.floor(255*x.g/x.a),l.data[p+f+2]=Math.floor(255*x.b/x.a),l.data[p+f+3]=Math.floor(255*x.a)};if(i.clips)for(let p=0,f=0;p<s;++p,f+=4*r)for(let g=0,x=0;g<r;g++,x+=4){const w=g/(r-1),{start:I,end:A}=i.clips[p];u(f,x,I*(1-w)+A*w)}else for(let p=0,f=0;p<r;p++,f+=4)u(0,f,p/(r-1));return l}De("AlphaImage",Do),De("RGBAImage",Ki);var Zh={paint:new ri({"hillshade-illumination-direction":new Oe(de.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Oe(de.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Oe(de.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Oe(de.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Oe(de.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Oe(de.paint_hillshade["hillshade-accent-color"])})};const Xh=Nt([{name:"a_pos",components:2,type:"Int16"}],4),{members:Hh}=Xh;var Fa={exports:{}};function Oa(i,e,r){r=r||2;var s,l,u,p,f,g,x,w=e&&e.length,I=w?e[0]*r:i.length,A=Ec(i,0,I,r,!0),M=[];if(!A||A.next===A.prev)return M;if(w&&(A=function(N,V,J,oe){var Y,ne,me,pe=[];for(Y=0,ne=V.length;Y<ne;Y++)(me=Ec(N,V[Y]*oe,Y<ne-1?V[Y+1]*oe:N.length,oe,!1))===me.next&&(me.steiner=!0),pe.push(iu(me));for(pe.sort(Qh),Y=0;Y<pe.length;Y++)J=eu(pe[Y],J);return J}(i,e,A,r)),i.length>80*r){s=u=i[0],l=p=i[1];for(var k=r;k<I;k+=r)(f=i[k])<s&&(s=f),(g=i[k+1])<l&&(l=g),f>u&&(u=f),g>p&&(p=g);x=(x=Math.max(u-s,p-l))!==0?32767/x:0}return Lo(A,M,r,s,l,x,0),M}function Ec(i,e,r,s,l){var u,p;if(l===Dl(i,e,r,s)>0)for(u=e;u<r;u+=s)p=Ac(u,i[u],i[u+1],p);else for(u=r-s;u>=e;u-=s)p=Ac(u,i[u],i[u+1],p);return p&&Ua(p,p.next)&&(Ro(p),p=p.next),p}function gs(i,e){if(!i)return i;e||(e=i);var r,s=i;do if(r=!1,s.steiner||!Ua(s,s.next)&&Ut(s.prev,s,s.next)!==0)s=s.next;else{if(Ro(s),(s=e=s.prev)===s.next)break;r=!0}while(r||s!==e);return e}function Lo(i,e,r,s,l,u,p){if(i){!p&&u&&function(w,I,A,M){var k=w;do k.z===0&&(k.z=kl(k.x,k.y,I,A,M)),k.prevZ=k.prev,k.nextZ=k.next,k=k.next;while(k!==w);k.prevZ.nextZ=null,k.prevZ=null,function(N){var V,J,oe,Y,ne,me,pe,ke,Be=1;do{for(J=N,N=null,ne=null,me=0;J;){for(me++,oe=J,pe=0,V=0;V<Be&&(pe++,oe=oe.nextZ);V++);for(ke=Be;pe>0||ke>0&&oe;)pe!==0&&(ke===0||!oe||J.z<=oe.z)?(Y=J,J=J.nextZ,pe--):(Y=oe,oe=oe.nextZ,ke--),ne?ne.nextZ=Y:N=Y,Y.prevZ=ne,ne=Y;J=oe}ne.nextZ=null,Be*=2}while(me>1)}(k)}(i,s,l,u);for(var f,g,x=i;i.prev!==i.next;)if(f=i.prev,g=i.next,u?Kh(i,s,l,u):Wh(i))e.push(f.i/r|0),e.push(i.i/r|0),e.push(g.i/r|0),Ro(i),i=g.next,x=g.next;else if((i=g)===x){p?p===1?Lo(i=Yh(gs(i),e,r),e,r,s,l,u,2):p===2&&Jh(i,e,r,s,l,u):Lo(gs(i),e,r,s,l,u,1);break}}}function Wh(i){var e=i.prev,r=i,s=i.next;if(Ut(e,r,s)>=0)return!1;for(var l=e.x,u=r.x,p=s.x,f=e.y,g=r.y,x=s.y,w=l<u?l<p?l:p:u<p?u:p,I=f<g?f<x?f:x:g<x?g:x,A=l>u?l>p?l:p:u>p?u:p,M=f>g?f>x?f:x:g>x?g:x,k=s.next;k!==e;){if(k.x>=w&&k.x<=A&&k.y>=I&&k.y<=M&&$s(l,f,u,g,p,x,k.x,k.y)&&Ut(k.prev,k,k.next)>=0)return!1;k=k.next}return!0}function Kh(i,e,r,s){var l=i.prev,u=i,p=i.next;if(Ut(l,u,p)>=0)return!1;for(var f=l.x,g=u.x,x=p.x,w=l.y,I=u.y,A=p.y,M=f<g?f<x?f:x:g<x?g:x,k=w<I?w<A?w:A:I<A?I:A,N=f>g?f>x?f:x:g>x?g:x,V=w>I?w>A?w:A:I>A?I:A,J=kl(M,k,e,r,s),oe=kl(N,V,e,r,s),Y=i.prevZ,ne=i.nextZ;Y&&Y.z>=J&&ne&&ne.z<=oe;){if(Y.x>=M&&Y.x<=N&&Y.y>=k&&Y.y<=V&&Y!==l&&Y!==p&&$s(f,w,g,I,x,A,Y.x,Y.y)&&Ut(Y.prev,Y,Y.next)>=0||(Y=Y.prevZ,ne.x>=M&&ne.x<=N&&ne.y>=k&&ne.y<=V&&ne!==l&&ne!==p&&$s(f,w,g,I,x,A,ne.x,ne.y)&&Ut(ne.prev,ne,ne.next)>=0))return!1;ne=ne.nextZ}for(;Y&&Y.z>=J;){if(Y.x>=M&&Y.x<=N&&Y.y>=k&&Y.y<=V&&Y!==l&&Y!==p&&$s(f,w,g,I,x,A,Y.x,Y.y)&&Ut(Y.prev,Y,Y.next)>=0)return!1;Y=Y.prevZ}for(;ne&&ne.z<=oe;){if(ne.x>=M&&ne.x<=N&&ne.y>=k&&ne.y<=V&&ne!==l&&ne!==p&&$s(f,w,g,I,x,A,ne.x,ne.y)&&Ut(ne.prev,ne,ne.next)>=0)return!1;ne=ne.nextZ}return!0}function Yh(i,e,r){var s=i;do{var l=s.prev,u=s.next.next;!Ua(l,u)&&Sc(l,s,s.next,u)&&Bo(l,u)&&Bo(u,l)&&(e.push(l.i/r|0),e.push(s.i/r|0),e.push(u.i/r|0),Ro(s),Ro(s.next),s=i=u),s=s.next}while(s!==i);return gs(s)}function Jh(i,e,r,s,l,u){var p=i;do{for(var f=p.next.next;f!==p.prev;){if(p.i!==f.i&&ru(p,f)){var g=Cc(p,f);return p=gs(p,p.next),g=gs(g,g.next),Lo(p,e,r,s,l,u,0),void Lo(g,e,r,s,l,u,0)}f=f.next}p=p.next}while(p!==i)}function Qh(i,e){return i.x-e.x}function eu(i,e){var r=function(l,u){var p,f=u,g=l.x,x=l.y,w=-1/0;do{if(x<=f.y&&x>=f.next.y&&f.next.y!==f.y){var I=f.x+(x-f.y)*(f.next.x-f.x)/(f.next.y-f.y);if(I<=g&&I>w&&(w=I,p=f.x<f.next.x?f:f.next,I===g))return p}f=f.next}while(f!==u);if(!p)return null;var A,M=p,k=p.x,N=p.y,V=1/0;f=p;do g>=f.x&&f.x>=k&&g!==f.x&&$s(x<N?g:w,x,k,N,x<N?w:g,x,f.x,f.y)&&(A=Math.abs(x-f.y)/(g-f.x),Bo(f,l)&&(A<V||A===V&&(f.x>p.x||f.x===p.x&&tu(p,f)))&&(p=f,V=A)),f=f.next;while(f!==M);return p}(i,e);if(!r)return e;var s=Cc(r,i);return gs(s,s.next),gs(r,r.next)}function tu(i,e){return Ut(i.prev,i,e.prev)<0&&Ut(e.next,i,i.next)<0}function kl(i,e,r,s,l){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-r)*l|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*l|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function iu(i){var e=i,r=i;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==i);return r}function $s(i,e,r,s,l,u,p,f){return(l-p)*(e-f)>=(i-p)*(u-f)&&(i-p)*(s-f)>=(r-p)*(e-f)&&(r-p)*(u-f)>=(l-p)*(s-f)}function ru(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(r,s){var l=r;do{if(l.i!==r.i&&l.next.i!==r.i&&l.i!==s.i&&l.next.i!==s.i&&Sc(l,l.next,r,s))return!0;l=l.next}while(l!==r);return!1}(i,e)&&(Bo(i,e)&&Bo(e,i)&&function(r,s){var l=r,u=!1,p=(r.x+s.x)/2,f=(r.y+s.y)/2;do l.y>f!=l.next.y>f&&l.next.y!==l.y&&p<(l.next.x-l.x)*(f-l.y)/(l.next.y-l.y)+l.x&&(u=!u),l=l.next;while(l!==r);return u}(i,e)&&(Ut(i.prev,i,e.prev)||Ut(i,e.prev,e))||Ua(i,e)&&Ut(i.prev,i,i.next)>0&&Ut(e.prev,e,e.next)>0)}function Ut(i,e,r){return(e.y-i.y)*(r.x-e.x)-(e.x-i.x)*(r.y-e.y)}function Ua(i,e){return i.x===e.x&&i.y===e.y}function Sc(i,e,r,s){var l=Na(Ut(i,e,r)),u=Na(Ut(i,e,s)),p=Na(Ut(r,s,i)),f=Na(Ut(r,s,e));return l!==u&&p!==f||!(l!==0||!Va(i,r,e))||!(u!==0||!Va(i,s,e))||!(p!==0||!Va(r,i,s))||!(f!==0||!Va(r,e,s))}function Va(i,e,r){return e.x<=Math.max(i.x,r.x)&&e.x>=Math.min(i.x,r.x)&&e.y<=Math.max(i.y,r.y)&&e.y>=Math.min(i.y,r.y)}function Na(i){return i>0?1:i<0?-1:0}function Bo(i,e){return Ut(i.prev,i,i.next)<0?Ut(i,e,i.next)>=0&&Ut(i,i.prev,e)>=0:Ut(i,e,i.prev)<0||Ut(i,i.next,e)<0}function Cc(i,e){var r=new Pl(i.i,i.x,i.y),s=new Pl(e.i,e.x,e.y),l=i.next,u=e.prev;return i.next=e,e.prev=i,r.next=l,l.prev=r,s.next=r,r.prev=s,u.next=s,s.prev=u,s}function Ac(i,e,r,s){var l=new Pl(i,e,r);return s?(l.next=s.next,l.prev=s,s.next.prev=l,s.next=l):(l.prev=l,l.next=l),l}function Ro(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Pl(i,e,r){this.i=i,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Dl(i,e,r,s){for(var l=0,u=e,p=r-s;u<r;u+=s)l+=(i[p]-i[u])*(i[u+1]+i[p+1]),p=u;return l}function nu(i,e,r,s,l){zc(i,e,r||0,s||i.length-1,l||su)}function zc(i,e,r,s,l){for(;s>r;){if(s-r>600){var u=s-r+1,p=e-r+1,f=Math.log(u),g=.5*Math.exp(2*f/3),x=.5*Math.sqrt(f*g*(u-g)/u)*(p-u/2<0?-1:1);zc(i,e,Math.max(r,Math.floor(e-p*g/u+x)),Math.min(s,Math.floor(e+(u-p)*g/u+x)),l)}var w=i[e],I=r,A=s;for(Fo(i,r,e),l(i[s],w)>0&&Fo(i,r,s);I<A;){for(Fo(i,I,A),I++,A--;l(i[I],w)<0;)I++;for(;l(i[A],w)>0;)A--}l(i[r],w)===0?Fo(i,r,A):Fo(i,++A,s),A<=e&&(r=A+1),e<=A&&(s=A-1)}}function Fo(i,e,r){var s=i[e];i[e]=i[r],i[r]=s}function su(i,e){return i<e?-1:i>e?1:0}function Ll(i,e){const r=i.length;if(r<=1)return[i];const s=[];let l,u;for(let p=0;p<r;p++){const f=_i(i[p]);f!==0&&(i[p].area=Math.abs(f),u===void 0&&(u=f<0),u===f<0?(l&&s.push(l),l=[i[p]]):l.push(i[p]))}if(l&&s.push(l),e>1)for(let p=0;p<s.length;p++)s[p].length<=e||(nu(s[p],e,1,s[p].length-1,ou),s[p]=s[p].slice(0,e));return s}function ou(i,e){return e.area-i.area}function Bl(i,e,r){const s=r.patternDependencies;let l=!1;for(const u of e){const p=u.paint.get(`${i}-pattern`);p.isConstant()||(l=!0);const f=p.constantOr(null);f&&(l=!0,s[f.to]=!0,s[f.from]=!0)}return l}function Rl(i,e,r,s,l){const u=l.patternDependencies;for(const p of e){const f=p.paint.get(`${i}-pattern`).value;if(f.kind!=="constant"){let g=f.evaluate({zoom:s-1},r,{},l.availableImages),x=f.evaluate({zoom:s},r,{},l.availableImages),w=f.evaluate({zoom:s+1},r,{},l.availableImages);g=g&&g.name?g.name:g,x=x&&x.name?x.name:x,w=w&&w.name?w.name:w,u[g]=!0,u[x]=!0,u[w]=!0,r.patterns[p.id]={min:g,mid:x,max:w}}}return r}Fa.exports=Oa,Fa.exports.default=Oa,Oa.deviation=function(i,e,r,s){var l=e&&e.length,u=Math.abs(Dl(i,0,l?e[0]*r:i.length,r));if(l)for(var p=0,f=e.length;p<f;p++)u-=Math.abs(Dl(i,e[p]*r,p<f-1?e[p+1]*r:i.length,r));var g=0;for(p=0;p<s.length;p+=3){var x=s[p]*r,w=s[p+1]*r,I=s[p+2]*r;g+=Math.abs((i[x]-i[I])*(i[w+1]-i[x+1])-(i[x]-i[w])*(i[I+1]-i[x+1]))}return u===0&&g===0?0:Math.abs((g-u)/u)},Oa.flatten=function(i){for(var e=i[0][0].length,r={vertices:[],holes:[],dimensions:e},s=0,l=0;l<i.length;l++){for(var u=0;u<i[l].length;u++)for(var p=0;p<e;p++)r.vertices.push(i[l][u][p]);l>0&&r.holes.push(s+=i[l-1].length)}return r};class Fl{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new yt,this.indexArray=new bi,this.indexArray2=new xr,this.programConfigurations=new ps(e.layers,e.zoom),this.segments=new rt,this.segments2=new rt,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s){this.hasPattern=Bl("fill",this.layers,r);const l=this.layers[0].layout.get("fill-sort-key"),u=!l.isConstant(),p=[];for(const{feature:f,id:g,index:x,sourceLayerIndex:w}of e){const I=this.layers[0]._featureFilter.needGeometry,A=fs(f,I);if(!this.layers[0]._featureFilter.filter(new Mt(this.zoom),A,s))continue;const M=u?l.evaluate(A,{},s,r.availableImages):void 0,k={id:g,properties:f.properties,type:f.type,sourceLayerIndex:w,index:x,geometry:I?A.geometry:ms(f),patterns:{},sortKey:M};p.push(k)}u&&p.sort((f,g)=>f.sortKey-g.sortKey);for(const f of p){const{geometry:g,index:x,sourceLayerIndex:w}=f;if(this.hasPattern){const I=Rl("fill",this.layers,f,this.zoom,r);this.patternFeatures.push(I)}else this.addFeature(f,g,x,s,{});r.featureIndex.insert(e[x].feature,g,x,w,this.index)}}update(e,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s)}addFeatures(e,r,s){for(const l of this.patternFeatures)this.addFeature(l,l.geometry,l.index,r,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Hh),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,s,l,u){for(const p of Ll(r,500)){let f=0;for(const M of p)f+=M.length;const g=this.segments.prepareSegment(f,this.layoutVertexArray,this.indexArray),x=g.vertexLength,w=[],I=[];for(const M of p){if(M.length===0)continue;M!==p[0]&&I.push(w.length/2);const k=this.segments2.prepareSegment(M.length,this.layoutVertexArray,this.indexArray2),N=k.vertexLength;this.layoutVertexArray.emplaceBack(M[0].x,M[0].y),this.indexArray2.emplaceBack(N+M.length-1,N),w.push(M[0].x),w.push(M[0].y);for(let V=1;V<M.length;V++)this.layoutVertexArray.emplaceBack(M[V].x,M[V].y),this.indexArray2.emplaceBack(N+V-1,N+V),w.push(M[V].x),w.push(M[V].y);k.vertexLength+=M.length,k.primitiveLength+=M.length}const A=Fa.exports(w,I);for(let M=0;M<A.length;M+=3)this.indexArray.emplaceBack(x+A[M],x+A[M+1],x+A[M+2]);g.vertexLength+=f,g.primitiveLength+=A.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,u,l)}}De("FillBucket",Fl,{omit:["layers","patternFeatures"]});const au=new ri({"fill-sort-key":new Ge(de.layout_fill["fill-sort-key"])});var lu={paint:new ri({"fill-antialias":new Oe(de.paint_fill["fill-antialias"]),"fill-opacity":new Ge(de.paint_fill["fill-opacity"]),"fill-color":new Ge(de.paint_fill["fill-color"]),"fill-outline-color":new Ge(de.paint_fill["fill-outline-color"]),"fill-translate":new Oe(de.paint_fill["fill-translate"]),"fill-translate-anchor":new Oe(de.paint_fill["fill-translate-anchor"]),"fill-pattern":new Pn(de.paint_fill["fill-pattern"])}),layout:au};const cu=Nt([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),hu=Nt([{name:"a_centroid",components:2,type:"Int16"}],4),{members:uu}=cu;var Bn={},du=je,Mc=Gs;function Gs(i,e,r,s,l){this.properties={},this.extent=r,this.type=0,this._pbf=i,this._geometry=-1,this._keys=s,this._values=l,i.readFields(pu,this,e)}function pu(i,e,r){i==1?e.id=r.readVarint():i==2?function(s,l){for(var u=s.readVarint()+s.pos;s.pos<u;){var p=l._keys[s.readVarint()],f=l._values[s.readVarint()];l.properties[p]=f}}(r,e):i==3?e.type=r.readVarint():i==4&&(e._geometry=r.pos)}function mu(i){for(var e,r,s=0,l=0,u=i.length,p=u-1;l<u;p=l++)s+=((r=i[p]).x-(e=i[l]).x)*(e.y+r.y);return s}Gs.types=["Unknown","Point","LineString","Polygon"],Gs.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,r=i.readVarint()+i.pos,s=1,l=0,u=0,p=0,f=[];i.pos<r;){if(l<=0){var g=i.readVarint();s=7&g,l=g>>3}if(l--,s===1||s===2)u+=i.readSVarint(),p+=i.readSVarint(),s===1&&(e&&f.push(e),e=[]),e.push(new du(u,p));else{if(s!==7)throw new Error("unknown command "+s);e&&e.push(e[0].clone())}}return e&&f.push(e),f},Gs.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,r=1,s=0,l=0,u=0,p=1/0,f=-1/0,g=1/0,x=-1/0;i.pos<e;){if(s<=0){var w=i.readVarint();r=7&w,s=w>>3}if(s--,r===1||r===2)(l+=i.readSVarint())<p&&(p=l),l>f&&(f=l),(u+=i.readSVarint())<g&&(g=u),u>x&&(x=u);else if(r!==7)throw new Error("unknown command "+r)}return[p,g,f,x]},Gs.prototype.toGeoJSON=function(i,e,r){var s,l,u=this.extent*Math.pow(2,r),p=this.extent*i,f=this.extent*e,g=this.loadGeometry(),x=Gs.types[this.type];function w(M){for(var k=0;k<M.length;k++){var N=M[k];M[k]=[360*(N.x+p)/u-180,360/Math.PI*Math.atan(Math.exp((180-360*(N.y+f)/u)*Math.PI/180))-90]}}switch(this.type){case 1:var I=[];for(s=0;s<g.length;s++)I[s]=g[s][0];w(g=I);break;case 2:for(s=0;s<g.length;s++)w(g[s]);break;case 3:for(g=function(M){var k=M.length;if(k<=1)return[M];for(var N,V,J=[],oe=0;oe<k;oe++){var Y=mu(M[oe]);Y!==0&&(V===void 0&&(V=Y<0),V===Y<0?(N&&J.push(N),N=[M[oe]]):N.push(M[oe]))}return N&&J.push(N),J}(g),s=0;s<g.length;s++)for(l=0;l<g[s].length;l++)w(g[s][l])}g.length===1?g=g[0]:x="Multi"+x;var A={type:"Feature",geometry:{type:x,coordinates:g},properties:this.properties};return"id"in this&&(A.id=this.id),A};var fu=Mc,kc=Pc;function Pc(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(gu,this,e),this.length=this._features.length}function gu(i,e,r){i===15?e.version=r.readVarint():i===1?e.name=r.readString():i===5?e.extent=r.readVarint():i===2?e._features.push(r.pos):i===3?e._keys.push(r.readString()):i===4&&e._values.push(function(s){for(var l=null,u=s.readVarint()+s.pos;s.pos<u;){var p=s.readVarint()>>3;l=p===1?s.readString():p===2?s.readFloat():p===3?s.readDouble():p===4?s.readVarint64():p===5?s.readVarint():p===6?s.readSVarint():p===7?s.readBoolean():null}return l}(r))}Pc.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new fu(this._pbf,e,this.extent,this._keys,this._values)};var yu=kc;function _u(i,e,r){if(i===3){var s=new yu(r,r.readVarint()+r.pos);s.length&&(e[s.name]=s)}}Bn.VectorTile=function(i,e){this.layers=i.readFields(_u,{},e)},Bn.VectorTileFeature=Mc,Bn.VectorTileLayer=kc;const xu=Bn.VectorTileFeature.types,Ol=Math.pow(2,13);function Oo(i,e,r,s,l,u,p,f){i.emplaceBack(e,r,2*Math.floor(s*Ol)+p,l*Ol*2,u*Ol*2,Math.round(f))}class Ul{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new ot,this.centroidVertexArray=new Ve,this.indexArray=new bi,this.programConfigurations=new ps(e.layers,e.zoom),this.segments=new rt,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s){this.features=[],this.hasPattern=Bl("fill-extrusion",this.layers,r);for(const{feature:l,id:u,index:p,sourceLayerIndex:f}of e){const g=this.layers[0]._featureFilter.needGeometry,x=fs(l,g);if(!this.layers[0]._featureFilter.filter(new Mt(this.zoom),x,s))continue;const w={id:u,sourceLayerIndex:f,index:p,geometry:g?x.geometry:ms(l),properties:l.properties,type:l.type,patterns:{}};this.hasPattern?this.features.push(Rl("fill-extrusion",this.layers,w,this.zoom,r)):this.addFeature(w,w.geometry,p,s,{}),r.featureIndex.insert(l,w.geometry,p,f,this.index,!0)}}addFeatures(e,r,s){for(const l of this.features){const{geometry:u}=l;this.addFeature(l,u,l.index,r,s)}}update(e,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,uu),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,hu.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,r,s,l,u){const p={x:0,y:0,vertexCount:0};for(const f of Ll(r,500)){let g=0;for(const k of f)g+=k.length;let x=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const k of f){if(k.length===0||bu(k))continue;let N=0;for(let V=0;V<k.length;V++){const J=k[V];if(V>=1){const oe=k[V-1];if(!vu(J,oe)){x.vertexLength+4>rt.MAX_VERTEX_ARRAY_LENGTH&&(x=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Y=J.sub(oe)._perp()._unit(),ne=oe.dist(J);N+ne>32768&&(N=0),Oo(this.layoutVertexArray,J.x,J.y,Y.x,Y.y,0,0,N),Oo(this.layoutVertexArray,J.x,J.y,Y.x,Y.y,0,1,N),p.x+=2*J.x,p.y+=2*J.y,p.vertexCount+=2,N+=ne,Oo(this.layoutVertexArray,oe.x,oe.y,Y.x,Y.y,0,0,N),Oo(this.layoutVertexArray,oe.x,oe.y,Y.x,Y.y,0,1,N),p.x+=2*oe.x,p.y+=2*oe.y,p.vertexCount+=2;const me=x.vertexLength;this.indexArray.emplaceBack(me,me+2,me+1),this.indexArray.emplaceBack(me+1,me+2,me+3),x.vertexLength+=4,x.primitiveLength+=2}}}}if(x.vertexLength+g>rt.MAX_VERTEX_ARRAY_LENGTH&&(x=this.segments.prepareSegment(g,this.layoutVertexArray,this.indexArray)),xu[e.type]!=="Polygon")continue;const w=[],I=[],A=x.vertexLength;for(const k of f)if(k.length!==0){k!==f[0]&&I.push(w.length/2);for(let N=0;N<k.length;N++){const V=k[N];Oo(this.layoutVertexArray,V.x,V.y,0,0,1,1,0),p.x+=V.x,p.y+=V.y,p.vertexCount+=1,w.push(V.x),w.push(V.y)}}const M=Fa.exports(w,I);for(let k=0;k<M.length;k+=3)this.indexArray.emplaceBack(A+M[k],A+M[k+2],A+M[k+1]);x.primitiveLength+=M.length/3,x.vertexLength+=g}for(let f=0;f<p.vertexCount;f++)this.centroidVertexArray.emplaceBack(Math.floor(p.x/p.vertexCount),Math.floor(p.y/p.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,u,l)}}function vu(i,e){return i.x===e.x&&(i.x<0||i.x>Zt)||i.y===e.y&&(i.y<0||i.y>Zt)}function bu(i){return i.every(e=>e.x<0)||i.every(e=>e.x>Zt)||i.every(e=>e.y<0)||i.every(e=>e.y>Zt)}De("FillExtrusionBucket",Ul,{omit:["layers","features"]});var wu={paint:new ri({"fill-extrusion-opacity":new Oe(de["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ge(de["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Oe(de["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Oe(de["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Pn(de["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ge(de["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ge(de["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Oe(de["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Uo(i,e){return i.x*e.x+i.y*e.y}function Dc(i,e){if(i.length===1){let r=0;const s=e[r++];let l;for(;!l||s.equals(l);)if(l=e[r++],!l)return 1/0;for(;r<e.length;r++){const u=e[r],p=i[0],f=l.sub(s),g=u.sub(s),x=p.sub(s),w=Uo(f,f),I=Uo(f,g),A=Uo(g,g),M=Uo(x,f),k=Uo(x,g),N=w*A-I*I,V=(A*M-I*k)/N,J=(w*k-I*M)/N,oe=s.z*(1-V-J)+l.z*V+u.z*J;if(isFinite(oe))return oe}return 1/0}{let r=1/0;for(const s of e)r=Math.min(r,s.z);return r}}const Tu=Nt([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Iu}=Tu,Eu=Nt([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Su}=Eu,Cu=Bn.VectorTileFeature.types,Au=Math.cos(Math.PI/180*37.5),Lc=Math.pow(2,14)/.5;class Vl{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new ut,this.layoutVertexArray2=new vt,this.indexArray=new bi,this.programConfigurations=new ps(e.layers,e.zoom),this.segments=new rt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s){this.hasPattern=Bl("line",this.layers,r);const l=this.layers[0].layout.get("line-sort-key"),u=!l.isConstant(),p=[];for(const{feature:f,id:g,index:x,sourceLayerIndex:w}of e){const I=this.layers[0]._featureFilter.needGeometry,A=fs(f,I);if(!this.layers[0]._featureFilter.filter(new Mt(this.zoom),A,s))continue;const M=u?l.evaluate(A,{},s):void 0,k={id:g,properties:f.properties,type:f.type,sourceLayerIndex:w,index:x,geometry:I?A.geometry:ms(f),patterns:{},sortKey:M};p.push(k)}u&&p.sort((f,g)=>f.sortKey-g.sortKey);for(const f of p){const{geometry:g,index:x,sourceLayerIndex:w}=f;if(this.hasPattern){const I=Rl("line",this.layers,f,this.zoom,r);this.patternFeatures.push(I)}else this.addFeature(f,g,x,s,{});r.featureIndex.insert(e[x].feature,g,x,w,this.index)}}update(e,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s)}addFeatures(e,r,s){for(const l of this.patternFeatures)this.addFeature(l,l.geometry,l.index,r,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Su)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Iu),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,s,l,u){const p=this.layers[0].layout,f=p.get("line-join").evaluate(e,{}),g=p.get("line-cap"),x=p.get("line-miter-limit"),w=p.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const I of r)this.addLine(I,e,f,g,x,w);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,u,l)}addLine(e,r,s,l,u,p){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let J=0;J<e.length-1;J++)this.totalDistance+=e[J].dist(e[J+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const f=Cu[r.type]==="Polygon";let g=e.length;for(;g>=2&&e[g-1].equals(e[g-2]);)g--;let x=0;for(;x<g-1&&e[x].equals(e[x+1]);)x++;if(g<(f?3:2))return;s==="bevel"&&(u=1.05);const w=this.overscaling<=16?122880/(512*this.overscaling):0,I=this.segments.prepareSegment(10*g,this.layoutVertexArray,this.indexArray);let A,M,k,N,V;this.e1=this.e2=-1,f&&(A=e[g-2],V=e[x].sub(A)._unit()._perp());for(let J=x;J<g;J++){if(k=J===g-1?f?e[x+1]:void 0:e[J+1],k&&e[J].equals(k))continue;V&&(N=V),A&&(M=A),A=e[J],V=k?k.sub(A)._unit()._perp():N,N=N||V;let oe=N.add(V);oe.x===0&&oe.y===0||oe._unit();const Y=N.x*V.x+N.y*V.y,ne=oe.x*V.x+oe.y*V.y,me=ne!==0?1/ne:1/0,pe=2*Math.sqrt(2-2*ne),ke=ne<Au&&M&&k,Be=N.x*V.y-N.y*V.x>0;if(ke&&J>x){const xe=A.dist(M);if(xe>2*w){const Ce=A.sub(A.sub(M)._mult(w/xe)._round());this.updateDistance(M,Ce),this.addCurrentVertex(Ce,N,0,0,I),M=Ce}}const Se=M&&k;let we=Se?s:f?"butt":l;if(Se&&we==="round"&&(me<p?we="miter":me<=2&&(we="fakeround")),we==="miter"&&me>u&&(we="bevel"),we==="bevel"&&(me>2&&(we="flipbevel"),me<u&&(we="miter")),M&&this.updateDistance(M,A),we==="miter")oe._mult(me),this.addCurrentVertex(A,oe,0,0,I);else if(we==="flipbevel"){if(me>100)oe=V.mult(-1);else{const xe=me*N.add(V).mag()/N.sub(V).mag();oe._perp()._mult(xe*(Be?-1:1))}this.addCurrentVertex(A,oe,0,0,I),this.addCurrentVertex(A,oe.mult(-1),0,0,I)}else if(we==="bevel"||we==="fakeround"){const xe=-Math.sqrt(me*me-1),Ce=Be?xe:0,Ie=Be?0:xe;if(M&&this.addCurrentVertex(A,N,Ce,Ie,I),we==="fakeround"){const _e=Math.round(180*pe/Math.PI/20);for(let Ne=1;Ne<_e;Ne++){let Ue=Ne/_e;if(Ue!==.5){const St=Ue-.5;Ue+=Ue*St*(Ue-1)*((1.0904+Y*(Y*(3.55645-1.43519*Y)-3.2452))*St*St+(.848013+Y*(.215638*Y-1.06021)))}const it=V.sub(N)._mult(Ue)._add(N)._unit()._mult(Be?-1:1);this.addHalfVertex(A,it.x,it.y,!1,Be,0,I)}}k&&this.addCurrentVertex(A,V,-Ce,-Ie,I)}else if(we==="butt")this.addCurrentVertex(A,oe,0,0,I);else if(we==="square"){const xe=M?1:-1;this.addCurrentVertex(A,oe,xe,xe,I)}else we==="round"&&(M&&(this.addCurrentVertex(A,N,0,0,I),this.addCurrentVertex(A,N,1,1,I,!0)),k&&(this.addCurrentVertex(A,V,-1,-1,I,!0),this.addCurrentVertex(A,V,0,0,I)));if(ke&&J<g-1){const xe=A.dist(k);if(xe>2*w){const Ce=A.add(k.sub(A)._mult(w/xe)._round());this.updateDistance(A,Ce),this.addCurrentVertex(Ce,V,0,0,I),A=Ce}}}}addCurrentVertex(e,r,s,l,u,p=!1){const f=r.y*l-r.x,g=-r.y-r.x*l;this.addHalfVertex(e,r.x+r.y*s,r.y-r.x*s,p,!1,s,u),this.addHalfVertex(e,f,g,p,!0,-l,u),this.distance>Lc/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(e,r,s,l,u,p))}addHalfVertex({x:e,y:r},s,l,u,p,f,g){const x=.5*(this.lineClips?this.scaledDistance*(Lc-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(u?1:0),(r<<1)+(p?1:0),Math.round(63*s)+128,Math.round(63*l)+128,1+(f===0?0:f<0?-1:1)|(63&x)<<2,x>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const w=g.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,w),g.primitiveLength++),p?this.e2=w:this.e1=w}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}De("LineBucket",Vl,{omit:["layers","patternFeatures"]});const zu=new ri({"line-cap":new Oe(de.layout_line["line-cap"]),"line-join":new Ge(de.layout_line["line-join"]),"line-miter-limit":new Oe(de.layout_line["line-miter-limit"]),"line-round-limit":new Oe(de.layout_line["line-round-limit"]),"line-sort-key":new Ge(de.layout_line["line-sort-key"])});var Bc={paint:new ri({"line-opacity":new Ge(de.paint_line["line-opacity"]),"line-color":new Ge(de.paint_line["line-color"]),"line-translate":new Oe(de.paint_line["line-translate"]),"line-translate-anchor":new Oe(de.paint_line["line-translate-anchor"]),"line-width":new Ge(de.paint_line["line-width"]),"line-gap-width":new Ge(de.paint_line["line-gap-width"]),"line-offset":new Ge(de.paint_line["line-offset"]),"line-blur":new Ge(de.paint_line["line-blur"]),"line-dasharray":new So(de.paint_line["line-dasharray"]),"line-pattern":new Pn(de.paint_line["line-pattern"]),"line-gradient":new Fr(de.paint_line["line-gradient"])}),layout:zu};const Rc=new class extends Ge{possiblyEvaluate(i,e){return e=new Mt(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(i,e)}evaluate(i,e,r,s){return e=_t({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(i,e,r,s)}}(Bc.paint.properties["line-width"].specification);function Fc(i,e){return e>0?e+2*i:i}Rc.useIntegerZoom=!0;const Mu=Nt([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),ku=Nt([{name:"a_projected_pos",components:3,type:"Float32"}],4);Nt([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Pu=Nt([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Nt([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Oc=Nt([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Du=Nt([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Lu(i,e,r){return i.sections.forEach(s=>{s.text=function(l,u,p){const f=u.layout.get("text-transform").evaluate(p,{});return f==="uppercase"?l=l.toLocaleUpperCase():f==="lowercase"&&(l=l.toLocaleLowerCase()),Vi.applyArabicShaping&&(l=Vi.applyArabicShaping(l)),l}(s.text,e,r)}),i}Nt([{name:"triangle",components:3,type:"Uint16"}]),Nt([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Nt([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Nt([{type:"Float32",name:"offsetX"}]),Nt([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const Vo={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};var ni=24,Nl=Tt,Uc=function(i,e,r,s,l){var u,p,f=8*l-s-1,g=(1<<f)-1,x=g>>1,w=-7,I=r?l-1:0,A=r?-1:1,M=i[e+I];for(I+=A,u=M&(1<<-w)-1,M>>=-w,w+=f;w>0;u=256*u+i[e+I],I+=A,w-=8);for(p=u&(1<<-w)-1,u>>=-w,w+=s;w>0;p=256*p+i[e+I],I+=A,w-=8);if(u===0)u=1-x;else{if(u===g)return p?NaN:1/0*(M?-1:1);p+=Math.pow(2,s),u-=x}return(M?-1:1)*p*Math.pow(2,u-s)},Vc=function(i,e,r,s,l,u){var p,f,g,x=8*u-l-1,w=(1<<x)-1,I=w>>1,A=l===23?Math.pow(2,-24)-Math.pow(2,-77):0,M=s?0:u-1,k=s?1:-1,N=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(f=isNaN(e)?1:0,p=w):(p=Math.floor(Math.log(e)/Math.LN2),e*(g=Math.pow(2,-p))<1&&(p--,g*=2),(e+=p+I>=1?A/g:A*Math.pow(2,1-I))*g>=2&&(p++,g/=2),p+I>=w?(f=0,p=w):p+I>=1?(f=(e*g-1)*Math.pow(2,l),p+=I):(f=e*Math.pow(2,I-1)*Math.pow(2,l),p=0));l>=8;i[r+M]=255&f,M+=k,f/=256,l-=8);for(p=p<<l|f,x+=l;x>0;i[r+M]=255&p,M+=k,p/=256,x-=8);i[r+M-k]|=128*N};function Tt(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Tt.Varint=0,Tt.Fixed64=1,Tt.Bytes=2,Tt.Fixed32=5;var Rn,$l=4294967296,Nc=1/$l,$c=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function sn(i){return i.type===Tt.Bytes?i.readVarint()+i.pos:i.pos+1}function qs(i,e,r){return r?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function Gc(i,e,r){var s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(s);for(var l=r.pos-1;l>=i;l--)r.buf[l+s]=r.buf[l]}function Bu(i,e){for(var r=0;r<i.length;r++)e.writeVarint(i[r])}function Ru(i,e){for(var r=0;r<i.length;r++)e.writeSVarint(i[r])}function Fu(i,e){for(var r=0;r<i.length;r++)e.writeFloat(i[r])}function Ou(i,e){for(var r=0;r<i.length;r++)e.writeDouble(i[r])}function Uu(i,e){for(var r=0;r<i.length;r++)e.writeBoolean(i[r])}function Vu(i,e){for(var r=0;r<i.length;r++)e.writeFixed32(i[r])}function Nu(i,e){for(var r=0;r<i.length;r++)e.writeSFixed32(i[r])}function $u(i,e){for(var r=0;r<i.length;r++)e.writeFixed64(i[r])}function Gu(i,e){for(var r=0;r<i.length;r++)e.writeSFixed64(i[r])}function $a(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function js(i,e,r){i[r]=e,i[r+1]=e>>>8,i[r+2]=e>>>16,i[r+3]=e>>>24}function qc(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}function qu(i,e,r){i===1&&r.readMessage(ju,e)}function ju(i,e,r){if(i===3){const{id:s,bitmap:l,width:u,height:p,left:f,top:g,advance:x}=r.readMessage(Zu,{});e.push({id:s,bitmap:new Do({width:u+6,height:p+6},l),metrics:{width:u,height:p,left:f,top:g,advance:x}})}}function Zu(i,e,r){i===1?e.id=r.readVarint():i===2?e.bitmap=r.readBytes():i===3?e.width=r.readVarint():i===4?e.height=r.readVarint():i===5?e.left=r.readSVarint():i===6?e.top=r.readSVarint():i===7&&(e.advance=r.readVarint())}function jc(i){let e=0,r=0;for(const p of i)e+=p.w*p.h,r=Math.max(r,p.w);i.sort((p,f)=>f.h-p.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let l=0,u=0;for(const p of i)for(let f=s.length-1;f>=0;f--){const g=s[f];if(!(p.w>g.w||p.h>g.h)){if(p.x=g.x,p.y=g.y,u=Math.max(u,p.y+p.h),l=Math.max(l,p.x+p.w),p.w===g.w&&p.h===g.h){const x=s.pop();f<s.length&&(s[f]=x)}else p.h===g.h?(g.x+=p.w,g.w-=p.w):p.w===g.w?(g.y+=p.h,g.h-=p.h):(s.push({x:g.x+p.w,y:g.y,w:g.w-p.w,h:p.h}),g.y+=p.h,g.h-=p.h);break}}return{w:l,h:u,fill:e/(l*u)||0}}Tt.prototype={destroy:function(){this.buf=null},readFields:function(i,e,r){for(r=r||this.length;this.pos<r;){var s=this.readVarint(),l=s>>3,u=this.pos;this.type=7&s,i(l,e,this),this.pos===u&&this.skip(s)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=$a(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=qc(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=$a(this.buf,this.pos)+$a(this.buf,this.pos+4)*$l;return this.pos+=8,i},readSFixed64:function(){var i=$a(this.buf,this.pos)+qc(this.buf,this.pos+4)*$l;return this.pos+=8,i},readFloat:function(){var i=Uc(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=Uc(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,r,s=this.buf;return e=127&(r=s[this.pos++]),r<128?e:(e|=(127&(r=s[this.pos++]))<<7,r<128?e:(e|=(127&(r=s[this.pos++]))<<14,r<128?e:(e|=(127&(r=s[this.pos++]))<<21,r<128?e:function(l,u,p){var f,g,x=p.buf;if(f=(112&(g=x[p.pos++]))>>4,g<128||(f|=(127&(g=x[p.pos++]))<<3,g<128)||(f|=(127&(g=x[p.pos++]))<<10,g<128)||(f|=(127&(g=x[p.pos++]))<<17,g<128)||(f|=(127&(g=x[p.pos++]))<<24,g<128)||(f|=(1&(g=x[p.pos++]))<<31,g<128))return qs(l,f,u);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=s[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&$c?function(r,s,l){return $c.decode(r.subarray(s,l))}(this.buf,e,i):function(r,s,l){for(var u="",p=s;p<l;){var f,g,x,w=r[p],I=null,A=w>239?4:w>223?3:w>191?2:1;if(p+A>l)break;A===1?w<128&&(I=w):A===2?(192&(f=r[p+1]))==128&&(I=(31&w)<<6|63&f)<=127&&(I=null):A===3?(g=r[p+2],(192&(f=r[p+1]))==128&&(192&g)==128&&((I=(15&w)<<12|(63&f)<<6|63&g)<=2047||I>=55296&&I<=57343)&&(I=null)):A===4&&(g=r[p+2],x=r[p+3],(192&(f=r[p+1]))==128&&(192&g)==128&&(192&x)==128&&((I=(15&w)<<18|(63&f)<<12|(63&g)<<6|63&x)<=65535||I>=1114112)&&(I=null)),I===null?(I=65533,A=1):I>65535&&(I-=65536,u+=String.fromCharCode(I>>>10&1023|55296),I=56320|1023&I),u+=String.fromCharCode(I),p+=A}return u}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==Tt.Bytes)return i.push(this.readVarint(e));var r=sn(this);for(i=i||[];this.pos<r;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==Tt.Bytes)return i.push(this.readSVarint());var e=sn(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Tt.Bytes)return i.push(this.readBoolean());var e=sn(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Tt.Bytes)return i.push(this.readFloat());var e=sn(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Tt.Bytes)return i.push(this.readDouble());var e=sn(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Tt.Bytes)return i.push(this.readFixed32());var e=sn(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Tt.Bytes)return i.push(this.readSFixed32());var e=sn(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Tt.Bytes)return i.push(this.readFixed64());var e=sn(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Tt.Bytes)return i.push(this.readSFixed64());var e=sn(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===Tt.Varint)for(;this.buf[this.pos++]>127;);else if(e===Tt.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Tt.Fixed32)this.pos+=4;else{if(e!==Tt.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),js(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),js(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),js(this.buf,-1&i,this.pos),js(this.buf,Math.floor(i*Nc),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),js(this.buf,-1&i,this.pos),js(this.buf,Math.floor(i*Nc),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,r){var s,l;if(e>=0?(s=e%4294967296|0,l=e/4294967296|0):(l=~(-e/4294967296),4294967295^(s=~(-e%4294967296))?s=s+1|0:(s=0,l=l+1|0)),e>=0xffffffffffffffff||e<-0xffffffffffffffff)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(u,p,f){f.buf[f.pos++]=127&u|128,u>>>=7,f.buf[f.pos++]=127&u|128,u>>>=7,f.buf[f.pos++]=127&u|128,u>>>=7,f.buf[f.pos++]=127&u|128,f.buf[f.pos]=127&(u>>>=7)}(s,0,r),function(u,p){var f=(7&u)<<4;p.buf[p.pos++]|=f|((u>>>=3)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u)))))}(l,r)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(Boolean(i))},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(s,l,u){for(var p,f,g=0;g<l.length;g++){if((p=l.charCodeAt(g))>55295&&p<57344){if(!f){p>56319||g+1===l.length?(s[u++]=239,s[u++]=191,s[u++]=189):f=p;continue}if(p<56320){s[u++]=239,s[u++]=191,s[u++]=189,f=p;continue}p=f-55296<<10|p-56320|65536,f=null}else f&&(s[u++]=239,s[u++]=191,s[u++]=189,f=null);p<128?s[u++]=p:(p<2048?s[u++]=p>>6|192:(p<65536?s[u++]=p>>12|224:(s[u++]=p>>18|240,s[u++]=p>>12&63|128),s[u++]=p>>6&63|128),s[u++]=63&p|128)}return u}(this.buf,i,this.pos);var r=this.pos-e;r>=128&&Gc(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(i){this.realloc(4),Vc(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),Vc(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=i[r]},writeRawMessage:function(i,e){this.pos++;var r=this.pos;i(e,this);var s=this.pos-r;s>=128&&Gc(r,s,this),this.pos=r-1,this.writeVarint(s),this.pos+=s},writeMessage:function(i,e,r){this.writeTag(i,Tt.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,Bu,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,Ru,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,Uu,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,Fu,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,Ou,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,Vu,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,Nu,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,$u,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,Gu,e)},writeBytesField:function(i,e){this.writeTag(i,Tt.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,Tt.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,Tt.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,Tt.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,Tt.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,Tt.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,Tt.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,Tt.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,Tt.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,Tt.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,Boolean(e))}};class Gl{constructor(e,{pixelRatio:r,version:s,stretchX:l,stretchY:u,content:p}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=l,this.stretchY=u,this.content=p,this.version=s}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Zc{constructor(e,r){const s={},l={};this.haveRenderCallbacks=[];const u=[];this.addImages(e,s,u),this.addImages(r,l,u);const{w:p,h:f}=jc(u),g=new Ki({width:p||1,height:f||1});for(const x in e){const w=e[x],I=s[x].paddedRect;Ki.copy(w.data,g,{x:0,y:0},{x:I.x+1,y:I.y+1},w.data)}for(const x in r){const w=r[x],I=l[x].paddedRect,A=I.x+1,M=I.y+1,k=w.data.width,N=w.data.height;Ki.copy(w.data,g,{x:0,y:0},{x:A,y:M},w.data),Ki.copy(w.data,g,{x:0,y:N-1},{x:A,y:M-1},{width:k,height:1}),Ki.copy(w.data,g,{x:0,y:0},{x:A,y:M+N},{width:k,height:1}),Ki.copy(w.data,g,{x:k-1,y:0},{x:A-1,y:M},{width:1,height:N}),Ki.copy(w.data,g,{x:0,y:0},{x:A+k,y:M},{width:1,height:N})}this.image=g,this.iconPositions=s,this.patternPositions=l}addImages(e,r,s){for(const l in e){const u=e[l],p={x:0,y:0,w:u.data.width+2,h:u.data.height+2};s.push(p),r[l]=new Gl(p,u),u.hasRenderCallback&&this.haveRenderCallbacks.push(l)}}patchUpdatedImages(e,r){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in e.updatedImages)this.patchUpdatedImage(this.iconPositions[s],e.getImage(s),r),this.patchUpdatedImage(this.patternPositions[s],e.getImage(s),r)}patchUpdatedImage(e,r,s){if(!e||!r||e.version===r.version)return;e.version=r.version;const[l,u]=e.tl;s.update(r.data,void 0,{x:l,y:u})}}De("ImagePosition",Gl),De("ImageAtlas",Zc),h.WritingMode=void 0,(Rn=h.WritingMode||(h.WritingMode={}))[Rn.none=0]="none",Rn[Rn.horizontal=1]="horizontal",Rn[Rn.vertical=2]="vertical",Rn[Rn.horizontalOnly=3]="horizontalOnly";const Ga=-17;class No{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const s=new No;return s.scale=e||1,s.fontStack=r,s}static forImage(e){const r=new No;return r.imageName=e,r}}class Zs{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const s=new Zs;for(let l=0;l<e.sections.length;l++){const u=e.sections[l];u.image?s.addImageSection(u):s.addTextSection(u,r)}return s}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let r="";for(let s=0;s<e.length;s++){const l=e.charCodeAt(s+1)||null,u=e.charCodeAt(s-1)||null;r+=l&&Ta(l)&&!Vo[e[s+1]]||u&&Ta(u)&&!Vo[e[s-1]]||!Vo[e[s]]?e[s]:Vo[e[s]]}return r}(this.text)}trim(){let e=0;for(let s=0;s<this.text.length&&ja[this.text.charCodeAt(s)];s++)e++;let r=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&ja[this.text.charCodeAt(s)];s--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const s=new Zs;return s.text=this.text.substring(e,r),s.sectionIndex=this.sectionIndex.slice(e,r),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(No.forText(e.scale,e.fontStack||r));const s=this.sections.length-1;for(let l=0;l<e.text.length;++l)this.sectionIndex.push(s)}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void Rt("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(No.forImage(r)),this.sectionIndex.push(this.sections.length-1)):Rt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function qa(i,e,r,s,l,u,p,f,g,x,w,I,A,M,k,N){const V=Zs.fromFeature(i,l);let J;I===h.WritingMode.vertical&&V.verticalizePunctuation();const{processBidirectionalText:oe,processStyledBidirectionalText:Y}=Vi;if(oe&&V.sections.length===1){J=[];const pe=oe(V.toString(),ql(V,x,u,e,s,M,k));for(const ke of pe){const Be=new Zs;Be.text=ke,Be.sections=V.sections;for(let Se=0;Se<ke.length;Se++)Be.sectionIndex.push(0);J.push(Be)}}else if(Y){J=[];const pe=Y(V.text,V.sectionIndex,ql(V,x,u,e,s,M,k));for(const ke of pe){const Be=new Zs;Be.text=ke[0],Be.sectionIndex=ke[1],Be.sections=V.sections,J.push(Be)}}else J=function(pe,ke){const Be=[],Se=pe.text;let we=0;for(const xe of ke)Be.push(pe.substring(we,xe)),we=xe;return we<Se.length&&Be.push(pe.substring(we,Se.length)),Be}(V,ql(V,x,u,e,s,M,k));const ne=[],me={positionedLines:ne,text:V.toString(),top:w[1],bottom:w[1],left:w[0],right:w[0],writingMode:I,iconsInText:!1,verticalizable:!1};return function(pe,ke,Be,Se,we,xe,Ce,Ie,_e,Ne,Ue,it){let St=0,Pt=Ga,Xt=0,Ji=0;const li=Ie==="right"?1:Ie==="left"?0:.5;let $t=0;for(const Gt of we){Gt.trim();const hi=Gt.getMaxScale(),fi=(hi-1)*ni,Ii={positionedGlyphs:[],lineOffset:0};pe.positionedLines[$t]=Ii;const Di=Ii.positionedGlyphs;let Li=0;if(!Gt.length()){Pt+=xe,++$t;continue}for(let ei=0;ei<Gt.length();ei++){const nt=Gt.getSection(ei),Gi=Gt.getSectionIndex(ei),ui=Gt.getCharCode(ei);let gi=0,lr=null,br=null,wr=null,an=ni;const cr=!(_e===h.WritingMode.horizontal||!Ue&&!vo(ui)||Ue&&(ja[ui]||(Qt=ui,Ee.Arabic(Qt)||Ee["Arabic Supplement"](Qt)||Ee["Arabic Extended-A"](Qt)||Ee["Arabic Presentation Forms-A"](Qt)||Ee["Arabic Presentation Forms-B"](Qt))));if(nt.imageName){const Qi=Se[nt.imageName];if(!Qi)continue;wr=nt.imageName,pe.iconsInText=pe.iconsInText||!0,br=Qi.paddedRect;const Bi=Qi.displaySize;nt.scale=nt.scale*ni/it,lr={width:Bi[0],height:Bi[1],left:1,top:-3,advance:cr?Bi[1]:Bi[0]},gi=fi+(ni-Bi[1]*nt.scale),an=lr.advance;const ln=cr?Bi[0]*nt.scale-ni*hi:Bi[1]*nt.scale-ni*hi;ln>0&&ln>Li&&(Li=ln)}else{const Qi=Be[nt.fontStack],Bi=Qi&&Qi[ui];if(Bi&&Bi.rect)br=Bi.rect,lr=Bi.metrics;else{const ln=ke[nt.fontStack],qo=ln&&ln[ui];if(!qo)continue;lr=qo.metrics}gi=(hi-nt.scale)*ni}cr?(pe.verticalizable=!0,Di.push({glyph:ui,imageName:wr,x:St,y:Pt+gi,vertical:cr,scale:nt.scale,fontStack:nt.fontStack,sectionIndex:Gi,metrics:lr,rect:br}),St+=an*nt.scale+Ne):(Di.push({glyph:ui,imageName:wr,x:St,y:Pt+gi,vertical:cr,scale:nt.scale,fontStack:nt.fontStack,sectionIndex:Gi,metrics:lr,rect:br}),St+=lr.advance*nt.scale+Ne)}Di.length!==0&&(Xt=Math.max(St-Ne,Xt),Wu(Di,0,Di.length-1,li,Li)),St=0;const Dt=xe*hi+Li;Ii.lineOffset=Math.max(Li,fi),Pt+=Dt,Ji=Math.max(Dt,Ji),++$t}var Qt;const ci=Pt-Ga,{horizontalAlign:mi,verticalAlign:Pi}=jl(Ce);(function(Gt,hi,fi,Ii,Di,Li,Dt,ei,nt){const Gi=(hi-fi)*Di;let ui=0;ui=Li!==Dt?-ei*Ii-Ga:(-Ii*nt+.5)*Dt;for(const gi of Gt)for(const lr of gi.positionedGlyphs)lr.x+=Gi,lr.y+=ui})(pe.positionedLines,li,mi,Pi,Xt,Ji,xe,ci,we.length),pe.top+=-Pi*ci,pe.bottom=pe.top+ci,pe.left+=-mi*Xt,pe.right=pe.left+Xt}(me,e,r,s,J,p,f,g,I,x,A,N),!function(pe){for(const ke of pe)if(ke.positionedGlyphs.length!==0)return!1;return!0}(ne)&&me}const ja={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Xu={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Xc(i,e,r,s,l,u){if(e.imageName){const p=s[e.imageName];return p?p.displaySize[0]*e.scale*ni/u+l:0}{const p=r[e.fontStack],f=p&&p[i];return f?f.metrics.advance*e.scale+l:0}}function Hc(i,e,r,s){const l=Math.pow(i-e,2);return s?i<e?l/2:2*l:l+Math.abs(r)*r}function Hu(i,e,r){let s=0;return i===10&&(s-=1e4),r&&(s+=150),i!==40&&i!==65288||(s+=50),e!==41&&e!==65289||(s+=50),s}function Wc(i,e,r,s,l,u){let p=null,f=Hc(e,r,l,u);for(const g of s){const x=Hc(e-g.x,r,l,u)+g.badness;x<=f&&(p=g,f=x)}return{index:i,x:e,priorBreak:p,badness:f}}function Kc(i){return i?Kc(i.priorBreak).concat(i.index):[]}function ql(i,e,r,s,l,u,p){if(u!=="point")return[];if(!i)return[];const f=[],g=function(A,M,k,N,V,J){let oe=0;for(let Y=0;Y<A.length();Y++){const ne=A.getSection(Y);oe+=Xc(A.getCharCode(Y),ne,N,V,M,J)}return oe/Math.max(1,Math.ceil(oe/k))}(i,e,r,s,l,p),x=i.text.indexOf("\u200B")>=0;let w=0;for(let A=0;A<i.length();A++){const M=i.getSection(A),k=i.getCharCode(A);if(ja[k]||(w+=Xc(k,M,s,l,e,p)),A<i.length()-1){const N=!((I=k)<11904||!(Ee["Bopomofo Extended"](I)||Ee.Bopomofo(I)||Ee["CJK Compatibility Forms"](I)||Ee["CJK Compatibility Ideographs"](I)||Ee["CJK Compatibility"](I)||Ee["CJK Radicals Supplement"](I)||Ee["CJK Strokes"](I)||Ee["CJK Symbols and Punctuation"](I)||Ee["CJK Unified Ideographs Extension A"](I)||Ee["CJK Unified Ideographs"](I)||Ee["Enclosed CJK Letters and Months"](I)||Ee["Halfwidth and Fullwidth Forms"](I)||Ee.Hiragana(I)||Ee["Ideographic Description Characters"](I)||Ee["Kangxi Radicals"](I)||Ee["Katakana Phonetic Extensions"](I)||Ee.Katakana(I)||Ee["Vertical Forms"](I)||Ee["Yi Radicals"](I)||Ee["Yi Syllables"](I)));(Xu[k]||N||M.imageName)&&f.push(Wc(A+1,w,g,f,Hu(k,i.getCharCode(A+1),N&&x),!1))}}var I;return Kc(Wc(i.length(),w,g,f,0,!0))}function jl(i){let e=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function Wu(i,e,r,s,l){if(!s&&!l)return;const u=i[r],p=(i[r].x+u.metrics.advance*u.scale)*s;for(let f=e;f<=r;f++)i[f].x-=p,i[f].y+=l}function Ku(i,e,r){const{horizontalAlign:s,verticalAlign:l}=jl(r),u=e[0]-i.displaySize[0]*s,p=e[1]-i.displaySize[1]*l;return{image:i,top:p,bottom:p+i.displaySize[1],left:u,right:u+i.displaySize[0]}}function Yc(i,e,r,s,l,u){const p=i.image;let f;if(p.content){const V=p.content,J=p.pixelRatio||1;f=[V[0]/J,V[1]/J,p.displaySize[0]-V[2]/J,p.displaySize[1]-V[3]/J]}const g=e.left*u,x=e.right*u;let w,I,A,M;r==="width"||r==="both"?(M=l[0]+g-s[3],I=l[0]+x+s[1]):(M=l[0]+(g+x-p.displaySize[0])/2,I=M+p.displaySize[0]);const k=e.top*u,N=e.bottom*u;return r==="height"||r==="both"?(w=l[1]+k-s[0],A=l[1]+N+s[2]):(w=l[1]+(k+N-p.displaySize[1])/2,A=w+p.displaySize[1]),{image:p,top:w,right:I,bottom:A,left:M,collisionPadding:f}}const on=128;function Jc(i,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Mt(i+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:s,interpolationType:l}=r;let u=0;for(;u<s.length&&s[u]<=i;)u++;u=Math.max(0,u-1);let p=u;for(;p<s.length&&s[p]<i+1;)p++;p=Math.min(s.length-1,p);const f=s[u],g=s[p];return r.kind==="composite"?{kind:"composite",minZoom:f,maxZoom:g,interpolationType:l}:{kind:"camera",minZoom:f,maxZoom:g,minSize:r.evaluate(new Mt(f)),maxSize:r.evaluate(new Mt(g)),interpolationType:l}}}class Fn extends je{constructor(e,r,s,l){super(e,r),this.angle=s,l!==void 0&&(this.segment=l)}clone(){return new Fn(this.x,this.y,this.angle,this.segment)}}function Qc(i,e,r,s,l){if(e.segment===void 0)return!0;let u=e,p=e.segment+1,f=0;for(;f>-r/2;){if(p--,p<0)return!1;f-=i[p].dist(u),u=i[p]}f+=i[p].dist(i[p+1]),p++;const g=[];let x=0;for(;f<r/2;){const w=i[p],I=i[p+1];if(!I)return!1;let A=i[p-1].angleTo(w)-w.angleTo(I);for(A=Math.abs((A+3*Math.PI)%(2*Math.PI)-Math.PI),g.push({distance:f,angleDelta:A}),x+=A;f-g[0].distance>s;)x-=g.shift().angleDelta;if(x>l)return!1;p++,f+=w.dist(I)}return!0}function eh(i){let e=0;for(let r=0;r<i.length-1;r++)e+=i[r].dist(i[r+1]);return e}function th(i,e,r){return i?.6*e*r:0}function ih(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function Yu(i,e,r,s,l,u){const p=th(r,l,u),f=ih(r,s)*u;let g=0;const x=eh(i)/2;for(let w=0;w<i.length-1;w++){const I=i[w],A=i[w+1],M=I.dist(A);if(g+M>x){const k=(x-g)/M,N=At(I.x,A.x,k),V=At(I.y,A.y,k),J=new Fn(N,V,A.angleTo(I),w);return J._round(),!p||Qc(i,J,f,p,e)?J:void 0}g+=M}}function Ju(i,e,r,s,l,u,p,f,g){const x=th(s,u,p),w=ih(s,l),I=w*p,A=i[0].x===0||i[0].x===g||i[0].y===0||i[0].y===g;return e-I<e/4&&(e=I+e/4),rh(i,A?e/2*f%e:(w/2+2*u)*p*f%e,e,x,r,I,A,!1,g)}function rh(i,e,r,s,l,u,p,f,g){const x=u/2,w=eh(i);let I=0,A=e-r,M=[];for(let k=0;k<i.length-1;k++){const N=i[k],V=i[k+1],J=N.dist(V),oe=V.angleTo(N);for(;A+r<I+J;){A+=r;const Y=(A-I)/J,ne=At(N.x,V.x,Y),me=At(N.y,V.y,Y);if(ne>=0&&ne<g&&me>=0&&me<g&&A-x>=0&&A+x<=w){const pe=new Fn(ne,me,oe,k);pe._round(),s&&!Qc(i,pe,u,s,l)||M.push(pe)}}I+=J}return f||M.length||p||(M=rh(i,I/2,r,s,l,u,p,!0,g)),M}function nh(i,e,r,s,l){const u=[];for(let p=0;p<i.length;p++){const f=i[p];let g;for(let x=0;x<f.length-1;x++){let w=f[x],I=f[x+1];w.x<e&&I.x<e||(w.x<e?w=new je(e,w.y+(e-w.x)/(I.x-w.x)*(I.y-w.y))._round():I.x<e&&(I=new je(e,w.y+(e-w.x)/(I.x-w.x)*(I.y-w.y))._round()),w.y<r&&I.y<r||(w.y<r?w=new je(w.x+(r-w.y)/(I.y-w.y)*(I.x-w.x),r)._round():I.y<r&&(I=new je(w.x+(r-w.y)/(I.y-w.y)*(I.x-w.x),r)._round()),w.x>=s&&I.x>=s||(w.x>=s?w=new je(s,w.y+(s-w.x)/(I.x-w.x)*(I.y-w.y))._round():I.x>=s&&(I=new je(s,w.y+(s-w.x)/(I.x-w.x)*(I.y-w.y))._round()),w.y>=l&&I.y>=l||(w.y>=l?w=new je(w.x+(l-w.y)/(I.y-w.y)*(I.x-w.x),l)._round():I.y>=l&&(I=new je(w.x+(l-w.y)/(I.y-w.y)*(I.x-w.x),l)._round()),g&&w.equals(g[g.length-1])||(g=[w],u.push(g)),g.push(I)))))}}return u}function sh(i,e,r,s){const l=[],u=i.image,p=u.pixelRatio,f=u.paddedRect.w-2,g=u.paddedRect.h-2,x=i.right-i.left,w=i.bottom-i.top,I=u.stretchX||[[0,f]],A=u.stretchY||[[0,g]],M=(xe,Ce)=>xe+Ce[1]-Ce[0],k=I.reduce(M,0),N=A.reduce(M,0),V=f-k,J=g-N;let oe=0,Y=k,ne=0,me=N,pe=0,ke=V,Be=0,Se=J;if(u.content&&s){const xe=u.content;oe=Za(I,0,xe[0]),ne=Za(A,0,xe[1]),Y=Za(I,xe[0],xe[2]),me=Za(A,xe[1],xe[3]),pe=xe[0]-oe,Be=xe[1]-ne,ke=xe[2]-xe[0]-Y,Se=xe[3]-xe[1]-me}const we=(xe,Ce,Ie,_e)=>{const Ne=Xa(xe.stretch-oe,Y,x,i.left),Ue=Ha(xe.fixed-pe,ke,xe.stretch,k),it=Xa(Ce.stretch-ne,me,w,i.top),St=Ha(Ce.fixed-Be,Se,Ce.stretch,N),Pt=Xa(Ie.stretch-oe,Y,x,i.left),Xt=Ha(Ie.fixed-pe,ke,Ie.stretch,k),Ji=Xa(_e.stretch-ne,me,w,i.top),li=Ha(_e.fixed-Be,Se,_e.stretch,N),$t=new je(Ne,it),Qt=new je(Pt,it),ci=new je(Pt,Ji),mi=new je(Ne,Ji),Pi=new je(Ue/p,St/p),Gt=new je(Xt/p,li/p),hi=e*Math.PI/180;if(hi){const Di=Math.sin(hi),Li=Math.cos(hi),Dt=[Li,-Di,Di,Li];$t._matMult(Dt),Qt._matMult(Dt),mi._matMult(Dt),ci._matMult(Dt)}const fi=xe.stretch+xe.fixed,Ii=Ce.stretch+Ce.fixed;return{tl:$t,tr:Qt,bl:mi,br:ci,tex:{x:u.paddedRect.x+1+fi,y:u.paddedRect.y+1+Ii,w:Ie.stretch+Ie.fixed-fi,h:_e.stretch+_e.fixed-Ii},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Pi,pixelOffsetBR:Gt,minFontScaleX:ke/p/x,minFontScaleY:Se/p/w,isSDF:r}};if(s&&(u.stretchX||u.stretchY)){const xe=oh(I,V,k),Ce=oh(A,J,N);for(let Ie=0;Ie<xe.length-1;Ie++){const _e=xe[Ie],Ne=xe[Ie+1];for(let Ue=0;Ue<Ce.length-1;Ue++)l.push(we(_e,Ce[Ue],Ne,Ce[Ue+1]))}}else l.push(we({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:f+1},{fixed:0,stretch:g+1}));return l}function Za(i,e,r){let s=0;for(const l of i)s+=Math.max(e,Math.min(r,l[1]))-Math.max(e,Math.min(r,l[0]));return s}function oh(i,e,r){const s=[{fixed:-1,stretch:0}];for(const[l,u]of i){const p=s[s.length-1];s.push({fixed:l-p.stretch,stretch:p.stretch}),s.push({fixed:l-p.stretch,stretch:p.stretch+(u-l)})}return s.push({fixed:e+1,stretch:r}),s}function Xa(i,e,r,s){return i/e*r+s}function Ha(i,e,r,s){return i-e*r/s}De("Anchor",Fn);class Wa{constructor(e,r,s,l,u,p,f,g,x,w){if(this.boxStartIndex=e.length,x){let I=p.top,A=p.bottom;const M=p.collisionPadding;M&&(I-=M[1],A+=M[3]);let k=A-I;k>0&&(k=Math.max(10,k),this.circleDiameter=k)}else{let I=p.top*f-g[0],A=p.bottom*f+g[2],M=p.left*f-g[3],k=p.right*f+g[1];const N=p.collisionPadding;if(N&&(M-=N[0]*f,I-=N[1]*f,k+=N[2]*f,A+=N[3]*f),w){const V=new je(M,I),J=new je(k,I),oe=new je(M,A),Y=new je(k,A),ne=w*Math.PI/180;V._rotate(ne),J._rotate(ne),oe._rotate(ne),Y._rotate(ne),M=Math.min(V.x,J.x,oe.x,Y.x),k=Math.max(V.x,J.x,oe.x,Y.x),I=Math.min(V.y,J.y,oe.y,Y.y),A=Math.max(V.y,J.y,oe.y,Y.y)}e.emplaceBack(r.x,r.y,M,I,k,A,s,l,u)}this.boxEndIndex=e.length}}class Qu{constructor(e=[],r=ed){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:s}=this,l=r[e];for(;e>0;){const u=e-1>>1,p=r[u];if(s(l,p)>=0)break;r[e]=p,e=u}r[e]=l}_down(e){const{data:r,compare:s}=this,l=this.length>>1,u=r[e];for(;e<l;){let p=1+(e<<1),f=r[p];const g=p+1;if(g<this.length&&s(r[g],f)<0&&(p=g,f=r[g]),s(f,u)>=0)break;r[e]=f,e=p}r[e]=u}}function ed(i,e){return i<e?-1:i>e?1:0}function td(i,e=1,r=!1){let s=1/0,l=1/0,u=-1/0,p=-1/0;const f=i[0];for(let M=0;M<f.length;M++){const k=f[M];(!M||k.x<s)&&(s=k.x),(!M||k.y<l)&&(l=k.y),(!M||k.x>u)&&(u=k.x),(!M||k.y>p)&&(p=k.y)}const g=Math.min(u-s,p-l);let x=g/2;const w=new Qu([],id);if(g===0)return new je(s,l);for(let M=s;M<u;M+=g)for(let k=l;k<p;k+=g)w.push(new Xs(M+x,k+x,x,i));let I=function(M){let k=0,N=0,V=0;const J=M[0];for(let oe=0,Y=J.length,ne=Y-1;oe<Y;ne=oe++){const me=J[oe],pe=J[ne],ke=me.x*pe.y-pe.x*me.y;N+=(me.x+pe.x)*ke,V+=(me.y+pe.y)*ke,k+=3*ke}return new Xs(N/k,V/k,0,M)}(i),A=w.length;for(;w.length;){const M=w.pop();(M.d>I.d||!I.d)&&(I=M,r&&console.log("found best %d after %d probes",Math.round(1e4*M.d)/1e4,A)),M.max-I.d<=e||(x=M.h/2,w.push(new Xs(M.p.x-x,M.p.y-x,x,i)),w.push(new Xs(M.p.x+x,M.p.y-x,x,i)),w.push(new Xs(M.p.x-x,M.p.y+x,x,i)),w.push(new Xs(M.p.x+x,M.p.y+x,x,i)),A+=4)}return r&&(console.log(`num probes: ${A}`),console.log(`best distance: ${I.d}`)),I.p}function id(i,e){return e.max-i.max}function Xs(i,e,r,s){this.p=new je(i,e),this.h=r,this.d=function(l,u){let p=!1,f=1/0;for(let g=0;g<u.length;g++){const x=u[g];for(let w=0,I=x.length,A=I-1;w<I;A=w++){const M=x[w],k=x[A];M.y>l.y!=k.y>l.y&&l.x<(k.x-M.x)*(l.y-M.y)/(k.y-M.y)+M.x&&(p=!p),f=Math.min(f,mc(l,M,k))}}return(p?1:-1)*Math.sqrt(f)}(this.p,s),this.max=this.d+this.h*Math.SQRT2}const Zl=Number.POSITIVE_INFINITY;function ah(i,e){return e[1]!==Zl?function(r,s,l){let u=0,p=0;switch(s=Math.abs(s),l=Math.abs(l),r){case"top-right":case"top-left":case"top":p=l-7;break;case"bottom-right":case"bottom-left":case"bottom":p=7-l}switch(r){case"top-right":case"bottom-right":case"right":u=-s;break;case"top-left":case"bottom-left":case"left":u=s}return[u,p]}(i,e[0],e[1]):function(r,s){let l=0,u=0;s<0&&(s=0);const p=s/Math.sqrt(2);switch(r){case"top-right":case"top-left":u=p-7;break;case"bottom-right":case"bottom-left":u=7-p;break;case"bottom":u=7-s;break;case"top":u=s-7}switch(r){case"top-right":case"bottom-right":l=-p;break;case"top-left":case"bottom-left":l=p;break;case"left":l=s;break;case"right":l=-s}return[l,u]}(i,e[0])}function Xl(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function rd(i,e,r,s,l,u,p,f,g,x,w){let I=u.textMaxSize.evaluate(e,{});I===void 0&&(I=p);const A=i.layers[0].layout,M=A.get("icon-offset").evaluate(e,{},w),k=ch(r.horizontal),N=p/24,V=i.tilePixelRatio*N,J=i.tilePixelRatio*I/24,oe=i.tilePixelRatio*f,Y=i.tilePixelRatio*A.get("symbol-spacing"),ne=A.get("text-padding")*i.tilePixelRatio,me=function(_e,Ne,Ue,it=1){const St=_e.get("icon-padding").evaluate(Ne,{},Ue),Pt=St&&St.values;return[Pt[0]*it,Pt[1]*it,Pt[2]*it,Pt[3]*it]}(A,e,w,i.tilePixelRatio),pe=A.get("text-max-angle")/180*Math.PI,ke=A.get("text-rotation-alignment")!=="viewport"&&A.get("symbol-placement")!=="point",Be=A.get("icon-rotation-alignment")==="map"&&A.get("symbol-placement")!=="point",Se=A.get("symbol-placement"),we=Y/2,xe=A.get("icon-text-fit");let Ce;s&&xe!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(Ce=Yc(s,r.vertical,xe,A.get("icon-text-fit-padding"),M,N)),k&&(s=Yc(s,k,xe,A.get("icon-text-fit-padding"),M,N)));const Ie=(_e,Ne)=>{Ne.x<0||Ne.x>=Zt||Ne.y<0||Ne.y>=Zt||function(Ue,it,St,Pt,Xt,Ji,li,$t,Qt,ci,mi,Pi,Gt,hi,fi,Ii,Di,Li,Dt,ei,nt,Gi,ui,gi,lr){const br=Ue.addToLineVertexArray(it,St);let wr,an,cr,Qi,Bi=0,ln=0,qo=0,Eh=0,rc=-1,nc=-1;const cn={};let Sh=Jt.exports(""),sc=0,oc=0;if($t._unevaluatedLayout.getValue("text-radial-offset")===void 0?[sc,oc]=$t.layout.get("text-offset").evaluate(nt,{},gi).map(Ri=>Ri*ni):(sc=$t.layout.get("text-radial-offset").evaluate(nt,{},gi)*ni,oc=Zl),Ue.allowVerticalPlacement&&Pt.vertical){const Ri=$t.layout.get("text-rotate").evaluate(nt,{},gi)+90;cr=new Wa(Qt,it,ci,mi,Pi,Pt.vertical,Gt,hi,fi,Ri),li&&(Qi=new Wa(Qt,it,ci,mi,Pi,li,Di,Li,fi,Ri))}if(Xt){const Ri=$t.layout.get("icon-rotate").evaluate(nt,{}),$r=$t.layout.get("icon-text-fit")!=="none",jo=sh(Xt,Ri,ui,$r),Zo=li?sh(li,Ri,ui,$r):void 0;an=new Wa(Qt,it,ci,mi,Pi,Xt,Di,Li,!1,Ri),Bi=4*jo.length;const zh=Ue.iconSizeData;let _s=null;zh.kind==="source"?(_s=[on*$t.layout.get("icon-size").evaluate(nt,{})],_s[0]>On&&Rt(`${Ue.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):zh.kind==="composite"&&(_s=[on*Gi.compositeIconSizes[0].evaluate(nt,{},gi),on*Gi.compositeIconSizes[1].evaluate(nt,{},gi)],(_s[0]>On||_s[1]>On)&&Rt(`${Ue.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Ue.addSymbols(Ue.icon,jo,_s,ei,Dt,nt,h.WritingMode.none,it,br.lineStartIndex,br.lineLength,-1,gi),rc=Ue.icon.placedSymbolArray.length-1,Zo&&(ln=4*Zo.length,Ue.addSymbols(Ue.icon,Zo,_s,ei,Dt,nt,h.WritingMode.vertical,it,br.lineStartIndex,br.lineLength,-1,gi),nc=Ue.icon.placedSymbolArray.length-1)}const Ch=Object.keys(Pt.horizontal);for(const Ri of Ch){const $r=Pt.horizontal[Ri];if(!wr){Sh=Jt.exports($r.text);const Zo=$t.layout.get("text-rotate").evaluate(nt,{},gi);wr=new Wa(Qt,it,ci,mi,Pi,$r,Gt,hi,fi,Zo)}const jo=$r.positionedLines.length===1;if(qo+=lh(Ue,it,$r,Ji,$t,fi,nt,Ii,br,Pt.vertical?h.WritingMode.horizontal:h.WritingMode.horizontalOnly,jo?Ch:[Ri],cn,rc,Gi,gi),jo)break}Pt.vertical&&(Eh+=lh(Ue,it,Pt.vertical,Ji,$t,fi,nt,Ii,br,h.WritingMode.vertical,["vertical"],cn,nc,Gi,gi));const gd=wr?wr.boxStartIndex:Ue.collisionBoxArray.length,yd=wr?wr.boxEndIndex:Ue.collisionBoxArray.length,_d=cr?cr.boxStartIndex:Ue.collisionBoxArray.length,xd=cr?cr.boxEndIndex:Ue.collisionBoxArray.length,vd=an?an.boxStartIndex:Ue.collisionBoxArray.length,bd=an?an.boxEndIndex:Ue.collisionBoxArray.length,wd=Qi?Qi.boxStartIndex:Ue.collisionBoxArray.length,Td=Qi?Qi.boxEndIndex:Ue.collisionBoxArray.length;let Tr=-1;const el=(Ri,$r)=>Ri&&Ri.circleDiameter?Math.max(Ri.circleDiameter,$r):$r;Tr=el(wr,Tr),Tr=el(cr,Tr),Tr=el(an,Tr),Tr=el(Qi,Tr);const Ah=Tr>-1?1:0;Ah&&(Tr*=lr/ni),Ue.glyphOffsetArray.length>=Hs.MAX_GLYPHS&&Rt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),nt.sortKey!==void 0&&Ue.addToSortKeyRanges(Ue.symbolInstances.length,nt.sortKey),Ue.symbolInstances.emplaceBack(it.x,it.y,cn.right>=0?cn.right:-1,cn.center>=0?cn.center:-1,cn.left>=0?cn.left:-1,cn.vertical||-1,rc,nc,Sh,gd,yd,_d,xd,vd,bd,wd,Td,ci,qo,Eh,Bi,ln,Ah,0,Gt,sc,oc,Tr)}(i,Ne,_e,r,s,l,Ce,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,V,[ne,ne,ne,ne],ke,g,oe,me,Be,M,e,u,x,w,p)};if(Se==="line")for(const _e of nh(e.geometry,0,0,Zt,Zt)){const Ne=Ju(_e,Y,pe,r.vertical||k,s,24,J,i.overscaling,Zt);for(const Ue of Ne){const it=k;it&&nd(i,it.text,we,Ue)||Ie(_e,Ue)}}else if(Se==="line-center"){for(const _e of e.geometry)if(_e.length>1){const Ne=Yu(_e,pe,r.vertical||k,s,24,J);Ne&&Ie(_e,Ne)}}else if(e.type==="Polygon")for(const _e of Ll(e.geometry,0)){const Ne=td(_e,16);Ie(_e[0],new Fn(Ne.x,Ne.y,0))}else if(e.type==="LineString")for(const _e of e.geometry)Ie(_e,new Fn(_e[0].x,_e[0].y,0));else if(e.type==="Point")for(const _e of e.geometry)for(const Ne of _e)Ie([Ne],new Fn(Ne.x,Ne.y,0))}const On=32640;function lh(i,e,r,s,l,u,p,f,g,x,w,I,A,M,k){const N=function(oe,Y,ne,me,pe,ke,Be,Se){const we=me.layout.get("text-rotate").evaluate(ke,{})*Math.PI/180,xe=[];for(const Ce of Y.positionedLines)for(const Ie of Ce.positionedGlyphs){if(!Ie.rect)continue;const _e=Ie.rect||{};let Ne=4,Ue=!0,it=1,St=0;const Pt=(pe||Se)&&Ie.vertical,Xt=Ie.metrics.advance*Ie.scale/2;if(Se&&Y.verticalizable){const Dt=(Ie.scale-1)*ni,ei=(ni-Ie.metrics.width*Ie.scale)/2;St=Ce.lineOffset/2-(Ie.imageName?-ei:Dt)}if(Ie.imageName){const Dt=Be[Ie.imageName];Ue=Dt.sdf,it=Dt.pixelRatio,Ne=1/it}const Ji=pe?[Ie.x+Xt,Ie.y]:[0,0];let li=pe?[0,0]:[Ie.x+Xt+ne[0],Ie.y+ne[1]-St],$t=[0,0];Pt&&($t=li,li=[0,0]);const Qt=(Ie.metrics.left-Ne)*Ie.scale-Xt+li[0],ci=(-Ie.metrics.top-Ne)*Ie.scale+li[1],mi=Qt+_e.w*Ie.scale/it,Pi=ci+_e.h*Ie.scale/it,Gt=new je(Qt,ci),hi=new je(mi,ci),fi=new je(Qt,Pi),Ii=new je(mi,Pi);if(Pt){const Dt=new je(-Xt,Xt-Ga),ei=-Math.PI/2,nt=12-Xt,Gi=new je(22-nt,-(Ie.imageName?nt:0)),ui=new je(...$t);Gt._rotateAround(ei,Dt)._add(Gi)._add(ui),hi._rotateAround(ei,Dt)._add(Gi)._add(ui),fi._rotateAround(ei,Dt)._add(Gi)._add(ui),Ii._rotateAround(ei,Dt)._add(Gi)._add(ui)}if(we){const Dt=Math.sin(we),ei=Math.cos(we),nt=[ei,-Dt,Dt,ei];Gt._matMult(nt),hi._matMult(nt),fi._matMult(nt),Ii._matMult(nt)}const Di=new je(0,0),Li=new je(0,0);xe.push({tl:Gt,tr:hi,bl:fi,br:Ii,tex:_e,writingMode:Y.writingMode,glyphOffset:Ji,sectionIndex:Ie.sectionIndex,isSDF:Ue,pixelOffsetTL:Di,pixelOffsetBR:Li,minFontScaleX:0,minFontScaleY:0})}return xe}(0,r,f,l,u,p,s,i.allowVerticalPlacement),V=i.textSizeData;let J=null;V.kind==="source"?(J=[on*l.layout.get("text-size").evaluate(p,{})],J[0]>On&&Rt(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):V.kind==="composite"&&(J=[on*M.compositeTextSizes[0].evaluate(p,{},k),on*M.compositeTextSizes[1].evaluate(p,{},k)],(J[0]>On||J[1]>On)&&Rt(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,N,J,f,u,p,x,e,g.lineStartIndex,g.lineLength,A,k);for(const oe of w)I[oe]=i.text.placedSymbolArray.length-1;return 4*N.length}function ch(i){for(const e in i)return i[e];return null}function nd(i,e,r,s){const l=i.compareText;if(e in l){const u=l[e];for(let p=u.length-1;p>=0;p--)if(s.dist(u[p])<r)return!0}else l[e]=[];return l[e].push(s),!1}const sd=Bn.VectorTileFeature.types,od=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ka(i,e,r,s,l,u,p,f,g,x,w,I,A){const M=f?Math.min(On,Math.round(f[0])):0,k=f?Math.min(On,Math.round(f[1])):0;i.emplaceBack(e,r,Math.round(32*s),Math.round(32*l),u,p,(M<<1)+(g?1:0),k,16*x,16*w,256*I,256*A)}function Hl(i,e,r){i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r)}function ad(i){for(const e of i.sections)if(Ea(e.text))return!0;return!1}class Wl{constructor(e){this.layoutVertexArray=new or,this.indexArray=new bi,this.programConfigurations=e,this.segments=new rt,this.dynamicLayoutVertexArray=new Wi,this.opacityVertexArray=new ar,this.placedSymbolArray=new ye}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,s,l){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Mu.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,ku.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,od,!0),this.opacityVertexBuffer.itemSize=1),(s||l)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}De("SymbolBuffers",Wl);class Kl{constructor(e,r,s){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new s,this.segments=new rt,this.collisionVertexArray=new Ni}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Pu.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}De("CollisionBuffers",Kl);class Hs{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(p=>p.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Al([]),this.placementViewportMatrix=Al([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Jc(this.zoom,r["text-size"]),this.iconSizeData=Jc(this.zoom,r["icon-size"]);const s=this.layers[0].layout,l=s.get("symbol-sort-key"),u=s.get("symbol-z-order");this.canOverlap=Jl(s,"text-overlap","text-allow-overlap")!=="never"||Jl(s,"icon-overlap","icon-allow-overlap")!=="never"||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=u!=="viewport-y"&&!l.isConstant(),this.sortFeaturesByY=(u==="viewport-y"||u==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,s.get("symbol-placement")==="point"&&(this.writingModes=s.get("text-writing-mode").map(p=>h.WritingMode[p])),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.sourceID=e.sourceID}createArrays(){this.text=new Wl(new ps(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Wl(new ps(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new be,this.lineVertexArray=new Me,this.symbolInstances=new ze}calculateGlyphDependencies(e,r,s,l,u){for(let p=0;p<e.length;p++)if(r[e.charCodeAt(p)]=!0,(s||l)&&u){const f=Vo[e.charAt(p)];f&&(r[f.charCodeAt(0)]=!0)}}populate(e,r,s){const l=this.layers[0],u=l.layout,p=u.get("text-font"),f=u.get("text-field"),g=u.get("icon-image"),x=(f.value.kind!=="constant"||f.value.value instanceof j&&!f.value.value.isEmpty()||f.value.value.toString().length>0)&&(p.value.kind!=="constant"||p.value.value.length>0),w=g.value.kind!=="constant"||!!g.value.value||Object.keys(g.parameters).length>0,I=u.get("symbol-sort-key");if(this.features=[],!x&&!w)return;const A=r.iconDependencies,M=r.glyphDependencies,k=r.availableImages,N=new Mt(this.zoom);for(const{feature:V,id:J,index:oe,sourceLayerIndex:Y}of e){const ne=l._featureFilter.needGeometry,me=fs(V,ne);if(!l._featureFilter.filter(N,me,s))continue;let pe,ke;if(ne||(me.geometry=ms(V)),x){const Se=l.getValueAndResolveTokens("text-field",me,s,k),we=j.factory(Se);ad(we)&&(this.hasRTLText=!0),(!this.hasRTLText||hs()==="unavailable"||this.hasRTLText&&Vi.isParsed())&&(pe=Lu(we,l,me))}if(w){const Se=l.getValueAndResolveTokens("icon-image",me,s,k);ke=Se instanceof W?Se:W.fromString(Se)}if(!pe&&!ke)continue;const Be=this.sortFeaturesByKey?I.evaluate(me,{},s):void 0;if(this.features.push({id:J,text:pe,icon:ke,index:oe,sourceLayerIndex:Y,geometry:me.geometry,properties:V.properties,type:sd[V.type],sortKey:Be}),ke&&(A[ke.name]=!0),pe){const Se=p.evaluate(me,{},s).join(","),we=u.get("text-rotation-alignment")!=="viewport"&&u.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(h.WritingMode.vertical)>=0;for(const xe of pe.sections)if(xe.image)A[xe.image.name]=!0;else{const Ce=Rs(pe.toString()),Ie=xe.fontStack||Se,_e=M[Ie]=M[Ie]||{};this.calculateGlyphDependencies(xe.text,_e,we,this.allowVerticalPlacement,Ce)}}}u.get("symbol-placement")==="line"&&(this.features=function(V){const J={},oe={},Y=[];let ne=0;function me(Se){Y.push(V[Se]),ne++}function pe(Se,we,xe){const Ce=oe[Se];return delete oe[Se],oe[we]=Ce,Y[Ce].geometry[0].pop(),Y[Ce].geometry[0]=Y[Ce].geometry[0].concat(xe[0]),Ce}function ke(Se,we,xe){const Ce=J[we];return delete J[we],J[Se]=Ce,Y[Ce].geometry[0].shift(),Y[Ce].geometry[0]=xe[0].concat(Y[Ce].geometry[0]),Ce}function Be(Se,we,xe){const Ce=xe?we[0][we[0].length-1]:we[0][0];return`${Se}:${Ce.x}:${Ce.y}`}for(let Se=0;Se<V.length;Se++){const we=V[Se],xe=we.geometry,Ce=we.text?we.text.toString():null;if(!Ce){me(Se);continue}const Ie=Be(Ce,xe),_e=Be(Ce,xe,!0);if(Ie in oe&&_e in J&&oe[Ie]!==J[_e]){const Ne=ke(Ie,_e,xe),Ue=pe(Ie,_e,Y[Ne].geometry);delete J[Ie],delete oe[_e],oe[Be(Ce,Y[Ue].geometry,!0)]=Ue,Y[Ne].geometry=null}else Ie in oe?pe(Ie,_e,xe):_e in J?ke(Ie,_e,xe):(me(Se),J[Ie]=ne-1,oe[_e]=ne-1)}return Y.filter(Se=>Se.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((V,J)=>V.sortKey-J.sortKey)}update(e,r,s){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,s),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,s))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const s=this.lineVertexArray.length;if(e.segment!==void 0){let l=e.dist(r[e.segment+1]),u=e.dist(r[e.segment]);const p={};for(let f=e.segment+1;f<r.length;f++)p[f]={x:r[f].x,y:r[f].y,tileUnitDistanceFromAnchor:l},f<r.length-1&&(l+=r[f+1].dist(r[f]));for(let f=e.segment||0;f>=0;f--)p[f]={x:r[f].x,y:r[f].y,tileUnitDistanceFromAnchor:u},f>0&&(u+=r[f-1].dist(r[f]));for(let f=0;f<r.length;f++){const g=p[f];this.lineVertexArray.emplaceBack(g.x,g.y,g.tileUnitDistanceFromAnchor)}}return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,r,s,l,u,p,f,g,x,w,I,A){const M=e.indexArray,k=e.layoutVertexArray,N=e.segments.prepareSegment(4*r.length,k,M,this.canOverlap?p.sortKey:void 0),V=this.glyphOffsetArray.length,J=N.vertexLength,oe=this.allowVerticalPlacement&&f===h.WritingMode.vertical?Math.PI/2:0,Y=p.text&&p.text.sections;for(let ne=0;ne<r.length;ne++){const{tl:me,tr:pe,bl:ke,br:Be,tex:Se,pixelOffsetTL:we,pixelOffsetBR:xe,minFontScaleX:Ce,minFontScaleY:Ie,glyphOffset:_e,isSDF:Ne,sectionIndex:Ue}=r[ne],it=N.vertexLength,St=_e[1];Ka(k,g.x,g.y,me.x,St+me.y,Se.x,Se.y,s,Ne,we.x,we.y,Ce,Ie),Ka(k,g.x,g.y,pe.x,St+pe.y,Se.x+Se.w,Se.y,s,Ne,xe.x,we.y,Ce,Ie),Ka(k,g.x,g.y,ke.x,St+ke.y,Se.x,Se.y+Se.h,s,Ne,we.x,xe.y,Ce,Ie),Ka(k,g.x,g.y,Be.x,St+Be.y,Se.x+Se.w,Se.y+Se.h,s,Ne,xe.x,xe.y,Ce,Ie),Hl(e.dynamicLayoutVertexArray,g,oe),M.emplaceBack(it,it+1,it+2),M.emplaceBack(it+1,it+2,it+3),N.vertexLength+=4,N.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(_e[0]),ne!==r.length-1&&Ue===r[ne+1].sectionIndex||e.programConfigurations.populatePaintArrays(k.length,p,p.index,{},A,Y&&Y[Ue])}e.placedSymbolArray.emplaceBack(g.x,g.y,V,this.glyphOffsetArray.length-V,J,x,w,g.segment,s?s[0]:0,s?s[1]:0,l[0],l[1],f,0,!1,0,I)}_addCollisionDebugVertex(e,r,s,l,u,p){return r.emplaceBack(0,0),e.emplaceBack(s.x,s.y,l,u,Math.round(p.x),Math.round(p.y))}addCollisionDebugVertices(e,r,s,l,u,p,f){const g=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),x=g.vertexLength,w=u.layoutVertexArray,I=u.collisionVertexArray,A=f.anchorX,M=f.anchorY;this._addCollisionDebugVertex(w,I,p,A,M,new je(e,r)),this._addCollisionDebugVertex(w,I,p,A,M,new je(s,r)),this._addCollisionDebugVertex(w,I,p,A,M,new je(s,l)),this._addCollisionDebugVertex(w,I,p,A,M,new je(e,l)),g.vertexLength+=4;const k=u.indexArray;k.emplaceBack(x,x+1),k.emplaceBack(x+1,x+2),k.emplaceBack(x+2,x+3),k.emplaceBack(x+3,x),g.primitiveLength+=4}addDebugCollisionBoxes(e,r,s,l){for(let u=e;u<r;u++){const p=this.collisionBoxArray.get(u);this.addCollisionDebugVertices(p.x1,p.y1,p.x2,p.y2,l?this.textCollisionBox:this.iconCollisionBox,p.anchorPoint,s)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Kl(Vr,Oc.members,xr),this.iconCollisionBox=new Kl(Vr,Oc.members,xr);for(let e=0;e<this.symbolInstances.length;e++){const r=this.symbolInstances.get(e);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(e,r,s,l,u,p,f,g,x){const w={};for(let I=r;I<s;I++){const A=e.get(I);w.textBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,anchorPointX:A.anchorPointX,anchorPointY:A.anchorPointY},w.textFeatureIndex=A.featureIndex;break}for(let I=l;I<u;I++){const A=e.get(I);w.verticalTextBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,anchorPointX:A.anchorPointX,anchorPointY:A.anchorPointY},w.verticalTextFeatureIndex=A.featureIndex;break}for(let I=p;I<f;I++){const A=e.get(I);w.iconBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,anchorPointX:A.anchorPointX,anchorPointY:A.anchorPointY},w.iconFeatureIndex=A.featureIndex;break}for(let I=g;I<x;I++){const A=e.get(I);w.verticalIconBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,anchorPointX:A.anchorPointX,anchorPointY:A.anchorPointY},w.verticalIconFeatureIndex=A.featureIndex;break}return w}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const s=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const s=e.placedSymbolArray.get(r),l=s.vertexStartIndex+4*s.numGlyphs;for(let u=s.vertexStartIndex;u<l;u+=4)e.indexArray.emplaceBack(u,u+1,u+2),e.indexArray.emplaceBack(u+1,u+2,u+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),s=Math.cos(e),l=[],u=[],p=[];for(let f=0;f<this.symbolInstances.length;++f){p.push(f);const g=this.symbolInstances.get(f);l.push(0|Math.round(r*g.anchorX+s*g.anchorY)),u.push(g.featureIndex)}return p.sort((f,g)=>l[f]-l[g]||u[g]-u[f]),p}addToSortKeyRanges(e,r){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===r?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const s=this.symbolInstances.get(r);this.featureSortOrder.push(s.featureIndex),[s.rightJustifiedTextSymbolIndex,s.centerJustifiedTextSymbolIndex,s.leftJustifiedTextSymbolIndex].forEach((l,u,p)=>{l>=0&&p.indexOf(l)===u&&this.addIndicesForPlacedSymbol(this.text,l)}),s.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,s.verticalPlacedTextSymbolIndex),s.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.placedIconSymbolIndex),s.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}De("SymbolBucket",Hs,{omit:["layers","collisionBoxArray","features","compareText"]}),Hs.MAX_GLYPHS=65535,Hs.addDynamicAttributes=Hl;const ld=new ri({"symbol-placement":new Oe(de.layout_symbol["symbol-placement"]),"symbol-spacing":new Oe(de.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Oe(de.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ge(de.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Oe(de.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Oe(de.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Oe(de.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Oe(de.layout_symbol["icon-ignore-placement"]),"icon-optional":new Oe(de.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Oe(de.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ge(de.layout_symbol["icon-size"]),"icon-text-fit":new Oe(de.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Oe(de.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ge(de.layout_symbol["icon-image"]),"icon-rotate":new Ge(de.layout_symbol["icon-rotate"]),"icon-padding":new Ge(de.layout_symbol["icon-padding"]),"icon-keep-upright":new Oe(de.layout_symbol["icon-keep-upright"]),"icon-offset":new Ge(de.layout_symbol["icon-offset"]),"icon-anchor":new Ge(de.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Oe(de.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Oe(de.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Oe(de.layout_symbol["text-rotation-alignment"]),"text-field":new Ge(de.layout_symbol["text-field"]),"text-font":new Ge(de.layout_symbol["text-font"]),"text-size":new Ge(de.layout_symbol["text-size"]),"text-max-width":new Ge(de.layout_symbol["text-max-width"]),"text-line-height":new Oe(de.layout_symbol["text-line-height"]),"text-letter-spacing":new Ge(de.layout_symbol["text-letter-spacing"]),"text-justify":new Ge(de.layout_symbol["text-justify"]),"text-radial-offset":new Ge(de.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Oe(de.layout_symbol["text-variable-anchor"]),"text-anchor":new Ge(de.layout_symbol["text-anchor"]),"text-max-angle":new Oe(de.layout_symbol["text-max-angle"]),"text-writing-mode":new Oe(de.layout_symbol["text-writing-mode"]),"text-rotate":new Ge(de.layout_symbol["text-rotate"]),"text-padding":new Oe(de.layout_symbol["text-padding"]),"text-keep-upright":new Oe(de.layout_symbol["text-keep-upright"]),"text-transform":new Ge(de.layout_symbol["text-transform"]),"text-offset":new Ge(de.layout_symbol["text-offset"]),"text-allow-overlap":new Oe(de.layout_symbol["text-allow-overlap"]),"text-overlap":new Oe(de.layout_symbol["text-overlap"]),"text-ignore-placement":new Oe(de.layout_symbol["text-ignore-placement"]),"text-optional":new Oe(de.layout_symbol["text-optional"])});var Yl={paint:new ri({"icon-opacity":new Ge(de.paint_symbol["icon-opacity"]),"icon-color":new Ge(de.paint_symbol["icon-color"]),"icon-halo-color":new Ge(de.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ge(de.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ge(de.paint_symbol["icon-halo-blur"]),"icon-translate":new Oe(de.paint_symbol["icon-translate"]),"icon-translate-anchor":new Oe(de.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ge(de.paint_symbol["text-opacity"]),"text-color":new Ge(de.paint_symbol["text-color"],{runtimeType:ii,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new Ge(de.paint_symbol["text-halo-color"]),"text-halo-width":new Ge(de.paint_symbol["text-halo-width"]),"text-halo-blur":new Ge(de.paint_symbol["text-halo-blur"]),"text-translate":new Oe(de.paint_symbol["text-translate"]),"text-translate-anchor":new Oe(de.paint_symbol["text-translate-anchor"])}),layout:ld};class hh{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:Pr,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}De("FormatSectionOverride",hh,{omit:["defaultValue"]});class Ya extends sr{constructor(e){super(e,Yl)}recalculate(e,r){if(super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const s=this.layout.get("text-writing-mode");if(s){const l=[];for(const u of s)l.indexOf(u)<0&&l.push(u);this.layout._values["text-writing-mode"]=l}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,r,s,l){const u=this.layout.get(e).evaluate(r,{},s,l),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||Yn(p.value)||!u?u:function(f,g){return g.replace(/{([^{}]+)}/g,(x,w)=>w in f?String(f[w]):"")}(r.properties,u)}createBucket(e){return new Hs(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of Yl.paint.overridableProperties){if(!Ya.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),s=new hh(r),l=new Ms(s,r.property.specification);let u=null;u=r.value.kind==="constant"||r.value.kind==="source"?new Qn("source",l):new mo("composite",l,r.value.zoomStops),this.paint._values[e]=new nr(r.property,u,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,s){return!(!this.layout||r.isDataDriven()||s.isDataDriven())&&Ya.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const s=e.get("text-field"),l=Yl.paint.properties[r];let u=!1;const p=f=>{for(const g of f)if(l.overrides&&l.overrides.hasOverride(g))return void(u=!0)};if(s.value.kind==="constant"&&s.value.value instanceof j)p(s.value.value.sections);else if(s.value.kind==="source"){const f=x=>{u||(x instanceof Fe&&ae(x.value)===Ht?p(x.value.sections):x instanceof As?p(x.sections):x.eachChild(f))},g=s.value;g._styleExpression&&f(g._styleExpression.expression)}return u}}function Jl(i,e,r){let s="never";const l=i.get(e);return l?s=l:i.get(r)&&(s="always"),s}var cd={paint:new ri({"background-color":new Oe(de.paint_background["background-color"]),"background-pattern":new So(de.paint_background["background-pattern"]),"background-opacity":new Oe(de.paint_background["background-opacity"])})},hd={paint:new ri({"raster-opacity":new Oe(de.paint_raster["raster-opacity"]),"raster-hue-rotate":new Oe(de.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Oe(de.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Oe(de.paint_raster["raster-brightness-max"]),"raster-saturation":new Oe(de.paint_raster["raster-saturation"]),"raster-contrast":new Oe(de.paint_raster["raster-contrast"]),"raster-resampling":new Oe(de.paint_raster["raster-resampling"]),"raster-fade-duration":new Oe(de.paint_raster["raster-fade-duration"])})};class ud extends sr{constructor(e){super(e,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}const dd={circle:class extends sr{constructor(i){super(i,Gh)}createBucket(i){return new El(i)}queryRadius(i){const e=i;return ko("circle-radius",this,e)+ko("circle-stroke-width",this,e)+La(this.paint.get("circle-translate"))}queryIntersectsFeature(i,e,r,s,l,u,p,f){const g=Ba(i,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),u.angle,p),x=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r),w=this.paint.get("circle-pitch-alignment")==="map",I=w?g:function(M,k){return M.map(N=>bc(N,k))}(g,f),A=w?x*p:x;for(const M of s)for(const k of M){const N=w?k:bc(k,f);let V=A;const J=Ra([],[k.x,k.y,0,1],f);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?V*=J[3]/u.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(V*=u.cameraToCenterDistance/J[3]),Oh(I,N,V))return!0}return!1}},heatmap:class extends sr{constructor(i){super(i,jh),this._updateColorRamp()}createBucket(i){return new wc(i)}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Ic({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}},hillshade:class extends sr{constructor(i){super(i,Zh)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}},fill:class extends sr{constructor(i){super(i,lu)}recalculate(i,e){super.recalculate(i,e);const r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new Fl(i)}queryRadius(){return La(this.paint.get("fill-translate"))}queryIntersectsFeature(i,e,r,s,l,u,p){return pc(Ba(i,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),u.angle,p),s)}isTileClipped(){return!0}},"fill-extrusion":class extends sr{constructor(i){super(i,wu)}createBucket(i){return new Ul(i)}queryRadius(){return La(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(i,e,r,s,l,u,p,f){const g=Ba(i,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),u.angle,p),x=this.paint.get("fill-extrusion-height").evaluate(e,r),w=this.paint.get("fill-extrusion-base").evaluate(e,r),I=function(M,k,N,V){const J=[];for(const oe of M){const Y=[oe.x,oe.y,0,1];Ra(Y,Y,k),J.push(new je(Y[0]/Y[3],Y[1]/Y[3]))}return J}(g,f),A=function(M,k,N,V){const J=[],oe=[],Y=V[8]*k,ne=V[9]*k,me=V[10]*k,pe=V[11]*k,ke=V[8]*N,Be=V[9]*N,Se=V[10]*N,we=V[11]*N;for(const xe of M){const Ce=[],Ie=[];for(const _e of xe){const Ne=_e.x,Ue=_e.y,it=V[0]*Ne+V[4]*Ue+V[12],St=V[1]*Ne+V[5]*Ue+V[13],Pt=V[2]*Ne+V[6]*Ue+V[14],Xt=V[3]*Ne+V[7]*Ue+V[15],Ji=Pt+me,li=Xt+pe,$t=it+ke,Qt=St+Be,ci=Pt+Se,mi=Xt+we,Pi=new je((it+Y)/li,(St+ne)/li);Pi.z=Ji/li,Ce.push(Pi);const Gt=new je($t/mi,Qt/mi);Gt.z=ci/mi,Ie.push(Gt)}J.push(Ce),oe.push(Ie)}return[J,oe]}(s,w,x,f);return function(M,k,N){let V=1/0;pc(N,k)&&(V=Dc(N,k[0]));for(let J=0;J<k.length;J++){const oe=k[J],Y=M[J];for(let ne=0;ne<oe.length-1;ne++){const me=oe[ne],pe=[me,oe[ne+1],Y[ne+1],Y[ne],me];dc(N,pe)&&(V=Math.min(V,Dc(N,pe)))}}return V!==1/0&&V}(A[0],A[1],I)}},line:class extends sr{constructor(i){super(i,Bc),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){i==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Zn,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,e){super.recalculate(i,e),this.paint._values["line-floorwidth"]=Rc.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new Vl(i)}queryRadius(i){const e=i,r=Fc(ko("line-width",this,e),ko("line-gap-width",this,e)),s=ko("line-offset",this,e);return r/2+Math.abs(s)+La(this.paint.get("line-translate"))}queryIntersectsFeature(i,e,r,s,l,u,p){const f=Ba(i,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),u.angle,p),g=p/2*Fc(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),x=this.paint.get("line-offset").evaluate(e,r);return x&&(s=function(w,I){const A=[];for(let M=0;M<w.length;M++){const k=w[M],N=[];for(let V=0;V<k.length;V++){const J=k[V-1],oe=k[V],Y=k[V+1],ne=V===0?new je(0,0):oe.sub(J)._unit()._perp(),me=V===k.length-1?new je(0,0):Y.sub(oe)._unit()._perp(),pe=ne._add(me)._unit(),ke=pe.x*me.x+pe.y*me.y;ke!==0&&pe._mult(1/ke),N.push(pe._mult(I)._add(oe))}A.push(N)}return A}(s,x*p)),function(w,I,A){for(let M=0;M<I.length;M++){const k=I[M];if(w.length>=3){for(let N=0;N<k.length;N++)if(Ns(w,k[N]))return!0}if(Uh(w,k,A))return!0}return!1}(f,s,g)}isTileClipped(){return!0}},symbol:Ya,background:class extends sr{constructor(i){super(i,cd)}},raster:class extends sr{constructor(i){super(i,hd)}}};class pd{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const uh=63710088e-1;class Ot{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ot(Bt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,s=this.lat*r,l=e.lat*r,u=Math.sin(s)*Math.sin(l)+Math.cos(s)*Math.cos(l)*Math.cos((e.lng-this.lng)*r);return uh*Math.acos(Math.min(u,1))}toBounds(e=0){const r=360*e/40075017,s=r/Math.cos(Math.PI/180*this.lat);return new ys(new Ot(this.lng-s,this.lat-r),new Ot(this.lng+s,this.lat+r))}static convert(e){if(e instanceof Ot)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Ot(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Ot(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class ys{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Ot?new Ot(e.lng,e.lat):Ot.convert(e),this}setSouthWest(e){return this._sw=e instanceof Ot?new Ot(e.lng,e.lat):Ot.convert(e),this}extend(e){const r=this._sw,s=this._ne;let l,u;if(e instanceof Ot)l=e,u=e;else{if(!(e instanceof ys))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(ys.convert(e)):this.extend(Ot.convert(e)):this;if(l=e._sw,u=e._ne,!l||!u)return this}return r||s?(r.lng=Math.min(l.lng,r.lng),r.lat=Math.min(l.lat,r.lat),s.lng=Math.max(u.lng,s.lng),s.lat=Math.max(u.lat,s.lat)):(this._sw=new Ot(l.lng,l.lat),this._ne=new Ot(u.lng,u.lat)),this}getCenter(){return new Ot((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Ot(this.getWest(),this.getNorth())}getSouthEast(){return new Ot(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:s}=Ot.convert(e);let l=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(l=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&l}static convert(e){return e instanceof ys?e:e&&new ys(e)}}const dh=2*Math.PI*uh;function ph(i){return dh*Math.cos(i*Math.PI/180)}function mh(i){return(180+i)/360}function fh(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function gh(i,e){return i/ph(e)}function Ql(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class Ja{constructor(e,r,s=0){this.x=+e,this.y=+r,this.z=+s}static fromLngLat(e,r=0){const s=Ot.convert(e);return new Ja(mh(s.lng),fh(s.lat),gh(r,s.lat))}toLngLat(){return new Ot(360*this.x-180,Ql(this.y))}toAltitude(){return this.z*ph(Ql(this.y))}meterInMercatorCoordinateUnits(){return 1/dh*(e=Ql(this.y),1/Math.cos(e*Math.PI/180));var e}}function yh(i,e,r){var s=2*Math.PI*6378137/256/Math.pow(2,r);return[i*s-2*Math.PI*6378137/2,e*s-2*Math.PI*6378137/2]}class ec{constructor(e,r,s){if(e<0||e>25||s<0||s>=Math.pow(2,e)||r<0||r>=Math.pow(2,e))throw new Error(`x=${r}, y=${s}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=r,this.y=s,this.key=$o(0,e,e,r,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r,s){const l=(p=this.y,f=this.z,g=yh(256*(u=this.x),256*(p=Math.pow(2,f)-p-1),f),x=yh(256*(u+1),256*(p+1),f),g[0]+","+g[1]+","+x[0]+","+x[1]);var u,p,f,g,x;const w=function(I,A,M){let k,N="";for(let V=I;V>0;V--)k=1<<V-1,N+=(A&k?1:0)+(M&k?2:0);return N}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,w).replace(/{bbox-epsg-3857}/g,l)}isChildOf(e){const r=this.z-e.z;return r>0&&e.x===this.x>>r&&e.y===this.y>>r}getTilePoint(e){const r=Math.pow(2,this.z);return new je((e.x*r-this.x)*Zt,(e.y*r-this.y)*Zt)}toString(){return`${this.z}/${this.x}/${this.y}`}}class _h{constructor(e,r){this.wrap=e,this.canonical=r,this.key=$o(e,r.z,r.z,r.x,r.y)}}class Yi{constructor(e,r,s,l,u){if(e<s)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${s}`);this.overscaledZ=e,this.wrap=r,this.canonical=new ec(s,+l,+u),this.key=$o(r,e,s,l,u)}clone(){return new Yi(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-e;return e>this.canonical.z?new Yi(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Yi(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const s=this.canonical.z-e;return e>this.canonical.z?$o(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y):$o(this.wrap*+r,e,e,this.canonical.x>>s,this.canonical.y>>s)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new Yi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,s=2*this.canonical.x,l=2*this.canonical.y;return[new Yi(r,this.wrap,r,s,l),new Yi(r,this.wrap,r,s+1,l),new Yi(r,this.wrap,r,s,l+1),new Yi(r,this.wrap,r,s+1,l+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Yi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Yi(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new _h(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new Ja(e.x-this.wrap,e.y))}}function $o(i,e,r,s,l){(i*=2)<0&&(i=-1*i-1);const u=1<<r;return(u*u*i+u*l+s).toString(36)+r.toString(36)+e.toString(36)}De("CanonicalTileID",ec),De("OverscaledTileID",Yi,{omit:["posMatrix"]});class xh{constructor(e,r,s){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(s&&s!=="mapbox"&&s!=="terrarium")return void Rt(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const l=this.dim=r.height-2;this.data=new Uint32Array(r.data.buffer),this.encoding=s||"mapbox";for(let u=0;u<l;u++)this.data[this._idx(-1,u)]=this.data[this._idx(0,u)],this.data[this._idx(l,u)]=this.data[this._idx(l-1,u)],this.data[this._idx(u,-1)]=this.data[this._idx(u,0)],this.data[this._idx(u,l)]=this.data[this._idx(u,l-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(l,-1)]=this.data[this._idx(l-1,0)],this.data[this._idx(-1,l)]=this.data[this._idx(0,l-1)],this.data[this._idx(l,l)]=this.data[this._idx(l-1,l-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let u=0;u<l;u++)for(let p=0;p<l;p++){const f=this.get(u,p);f>this.max&&(this.max=f),f<this.min&&(this.min=f)}}get(e,r){const s=new Uint8Array(this.data.buffer),l=4*this._idx(e,r);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(s[l],s[l+1],s[l+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}_unpackMapbox(e,r,s){return(256*e*256+256*r+s)/10-1e4}_unpackTerrarium(e,r,s){return 256*e+r+s/256-32768}getPixels(){return new Ki({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,r,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let l=r*this.dim,u=r*this.dim+this.dim,p=s*this.dim,f=s*this.dim+this.dim;switch(r){case-1:l=u-1;break;case 1:u=l+1}switch(s){case-1:p=f-1;break;case 1:f=p+1}const g=-r*this.dim,x=-s*this.dim;for(let w=p;w<f;w++)for(let I=l;I<u;I++)this.data[this._idx(I,w)]=e.data[this._idx(I+g,w+x)]}}De("DEMData",xh);class vh{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const s=e[r];this._stringToNumber[s]=r,this._numberToString[r]=s}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class bh{constructor(e,r,s,l,u){this.type="Feature",this._vectorTileFeature=e,e._z=r,e._x=s,e._y=l,this.properties=e.properties,this.id=u}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(e[r]=this[r]);return e}}class wh{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new cs(Zt,16,0),this.grid3D=new cs(Zt,16,0),this.featureIndexArray=new tt,this.promoteId=r}insert(e,r,s,l,u,p){const f=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,l,u);const g=p?this.grid3D:this.grid;for(let x=0;x<r.length;x++){const w=r[x],I=[1/0,1/0,-1/0,-1/0];for(let A=0;A<w.length;A++){const M=w[A];I[0]=Math.min(I[0],M.x),I[1]=Math.min(I[1],M.y),I[2]=Math.max(I[2],M.x),I[3]=Math.max(I[3],M.y)}I[0]<Zt&&I[1]<Zt&&I[2]>=0&&I[3]>=0&&g.insert(f,I[0],I[1],I[2],I[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Bn.VectorTile(new Nl(this.rawTileData)).layers,this.sourceLayerCoder=new vh(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,r,s,l){this.loadVTLayers();const u=e.params||{},p=Zt/e.tileSize/e.scale,f=Ds(u.filter),g=e.queryGeometry,x=e.queryPadding*p,w=Ih(g),I=this.grid.query(w.minX-x,w.minY-x,w.maxX+x,w.maxY+x),A=Ih(e.cameraQueryGeometry),M=this.grid3D.query(A.minX-x,A.minY-x,A.maxX+x,A.maxY+x,(V,J,oe,Y)=>function(ne,me,pe,ke,Be){for(const we of ne)if(me<=we.x&&pe<=we.y&&ke>=we.x&&Be>=we.y)return!0;const Se=[new je(me,pe),new je(me,Be),new je(ke,Be),new je(ke,pe)];if(ne.length>2){for(const we of Se)if(Ns(ne,we))return!0}for(let we=0;we<ne.length-1;we++)if(Nh(ne[we],ne[we+1],Se))return!0;return!1}(e.cameraQueryGeometry,V-x,J-x,oe+x,Y+x));for(const V of M)I.push(V);I.sort(md);const k={};let N;for(let V=0;V<I.length;V++){const J=I[V];if(J===N)continue;N=J;const oe=this.featureIndexArray.get(J);let Y=null;this.loadMatchingFeature(k,oe.bucketIndex,oe.sourceLayerIndex,oe.featureIndex,f,u.layers,u.availableImages,r,s,l,(ne,me,pe)=>(Y||(Y=ms(ne)),me.queryIntersectsFeature(g,ne,pe,Y,this.z,e.transform,p,e.pixelPosMatrix)))}return k}loadMatchingFeature(e,r,s,l,u,p,f,g,x,w,I){const A=this.bucketLayerIDs[r];if(p&&!function(V,J){for(let oe=0;oe<V.length;oe++)if(J.indexOf(V[oe])>=0)return!0;return!1}(p,A))return;const M=this.sourceLayerCoder.decode(s),k=this.vtLayers[M].feature(l);if(u.needGeometry){const V=fs(k,!0);if(!u.filter(new Mt(this.tileID.overscaledZ),V,this.tileID.canonical))return}else if(!u.filter(new Mt(this.tileID.overscaledZ),k))return;const N=this.getId(k,M);for(let V=0;V<A.length;V++){const J=A[V];if(p&&p.indexOf(J)<0)continue;const oe=g[J];if(!oe)continue;let Y={};N&&w&&(Y=w.getState(oe.sourceLayer||"_geojsonTileLayer",N));const ne=_t({},x[J]);ne.paint=Th(ne.paint,oe.paint,k,Y,f),ne.layout=Th(ne.layout,oe.layout,k,Y,f);const me=!I||I(k,oe,Y);if(!me)continue;const pe=new bh(k,this.z,this.x,this.y,N);pe.layer=ne;let ke=e[J];ke===void 0&&(ke=e[J]=[]),ke.push({featureIndex:l,feature:pe,intersectionZ:me})}}lookupSymbolFeatures(e,r,s,l,u,p,f,g){const x={};this.loadVTLayers();const w=Ds(u);for(const I of e)this.loadMatchingFeature(x,s,l,I,w,p,f,g,r);return x}hasLayer(e){for(const r of this.bucketLayerIDs)for(const s of r)if(e===s)return!0;return!1}getId(e,r){let s=e.id;return this.promoteId&&(s=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof s=="boolean"&&(s=Number(s))),s}}function Th(i,e,r,s,l){return ti(i,(u,p)=>{const f=e instanceof ds?e.get(p):null;return f&&f.evaluate?f.evaluate(r,s,l):f})}function Ih(i){let e=1/0,r=1/0,s=-1/0,l=-1/0;for(const u of i)e=Math.min(e,u.x),r=Math.min(r,u.y),s=Math.max(s,u.x),l=Math.max(l,u.y);return{minX:e,minY:r,maxX:s,maxY:l}}function md(i,e){return e-i}var tc;De("FeatureIndex",wh,{omit:["rawTileData","sourceLayerCoder"]}),h.PerformanceMarkers=void 0,(tc=h.PerformanceMarkers||(h.PerformanceMarkers={})).create="create",tc.load="load",tc.fullLoad="fullLoad";let Qa=null,Go=[];const ic=1e3/30,fd={mark(i){performance.mark(i)},frame(i){const e=i;Qa!=null&&Go.push(e-Qa),Qa=e},clearMetrics(){Qa=null,Go=[],performance.clearMeasures("loadTime"),performance.clearMeasures("fullLoadTime");for(const i in h.PerformanceMarkers)performance.clearMarks(h.PerformanceMarkers[i])},getPerformanceMetrics(){performance.measure("loadTime",h.PerformanceMarkers.create,h.PerformanceMarkers.load),performance.measure("fullLoadTime",h.PerformanceMarkers.create,h.PerformanceMarkers.fullLoad);const i=performance.getEntriesByName("loadTime")[0].duration,e=performance.getEntriesByName("fullLoadTime")[0].duration,r=Go.length,s=1/(Go.reduce((u,p)=>u+p,0)/r/1e3),l=Go.filter(u=>u>ic).reduce((u,p)=>u+(p-ic)/ic,0);return{loadTime:i,fullLoadTime:e,fps:s,percentDroppedFrames:l/(r+l)*100}}};h.AJAXError=Si,h.ARRAY_TYPE=Ti,h.Actor=class{constructor(i,e,r){this.target=i,this.parent=e,this.mapId=r,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},si(["receive","process"],this),this.invoker=new pd(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=di()?i:window}send(i,e,r,s,l=!1){const u=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(this.callbacks[u]=r);const p=Ir(this.globalScope)?void 0:[];return this.target.postMessage({id:u,type:i,hasCallback:!!r,targetMapId:s,mustQueue:l,sourceMapId:this.mapId,data:Jr(e,p)},p),{cancel:()=>{r&&delete this.callbacks[u],this.target.postMessage({id:u,type:"<cancel>",targetMapId:s,sourceMapId:this.mapId})}}}receive(i){const e=i.data,r=e.id;if(r&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){delete this.tasks[r];const s=this.cancelCallbacks[r];delete this.cancelCallbacks[r],s&&s()}else di()||e.mustQueue?(this.tasks[r]=e,this.taskQueue.push(r),this.invoker.trigger()):this.processTask(r,e)}process(){if(!this.taskQueue.length)return;const i=this.taskQueue.shift(),e=this.tasks[i];delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),e&&this.processTask(i,e)}processTask(i,e){if(e.type==="<response>"){const r=this.callbacks[i];delete this.callbacks[i],r&&(e.error?r(Br(e.error)):r(null,Br(e.data)))}else{let r=!1;const s=Ir(this.globalScope)?void 0:[],l=e.hasCallback?(f,g)=>{r=!0,delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:f?Jr(f):null,data:Jr(g,s)},s)}:f=>{r=!0};let u=null;const p=Br(e.data);if(this.parent[e.type])u=this.parent[e.type](e.sourceMapId,p,l);else if(this.parent.getWorkerSource){const f=e.type.split(".");u=this.parent.getWorkerSource(e.sourceMapId,f[0],p.source)[f[1]](p,l)}else l(new Error(`Could not find function ${e.type}`));!r&&u&&u.cancel&&(this.cancelCallbacks[i]=u.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},h.AlphaImage=Do,h.CanonicalTileID=ec,h.CollisionBoxArray=he,h.CollisionCircleLayoutArray=class extends T{},h.Color=D,h.DEMData=xh,h.DataConstantProperty=Oe,h.DictionaryCoder=vh,h.EXTENT=Zt,h.ErrorEvent=yn,h.EvaluationParameters=Mt,h.Event=mr,h.Evented=fr,h.FeatureIndex=wh,h.FillBucket=Fl,h.FillExtrusionBucket=Ul,h.GeoJSONFeature=bh,h.ImageAtlas=Zc,h.ImagePosition=Gl,h.LineBucket=Vl,h.LineStripIndexArray=class extends U{},h.LngLat=Ot,h.LngLatBounds=ys,h.MercatorCoordinate=Ja,h.ONE_EM=ni,h.OverscaledTileID=Yi,h.PerformanceUtils=fd,h.PosArray=Ve,h.Properties=ri,h.QuadTriangleArray=class extends z{},h.RGBAImage=Ki,h.RasterBoundsArray=class extends a{},h.RequestPerformance=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},h.ResourceType=dr,h.SegmentVector=rt,h.SymbolBucket=Hs,h.Transitionable=Aa,h.TriangleIndexArray=bi,h.Uniform1f=rn,h.Uniform1i=class extends tn{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},h.Uniform2f=class extends tn{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},h.Uniform3f=class extends tn{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},h.Uniform4f=Us,h.UniformColor=lc,h.UniformMatrix4f=class extends tn{constructor(i,e){super(i,e),this.current=Rh}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},h.UnwrappedTileID=_h,h.ValidationError=Te,h.ZoomHistory=_o,h.add=function(i,e,r){return i[0]=e[0]+r[0],i[1]=e[1]+r[1],i[2]=e[2]+r[2],i},h.addDynamicAttributes=Hl,h.asyncAll=function(i,e,r){if(!i.length)return r(null,[]);let s=i.length;const l=new Array(i.length);let u=null;i.forEach((p,f)=>{e(p,(g,x)=>{g&&(u=g),l[f]=x,--s==0&&r(u,l)})})},h.bezier=Je,h.bindAll=si,h.cacheEntryPossiblyAdded=function(i){tr++,tr>dn&&(i.getActor().send("enforceCacheSizeLimit",un),tr=0)},h.clamp=re,h.clearTileCache=function(i){const e=caches.delete(ji);i&&e.catch(i).then(()=>i())},h.clipLine=nh,h.clone=function(i){var e=new Ti(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},h.clone$1=oi,h.clone$2=function(i){var e=new Ti(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e},h.collisionCircleLayout=Du,h.config=ur,h.copy=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},h.create=function(){var i=new Ti(16);return Ti!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},h.create$1=gc,h.createExpression=Jn,h.createFilter=Ds,h.createLayout=Nt,h.createStyleLayer=function(i){return i.type==="custom"?new ud(i):new dd[i.type](i)},h.cross=function(i,e,r){var s=e[0],l=e[1],u=e[2],p=r[0],f=r[1],g=r[2];return i[0]=l*g-u*f,i[1]=u*p-s*g,i[2]=s*f-l*p,i},h.dot=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]},h.dot$1=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3]},h.ease=Re,h.emitValidationErrors=Bs,h.enforceCacheSizeLimit=function(i){pn(),Zi&&Zi.then(e=>{e.keys().then(r=>{for(let s=0;s<r.length-i;s++)e.delete(r[s])})})},h.equals=function(i,e){var r=i[0],s=i[1],l=i[2],u=i[3],p=i[4],f=i[5],g=i[6],x=i[7],w=i[8],I=i[9],A=i[10],M=i[11],k=i[12],N=i[13],V=i[14],J=i[15],oe=e[0],Y=e[1],ne=e[2],me=e[3],pe=e[4],ke=e[5],Be=e[6],Se=e[7],we=e[8],xe=e[9],Ce=e[10],Ie=e[11],_e=e[12],Ne=e[13],Ue=e[14],it=e[15];return Math.abs(r-oe)<=wi*Math.max(1,Math.abs(r),Math.abs(oe))&&Math.abs(s-Y)<=wi*Math.max(1,Math.abs(s),Math.abs(Y))&&Math.abs(l-ne)<=wi*Math.max(1,Math.abs(l),Math.abs(ne))&&Math.abs(u-me)<=wi*Math.max(1,Math.abs(u),Math.abs(me))&&Math.abs(p-pe)<=wi*Math.max(1,Math.abs(p),Math.abs(pe))&&Math.abs(f-ke)<=wi*Math.max(1,Math.abs(f),Math.abs(ke))&&Math.abs(g-Be)<=wi*Math.max(1,Math.abs(g),Math.abs(Be))&&Math.abs(x-Se)<=wi*Math.max(1,Math.abs(x),Math.abs(Se))&&Math.abs(w-we)<=wi*Math.max(1,Math.abs(w),Math.abs(we))&&Math.abs(I-xe)<=wi*Math.max(1,Math.abs(I),Math.abs(xe))&&Math.abs(A-Ce)<=wi*Math.max(1,Math.abs(A),Math.abs(Ce))&&Math.abs(M-Ie)<=wi*Math.max(1,Math.abs(M),Math.abs(Ie))&&Math.abs(k-_e)<=wi*Math.max(1,Math.abs(k),Math.abs(_e))&&Math.abs(N-Ne)<=wi*Math.max(1,Math.abs(N),Math.abs(Ne))&&Math.abs(V-Ue)<=wi*Math.max(1,Math.abs(V),Math.abs(Ue))&&Math.abs(J-it)<=wi*Math.max(1,Math.abs(J),Math.abs(it))},h.evaluateSizeForFeature=function(i,{uSize:e,uSizeT:r},{lowerSize:s,upperSize:l}){return i.kind==="source"?s/on:i.kind==="composite"?At(s/on,l/on,r):e},h.evaluateSizeForZoom=function(i,e){let r=0,s=0;if(i.kind==="constant")s=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:l,minZoom:u,maxZoom:p}=i,f=l?re(zi.interpolationFactor(l,e,u,p),0,1):0;i.kind==="camera"?s=At(i.minSize,i.maxSize,f):r=f}return{uSizeT:r,uSize:s}},h.evaluateVariableOffset=ah,h.evented=Eo,h.exported=Er,h.exported$1=Sr,h.extend=_t,h.filterObject=qt,h.fromRotation=function(i,e){var r=Math.sin(e),s=Math.cos(e);return i[0]=s,i[1]=r,i[2]=0,i[3]=-r,i[4]=s,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},h.fromScaling=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},h.getAnchorAlignment=jl,h.getAnchorJustification=Xl,h.getArrayBuffer=gn,h.getImage=kr,h.getJSON=function(i,e){return fn(_t(i,{type:"json"}),e)},h.getOverlapMode=Jl,h.getRTLTextPluginStatus=hs,h.getReferrer=Nn,h.getVideo=function(i,e){const r=window.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let s=0;s<i.length;s++){const l=window.document.createElement("source");$n(i[s])||(r.crossOrigin="Anonymous"),l.src=i[s],r.appendChild(l)}return{cancel:()=>{}}},h.identity=Al,h.invert=function(i,e){var r=e[0],s=e[1],l=e[2],u=e[3],p=e[4],f=e[5],g=e[6],x=e[7],w=e[8],I=e[9],A=e[10],M=e[11],k=e[12],N=e[13],V=e[14],J=e[15],oe=r*f-s*p,Y=r*g-l*p,ne=r*x-u*p,me=s*g-l*f,pe=s*x-u*f,ke=l*x-u*g,Be=w*N-I*k,Se=w*V-A*k,we=w*J-M*k,xe=I*V-A*N,Ce=I*J-M*N,Ie=A*J-M*V,_e=oe*Ie-Y*Ce+ne*xe+me*we-pe*Se+ke*Be;return _e?(i[0]=(f*Ie-g*Ce+x*xe)*(_e=1/_e),i[1]=(l*Ce-s*Ie-u*xe)*_e,i[2]=(N*ke-V*pe+J*me)*_e,i[3]=(A*pe-I*ke-M*me)*_e,i[4]=(g*we-p*Ie-x*Se)*_e,i[5]=(r*Ie-l*we+u*Se)*_e,i[6]=(V*ne-k*ke-J*Y)*_e,i[7]=(w*ke-A*ne+M*Y)*_e,i[8]=(p*Ce-f*we+x*Be)*_e,i[9]=(s*we-r*Ce-u*Be)*_e,i[10]=(k*pe-N*ne+J*oe)*_e,i[11]=(I*ne-w*pe-M*oe)*_e,i[12]=(f*Se-p*xe-g*Be)*_e,i[13]=(r*xe-s*Se+l*Be)*_e,i[14]=(N*Y-k*me-V*oe)*_e,i[15]=(w*me-I*Y+A*oe)*_e,i):null},h.isImageBitmap=er,h.isSafari=Ir,h.isWorker=di,h.keysDifference=function(i,e){const r=[];for(const s in i)s in e||r.push(s);return r},h.lazyLoadRTLTextPlugin=function(){Vi.isLoading()||Vi.isLoaded()||hs()!=="deferred"||Ca()},h.makeRequest=fn,h.mapObject=ti,h.mercatorXfromLng=mh,h.mercatorYfromLat=fh,h.mercatorZfromAltitude=gh,h.mul=qh,h.mul$1=function(i,e,r){return i[0]=e[0]*r[0],i[1]=e[1]*r[1],i[2]=e[2]*r[2],i[3]=e[3]*r[3],i},h.multiply=yc,h.nextPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},h.normalize=function(i,e){var r=e[0],s=e[1],l=e[2],u=r*r+s*s+l*l;return u>0&&(u=1/Math.sqrt(u)),i[0]=e[0]*u,i[1]=e[1]*u,i[2]=e[2]*u,i},h.number=At,h.ortho=function(i,e,r,s,l,u,p){var f=1/(e-r),g=1/(s-l),x=1/(u-p);return i[0]=-2*f,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*g,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*x,i[11]=0,i[12]=(e+r)*f,i[13]=(l+s)*g,i[14]=(p+u)*x,i[15]=1,i},h.parseCacheControl=hn,h.parseGlyphPbf=function(i){return new Nl(i).readFields(qu,[])},h.pbf=Nl,h.performSymbolLayout=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=Zt/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const e=i.bucket.layers[0].layout,r=i.bucket.layers[0]._unevaluatedLayout._values,s={layoutIconSize:r["icon-size"].possiblyEvaluate(new Mt(i.bucket.zoom+1),i.canonical),layoutTextSize:r["text-size"].possiblyEvaluate(new Mt(i.bucket.zoom+1),i.canonical),textMaxSize:r["text-size"].possiblyEvaluate(new Mt(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:g,maxZoom:x}=i.bucket.textSizeData;s.compositeTextSizes=[r["text-size"].possiblyEvaluate(new Mt(g),i.canonical),r["text-size"].possiblyEvaluate(new Mt(x),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:g,maxZoom:x}=i.bucket.iconSizeData;s.compositeIconSizes=[r["icon-size"].possiblyEvaluate(new Mt(g),i.canonical),r["icon-size"].possiblyEvaluate(new Mt(x),i.canonical)]}const l=e.get("text-line-height")*ni,u=e.get("text-rotation-alignment")!=="viewport"&&e.get("symbol-placement")!=="point",p=e.get("text-keep-upright"),f=e.get("text-size");for(const g of i.bucket.features){const x=e.get("text-font").evaluate(g,{},i.canonical).join(","),w=f.evaluate(g,{},i.canonical),I=s.layoutTextSize.evaluate(g,{},i.canonical),A=s.layoutIconSize.evaluate(g,{},i.canonical),M={horizontal:{},vertical:void 0},k=g.text;let N,V=[0,0];if(k){const Y=k.toString(),ne=e.get("text-letter-spacing").evaluate(g,{},i.canonical)*ni,me=vl(Y)?ne:0,pe=e.get("text-anchor").evaluate(g,{},i.canonical),ke=e.get("text-variable-anchor");if(!ke){const Ce=e.get("text-radial-offset").evaluate(g,{},i.canonical);V=Ce?ah(pe,[Ce*ni,Zl]):e.get("text-offset").evaluate(g,{},i.canonical).map(Ie=>Ie*ni)}let Be=u?"center":e.get("text-justify").evaluate(g,{},i.canonical);const Se=e.get("symbol-placement"),we=Se==="point"?e.get("text-max-width").evaluate(g,{},i.canonical)*ni:0,xe=()=>{i.bucket.allowVerticalPlacement&&Rs(Y)&&(M.vertical=qa(k,i.glyphMap,i.glyphPositions,i.imagePositions,x,we,l,pe,"left",me,V,h.WritingMode.vertical,!0,Se,I,w))};if(!u&&ke){const Ce=Be==="auto"?ke.map(_e=>Xl(_e)):[Be];let Ie=!1;for(let _e=0;_e<Ce.length;_e++){const Ne=Ce[_e];if(!M.horizontal[Ne])if(Ie)M.horizontal[Ne]=M.horizontal[0];else{const Ue=qa(k,i.glyphMap,i.glyphPositions,i.imagePositions,x,we,l,"center",Ne,me,V,h.WritingMode.horizontal,!1,Se,I,w);Ue&&(M.horizontal[Ne]=Ue,Ie=Ue.positionedLines.length===1)}}xe()}else{Be==="auto"&&(Be=Xl(pe));const Ce=qa(k,i.glyphMap,i.glyphPositions,i.imagePositions,x,we,l,pe,Be,me,V,h.WritingMode.horizontal,!1,Se,I,w);Ce&&(M.horizontal[Be]=Ce),xe(),Rs(Y)&&u&&p&&(M.vertical=qa(k,i.glyphMap,i.glyphPositions,i.imagePositions,x,we,l,pe,Be,me,V,h.WritingMode.vertical,!1,Se,I,w))}}let J=!1;if(g.icon&&g.icon.name){const Y=i.imageMap[g.icon.name];Y&&(N=Ku(i.imagePositions[g.icon.name],e.get("icon-offset").evaluate(g,{},i.canonical),e.get("icon-anchor").evaluate(g,{},i.canonical)),J=!!Y.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=J:i.bucket.sdfIcons!==J&&Rt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Y.pixelRatio!==i.bucket.pixelRatio||e.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const oe=ch(M.horizontal)||M.vertical;i.bucket.iconsInText=!!oe&&oe.iconsInText,(oe||N)&&rd(i.bucket,g,M,N,i.imageMap,s,I,A,V,J,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},h.perspective=function(i,e,r,s,l){var u,p=1/Math.tan(e/2);return i[0]=p/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=p,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,l!=null&&l!==1/0?(i[10]=(l+s)*(u=1/(s-l)),i[14]=2*l*s*u):(i[10]=-1,i[14]=-2*s),i},h.pick=function(i,e){const r={};for(let s=0;s<e.length;s++){const l=e[s];l in i&&(r[l]=i[l])}return r},h.plugin=Vi,h.pointGeometry=je,h.polygonIntersectsPolygon=dc,h.potpack=jc,h.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],h.register=De,h.registerForPluginStateChange=function(i){return i({pluginStatus:vi,pluginURL:Rr}),Eo.on("pluginStateChange",i),i},h.renderColorRamp=Ic,h.rotateX=function(i,e,r){var s=Math.sin(r),l=Math.cos(r),u=e[4],p=e[5],f=e[6],g=e[7],x=e[8],w=e[9],I=e[10],A=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=u*l+x*s,i[5]=p*l+w*s,i[6]=f*l+I*s,i[7]=g*l+A*s,i[8]=x*l-u*s,i[9]=w*l-p*s,i[10]=I*l-f*s,i[11]=A*l-g*s,i},h.rotateZ=function(i,e,r){var s=Math.sin(r),l=Math.cos(r),u=e[0],p=e[1],f=e[2],g=e[3],x=e[4],w=e[5],I=e[6],A=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=u*l+x*s,i[1]=p*l+w*s,i[2]=f*l+I*s,i[3]=g*l+A*s,i[4]=x*l-u*s,i[5]=w*l-p*s,i[6]=I*l-f*s,i[7]=A*l-g*s,i},h.scale=function(i,e,r){var s=r[0],l=r[1],u=r[2];return i[0]=e[0]*s,i[1]=e[1]*s,i[2]=e[2]*s,i[3]=e[3]*s,i[4]=e[4]*l,i[5]=e[5]*l,i[6]=e[6]*l,i[7]=e[7]*l,i[8]=e[8]*u,i[9]=e[9]*u,i[10]=e[10]*u,i[11]=e[11]*u,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},h.scale$1=function(i,e,r){return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i},h.setCacheLimits=function(i,e){un=i,dn=e},h.setRTLTextPlugin=function(i,e,r=!1){if(vi===bo||vi===wo||vi===To)throw new Error("setRTLTextPlugin cannot be called multiple times.");Rr=Er.resolveURL(i),vi=bo,Io=e,kn(),r||Ca()},h.spec=de,h.sphericalToCartesian=function([i,e,r]){return e+=90,e*=Math.PI/180,r*=Math.PI/180,{x:i*Math.cos(e)*Math.sin(r),y:i*Math.sin(e)*Math.sin(r),z:i*Math.cos(r)}},h.sqrLen=function(i){var e=i[0],r=i[1];return e*e+r*r},h.sub=function(i,e,r){return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],i},h.toEvaluationFeature=fs,h.transformMat3=function(i,e,r){var s=e[0],l=e[1],u=e[2];return i[0]=s*r[0]+l*r[3]+u*r[6],i[1]=s*r[1]+l*r[4]+u*r[7],i[2]=s*r[2]+l*r[5]+u*r[8],i},h.transformMat4=Ra,h.transformMat4$1=function(i,e,r){var s=e[0],l=e[1];return i[0]=r[0]*s+r[4]*l+r[12],i[1]=r[1]*s+r[5]*l+r[13],i},h.translate=function(i,e,r){var s,l,u,p,f,g,x,w,I,A,M,k,N=r[0],V=r[1],J=r[2];return e===i?(i[12]=e[0]*N+e[4]*V+e[8]*J+e[12],i[13]=e[1]*N+e[5]*V+e[9]*J+e[13],i[14]=e[2]*N+e[6]*V+e[10]*J+e[14],i[15]=e[3]*N+e[7]*V+e[11]*J+e[15]):(l=e[1],u=e[2],p=e[3],f=e[4],g=e[5],x=e[6],w=e[7],I=e[8],A=e[9],M=e[10],k=e[11],i[0]=s=e[0],i[1]=l,i[2]=u,i[3]=p,i[4]=f,i[5]=g,i[6]=x,i[7]=w,i[8]=I,i[9]=A,i[10]=M,i[11]=k,i[12]=s*N+f*V+I*J+e[12],i[13]=l*N+g*V+A*J+e[13],i[14]=u*N+x*V+M*J+e[14],i[15]=p*N+w*V+k*J+e[15]),i},h.triggerPluginCompletionEvent=Sa,h.unicodeBlockLookup=Ee,h.uniqueId=function(){return dt++},h.validateCustomStyleLayer=function(i){const e=[],r=i.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},h.validateLight=yo,h.validateStyle=ls,h.vectorTile=Bn,h.warnOnce=Rt,h.wrap=Bt}),ie(["./shared"],function(h){function Pe(L){const b=typeof L;if(b==="number"||b==="boolean"||b==="string"||L==null)return JSON.stringify(L);if(Array.isArray(L)){let D="[";for(const $ of L)D+=`${Pe($)},`;return`${D}]`}const S=Object.keys(L).sort();let P="{";for(let D=0;D<S.length;D++)P+=`${JSON.stringify(S[D])}:${Pe(L[S[D]])},`;return`${P}}`}function Ze(L){let b="";for(const S of h.refProperties)b+=`/${Pe(L[S])}`;return b}class Je{constructor(b){this.keyCache={},b&&this.replace(b)}replace(b){this._layerConfigs={},this._layers={},this.update(b,[])}update(b,S){for(const D of b){this._layerConfigs[D.id]=D;const $=this._layers[D.id]=h.createStyleLayer(D);$._featureFilter=h.createFilter($.filter),this.keyCache[D.id]&&delete this.keyCache[D.id]}for(const D of S)delete this.keyCache[D],delete this._layerConfigs[D],delete this._layers[D];this.familiesBySource={};const P=function(D,$){const H={};for(let G=0;G<D.length;G++){const W=$&&$[D[G].id]||Ze(D[G]);$&&($[D[G].id]=W);let le=H[W];le||(le=H[W]=[]),le.push(D[G])}const j=[];for(const G in H)j.push(H[G]);return j}(Object.values(this._layerConfigs),this.keyCache);for(const D of P){const $=D.map(ge=>this._layers[ge.id]),H=$[0];if(H.visibility==="none")continue;const j=H.source||"";let G=this.familiesBySource[j];G||(G=this.familiesBySource[j]={});const W=H.sourceLayer||"_geojsonTileLayer";let le=G[W];le||(le=G[W]=[]),le.push($)}}}class Re{constructor(b){const S={},P=[];for(const j in b){const G=b[j],W=S[j]={};for(const le in G){const ge=G[+le];if(!ge||ge.bitmap.width===0||ge.bitmap.height===0)continue;const ae={x:0,y:0,w:ge.bitmap.width+2,h:ge.bitmap.height+2};P.push(ae),W[le]={rect:ae,metrics:ge.metrics}}}const{w:D,h:$}=h.potpack(P),H=new h.AlphaImage({width:D||1,height:$||1});for(const j in b){const G=b[j];for(const W in G){const le=G[+W];if(!le||le.bitmap.width===0||le.bitmap.height===0)continue;const ge=S[j][W].rect;h.AlphaImage.copy(le.bitmap,H,{x:0,y:0},{x:ge.x+1,y:ge.y+1},le.bitmap)}}this.image=H,this.positions=S}}h.register("GlyphAtlas",Re);class re{constructor(b){this.tileID=new h.OverscaledTileID(b.tileID.overscaledZ,b.tileID.wrap,b.tileID.canonical.z,b.tileID.canonical.x,b.tileID.canonical.y),this.uid=b.uid,this.zoom=b.zoom,this.pixelRatio=b.pixelRatio,this.tileSize=b.tileSize,this.source=b.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=b.showCollisionBoxes,this.collectResourceTiming=!!b.collectResourceTiming,this.returnDependencies=!!b.returnDependencies,this.promoteId=b.promoteId}parse(b,S,P,D,$){this.status="parsing",this.data=b,this.collisionBoxArray=new h.CollisionBoxArray;const H=new h.DictionaryCoder(Object.keys(b.layers).sort()),j=new h.FeatureIndex(this.tileID,this.promoteId);j.bucketLayerIDs=[];const G={},W={featureIndex:j,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:P},le=S.familiesBySource[this.source];for(const Xe in le){const et=b.layers[Xe];if(!et)continue;et.version===1&&h.warnOnce(`Vector tile source "${this.source}" layer "${Xe}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ht=H.encode(Xe),bt=[];for(let Wt=0;Wt<et.length;Wt++){const Ct=et.feature(Wt),ai=j.getId(Ct,Xe);bt.push({feature:Ct,id:ai,index:Wt,sourceLayerIndex:ht})}for(const Wt of le[Xe]){const Ct=Wt[0];Ct.source!==this.source&&h.warnOnce(`layer.source = ${Ct.source} does not equal this.source = ${this.source}`),Ct.minzoom&&this.zoom<Math.floor(Ct.minzoom)||Ct.maxzoom&&this.zoom>=Ct.maxzoom||Ct.visibility!=="none"&&(Bt(Wt,this.zoom,P),(G[Ct.id]=Ct.createBucket({index:j.bucketLayerIDs.length,layers:Wt,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ht,sourceID:this.source})).populate(bt,W,this.tileID.canonical),j.bucketLayerIDs.push(Wt.map(ai=>ai.id)))}}let ge,ae,Le,Fe;const Ae=h.mapObject(W.glyphDependencies,Xe=>Object.keys(Xe).map(Number));Object.keys(Ae).length?D.send("getGlyphs",{uid:this.uid,stacks:Ae},(Xe,et)=>{ge||(ge=Xe,ae=et,ct.call(this))}):ae={};const $e=Object.keys(W.iconDependencies);$e.length?D.send("getImages",{icons:$e,source:this.source,tileID:this.tileID,type:"icons"},(Xe,et)=>{ge||(ge=Xe,Le=et,ct.call(this))}):Le={};const qe=Object.keys(W.patternDependencies);function ct(){if(ge)return $(ge);if(ae&&Le&&Fe){const Xe=new Re(ae),et=new h.ImageAtlas(Le,Fe);for(const ht in G){const bt=G[ht];bt instanceof h.SymbolBucket?(Bt(bt.layers,this.zoom,P),h.performSymbolLayout({bucket:bt,glyphMap:ae,glyphPositions:Xe.positions,imageMap:Le,imagePositions:et.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):bt.hasPattern&&(bt instanceof h.LineBucket||bt instanceof h.FillBucket||bt instanceof h.FillExtrusionBucket)&&(Bt(bt.layers,this.zoom,P),bt.addFeatures(W,this.tileID.canonical,et.patternPositions))}this.status="done",$(null,{buckets:Object.values(G).filter(ht=>!ht.isEmpty()),featureIndex:j,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Xe.image,imageAtlas:et,glyphMap:this.returnDependencies?ae:null,iconMap:this.returnDependencies?Le:null,glyphPositions:this.returnDependencies?Xe.positions:null})}}qe.length?D.send("getImages",{icons:qe,source:this.source,tileID:this.tileID,type:"patterns"},(Xe,et)=>{ge||(ge=Xe,Fe=et,ct.call(this))}):Fe={},ct.call(this)}}function Bt(L,b,S){const P=new h.EvaluationParameters(b);for(const D of L)D.recalculate(P,S)}function _t(L,b){const S=h.getArrayBuffer(L.request,(P,D,$,H)=>{P?b(P):D&&b(null,{vectorTile:new h.vectorTile.VectorTile(new h.pbf(D)),rawData:D,cacheControl:$,expires:H})});return()=>{S.cancel(),b()}}class dt{constructor(b,S,P,D){this.actor=b,this.layerIndex=S,this.availableImages=P,this.loadVectorData=D||_t,this.loading={},this.loaded={}}loadTile(b,S){const P=b.uid;this.loading||(this.loading={});const D=!!(b&&b.request&&b.request.collectResourceTiming)&&new h.RequestPerformance(b.request),$=this.loading[P]=new re(b);$.abort=this.loadVectorData(b,(H,j)=>{if(delete this.loading[P],H||!j)return $.status="done",this.loaded[P]=$,S(H);const G=j.rawData,W={};j.expires&&(W.expires=j.expires),j.cacheControl&&(W.cacheControl=j.cacheControl);const le={};if(D){const ge=D.finish();ge&&(le.resourceTiming=JSON.parse(JSON.stringify(ge)))}$.vectorTile=j.vectorTile,$.parse(j.vectorTile,this.layerIndex,this.availableImages,this.actor,(ge,ae)=>{if(ge||!ae)return S(ge);S(null,h.extend({rawTileData:G.slice(0)},ae,W,le))}),this.loaded=this.loaded||{},this.loaded[P]=$})}reloadTile(b,S){const P=this.loaded,D=b.uid,$=this;if(P&&P[D]){const H=P[D];H.showCollisionBoxes=b.showCollisionBoxes;const j=(G,W)=>{const le=H.reloadCallback;le&&(delete H.reloadCallback,H.parse(H.vectorTile,$.layerIndex,this.availableImages,$.actor,le)),S(G,W)};H.status==="parsing"?H.reloadCallback=j:H.status==="done"&&(H.vectorTile?H.parse(H.vectorTile,this.layerIndex,this.availableImages,this.actor,j):j())}}abortTile(b,S){const P=this.loading,D=b.uid;P&&P[D]&&P[D].abort&&(P[D].abort(),delete P[D]),S()}removeTile(b,S){const P=this.loaded,D=b.uid;P&&P[D]&&delete P[D],S()}}class si{constructor(){this.loaded={}}loadTile(b,S){const{uid:P,encoding:D,rawImageData:$}=b,H=h.isImageBitmap($)?this.getImageData($):$,j=new h.DEMData(P,H,D);this.loaded=this.loaded||{},this.loaded[P]=j,S(null,j)}getImageData(b){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(b.width,b.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=b.width,this.offscreenCanvas.height=b.height,this.offscreenCanvasContext.drawImage(b,0,0,b.width,b.height);const S=this.offscreenCanvasContext.getImageData(-1,-1,b.width+2,b.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new h.RGBAImage({width:S.width,height:S.height},S.data)}removeTile(b){const S=this.loaded,P=b.uid;S&&S[P]&&delete S[P]}}var ti=function L(b,S){var P,D=b&&b.type;if(D==="FeatureCollection")for(P=0;P<b.features.length;P++)L(b.features[P],S);else if(D==="GeometryCollection")for(P=0;P<b.geometries.length;P++)L(b.geometries[P],S);else if(D==="Feature")L(b.geometry,S);else if(D==="Polygon")qt(b.coordinates,S);else if(D==="MultiPolygon")for(P=0;P<b.coordinates.length;P++)qt(b.coordinates[P],S);return b};function qt(L,b){if(L.length!==0){oi(L[0],b);for(var S=1;S<L.length;S++)oi(L[S],!b)}}function oi(L,b){for(var S=0,P=0,D=0,$=L.length,H=$-1;D<$;H=D++){var j=(L[D][0]-L[H][0])*(L[H][1]+L[D][1]),G=S+j;P+=Math.abs(S)>=Math.abs(j)?S-G+j:j-G+S,S=G}S+P>=0!=!!b&&L.reverse()}const Gr=h.vectorTile.VectorTileFeature.prototype.toGeoJSON;class Rt{constructor(b){this._feature=b,this.extent=h.EXTENT,this.type=b.type,this.properties=b.tags,"id"in b&&!isNaN(b.id)&&(this.id=parseInt(b.id,10))}loadGeometry(){if(this._feature.type===1){const b=[];for(const S of this._feature.geometry)b.push([new h.pointGeometry(S[0],S[1])]);return b}{const b=[];for(const S of this._feature.geometry){const P=[];for(const D of S)P.push(new h.pointGeometry(D[0],D[1]));b.push(P)}return b}}toGeoJSON(b,S,P){return Gr.call(this,b,S,P)}}class Fi{constructor(b){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=h.EXTENT,this.length=b.length,this._features=b}feature(b){return new Rt(this._features[b])}}var _i={exports:{}},di=h.pointGeometry,hn=h.vectorTile.VectorTileFeature,qi=Ei;function Ei(L,b){this.options=b||{},this.features=L,this.length=L.length}function Oi(L,b){this.id=typeof L.id=="number"?L.id:void 0,this.type=L.type,this.rawGeometry=L.type===1?[L.geometry]:L.geometry,this.properties=L.tags,this.extent=b||4096}Ei.prototype.feature=function(L){return new Oi(this.features[L],this.options.extent)},Oi.prototype.loadGeometry=function(){var L=this.rawGeometry;this.geometry=[];for(var b=0;b<L.length;b++){for(var S=L[b],P=[],D=0;D<S.length;D++)P.push(new di(S[D][0],S[D][1]));this.geometry.push(P)}return this.geometry},Oi.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var L=this.geometry,b=1/0,S=-1/0,P=1/0,D=-1/0,$=0;$<L.length;$++)for(var H=L[$],j=0;j<H.length;j++){var G=H[j];b=Math.min(b,G.x),S=Math.max(S,G.x),P=Math.min(P,G.y),D=Math.max(D,G.y)}return[b,P,S,D]},Oi.prototype.toGeoJSON=hn.prototype.toGeoJSON;var Ir=h.pbf,er=qi;function Er(L){var b=new Ir;return function(S,P){for(var D in S.layers)P.writeMessage(3,je,S.layers[D])}(L,b),b.finish()}function je(L,b){var S;b.writeVarintField(15,L.version||1),b.writeStringField(1,L.name||""),b.writeVarintField(5,L.extent||4096);var P={keys:[],values:[],keycache:{},valuecache:{}};for(S=0;S<L.length;S++)P.feature=L.feature(S),b.writeMessage(2,hr,P);var D=P.keys;for(S=0;S<D.length;S++)b.writeStringField(3,D[S]);var $=P.values;for(S=0;S<$.length;S++)b.writeMessage(4,un,$[S])}function hr(L,b){var S=L.feature;S.id!==void 0&&b.writeVarintField(1,S.id),b.writeMessage(2,ur,L),b.writeVarintField(3,S.type),b.writeMessage(4,qr,S)}function ur(L,b){var S=L.feature,P=L.keys,D=L.values,$=L.keycache,H=L.valuecache;for(var j in S.properties){var G=S.properties[j],W=$[j];if(G!==null){W===void 0&&(P.push(j),$[j]=W=P.length-1),b.writeVarint(W);var le=typeof G;le!=="string"&&le!=="boolean"&&le!=="number"&&(G=JSON.stringify(G));var ge=le+":"+G,ae=H[ge];ae===void 0&&(D.push(G),H[ge]=ae=D.length-1),b.writeVarint(ae)}}}function ji(L,b){return(b<<3)+(7&L)}function Zi(L){return L<<1^L>>31}function qr(L,b){for(var S=L.loadGeometry(),P=L.type,D=0,$=0,H=S.length,j=0;j<H;j++){var G=S[j],W=1;P===1&&(W=G.length),b.writeVarint(ji(1,W));for(var le=P===3?G.length-1:G.length,ge=0;ge<le;ge++){ge===1&&P!==1&&b.writeVarint(ji(2,le-1));var ae=G[ge].x-D,Le=G[ge].y-$;b.writeVarint(Zi(ae)),b.writeVarint(Zi(Le)),D+=ae,$+=Le}P===3&&b.writeVarint(ji(7,1))}}function un(L,b){var S=typeof L;S==="string"?b.writeStringField(1,L):S==="boolean"?b.writeBooleanField(7,L):S==="number"&&(L%1!=0?b.writeDoubleField(3,L):L<0?b.writeSVarintField(6,L):b.writeVarintField(5,L))}function dn(L,b,S,P,D,$){if(D-P<=S)return;const H=P+D>>1;pn(L,b,H,P,D,$%2),dn(L,b,S,P,H-1,$+1),dn(L,b,S,H+1,D,$+1)}function pn(L,b,S,P,D,$){for(;D>P;){if(D-P>600){const W=D-P+1,le=S-P+1,ge=Math.log(W),ae=.5*Math.exp(2*ge/3),Le=.5*Math.sqrt(ge*ae*(W-ae)/W)*(le-W/2<0?-1:1);pn(L,b,S,Math.max(P,Math.floor(S-le*ae/W+Le)),Math.min(D,Math.floor(S+(W-le)*ae/W+Le)),$)}const H=b[2*S+$];let j=P,G=D;for(tr(L,b,P,S),b[2*D+$]>H&&tr(L,b,P,D);j<G;){for(tr(L,b,j,G),j++,G--;b[2*j+$]<H;)j++;for(;b[2*G+$]>H;)G--}b[2*P+$]===H?tr(L,b,P,G):(G++,tr(L,b,G,D)),G<=S&&(P=G+1),S<=G&&(D=G-1)}}function tr(L,b,S,P){Sr(L,S,P),Sr(b,2*S,2*P),Sr(b,2*S+1,2*P+1)}function Sr(L,b,S){const P=L[b];L[b]=L[S],L[S]=P}function Cr(L,b,S,P){const D=L-S,$=b-P;return D*D+$*$}_i.exports=Er,_i.exports.fromVectorTileJs=Er,_i.exports.fromGeojsonVt=function(L,b){b=b||{};var S={};for(var P in L)S[P]=new er(L[P].features,b),S[P].name=P,S[P].version=b.version,S[P].extent=b.extent;return Er({layers:S})},_i.exports.GeoJSONWrapper=er;const Ar=L=>L[0],xi=L=>L[1];class mn{constructor(b,S=Ar,P=xi,D=64,$=Float64Array){this.nodeSize=D,this.points=b;const H=b.length<65536?Uint16Array:Uint32Array,j=this.ids=new H(b.length),G=this.coords=new $(2*b.length);for(let W=0;W<b.length;W++)j[W]=W,G[2*W]=S(b[W]),G[2*W+1]=P(b[W]);dn(j,G,D,0,j.length-1,0)}range(b,S,P,D){return function($,H,j,G,W,le,ge){const ae=[0,$.length-1,0],Le=[];let Fe,Ae;for(;ae.length;){const $e=ae.pop(),qe=ae.pop(),ct=ae.pop();if(qe-ct<=ge){for(let ht=ct;ht<=qe;ht++)Fe=H[2*ht],Ae=H[2*ht+1],Fe>=j&&Fe<=W&&Ae>=G&&Ae<=le&&Le.push($[ht]);continue}const Xe=Math.floor((ct+qe)/2);Fe=H[2*Xe],Ae=H[2*Xe+1],Fe>=j&&Fe<=W&&Ae>=G&&Ae<=le&&Le.push($[Xe]);const et=($e+1)%2;($e===0?j<=Fe:G<=Ae)&&(ae.push(ct),ae.push(Xe-1),ae.push(et)),($e===0?W>=Fe:le>=Ae)&&(ae.push(Xe+1),ae.push(qe),ae.push(et))}return Le}(this.ids,this.coords,b,S,P,D,this.nodeSize)}within(b,S,P){return function(D,$,H,j,G,W){const le=[0,D.length-1,0],ge=[],ae=G*G;for(;le.length;){const Le=le.pop(),Fe=le.pop(),Ae=le.pop();if(Fe-Ae<=W){for(let et=Ae;et<=Fe;et++)Cr($[2*et],$[2*et+1],H,j)<=ae&&ge.push(D[et]);continue}const $e=Math.floor((Ae+Fe)/2),qe=$[2*$e],ct=$[2*$e+1];Cr(qe,ct,H,j)<=ae&&ge.push(D[$e]);const Xe=(Le+1)%2;(Le===0?H-G<=qe:j-G<=ct)&&(le.push(Ae),le.push($e-1),le.push(Xe)),(Le===0?H+G>=qe:j+G>=ct)&&(le.push($e+1),le.push(Fe),le.push(Xe))}return ge}(this.ids,this.coords,b,S,P,this.nodeSize)}}const Vn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:L=>L},dr=Math.fround||(Si=new Float32Array(1),L=>(Si[0]=+L,Si[0]));var Si;class Nn{constructor(b){this.options=kr(Object.create(Vn),b),this.trees=new Array(this.options.maxZoom+1)}load(b){const{log:S,minZoom:P,maxZoom:D,nodeSize:$}=this.options;S&&console.time("total time");const H=`prepare ${b.length} points`;S&&console.time(H),this.points=b;let j=[];for(let G=0;G<b.length;G++)b[G].geometry&&j.push(fn(b[G],G));this.trees[D+1]=new mn(j,Gn,pr,$,Float32Array),S&&console.timeEnd(H);for(let G=D;G>=P;G--){const W=+Date.now();j=this._cluster(j,G),this.trees[G]=new mn(j,Gn,pr,$,Float32Array),S&&console.log("z%d: %d clusters in %dms",G,j.length,+Date.now()-W)}return S&&console.timeEnd("total time"),this}getClusters(b,S){let P=((b[0]+180)%360+360)%360-180;const D=Math.max(-90,Math.min(90,b[1]));let $=b[2]===180?180:((b[2]+180)%360+360)%360-180;const H=Math.max(-90,Math.min(90,b[3]));if(b[2]-b[0]>=360)P=-180,$=180;else if(P>$){const le=this.getClusters([P,D,180,H],S),ge=this.getClusters([-180,D,$,H],S);return le.concat(ge)}const j=this.trees[this._limitZoom(S)],G=j.range(at(P),ir(H),at($),ir(D)),W=[];for(const le of G){const ge=j.points[le];W.push(ge.numPoints?gn(ge):this.points[ge.index])}return W}getChildren(b){const S=this._getOriginId(b),P=this._getOriginZoom(b),D="No cluster with the specified id.",$=this.trees[P];if(!$)throw new Error(D);const H=$.points[S];if(!H)throw new Error(D);const j=this.options.radius/(this.options.extent*Math.pow(2,P-1)),G=$.within(H.x,H.y,j),W=[];for(const le of G){const ge=$.points[le];ge.parentId===b&&W.push(ge.numPoints?gn(ge):this.points[ge.index])}if(W.length===0)throw new Error(D);return W}getLeaves(b,S,P){const D=[];return this._appendLeaves(D,b,S=S||10,P=P||0,0),D}getTile(b,S,P){const D=this.trees[this._limitZoom(b)],$=Math.pow(2,b),{extent:H,radius:j}=this.options,G=j/H,W=(P-G)/$,le=(P+1+G)/$,ge={features:[]};return this._addTileFeatures(D.range((S-G)/$,W,(S+1+G)/$,le),D.points,S,P,$,ge),S===0&&this._addTileFeatures(D.range(1-G/$,W,1,le),D.points,$,P,$,ge),S===$-1&&this._addTileFeatures(D.range(0,W,G/$,le),D.points,-1,P,$,ge),ge.features.length?ge:null}getClusterExpansionZoom(b){let S=this._getOriginZoom(b)-1;for(;S<=this.options.maxZoom;){const P=this.getChildren(b);if(S++,P.length!==1)break;b=P[0].properties.cluster_id}return S}_appendLeaves(b,S,P,D,$){const H=this.getChildren(S);for(const j of H){const G=j.properties;if(G&&G.cluster?$+G.point_count<=D?$+=G.point_count:$=this._appendLeaves(b,G.cluster_id,P,D,$):$<D?$++:b.push(j),b.length===P)break}return $}_addTileFeatures(b,S,P,D,$,H){for(const j of b){const G=S[j],W=G.numPoints;let le,ge,ae;if(W)le=$n(G),ge=G.x,ae=G.y;else{const Ae=this.points[G.index];le=Ae.properties,ge=at(Ae.geometry.coordinates[0]),ae=ir(Ae.geometry.coordinates[1])}const Le={type:1,geometry:[[Math.round(this.options.extent*(ge*$-P)),Math.round(this.options.extent*(ae*$-D))]],tags:le};let Fe;W?Fe=G.id:this.options.generateId?Fe=G.index:this.points[G.index].id&&(Fe=this.points[G.index].id),Fe!==void 0&&(Le.id=Fe),H.features.push(Le)}}_limitZoom(b){return Math.max(this.options.minZoom,Math.min(Math.floor(+b),this.options.maxZoom+1))}_cluster(b,S){const P=[],{radius:D,extent:$,reduce:H,minPoints:j}=this.options,G=D/($*Math.pow(2,S));for(let W=0;W<b.length;W++){const le=b[W];if(le.zoom<=S)continue;le.zoom=S;const ge=this.trees[S+1],ae=ge.within(le.x,le.y,G),Le=le.numPoints||1;let Fe=Le;for(const Ae of ae){const $e=ge.points[Ae];$e.zoom>S&&(Fe+=$e.numPoints||1)}if(Fe>Le&&Fe>=j){let Ae=le.x*Le,$e=le.y*Le,qe=H&&Le>1?this._map(le,!0):null;const ct=(W<<5)+(S+1)+this.points.length;for(const Xe of ae){const et=ge.points[Xe];if(et.zoom<=S)continue;et.zoom=S;const ht=et.numPoints||1;Ae+=et.x*ht,$e+=et.y*ht,et.parentId=ct,H&&(qe||(qe=this._map(le,!0)),H(qe,this._map(et)))}le.parentId=ct,P.push(zr(Ae/Fe,$e/Fe,ct,Fe,qe))}else if(P.push(le),Fe>1)for(const Ae of ae){const $e=ge.points[Ae];$e.zoom<=S||($e.zoom=S,P.push($e))}}return P}_getOriginId(b){return b-this.points.length>>5}_getOriginZoom(b){return(b-this.points.length)%32}_map(b,S){if(b.numPoints)return S?kr({},b.properties):b.properties;const P=this.points[b.index].properties,D=this.options.map(P);return S&&D===P?kr({},D):D}}function zr(L,b,S,P,D){return{x:dr(L),y:dr(b),zoom:1/0,id:S,parentId:-1,numPoints:P,properties:D}}function fn(L,b){const[S,P]=L.geometry.coordinates;return{x:dr(at(S)),y:dr(ir(P)),zoom:1/0,index:b,parentId:-1}}function gn(L){return{type:"Feature",id:L.id,properties:$n(L),geometry:{type:"Point",coordinates:[(b=L.x,360*(b-.5)),Mr(L.y)]}};var b}function $n(L){const b=L.numPoints,S=b>=1e4?`${Math.round(b/1e3)}k`:b>=1e3?Math.round(b/100)/10+"k":b;return kr(kr({},L.properties),{cluster:!0,cluster_id:L.id,point_count:b,point_count_abbreviated:S})}function at(L){return L/360+.5}function ir(L){const b=Math.sin(L*Math.PI/180),S=.5-.25*Math.log((1+b)/(1-b))/Math.PI;return S<0?0:S>1?1:S}function Mr(L){const b=(180-360*L)*Math.PI/180;return 360*Math.atan(Math.exp(b))/Math.PI-90}function kr(L,b){for(const S in b)L[S]=b[S];return L}function Gn(L){return L.x}function pr(L){return L.y}function mr(L,b,S,P){for(var D,$=P,H=S-b>>1,j=S-b,G=L[b],W=L[b+1],le=L[S],ge=L[S+1],ae=b+3;ae<S;ae+=3){var Le=yn(L[ae],L[ae+1],G,W,le,ge);if(Le>$)D=ae,$=Le;else if(Le===$){var Fe=Math.abs(ae-H);Fe<j&&(D=ae,j=Fe)}}$>P&&(D-b>3&&mr(L,b,D,P),L[D+2]=$,S-D>3&&mr(L,D,S,P))}function yn(L,b,S,P,D,$){var H=D-S,j=$-P;if(H!==0||j!==0){var G=((L-S)*H+(b-P)*j)/(H*H+j*j);G>1?(S=D,P=$):G>0&&(S+=H*G,P+=j*G)}return(H=L-S)*H+(j=b-P)*j}function fr(L,b,S,P){var D={id:L===void 0?null:L,type:b,geometry:S,tags:P,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function($){var H=$.geometry,j=$.type;if(j==="Point"||j==="MultiPoint"||j==="LineString")de($,H);else if(j==="Polygon"||j==="MultiLineString")for(var G=0;G<H.length;G++)de($,H[G]);else if(j==="MultiPolygon")for(G=0;G<H.length;G++)for(var W=0;W<H[G].length;W++)de($,H[G][W])}(D),D}function de(L,b){for(var S=0;S<b.length;S+=3)L.minX=Math.min(L.minX,b[S]),L.minY=Math.min(L.minY,b[S+1]),L.maxX=Math.max(L.maxX,b[S]),L.maxY=Math.max(L.maxY,b[S+1])}function Te(L,b,S,P){if(b.geometry){var D=b.geometry.coordinates,$=b.geometry.type,H=Math.pow(S.tolerance/((1<<S.maxZoom)*S.extent),2),j=[],G=b.id;if(S.promoteId?G=b.properties[S.promoteId]:S.generateId&&(G=P||0),$==="Point")jr(D,j);else if($==="MultiPoint")for(var W=0;W<D.length;W++)jr(D[W],j);else if($==="LineString")Xi(D,j,H,!1);else if($==="MultiLineString"){if(S.lineMetrics){for(W=0;W<D.length;W++)Xi(D[W],j=[],H,!1),L.push(fr(G,"LineString",j,b.properties));return}lt(D,j,H,!1)}else if($==="Polygon")lt(D,j,H,!0);else{if($!=="MultiPolygon"){if($==="GeometryCollection"){for(W=0;W<b.geometry.geometries.length;W++)Te(L,{id:G,geometry:b.geometry.geometries[W],properties:b.properties},S,P);return}throw new Error("Input data is not a valid GeoJSON object.")}for(W=0;W<D.length;W++){var le=[];lt(D[W],le,H,!0),j.push(le)}}L.push(fr(G,$,j,b.properties))}}function jr(L,b){b.push(Ui(L[0])),b.push(Ci(L[1])),b.push(0)}function Xi(L,b,S,P){for(var D,$,H=0,j=0;j<L.length;j++){var G=Ui(L[j][0]),W=Ci(L[j][1]);b.push(G),b.push(W),b.push(0),j>0&&(H+=P?(D*W-G*$)/2:Math.sqrt(Math.pow(G-D,2)+Math.pow(W-$,2))),D=G,$=W}var le=b.length-3;b[2]=1,mr(b,0,le,S),b[le+2]=1,b.size=Math.abs(H),b.start=0,b.end=b.size}function lt(L,b,S,P){for(var D=0;D<L.length;D++){var $=[];Xi(L[D],$,S,P),b.push($)}}function Ui(L){return L/360+.5}function Ci(L){var b=Math.sin(L*Math.PI/180),S=.5-.25*Math.log((1+b)/(1-b))/Math.PI;return S<0?0:S>1?1:S}function Ai(L,b,S,P,D,$,H,j){if(P/=b,$>=(S/=b)&&H<P)return L;if(H<S||$>=P)return null;for(var G=[],W=0;W<L.length;W++){var le=L[W],ge=le.geometry,ae=le.type,Le=D===0?le.minX:le.minY,Fe=D===0?le.maxX:le.maxY;if(Le>=S&&Fe<P)G.push(le);else if(!(Fe<S||Le>=P)){var Ae=[];if(ae==="Point"||ae==="MultiPoint")Pr(ge,Ae,S,P,D);else if(ae==="LineString")ve(ge,Ae,S,P,D,!1,j.lineMetrics);else if(ae==="MultiLineString")Ke(ge,Ae,S,P,D,!1);else if(ae==="Polygon")Ke(ge,Ae,S,P,D,!0);else if(ae==="MultiPolygon")for(var $e=0;$e<ge.length;$e++){var qe=[];Ke(ge[$e],qe,S,P,D,!0),qe.length&&Ae.push(qe)}if(Ae.length){if(j.lineMetrics&&ae==="LineString"){for($e=0;$e<Ae.length;$e++)G.push(fr(le.id,ae,Ae[$e],le.tags));continue}ae!=="LineString"&&ae!=="MultiLineString"||(Ae.length===1?(ae="LineString",Ae=Ae[0]):ae="MultiLineString"),ae!=="Point"&&ae!=="MultiPoint"||(ae=Ae.length===3?"Point":"MultiPoint"),G.push(fr(le.id,ae,Ae,le.tags))}}}return G.length?G:null}function Pr(L,b,S,P,D){for(var $=0;$<L.length;$+=3){var H=L[$+D];H>=S&&H<=P&&(b.push(L[$]),b.push(L[$+1]),b.push(L[$+2]))}}function ve(L,b,S,P,D,$,H){for(var j,G,W=Qe(L),le=D===0?Dr:He,ge=L.start,ae=0;ae<L.length-3;ae+=3){var Le=L[ae],Fe=L[ae+1],Ae=L[ae+2],$e=L[ae+3],qe=L[ae+4],ct=D===0?Le:Fe,Xe=D===0?$e:qe,et=!1;H&&(j=Math.sqrt(Math.pow(Le-$e,2)+Math.pow(Fe-qe,2))),ct<S?Xe>S&&(G=le(W,Le,Fe,$e,qe,S),H&&(W.start=ge+j*G)):ct>P?Xe<P&&(G=le(W,Le,Fe,$e,qe,P),H&&(W.start=ge+j*G)):ii(W,Le,Fe,Ae),Xe<S&&ct>=S&&(G=le(W,Le,Fe,$e,qe,S),et=!0),Xe>P&&ct<=P&&(G=le(W,Le,Fe,$e,qe,P),et=!0),!$&&et&&(H&&(W.end=ge+j*G),b.push(W),W=Qe(L)),H&&(ge+=j)}var ht=L.length-3;Le=L[ht],Fe=L[ht+1],Ae=L[ht+2],(ct=D===0?Le:Fe)>=S&&ct<=P&&ii(W,Le,Fe,Ae),ht=W.length-3,$&&ht>=3&&(W[ht]!==W[0]||W[ht+1]!==W[1])&&ii(W,W[0],W[1],W[2]),W.length&&b.push(W)}function Qe(L){var b=[];return b.size=L.size,b.start=L.start,b.end=L.end,b}function Ke(L,b,S,P,D,$){for(var H=0;H<L.length;H++)ve(L[H],b,S,P,D,$,!1)}function ii(L,b,S,P){L.push(b),L.push(S),L.push(P)}function Dr(L,b,S,P,D,$){var H=($-b)/(P-b);return L.push($),L.push(S+(D-S)*H),L.push(1),H}function He(L,b,S,P,D,$){var H=($-S)/(D-S);return L.push(b+(P-b)*H),L.push($),L.push(1),H}function gr(L,b){for(var S=[],P=0;P<L.length;P++){var D,$=L[P],H=$.type;if(H==="Point"||H==="MultiPoint"||H==="LineString")D=Ht($.geometry,b);else if(H==="MultiLineString"||H==="Polygon"){D=[];for(var j=0;j<$.geometry.length;j++)D.push(Ht($.geometry[j],b))}else if(H==="MultiPolygon")for(D=[],j=0;j<$.geometry.length;j++){for(var G=[],W=0;W<$.geometry[j].length;W++)G.push(Ht($.geometry[j][W],b));D.push(G)}S.push(fr($.id,H,D,$.tags))}return S}function Ht(L,b){var S=[];S.size=L.size,L.start!==void 0&&(S.start=L.start,S.end=L.end);for(var P=0;P<L.length;P+=3)S.push(L[P]+b,L[P+1],L[P+2]);return S}function _n(L,b){if(L.transformed)return L;var S,P,D,$=1<<L.z,H=L.x,j=L.y;for(S=0;S<L.features.length;S++){var G=L.features[S],W=G.geometry,le=G.type;if(G.geometry=[],le===1)for(P=0;P<W.length;P+=2)G.geometry.push(Vt(W[P],W[P+1],b,$,H,j));else for(P=0;P<W.length;P++){var ge=[];for(D=0;D<W[P].length;D+=2)ge.push(Vt(W[P][D],W[P][D+1],b,$,H,j));G.geometry.push(ge)}}return L.transformed=!0,L}function Vt(L,b,S,P,D,$){return[Math.round(S*(L*P-D)),Math.round(S*(b*P-$))]}function pi(L,b,S,P,D){for(var $=b===D.maxZoom?0:D.tolerance/((1<<b)*D.extent),H={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:S,y:P,z:b,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},j=0;j<L.length;j++){H.numFeatures++,xt(H,L[j],$,D);var G=L[j].minX,W=L[j].minY,le=L[j].maxX,ge=L[j].maxY;G<H.minX&&(H.minX=G),W<H.minY&&(H.minY=W),le>H.maxX&&(H.maxX=le),ge>H.maxY&&(H.maxY=ge)}return H}function xt(L,b,S,P){var D=b.geometry,$=b.type,H=[];if($==="Point"||$==="MultiPoint")for(var j=0;j<D.length;j+=3)H.push(D[j]),H.push(D[j+1]),L.numPoints++,L.numSimplified++;else if($==="LineString")xn(H,D,L,S,!1,!1);else if($==="MultiLineString"||$==="Polygon")for(j=0;j<D.length;j++)xn(H,D[j],L,S,$==="Polygon",j===0);else if($==="MultiPolygon")for(var G=0;G<D.length;G++){var W=D[G];for(j=0;j<W.length;j++)xn(H,W[j],L,S,!0,j===0)}if(H.length){var le=b.tags||null;if($==="LineString"&&P.lineMetrics){for(var ge in le={},b.tags)le[ge]=b.tags[ge];le.mapbox_clip_start=D.start/D.size,le.mapbox_clip_end=D.end/D.size}var ae={geometry:H,type:$==="Polygon"||$==="MultiPolygon"?3:$==="LineString"||$==="MultiLineString"?2:1,tags:le};b.id!==null&&(ae.id=b.id),L.features.push(ae)}}function xn(L,b,S,P,D,$){var H=P*P;if(P>0&&b.size<(D?H:P))S.numPoints+=b.length/3;else{for(var j=[],G=0;G<b.length;G+=3)(P===0||b[G+2]>H)&&(S.numSimplified++,j.push(b[G]),j.push(b[G+1])),S.numPoints++;D&&function(W,le){for(var ge=0,ae=0,Le=W.length,Fe=Le-2;ae<Le;Fe=ae,ae+=2)ge+=(W[ae]-W[Fe])*(W[ae+1]+W[Fe+1]);if(ge>0===le)for(ae=0,Le=W.length;ae<Le/2;ae+=2){var Ae=W[ae],$e=W[ae+1];W[ae]=W[Le-2-ae],W[ae+1]=W[Le-1-ae],W[Le-2-ae]=Ae,W[Le-1-ae]=$e}}(j,$),L.push(j)}}function rr(L,b){var S=(b=this.options=function(D,$){for(var H in $)D[H]=$[H];return D}(Object.create(this.options),b)).debug;if(S&&console.time("preprocess data"),b.maxZoom<0||b.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(b.promoteId&&b.generateId)throw new Error("promoteId and generateId cannot be used together.");var P=function(D,$){var H=[];if(D.type==="FeatureCollection")for(var j=0;j<D.features.length;j++)Te(H,D.features[j],$,j);else Te(H,D.type==="Feature"?D:{geometry:D},$);return H}(L,b);this.tiles={},this.tileCoords=[],S&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",b.indexMaxZoom,b.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),P=function(D,$){var H=$.buffer/$.extent,j=D,G=Ai(D,1,-1-H,H,0,-1,2,$),W=Ai(D,1,1-H,2+H,0,-1,2,$);return(G||W)&&(j=Ai(D,1,-H,1+H,0,-1,2,$)||[],G&&(j=gr(G,1).concat(j)),W&&(j=j.concat(gr(W,-1)))),j}(P,b),P.length&&this.splitTile(P,0,0,0),S&&(P.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Zr(L,b,S){return 32*((1<<L)*S+b)+L}function Xr(L,b){const S=L.tileID.canonical;if(!this._geoJSONIndex)return b(null,null);const P=this._geoJSONIndex.getTile(S.z,S.x,S.y);if(!P)return b(null,null);const D=new Fi(P.features);let $=_i.exports(D);$.byteOffset===0&&$.byteLength===$.buffer.byteLength||($=new Uint8Array($)),b(null,{vectorTile:D,rawData:$.buffer})}rr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},rr.prototype.splitTile=function(L,b,S,P,D,$,H){for(var j=[L,b,S,P],G=this.options,W=G.debug;j.length;){P=j.pop(),S=j.pop(),b=j.pop(),L=j.pop();var le=1<<b,ge=Zr(b,S,P),ae=this.tiles[ge];if(!ae&&(W>1&&console.time("creation"),ae=this.tiles[ge]=pi(L,b,S,P,G),this.tileCoords.push({z:b,x:S,y:P}),W)){W>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",b,S,P,ae.numFeatures,ae.numPoints,ae.numSimplified),console.timeEnd("creation"));var Le="z"+b;this.stats[Le]=(this.stats[Le]||0)+1,this.total++}if(ae.source=L,D){if(b===G.maxZoom||b===D)continue;var Fe=1<<D-b;if(S!==Math.floor($/Fe)||P!==Math.floor(H/Fe))continue}else if(b===G.indexMaxZoom||ae.numPoints<=G.indexMaxPoints)continue;if(ae.source=null,L.length!==0){W>1&&console.time("clipping");var Ae,$e,qe,ct,Xe,et,ht=.5*G.buffer/G.extent,bt=.5-ht,Wt=.5+ht,Ct=1+ht;Ae=$e=qe=ct=null,Xe=Ai(L,le,S-ht,S+Wt,0,ae.minX,ae.maxX,G),et=Ai(L,le,S+bt,S+Ct,0,ae.minX,ae.maxX,G),L=null,Xe&&(Ae=Ai(Xe,le,P-ht,P+Wt,1,ae.minY,ae.maxY,G),$e=Ai(Xe,le,P+bt,P+Ct,1,ae.minY,ae.maxY,G),Xe=null),et&&(qe=Ai(et,le,P-ht,P+Wt,1,ae.minY,ae.maxY,G),ct=Ai(et,le,P+bt,P+Ct,1,ae.minY,ae.maxY,G),et=null),W>1&&console.timeEnd("clipping"),j.push(Ae||[],b+1,2*S,2*P),j.push($e||[],b+1,2*S,2*P+1),j.push(qe||[],b+1,2*S+1,2*P),j.push(ct||[],b+1,2*S+1,2*P+1)}}},rr.prototype.getTile=function(L,b,S){var P=this.options,D=P.extent,$=P.debug;if(L<0||L>24)return null;var H=1<<L,j=Zr(L,b=(b%H+H)%H,S);if(this.tiles[j])return _n(this.tiles[j],D);$>1&&console.log("drilling down to z%d-%d-%d",L,b,S);for(var G,W=L,le=b,ge=S;!G&&W>0;)W--,le=Math.floor(le/2),ge=Math.floor(ge/2),G=this.tiles[Zr(W,le,ge)];return G&&G.source?($>1&&console.log("found parent tile z%d-%d-%d",W,le,ge),$>1&&console.time("drilling down"),this.splitTile(G.source,W,le,ge,L,b,S),$>1&&console.timeEnd("drilling down"),this.tiles[j]?_n(this.tiles[j],D):null):null};class vn extends dt{constructor(b,S,P,D){super(b,S,P,Xr),D&&(this.loadGeoJSON=D)}loadData(b,S){var P;(P=this._pendingRequest)===null||P===void 0||P.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const D=!!(b&&b.request&&b.request.collectResourceTiming)&&new h.RequestPerformance(b.request);this._pendingCallback=S,this._pendingRequest=this.loadGeoJSON(b,($,H)=>{if(delete this._pendingCallback,delete this._pendingRequest,$||!H)return S($);if(typeof H!="object")return S(new Error(`Input data given to '${b.source}' is not a valid GeoJSON object.`));{ti(H,!0);try{if(b.filter){const G=h.createExpression(b.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(G.result==="error")throw new Error(G.value.map(le=>`${le.key}: ${le.message}`).join(", "));const W=H.features.filter(le=>G.value.evaluate({zoom:0},le));H={type:"FeatureCollection",features:W}}this._geoJSONIndex=b.cluster?new Nn(function({superclusterOptions:G,clusterProperties:W}){if(!W||!G)return G;const le={},ge={},ae={accumulated:null,zoom:0},Le={properties:null},Fe=Object.keys(W);for(const Ae of Fe){const[$e,qe]=W[Ae],ct=h.createExpression(qe),Xe=h.createExpression(typeof $e=="string"?[$e,["accumulated"],["get",Ae]]:$e);le[Ae]=ct.value,ge[Ae]=Xe.value}return G.map=Ae=>{Le.properties=Ae;const $e={};for(const qe of Fe)$e[qe]=le[qe].evaluate(ae,Le);return $e},G.reduce=(Ae,$e)=>{Le.properties=$e;for(const qe of Fe)ae.accumulated=Ae[qe],Ae[qe]=ge[qe].evaluate(ae,Le)},G}(b)).load(H.features):function(G,W){return new rr(G,W)}(H,b.geojsonVtOptions)}catch(G){return S(G)}this.loaded={};const j={};if(D){const G=D.finish();G&&(j.resourceTiming={},j.resourceTiming[b.source]=JSON.parse(JSON.stringify(G)))}S(null,j)}})}reloadTile(b,S){const P=this.loaded;return P&&P[b.uid]?super.reloadTile(b,S):this.loadTile(b,S)}loadGeoJSON(b,S){if(b.request)return h.getJSON(b.request,S);if(typeof b.data=="string")try{S(null,JSON.parse(b.data))}catch{S(new Error(`Input data given to '${b.source}' is not a valid GeoJSON object.`))}else S(new Error(`Input data given to '${b.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}}removeSource(b,S){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),S()}getClusterExpansionZoom(b,S){try{S(null,this._geoJSONIndex.getClusterExpansionZoom(b.clusterId))}catch(P){S(P)}}getClusterChildren(b,S){try{S(null,this._geoJSONIndex.getChildren(b.clusterId))}catch(P){S(P)}}getClusterLeaves(b,S){try{S(null,this._geoJSONIndex.getLeaves(b.clusterId,b.limit,b.offset))}catch(P){S(P)}}}class Hr{constructor(b){this.self=b,this.actor=new h.Actor(b,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:dt,geojson:vn},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(S,P)=>{if(this.workerSourceTypes[S])throw new Error(`Worker source with name "${S}" already registered.`);this.workerSourceTypes[S]=P},this.self.registerRTLTextPlugin=S=>{if(h.plugin.isParsed())throw new Error("RTL text plugin already registered.");h.plugin.applyArabicShaping=S.applyArabicShaping,h.plugin.processBidirectionalText=S.processBidirectionalText,h.plugin.processStyledBidirectionalText=S.processStyledBidirectionalText}}setReferrer(b,S){this.referrer=S}setImages(b,S,P){this.availableImages[b]=S;for(const D in this.workerSources[b]){const $=this.workerSources[b][D];for(const H in $)$[H].availableImages=S}P()}setLayers(b,S,P){this.getLayerIndex(b).replace(S),P()}updateLayers(b,S,P){this.getLayerIndex(b).update(S.layers,S.removedIds),P()}loadTile(b,S,P){this.getWorkerSource(b,S.type,S.source).loadTile(S,P)}loadDEMTile(b,S,P){this.getDEMWorkerSource(b,S.source).loadTile(S,P)}reloadTile(b,S,P){this.getWorkerSource(b,S.type,S.source).reloadTile(S,P)}abortTile(b,S,P){this.getWorkerSource(b,S.type,S.source).abortTile(S,P)}removeTile(b,S,P){this.getWorkerSource(b,S.type,S.source).removeTile(S,P)}removeDEMTile(b,S){this.getDEMWorkerSource(b,S.source).removeTile(S)}removeSource(b,S,P){if(!this.workerSources[b]||!this.workerSources[b][S.type]||!this.workerSources[b][S.type][S.source])return;const D=this.workerSources[b][S.type][S.source];delete this.workerSources[b][S.type][S.source],D.removeSource!==void 0?D.removeSource(S,P):P()}loadWorkerSource(b,S,P){try{this.self.importScripts(S.url),P()}catch(D){P(D.toString())}}syncRTLPluginState(b,S,P){try{h.plugin.setState(S);const D=h.plugin.getPluginURL();if(h.plugin.isLoaded()&&!h.plugin.isParsed()&&D!=null){this.self.importScripts(D);const $=h.plugin.isParsed();P($?void 0:new Error(`RTL Text Plugin failed to import scripts from ${D}`),$)}}catch(D){P(D.toString())}}getAvailableImages(b){let S=this.availableImages[b];return S||(S=[]),S}getLayerIndex(b){let S=this.layerIndexes[b];return S||(S=this.layerIndexes[b]=new Je),S}getWorkerSource(b,S,P){if(this.workerSources[b]||(this.workerSources[b]={}),this.workerSources[b][S]||(this.workerSources[b][S]={}),!this.workerSources[b][S][P]){const D={send:($,H,j)=>{this.actor.send($,H,j,b)}};this.workerSources[b][S][P]=new this.workerSourceTypes[S](D,this.getLayerIndex(b),this.getAvailableImages(b))}return this.workerSources[b][S][P]}getDEMWorkerSource(b,S){return this.demWorkerSources[b]||(this.demWorkerSources[b]={}),this.demWorkerSources[b][S]||(this.demWorkerSources[b][S]=new si),this.demWorkerSources[b][S]}enforceCacheSizeLimit(b,S){h.enforceCacheSizeLimit(S)}}return h.isWorker()&&(self.worker=new Hr(self)),Hr}),ie(["./shared"],function(h){var Pe=Ze;function Ze(a){return!function(t){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var o,c,d=new Blob([""],{type:"text/javascript"}),m=URL.createObjectURL(d);try{c=new Worker(m),o=!0}catch{o=!1}return c&&c.terminate(),URL.revokeObjectURL(m),o}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var o=document.createElement("canvas");o.width=o.height=1;var c=o.getContext("2d");if(!c)return!1;var d=c.getImageData(0,0,1,1);return d&&d.width===o.width}()?(Je[n=t&&t.failIfMajorPerformanceCaveat]===void 0&&(Je[n]=function(o){var c,d=function(m){var y=document.createElement("canvas"),_=Object.create(Ze.webGLContextAttributes);return _.failIfMajorPerformanceCaveat=m,y.getContext("webgl",_)||y.getContext("experimental-webgl",_)}(o);if(!d)return!1;try{c=d.createShader(d.VERTEX_SHADER)}catch{return!1}return!(!c||d.isContextLost())&&(d.shaderSource(c,"void main() {}"),d.compileShader(c),d.getShaderParameter(c,d.COMPILE_STATUS)===!0)}(n)),Je[n]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var n}(a)}var Je={};function Re(a,t){if(Array.isArray(a)){if(!Array.isArray(t)||a.length!==t.length)return!1;for(let n=0;n<a.length;n++)if(!Re(a[n],t[n]))return!1;return!0}if(typeof a=="object"&&a!==null&&t!==null){if(typeof t!="object"||Object.keys(a).length!==Object.keys(t).length)return!1;for(const n in a)if(!Re(a[n],t[n]))return!1;return!0}return a===t}Ze.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};class re{static testProp(t){if(!re.docStyle)return t[0];for(let n=0;n<t.length;n++)if(t[n]in re.docStyle)return t[n];return t[0]}static create(t,n,o){const c=window.document.createElement(t);return n!==void 0&&(c.className=n),o&&o.appendChild(c),c}static createNS(t,n){return window.document.createElementNS(t,n)}static disableDrag(){re.docStyle&&re.selectProp&&(re.userSelect=re.docStyle[re.selectProp],re.docStyle[re.selectProp]="none")}static enableDrag(){re.docStyle&&re.selectProp&&(re.docStyle[re.selectProp]=re.userSelect)}static setTransform(t,n){t.style[re.transformProp]=n}static addEventListener(t,n,o,c={}){t.addEventListener(n,o,"passive"in c?c:c.capture)}static removeEventListener(t,n,o,c={}){t.removeEventListener(n,o,"passive"in c?c:c.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",re.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",re.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",re.suppressClickInternal,!0)},0)}static mousePos(t,n){const o=t.getBoundingClientRect();return new h.pointGeometry(n.clientX-o.left-t.clientLeft,n.clientY-o.top-t.clientTop)}static touchPos(t,n){const o=t.getBoundingClientRect(),c=[];for(let d=0;d<n.length;d++)c.push(new h.pointGeometry(n[d].clientX-o.left-t.clientLeft,n[d].clientY-o.top-t.clientTop));return c}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}re.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,re.selectProp=re.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),re.transformProp=re.testProp(["transform","WebkitTransform"]);class Bt{constructor(t){this._transformRequestFn=t}transformRequest(t,n){return this._transformRequestFn&&this._transformRequestFn(t,n)||{url:t}}normalizeSpriteURL(t,n,o){const c=function(d){const m=d.match(_t);if(!m)throw new Error(`Unable to parse URL "${d}"`);return{protocol:m[1],authority:m[2],path:m[3]||"/",params:m[4]?m[4].split("&"):[]}}(t);return c.path+=`${n}${o}`,function(d){const m=d.params.length?`?${d.params.join("&")}`:"";return`${d.protocol}://${d.authority}${d.path}${m}`}(c)}setTransformRequest(t){this._transformRequestFn=t}}const _t=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;class dt{constructor(t,n,o,c){this.context=t,this.format=o,this.texture=t.gl.createTexture(),this.update(n,c)}update(t,n,o){const{width:c,height:d}=t,m=!(this.size&&this.size[0]===c&&this.size[1]===d||o),{context:y}=this,{gl:_}=y;if(this.useMipmap=Boolean(n&&n.useMipmap),_.bindTexture(_.TEXTURE_2D,this.texture),y.pixelStoreUnpackFlipY.set(!1),y.pixelStoreUnpack.set(1),y.pixelStoreUnpackPremultiplyAlpha.set(this.format===_.RGBA&&(!n||n.premultiply!==!1)),m)this.size=[c,d],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||h.isImageBitmap(t)?_.texImage2D(_.TEXTURE_2D,0,this.format,this.format,_.UNSIGNED_BYTE,t):_.texImage2D(_.TEXTURE_2D,0,this.format,c,d,0,this.format,_.UNSIGNED_BYTE,t.data);else{const{x:v,y:T}=o||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||h.isImageBitmap(t)?_.texSubImage2D(_.TEXTURE_2D,0,v,T,_.RGBA,_.UNSIGNED_BYTE,t):_.texSubImage2D(_.TEXTURE_2D,0,v,T,c,d,_.RGBA,_.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&_.generateMipmap(_.TEXTURE_2D)}bind(t,n,o){const{context:c}=this,{gl:d}=c;d.bindTexture(d.TEXTURE_2D,this.texture),o!==d.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(o=d.LINEAR),t!==this.filter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,t),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,o||t),this.filter=t),n!==this.wrap&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,n),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function si(a){const{userImage:t}=a;return!!(t&&t.render&&t.render())&&(a.data.replace(new Uint8Array(t.data.buffer)),!0)}class ti extends h.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new h.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:n,callback:o}of this.requestors)this._notify(n,o);this.requestors=[]}}getImage(t){return this.images[t]}addImage(t,n){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,n)&&(this.images[t]=n)}_validate(t,n){let o=!0;return this._validateStretch(n.stretchX,n.data&&n.data.width)||(this.fire(new h.ErrorEvent(new Error(`Image "${t}" has invalid "stretchX" value`))),o=!1),this._validateStretch(n.stretchY,n.data&&n.data.height)||(this.fire(new h.ErrorEvent(new Error(`Image "${t}" has invalid "stretchY" value`))),o=!1),this._validateContent(n.content,n)||(this.fire(new h.ErrorEvent(new Error(`Image "${t}" has invalid "content" value`))),o=!1),o}_validateStretch(t,n){if(!t)return!0;let o=0;for(const c of t){if(c[0]<o||c[1]<c[0]||n<c[1])return!1;o=c[1]}return!0}_validateContent(t,n){return!(t&&(t.length!==4||t[0]<0||n.data.width<t[0]||t[1]<0||n.data.height<t[1]||t[2]<0||n.data.width<t[2]||t[3]<0||n.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,n){const o=this.images[t];if(o.data.width!==n.data.width||o.data.height!==n.data.height)throw new Error(`size mismatch between old image (${o.data.width}x${o.data.height}) and new image (${n.data.width}x${n.data.height}).`);n.version=o.version+1,this.images[t]=n,this.updatedImages[t]=!0}removeImage(t){const n=this.images[t];delete this.images[t],delete this.patterns[t],n.userImage&&n.userImage.onRemove&&n.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,n){let o=!0;if(!this.isLoaded())for(const c of t)this.images[c]||(o=!1);this.isLoaded()||o?this._notify(t,n):this.requestors.push({ids:t,callback:n})}_notify(t,n){const o={};for(const c of t){this.images[c]||this.fire(new h.Event("styleimagemissing",{id:c}));const d=this.images[c];d?o[c]={data:d.data.clone(),pixelRatio:d.pixelRatio,sdf:d.sdf,version:d.version,stretchX:d.stretchX,stretchY:d.stretchY,content:d.content,hasRenderCallback:Boolean(d.userImage&&d.userImage.render)}:h.warnOnce(`Image "${c}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}n(null,o)}getPixelSize(){const{width:t,height:n}=this.atlasImage;return{width:t,height:n}}getPattern(t){const n=this.patterns[t],o=this.getImage(t);if(!o)return null;if(n&&n.position.version===o.version)return n.position;if(n)n.position.version=o.version;else{const c={w:o.data.width+2,h:o.data.height+2,x:0,y:0},d=new h.ImagePosition(c,o);this.patterns[t]={bin:c,position:d}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const n=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new dt(t,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const d in this.patterns)t.push(this.patterns[d].bin);const{w:n,h:o}=h.potpack(t),c=this.atlasImage;c.resize({width:n||1,height:o||1});for(const d in this.patterns){const{bin:m}=this.patterns[d],y=m.x+1,_=m.y+1,v=this.images[d].data,T=v.width,C=v.height;h.RGBAImage.copy(v,c,{x:0,y:0},{x:y,y:_},{width:T,height:C}),h.RGBAImage.copy(v,c,{x:0,y:C-1},{x:y,y:_-1},{width:T,height:1}),h.RGBAImage.copy(v,c,{x:0,y:0},{x:y,y:_+C},{width:T,height:1}),h.RGBAImage.copy(v,c,{x:T-1,y:0},{x:y-1,y:_},{width:1,height:C}),h.RGBAImage.copy(v,c,{x:0,y:0},{x:y+T,y:_},{width:1,height:C})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const n of t){if(this.callbackDispatchedThisFrame[n])continue;this.callbackDispatchedThisFrame[n]=!0;const o=this.images[n];o||h.warnOnce(`Image with ID: "${n}" was not found`),si(o)&&this.updateImage(n,o)}}}const qt=1e20;function oi(a,t,n,o,c,d,m,y,_){for(let v=t;v<t+o;v++)Gr(a,n*d+v,d,c,m,y,_);for(let v=n;v<n+c;v++)Gr(a,v*d+t,1,o,m,y,_)}function Gr(a,t,n,o,c,d,m){d[0]=0,m[0]=-qt,m[1]=qt,c[0]=a[t];for(let y=1,_=0,v=0;y<o;y++){c[y]=a[t+y*n];const T=y*y;do{const C=d[_];v=(c[y]-c[C]+T-C*C)/(y-C)/2}while(v<=m[_]&&--_>-1);_++,d[_]=y,m[_]=v,m[_+1]=qt}for(let y=0,_=0;y<o;y++){for(;m[_+1]<y;)_++;const v=d[_],T=y-v;a[t+y*n]=c[v]+T*T}}class Rt{constructor(t,n){this.requestManager=t,this.localIdeographFontFamily=n,this.entries={}}setURL(t){this.url=t}getGlyphs(t,n){const o=[];for(const c in t)for(const d of t[c])o.push({stack:c,id:d});h.asyncAll(o,({stack:c,id:d},m)=>{let y=this.entries[c];y||(y=this.entries[c]={glyphs:{},requests:{},ranges:{}});let _=y.glyphs[d];if(_!==void 0)return void m(null,{stack:c,id:d,glyph:_});if(_=this._tinySDF(y,c,d),_)return y.glyphs[d]=_,void m(null,{stack:c,id:d,glyph:_});const v=Math.floor(d/256);if(256*v>65535)return void m(new Error("glyphs > 65535 not supported"));if(y.ranges[v])return void m(null,{stack:c,id:d,glyph:_});let T=y.requests[v];T||(T=y.requests[v]=[],Rt.loadGlyphRange(c,v,this.url,this.requestManager,(C,z)=>{if(z){for(const F in z)this._doesCharSupportLocalGlyph(+F)||(y.glyphs[+F]=z[+F]);y.ranges[v]=!0}for(const F of T)F(C,z);delete y.requests[v]})),T.push((C,z)=>{C?m(C):z&&m(null,{stack:c,id:d,glyph:z[d]||null})})},(c,d)=>{if(c)n(c);else if(d){const m={};for(const{stack:y,id:_,glyph:v}of d)(m[y]||(m[y]={}))[_]=v&&{id:v.id,bitmap:v.bitmap.clone(),metrics:v.metrics};n(null,m)}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(h.unicodeBlockLookup["CJK Unified Ideographs"](t)||h.unicodeBlockLookup["Hangul Syllables"](t)||h.unicodeBlockLookup.Hiragana(t)||h.unicodeBlockLookup.Katakana(t))}_tinySDF(t,n,o){const c=this.localIdeographFontFamily;if(!c||!this._doesCharSupportLocalGlyph(o))return;let d=t.tinySDF;if(!d){let y="400";/bold/i.test(n)?y="900":/medium/i.test(n)?y="500":/light/i.test(n)&&(y="200"),d=t.tinySDF=new Rt.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:c,fontWeight:y})}const m=d.draw(String.fromCharCode(o));return{id:o,bitmap:new h.AlphaImage({width:m.width||30,height:m.height||30},m.data),metrics:{width:m.glyphWidth||24,height:m.glyphHeight||24,left:m.glyphLeft||0,top:m.glyphTop-27||-8,advance:m.glyphAdvance||24}}}}Rt.loadGlyphRange=function(a,t,n,o,c){const d=256*t,m=d+255,y=o.transformRequest(n.replace("{fontstack}",a).replace("{range}",`${d}-${m}`),h.ResourceType.Glyphs);h.getArrayBuffer(y,(_,v)=>{if(_)c(_);else if(v){const T={};for(const C of h.parseGlyphPbf(v))T[C.id]=C;c(null,T)}})},Rt.TinySDF=class{constructor({fontSize:a=24,buffer:t=3,radius:n=8,cutoff:o=.25,fontFamily:c="sans-serif",fontWeight:d="normal",fontStyle:m="normal"}={}){this.buffer=t,this.cutoff=o,this.radius=n;const y=this.size=a+4*t,_=this._createCanvas(y),v=this.ctx=_.getContext("2d",{willReadFrequently:!0});v.font=`${m} ${d} ${a}px ${c}`,v.textBaseline="alphabetic",v.textAlign="left",v.fillStyle="black",this.gridOuter=new Float64Array(y*y),this.gridInner=new Float64Array(y*y),this.f=new Float64Array(y),this.z=new Float64Array(y+1),this.v=new Uint16Array(y)}_createCanvas(a){const t=document.createElement("canvas");return t.width=t.height=a,t}draw(a){const{width:t,actualBoundingBoxAscent:n,actualBoundingBoxDescent:o,actualBoundingBoxLeft:c,actualBoundingBoxRight:d}=this.ctx.measureText(a),m=Math.ceil(n),y=Math.min(this.size-this.buffer,Math.ceil(d-c)),_=Math.min(this.size-this.buffer,m+Math.ceil(o)),v=y+2*this.buffer,T=_+2*this.buffer,C=Math.max(v*T,0),z=new Uint8ClampedArray(C),F={data:z,width:v,height:T,glyphWidth:y,glyphHeight:_,glyphTop:m,glyphLeft:0,glyphAdvance:t};if(y===0||_===0)return F;const{ctx:B,buffer:R,gridInner:Z,gridOuter:K}=this;B.clearRect(R,R,y,_),B.fillText(a,R,R+m);const ee=B.getImageData(R,R,y,_);K.fill(qt,0,C),Z.fill(0,0,C);for(let U=0;U<_;U++)for(let se=0;se<y;se++){const te=ee.data[4*(U*y+se)+3]/255;if(te===0)continue;const he=(U+R)*v+se+R;if(te===1)K[he]=0,Z[he]=qt;else{const ue=.5-te;K[he]=ue>0?ue*ue:0,Z[he]=ue<0?ue*ue:0}}oi(K,0,0,v,T,v,this.f,this.v,this.z),oi(Z,R,R,y,_,v,this.f,this.v,this.z);for(let U=0;U<C;U++){const se=Math.sqrt(K[U])-Math.sqrt(Z[U]);z[U]=Math.round(255-255*(se/this.radius+this.cutoff))}return F}};const Fi=new h.Properties({anchor:new h.DataConstantProperty(h.spec.light.anchor),position:new class{constructor(){this.specification=h.spec.light.position}possiblyEvaluate(a,t){return h.sphericalToCartesian(a.expression.evaluate(t))}interpolate(a,t,n){return{x:h.number(a.x,t.x,n),y:h.number(a.y,t.y,n),z:h.number(a.z,t.z,n)}}},color:new h.DataConstantProperty(h.spec.light.color),intensity:new h.DataConstantProperty(h.spec.light.intensity)}),_i="-transition";class di extends h.Evented{constructor(t){super(),this._transitionable=new h.Transitionable(Fi),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,n={}){if(!this._validate(h.validateLight,t,n))for(const o in t){const c=t[o];o.endsWith(_i)?this._transitionable.setTransition(o.slice(0,-_i.length),c):this._transitionable.setValue(o,c)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n,o){return(!o||o.validate!==!1)&&h.emitValidationErrors(this,t.call(h.validateStyle,h.extend({value:n,style:{glyphs:!0,sprite:!0},styleSpec:h.spec})))}}class hn{constructor(t,n){this.width=t,this.height=n,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,n){const o=t.join(",")+String(n);return this.dashEntry[o]||(this.dashEntry[o]=this.addDash(t,n)),this.dashEntry[o]}getDashRanges(t,n,o){const c=[];let d=t.length%2==1?-t[t.length-1]*o:0,m=t[0]*o,y=!0;c.push({left:d,right:m,isDash:y,zeroLength:t[0]===0});let _=t[0];for(let v=1;v<t.length;v++){y=!y;const T=t[v];d=_*o,_+=T,m=_*o,c.push({left:d,right:m,isDash:y,zeroLength:T===0})}return c}addRoundDash(t,n,o){const c=n/2;for(let d=-o;d<=o;d++){const m=this.width*(this.nextRow+o+d);let y=0,_=t[y];for(let v=0;v<this.width;v++){v/_.right>1&&(_=t[++y]);const T=Math.abs(v-_.left),C=Math.abs(v-_.right),z=Math.min(T,C);let F;const B=d/o*(c+1);if(_.isDash){const R=c-Math.abs(B);F=Math.sqrt(z*z+R*R)}else F=c-Math.sqrt(z*z+B*B);this.data[m+v]=Math.max(0,Math.min(255,F+128))}}}addRegularDash(t){for(let y=t.length-1;y>=0;--y){const _=t[y],v=t[y+1];_.zeroLength?t.splice(y,1):v&&v.isDash===_.isDash&&(v.left=_.left,t.splice(y,1))}const n=t[0],o=t[t.length-1];n.isDash===o.isDash&&(n.left=o.left-this.width,o.right=n.right+this.width);const c=this.width*this.nextRow;let d=0,m=t[d];for(let y=0;y<this.width;y++){y/m.right>1&&(m=t[++d]);const _=Math.abs(y-m.left),v=Math.abs(y-m.right),T=Math.min(_,v);this.data[c+y]=Math.max(0,Math.min(255,(m.isDash?T:-T)+128))}}addDash(t,n){const o=n?7:0,c=2*o+1;if(this.nextRow+c>this.height)return h.warnOnce("LineAtlas out of space"),null;let d=0;for(let y=0;y<t.length;y++)d+=t[y];if(d!==0){const y=this.width/d,_=this.getDashRanges(t,this.width,y);n?this.addRoundDash(_,y,o):this.addRegularDash(_)}const m={y:(this.nextRow+o+.5)/this.height,height:2*o/this.height,width:d};return this.nextRow+=c,this.dirty=!0,m}bind(t){const n=t.gl;this.texture?(n.bindTexture(n.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,n.texSubImage2D(n.TEXTURE_2D,0,0,0,this.width,this.height,n.ALPHA,n.UNSIGNED_BYTE,this.data))):(this.texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.texture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texImage2D(n.TEXTURE_2D,0,n.ALPHA,this.width,this.height,0,n.ALPHA,n.UNSIGNED_BYTE,this.data))}}class qi{constructor(t,n){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=h.uniqueId();const o=this.workerPool.acquire(this.id);for(let c=0;c<o.length;c++){const d=new qi.Actor(o[c],n,this.id);d.name=`Worker ${c}`,this.actors.push(d)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,n,o){h.asyncAll(this.actors,(c,d)=>{c.send(t,n,d)},o=o||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Ei(a,t,n){const o=function(c,d){if(c)return n(c);if(d){const m=h.pick(h.extend(d,a),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);d.vector_layers&&(m.vectorLayers=d.vector_layers,m.vectorLayerIds=m.vectorLayers.map(y=>y.id)),n(null,m)}};return a.url?h.getJSON(t.transformRequest(a.url,h.ResourceType.Source),o):h.exported.frame(()=>o(null,a))}qi.Actor=h.Actor;class Oi{constructor(t,n,o){this.bounds=h.LngLatBounds.convert(this.validateBounds(t)),this.minzoom=n||0,this.maxzoom=o||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const n=Math.pow(2,t.z),o=Math.floor(h.mercatorXfromLng(this.bounds.getWest())*n),c=Math.floor(h.mercatorYfromLat(this.bounds.getNorth())*n),d=Math.ceil(h.mercatorXfromLng(this.bounds.getEast())*n),m=Math.ceil(h.mercatorYfromLat(this.bounds.getSouth())*n);return t.x>=o&&t.x<d&&t.y>=c&&t.y<m}}class Ir extends h.Evented{constructor(t,n,o,c){if(super(),this.id=t,this.dispatcher=o,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,h.extend(this,h.pick(n,["url","scheme","tileSize","promoteId"])),this._options=h.extend({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(c)}load(){this._loaded=!1,this.fire(new h.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ei(this._options,this.map._requestManager,(t,n)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),t?this.fire(new h.ErrorEvent(t)):n&&(h.extend(this,n),n.bounds&&(this.tileBounds=new Oi(n.bounds,this.minzoom,this.maxzoom)),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return h.extend({},this._options)}loadTile(t,n){const o=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),c={request:this.map._requestManager.transformRequest(o,h.ResourceType.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function d(m,y){return delete t.request,t.aborted?n(null):m&&m.status!==404?n(m):(y&&y.resourceTiming&&(t.resourceTiming=y.resourceTiming),this.map._refreshExpiredTiles&&y&&t.setExpiryData(y),t.loadVectorData(y,this.map.painter),h.cacheEntryPossiblyAdded(this.dispatcher),n(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}c.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired"?t.state==="loading"?t.reloadCallback=n:t.request=t.actor.send("reloadTile",c,d.bind(this)):(t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",c,d.bind(this)))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)}unloadTile(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class er extends h.Evented{constructor(t,n,o,c){super(),this.id=t,this.dispatcher=o,this.setEventedParent(c),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=h.extend({type:"raster"},n),h.extend(this,h.pick(n,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new h.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ei(this._options,this.map._requestManager,(t,n)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new h.ErrorEvent(t)):n&&(h.extend(this,n),n.bounds&&(this.tileBounds=new Oi(n.bounds,this.minzoom,this.maxzoom)),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return h.extend({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,n){const o=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.request=h.getImage(this.map._requestManager.transformRequest(o,h.ResourceType.Tile),(c,d,m)=>{if(delete t.request,t.aborted)t.state="unloaded",n(null);else if(c)t.state="errored",n(c);else if(d){this.map._refreshExpiredTiles&&t.setExpiryData(m);const y=this.map.painter.context,_=y.gl;t.texture=this.map.painter.getTileTexture(d.width),t.texture?t.texture.update(d,{useMipmap:!0}):(t.texture=new dt(y,d,_.RGBA,{useMipmap:!0}),t.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE,_.LINEAR_MIPMAP_NEAREST),y.extTextureFilterAnisotropic&&_.texParameterf(_.TEXTURE_2D,y.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,y.extTextureFilterAnisotropicMax)),t.state="loaded",h.cacheEntryPossiblyAdded(this.dispatcher),n(null)}})}abortTile(t,n){t.request&&(t.request.cancel(),delete t.request),n()}unloadTile(t,n){t.texture&&this.map.painter.saveTileTexture(t.texture),n()}hasTransition(){return!1}}let Er;class je extends er{constructor(t,n,o,c){super(t,n,o,c),this.type="raster-dem",this.maxzoom=22,this._options=h.extend({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(t,n){const o=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function c(d,m){d&&(t.state="errored",n(d)),m&&(t.dem=m,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded",n(null))}t.request=h.getImage(this.map._requestManager.transformRequest(o,h.ResourceType.Tile),function(d,m){if(delete t.request,t.aborted)t.state="unloaded",n(null);else if(d)t.state="errored",n(d);else if(m){this.map._refreshExpiredTiles&&t.setExpiryData(m),delete m.cacheControl,delete m.expires;const y=h.isImageBitmap(m)&&(Er==null&&(Er=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Er)?m:h.exported.getImageData(m,1),_={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:y,encoding:this.encoding};t.actor&&t.state!=="expired"||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",_,c.bind(this)))}}.bind(this)),t.neighboringTiles=this._getNeighboringTiles(t.tileID)}_getNeighboringTiles(t){const n=t.canonical,o=Math.pow(2,n.z),c=(n.x-1+o)%o,d=n.x===0?t.wrap-1:t.wrap,m=(n.x+1+o)%o,y=n.x+1===o?t.wrap+1:t.wrap,_={};return _[new h.OverscaledTileID(t.overscaledZ,d,n.z,c,n.y).key]={backfilled:!1},_[new h.OverscaledTileID(t.overscaledZ,y,n.z,m,n.y).key]={backfilled:!1},n.y>0&&(_[new h.OverscaledTileID(t.overscaledZ,d,n.z,c,n.y-1).key]={backfilled:!1},_[new h.OverscaledTileID(t.overscaledZ,t.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},_[new h.OverscaledTileID(t.overscaledZ,y,n.z,m,n.y-1).key]={backfilled:!1}),n.y+1<o&&(_[new h.OverscaledTileID(t.overscaledZ,d,n.z,c,n.y+1).key]={backfilled:!1},_[new h.OverscaledTileID(t.overscaledZ,t.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},_[new h.OverscaledTileID(t.overscaledZ,y,n.z,m,n.y+1).key]={backfilled:!1}),_}unloadTile(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})}}class hr extends h.Evented{constructor(t,n,o,c){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=o.getActor(),this.setEventedParent(c),this._data=n.data,this._options=h.extend({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const d=h.EXTENT/this.tileSize;this.workerOptions=h.extend({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*d,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*d,extent:h.EXTENT,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:h.EXTENT,radius:(n.clusterRadius||50)*d,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions)}load(){this._updateWorkerData("metadata")}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData("content"),this}getClusterExpansionZoom(t,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},n),this}getClusterChildren(t,n){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},n),this}getClusterLeaves(t,n,o,c){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:n,offset:o},c),this}_updateWorkerData(t){const n=h.extend({},this.workerOptions),o=this._data;typeof o=="string"?(n.request=this.map._requestManager.transformRequest(h.exported.resolveURL(o),h.ResourceType.Source),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(o),this._pendingLoads++,this.fire(new h.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,n,(c,d)=>{if(this._pendingLoads--,this._removed||d&&d.abandoned)return void this.fire(new h.Event("dataabort",{dataType:"source",sourceDataType:t}));let m=null;if(d&&d.resourceTiming&&d.resourceTiming[this.id]&&(m=d.resourceTiming[this.id].slice(0)),c)return void this.fire(new h.ErrorEvent(c));const y={dataType:"source",sourceDataType:t};this._collectResourceTiming&&m&&m.length>0&&h.extend(y,{resourceTiming:m}),this.fire(new h.Event("data",y))})}loaded(){return this._pendingLoads===0}loadTile(t,n){const o=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const c={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.request=this.actor.send(o,c,(d,m)=>(delete t.request,t.unloadVectorData(),t.aborted?n(null):d?n(d):(t.loadVectorData(m,this.map.painter,o==="reloadTile"),n(null))))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return h.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var ur=h.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class ji extends h.Evented{constructor(t,n,o,c){super(),this.id=t,this.dispatcher=o,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(c),this.options=n}load(t,n){this._loaded=!1,this.fire(new h.Event("dataloading",{dataType:"source"})),this.url=this.options.url,h.getImage(this.map._requestManager.transformRequest(this.url,h.ResourceType.Image),(o,c)=>{this._loaded=!0,o?this.fire(new h.ErrorEvent(o)):c&&(this.image=c,t&&(this.coordinates=t),n&&n(),this._finishLoading())})}loaded(){return this._loaded}updateImage(t){return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}setCoordinates(t){this.coordinates=t;const n=t.map(h.MercatorCoordinate.fromLngLat);this.tileID=function(c){let d=1/0,m=1/0,y=-1/0,_=-1/0;for(const z of c)d=Math.min(d,z.x),m=Math.min(m,z.y),y=Math.max(y,z.x),_=Math.max(_,z.y);const v=Math.max(y-d,_-m),T=Math.max(0,Math.floor(-Math.log(v)/Math.LN2)),C=Math.pow(2,T);return new h.CanonicalTileID(T,Math.floor((d+y)/2*C),Math.floor((m+_)/2*C))}(n),this.minzoom=this.maxzoom=this.tileID.z;const o=n.map(c=>this.tileID.getTilePoint(c)._round());return this._boundsArray=new h.RasterBoundsArray,this._boundsArray.emplaceBack(o[0].x,o[0].y,0,0),this._boundsArray.emplaceBack(o[1].x,o[1].y,h.EXTENT,0),this._boundsArray.emplaceBack(o[3].x,o[3].y,0,h.EXTENT),this._boundsArray.emplaceBack(o[2].x,o[2].y,h.EXTENT,h.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,n=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,ur.members)),this.boundsSegments||(this.boundsSegments=h.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new dt(t,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));for(const o in this.tiles){const c=this.tiles[o];c.state!=="loaded"&&(c.state="loaded",c.texture=this.texture)}}loadTile(t,n){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},n(null)):(t.state="errored",n(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Zi extends ji{constructor(t,n,o,c){super(t,n,o,c),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const t=this.options;this.urls=[];for(const n of t.urls)this.urls.push(this.map._requestManager.transformRequest(n,h.ResourceType.Source).url);h.getVideo(this.urls,(n,o)=>{this._loaded=!0,n?this.fire(new h.ErrorEvent(n)):o&&(this.video=o,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const n=this.video.seekable;t<n.start(0)||t>n.end(0)?this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,n=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,ur.members)),this.boundsSegments||(this.boundsSegments=h.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new dt(t,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));for(const o in this.tiles){const c=this.tiles[o];c.state!=="loaded"&&(c.state="loaded",c.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class qr extends ji{constructor(t,n,o,c){super(t,n,o,c),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(d=>!Array.isArray(d)||d.length!==2||d.some(m=>typeof m!="number"))||this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${t}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${t}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new h.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context,o=n.gl;this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,ur.members)),this.boundsSegments||(this.boundsSegments=h.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new dt(n,this.canvas,o.RGBA,{premultiply:!0});for(const c in this.tiles){const d=this.tiles[c];d.state!=="loaded"&&(d.state="loaded",d.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const un={vector:Ir,raster:er,"raster-dem":je,geojson:hr,video:Zi,image:ji,canvas:qr};function dn(a,t){const n=h.create();return h.translate(n,n,[1,1,0]),h.scale(n,n,[.5*a.width,.5*a.height,1]),h.multiply(n,n,a.calculatePosMatrix(t.toUnwrapped()))}function pn(a,t,n,o,c,d){const m=function(C,z,F){if(C)for(const B of C){const R=z[B];if(R&&R.source===F&&R.type==="fill-extrusion")return!0}else for(const B in z){const R=z[B];if(R.source===F&&R.type==="fill-extrusion")return!0}return!1}(c&&c.layers,t,a.id),y=d.maxPitchScaleFactor(),_=a.tilesIn(o,y,m);_.sort(tr);const v=[];for(const C of _)v.push({wrappedTileID:C.tileID.wrapped().key,queryResults:C.tile.queryRenderedFeatures(t,n,a._state,C.queryGeometry,C.cameraQueryGeometry,C.scale,c,d,y,dn(a.transform,C.tileID))});const T=function(C){const z={},F={};for(const B of C){const R=B.queryResults,Z=B.wrappedTileID,K=F[Z]=F[Z]||{};for(const ee in R){const U=R[ee],se=K[ee]=K[ee]||{},te=z[ee]=z[ee]||[];for(const he of U)se[he.featureIndex]||(se[he.featureIndex]=!0,te.push(he))}}return z}(v);for(const C in T)T[C].forEach(z=>{const F=z.feature,B=a.getFeatureState(F.layer["source-layer"],F.id);F.source=F.layer.source,F.layer["source-layer"]&&(F.sourceLayer=F.layer["source-layer"]),F.state=B});return T}function tr(a,t){const n=a.tileID,o=t.tileID;return n.overscaledZ-o.overscaledZ||n.canonical.y-o.canonical.y||n.wrap-o.wrap||n.canonical.x-o.canonical.x}class Sr{constructor(t,n){this.tileID=t,this.uid=h.uniqueId(),this.uses=0,this.tileSize=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.textures=[],this.textureCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const n=t+this.timeAdded;n<h.exported.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.textures.forEach(n=>t.saveTileTexture(n)),this.demTexture=null,this.textures=[],this.textureCoords={}}loadVectorData(t,n,o){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(c,d){const m={};if(!d)return m;for(const y of c){const _=y.layerIds.map(v=>d.getLayer(v)).filter(Boolean);if(_.length!==0){y.layers=_,y.stateDependentLayerIds&&(y.stateDependentLayers=y.stateDependentLayerIds.map(v=>_.filter(T=>T.id===v)[0]));for(const v of _)m[v.id]=y}}return m}(t.buckets,n.style),this.hasSymbolBuckets=!1;for(const c in this.buckets){const d=this.buckets[c];if(d instanceof h.SymbolBucket){if(this.hasSymbolBuckets=!0,!o)break;d.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const c in this.buckets){const d=this.buckets[c];if(d instanceof h.SymbolBucket&&d.hasRTLText){this.hasRTLText=!0,h.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const c in this.buckets){const d=this.buckets[c];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(c).queryRadius(d))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new h.CollisionBoxArray}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const o in this.buckets){const c=this.buckets[o];c.uploadPending()&&c.upload(t)}const n=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new dt(t,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new dt(t,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,n,o,c,d,m,y,_,v,T){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:c,cameraQueryGeometry:d,scale:m,tileSize:this.tileSize,pixelPosMatrix:T,transform:_,params:y,queryPadding:this.queryPadding*v},t,n,o):{}}querySourceFeatures(t,n){const o=this.latestFeatureIndex;if(!o||!o.rawTileData)return;const c=o.loadVTLayers(),d=n?n.sourceLayer:"",m=c._geojsonTileLayer||c[d];if(!m)return;const y=h.createFilter(n&&n.filter),{z:_,x:v,y:T}=this.tileID.canonical,C={z:_,x:v,y:T};for(let z=0;z<m.length;z++){const F=m.feature(z);if(y.needGeometry){const Z=h.toEvaluationFeature(F,!0);if(!y.filter(new h.EvaluationParameters(this.tileID.overscaledZ),Z,this.tileID.canonical))continue}else if(!y.filter(new h.EvaluationParameters(this.tileID.overscaledZ),F))continue;const B=o.getId(F,d),R=new h.GeoJSONFeature(F,_,v,T,B);R.tile=C,t.push(R)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const n=this.expirationTime;if(t.cacheControl){const o=h.parseCacheControl(t.cacheControl);o["max-age"]&&(this.expirationTime=Date.now()+1e3*o["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const o=Date.now();let c=!1;if(this.expirationTime>o)c=!1;else if(n)if(this.expirationTime<n)c=!0;else{const d=this.expirationTime-n;d?this.expirationTime=o+Math.max(d,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const o=this.latestFeatureIndex.loadVTLayers();for(const c in this.buckets){if(!n.style.hasLayer(c))continue;const d=this.buckets[c],m=d.layers[0].sourceLayer||"_geojsonTileLayer",y=o[m],_=t[m];if(!y||!_||Object.keys(_).length===0)continue;d.update(_,y,this.imageAtlas&&this.imageAtlas.patternPositions||{});const v=n&&n.style&&n.style.getLayer(c);v&&(this.queryPadding=Math.max(this.queryPadding,v.queryRadius(d)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<h.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=h.exported.now()+t}setDependencies(t,n){const o={};for(const c of n)o[c]=!0;this.dependencies[t]=o}hasDependency(t,n){for(const o of t){const c=this.dependencies[o];if(c){for(const d of n)if(c[d])return!0}}return!1}}class Cr{constructor(t,n){this.max=t,this.onRemove=n,this.reset()}reset(){for(const t in this.data)for(const n of this.data[t])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(t,n,o){const c=t.wrapped().key;this.data[c]===void 0&&(this.data[c]=[]);const d={value:n,timeout:void 0};if(o!==void 0&&(d.timeout=setTimeout(()=>{this.remove(t,d)},o)),this.data[c].push(d),this.order.push(c),this.order.length>this.max){const m=this._getAndRemoveByKey(this.order[0]);m&&this.onRemove(m)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const n=this.data[t].shift();return n.timeout&&clearTimeout(n.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),n.value}getByKey(t){const n=this.data[t];return n?n[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,n){if(!this.has(t))return this;const o=t.wrapped().key,c=n===void 0?0:this.data[o].indexOf(n),d=this.data[o][c];return this.data[o].splice(c,1),d.timeout&&clearTimeout(d.timeout),this.data[o].length===0&&delete this.data[o],this.onRemove(d.value),this.order.splice(this.order.indexOf(o),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(t){const n=[];for(const o in this.data)for(const c of this.data[o])t(c.value)||n.push(c);for(const o of n)this.remove(o.value.tileID,o)}}class Ar{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,n,o){const c=String(n);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][c]=this.stateChanges[t][c]||{},h.extend(this.stateChanges[t][c],o),this.deletedStates[t]===null){this.deletedStates[t]={};for(const d in this.state[t])d!==c&&(this.deletedStates[t][d]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][c]===null){this.deletedStates[t][c]={};for(const d in this.state[t][c])o[d]||(this.deletedStates[t][c][d]=null)}else for(const d in o)this.deletedStates[t]&&this.deletedStates[t][c]&&this.deletedStates[t][c][d]===null&&delete this.deletedStates[t][c][d]}removeFeatureState(t,n,o){if(this.deletedStates[t]===null)return;const c=String(n);if(this.deletedStates[t]=this.deletedStates[t]||{},o&&n!==void 0)this.deletedStates[t][c]!==null&&(this.deletedStates[t][c]=this.deletedStates[t][c]||{},this.deletedStates[t][c][o]=null);else if(n!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][c])for(o in this.deletedStates[t][c]={},this.stateChanges[t][c])this.deletedStates[t][c][o]=null;else this.deletedStates[t][c]=null;else this.deletedStates[t]=null}getState(t,n){const o=String(n),c=h.extend({},(this.state[t]||{})[o],(this.stateChanges[t]||{})[o]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const d=this.deletedStates[t][n];if(d===null)return{};for(const m in d)delete c[m]}return c}initializeTileState(t,n){t.setFeatureState(this.state,n)}coalesceChanges(t,n){const o={};for(const c in this.stateChanges){this.state[c]=this.state[c]||{};const d={};for(const m in this.stateChanges[c])this.state[c][m]||(this.state[c][m]={}),h.extend(this.state[c][m],this.stateChanges[c][m]),d[m]=this.state[c][m];o[c]=d}for(const c in this.deletedStates){this.state[c]=this.state[c]||{};const d={};if(this.deletedStates[c]===null)for(const m in this.state[c])d[m]={},this.state[c][m]={};else for(const m in this.deletedStates[c]){if(this.deletedStates[c][m]===null)this.state[c][m]={};else for(const y of Object.keys(this.deletedStates[c][m]))delete this.state[c][m][y];d[m]=this.state[c][m]}o[c]=o[c]||{},h.extend(o[c],d)}if(this.stateChanges={},this.deletedStates={},Object.keys(o).length!==0)for(const c in t)t[c].setFeatureState(o,n)}}class xi extends h.Evented{constructor(t,n,o){super(),this.id=t,this.dispatcher=o,this.on("data",c=>{c.dataType==="source"&&c.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&c.dataType==="source"&&c.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain))}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(c,d,m,y){const _=new un[d.type](c,d,m,y);if(_.id!==c)throw new Error(`Expected Source id to be ${c} instead of ${_.id}`);return h.bindAll(["load","abort","unload","serialize","prepare"],_),_}(t,n,o,this),this._tiles={},this._cache=new Cr(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Ar}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles){const n=this._tiles[t];if(n.state!=="loaded"&&n.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,n){return this._source.loadTile(t,n)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){this._source.abortTile&&this._source.abortTile(t,()=>{}),this._source.fire(new h.Event("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const o=this._tiles[n];o.upload(t),o.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(mn).map(t=>t.key)}getRenderableIds(t){const n=[];for(const o in this._tiles)this._isIdRenderable(o,t)&&n.push(this._tiles[o]);return t?n.sort((o,c)=>{const d=o.tileID,m=c.tileID,y=new h.pointGeometry(d.canonical.x,d.canonical.y)._rotate(this.transform.angle),_=new h.pointGeometry(m.canonical.x,m.canonical.y)._rotate(this.transform.angle);return d.overscaledZ-m.overscaledZ||_.y-y.y||_.x-y.x}).map(o=>o.tileID.key):n.map(o=>o.tileID).sort(mn).map(o=>o.key)}hasRenderableParent(t){const n=this.findLoadedParent(t,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(t,n){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(n||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,n){const o=this._tiles[t];o&&(o.state!=="loading"&&(o.state=n),this._loadTile(o,this._tileLoaded.bind(this,o,t,n)))}_tileLoaded(t,n,o,c){if(c)return t.state="errored",void(c.status!==404?this._source.fire(new h.ErrorEvent(c,{tile:t})):this.update(this.transform,this.terrain));t.timeAdded=h.exported.now(),o==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(n,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new h.Event("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const n=this.getRenderableIds();for(let c=0;c<n.length;c++){const d=n[c];if(t.neighboringTiles&&t.neighboringTiles[d]){const m=this.getTileByID(d);o(t,m),o(m,t)}}function o(c,d){c.needsHillshadePrepare=!0,c.needsTerrainPrepare=!0;let m=d.tileID.canonical.x-c.tileID.canonical.x;const y=d.tileID.canonical.y-c.tileID.canonical.y,_=Math.pow(2,c.tileID.canonical.z),v=d.tileID.key;m===0&&y===0||Math.abs(y)>1||(Math.abs(m)>1&&(Math.abs(m+_)===1?m+=_:Math.abs(m-_)===1&&(m-=_)),d.dem&&c.dem&&(c.dem.backfillBorder(d.dem,m,y),c.neighboringTiles&&c.neighboringTiles[v]&&(c.neighboringTiles[v].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,n,o,c){for(const d in this._tiles){let m=this._tiles[d];if(c[d]||!m.hasData()||m.tileID.overscaledZ<=n||m.tileID.overscaledZ>o)continue;let y=m.tileID;for(;m&&m.tileID.overscaledZ>n+1;){const v=m.tileID.scaledTo(m.tileID.overscaledZ-1);m=this._tiles[v.key],m&&m.hasData()&&(y=v)}let _=y;for(;_.overscaledZ>n;)if(_=_.scaledTo(_.overscaledZ-1),t[_.key]){c[y.key]=y;break}}}findLoadedParent(t,n){if(t.key in this._loadedParentTiles){const o=this._loadedParentTiles[t.key];return o&&o.tileID.overscaledZ>=n?o:null}for(let o=t.overscaledZ-1;o>=n;o--){const c=t.scaledTo(o),d=this._getLoadedTile(c);if(d)return d}}_getLoadedTile(t){const n=this._tiles[t.key];return n&&n.hasData()?n:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const n=Math.ceil(t.width/this._source.tileSize)+1,o=Math.ceil(t.height/this._source.tileSize)+1,c=Math.floor(n*o*5),d=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,c):c;this._cache.setMaxSize(d)}handleWrapJump(t){const n=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,n){const o={};for(const c in this._tiles){const d=this._tiles[c];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+n),o[d.tileID.key]=d}this._tiles=o;for(const c in this._timers)clearTimeout(this._timers[c]),delete this._timers[c];for(const c in this._tiles)this._setTileReloadTimer(c,this._tiles[c])}}update(t,n){if(this.transform=t,this.terrain=n,!this._sourceLoaded||this._paused)return;let o;this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?o=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(v=>new h.OverscaledTileID(v.canonical.z,v.wrap,v.canonical.z,v.canonical.x,v.canonical.y)):(o=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:n}),this._source.hasTile&&(o=o.filter(v=>this._source.hasTile(v)))):o=[];const c=t.coveringZoomLevel(this._source),d=Math.max(c-xi.maxOverzooming,this._source.minzoom),m=Math.max(c+xi.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const v={};for(const T of o)if(T.canonical.z>this._source.minzoom){const C=T.scaledTo(T.canonical.z-1);v[C.key]=C;const z=T.scaledTo(Math.max(this._source.minzoom,Math.min(T.canonical.z,5)));v[z.key]=z}o=o.concat(Object.values(v))}const y=this._updateRetainedTiles(o,c);if(Vn(this._source.type)){const v={},T={},C=Object.keys(y);for(const z of C){const F=y[z],B=this._tiles[z];if(!B||B.fadeEndTime&&B.fadeEndTime<=h.exported.now())continue;const R=this.findLoadedParent(F,d);R&&(this._addTile(R.tileID),v[R.tileID.key]=R.tileID),T[z]=F}this._retainLoadedChildren(T,c,m,y);for(const z in v)y[z]||(this._coveredTiles[z]=!0,y[z]=v[z]);if(n){const z={},F={};for(const B of o)this._tiles[B.key].hasData()?z[B.key]=B:F[B.key]=B;for(const B in F){const R=F[B].children(this._source.maxzoom);this._tiles[R[0].key]&&this._tiles[R[1].key]&&this._tiles[R[2].key]&&this._tiles[R[3].key]&&(z[R[0].key]=y[R[0].key]=R[0],z[R[1].key]=y[R[1].key]=R[1],z[R[2].key]=y[R[2].key]=R[2],z[R[3].key]=y[R[3].key]=R[3],delete F[B])}for(const B in F){const R=this.findLoadedParent(F[B],this._source.minzoom);if(R){z[R.tileID.key]=y[R.tileID.key]=R.tileID;for(const Z in z)z[Z].isChildOf(R.tileID)&&delete z[Z]}}for(const B in this._tiles)z[B]||(this._coveredTiles[B]=!0)}}for(const v in y)this._tiles[v].clearFadeHold();const _=h.keysDifference(this._tiles,y);for(const v of _){const T=this._tiles[v];T.hasSymbolBuckets&&!T.holdingForFade()?T.setHoldDuration(this.map._fadeDuration):T.hasSymbolBuckets&&!T.symbolFadeFinished()||this._removeTile(v)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,n){const o={},c={},d=Math.max(n-xi.maxOverzooming,this._source.minzoom),m=Math.max(n+xi.maxUnderzooming,this._source.minzoom),y={};for(const _ of t){const v=this._addTile(_);o[_.key]=_,v.hasData()||n<this._source.maxzoom&&(y[_.key]=_)}this._retainLoadedChildren(y,n,m,o);for(const _ of t){let v=this._tiles[_.key];if(v.hasData())continue;if(n+1>this._source.maxzoom){const C=_.children(this._source.maxzoom)[0],z=this.getTile(C);if(z&&z.hasData()){o[C.key]=C;continue}}else{const C=_.children(this._source.maxzoom);if(o[C[0].key]&&o[C[1].key]&&o[C[2].key]&&o[C[3].key])continue}let T=v.wasRequested();for(let C=_.overscaledZ-1;C>=d;--C){const z=_.scaledTo(C);if(c[z.key]||(c[z.key]=!0,v=this.getTile(z),!v&&T&&(v=this._addTile(z)),v&&(o[z.key]=z,T=v.wasRequested(),v.hasData())))break}}return o}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const n=[];let o,c=this._tiles[t].tileID;for(;c.overscaledZ>0;){if(c.key in this._loadedParentTiles){o=this._loadedParentTiles[c.key];break}n.push(c.key);const d=c.scaledTo(c.overscaledZ-1);if(o=this._getLoadedTile(d),o)break;c=d}for(const d of n)this._loadedParentTiles[d]=o}}_addTile(t){let n=this._tiles[t.key];if(n)return n;n=this._cache.getAndRemove(t),n&&(this._setTileReloadTimer(t.key,n),n.tileID=t,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,n)));const o=n;return n||(n=new Sr(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(n,this._tileLoaded.bind(this,n,t.key,n.state))),n.uses++,this._tiles[t.key]=n,o||this._source.fire(new h.Event("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n}_setTileReloadTimer(t,n){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const o=n.getExpiryTimeout();o&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},o))}_removeTile(t){const n=this._tiles[t];n&&(n.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,n,o){const c=[],d=this.transform;if(!d)return c;const m=o?d.getCameraQueryGeometry(t):t,y=t.map(B=>d.pointCoordinate(B,this.terrain)),_=m.map(B=>d.pointCoordinate(B,this.terrain)),v=this.getIds();let T=1/0,C=1/0,z=-1/0,F=-1/0;for(const B of _)T=Math.min(T,B.x),C=Math.min(C,B.y),z=Math.max(z,B.x),F=Math.max(F,B.y);for(let B=0;B<v.length;B++){const R=this._tiles[v[B]];if(R.holdingForFade())continue;const Z=R.tileID,K=Math.pow(2,d.zoom-R.tileID.overscaledZ),ee=n*R.queryPadding*h.EXTENT/R.tileSize/K,U=[Z.getTilePoint(new h.MercatorCoordinate(T,C)),Z.getTilePoint(new h.MercatorCoordinate(z,F))];if(U[0].x-ee<h.EXTENT&&U[0].y-ee<h.EXTENT&&U[1].x+ee>=0&&U[1].y+ee>=0){const se=y.map(he=>Z.getTilePoint(he)),te=_.map(he=>Z.getTilePoint(he));c.push({tile:R,tileID:Z,queryGeometry:se,cameraQueryGeometry:te,scale:K})}}return c}getVisibleCoordinates(t){const n=this.getRenderableIds(t).map(o=>this._tiles[o].tileID);for(const o of n)o.posMatrix=this.transform.calculatePosMatrix(o.toUnwrapped());return n}hasTransition(){if(this._source.hasTransition())return!0;if(Vn(this._source.type))for(const t in this._tiles){const n=this._tiles[t];if(n.fadeEndTime!==void 0&&n.fadeEndTime>=h.exported.now())return!0}return!1}setFeatureState(t,n,o){this._state.updateState(t=t||"_geojsonTileLayer",n,o)}removeFeatureState(t,n,o){this._state.removeFeatureState(t=t||"_geojsonTileLayer",n,o)}getFeatureState(t,n){return this._state.getState(t=t||"_geojsonTileLayer",n)}setDependencies(t,n,o){const c=this._tiles[t];c&&c.setDependencies(n,o)}reloadTilesForDependencies(t,n){for(const o in this._tiles)this._tiles[o].hasDependency(t,n)&&this._reloadTile(o,"reloading");this._cache.filter(o=>!o.hasDependency(t,n))}}function mn(a,t){const n=Math.abs(2*a.wrap)-+(a.wrap<0),o=Math.abs(2*t.wrap)-+(t.wrap<0);return a.overscaledZ-t.overscaledZ||o-n||t.canonical.y-a.canonical.y||t.canonical.x-a.canonical.x}function Vn(a){return a==="raster"||a==="image"||a==="video"}xi.maxOverzooming=10,xi.maxUnderzooming=3;const dr="mapboxgl_preloaded_worker_pool";class Si{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Si.workerCount;)this.workers.push(new Worker(Qr.workerUrl));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[dr]}numActive(){return Object.keys(this.active).length}}const Nn=Math.floor(h.exported.hardwareConcurrency/2);let zr;function fn(){return zr||(zr=new Si),zr}function gn(a,t){const n={};for(const o in a)o!=="ref"&&(n[o]=a[o]);return h.refProperties.forEach(o=>{o in t&&(n[o]=t[o])}),n}function $n(a){a=a.slice();const t=Object.create(null);for(let n=0;n<a.length;n++)t[a[n].id]=a[n];for(let n=0;n<a.length;n++)"ref"in a[n]&&(a[n]=gn(a[n],t[a[n].ref]));return a}Si.workerCount=Math.max(Math.min(Nn,6),1);const at={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function ir(a,t,n){n.push({command:at.addSource,args:[a,t[a]]})}function Mr(a,t,n){t.push({command:at.removeSource,args:[a]}),n[a]=!0}function kr(a,t,n,o){Mr(a,n,o),ir(a,t,n)}function Gn(a,t,n){let o;for(o in a[n])if(Object.prototype.hasOwnProperty.call(a[n],o)&&o!=="data"&&!Re(a[n][o],t[n][o]))return!1;for(o in t[n])if(Object.prototype.hasOwnProperty.call(t[n],o)&&o!=="data"&&!Re(a[n][o],t[n][o]))return!1;return!0}function pr(a,t,n,o,c,d){let m;for(m in t=t||{},a=a||{})Object.prototype.hasOwnProperty.call(a,m)&&(Re(a[m],t[m])||n.push({command:d,args:[o,m,t[m],c]}));for(m in t)Object.prototype.hasOwnProperty.call(t,m)&&!Object.prototype.hasOwnProperty.call(a,m)&&(Re(a[m],t[m])||n.push({command:d,args:[o,m,t[m],c]}))}function mr(a){return a.id}function yn(a,t){return a[t.id]=t,a}class fr{constructor(t,n){this.reset(t,n)}reset(t,n){this.points=t||[],this._distances=[0];for(let o=1;o<this.points.length;o++)this._distances[o]=this._distances[o-1]+this.points[o].dist(this.points[o-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=h.clamp(t,0,1);let n=1,o=this._distances[n];const c=t*this.paddedLength+this.padding;for(;o<c&&n<this._distances.length;)o=this._distances[++n];const d=n-1,m=this._distances[d],y=o-m,_=y>0?(c-m)/y:0;return this.points[d].mult(1-_).add(this.points[n].mult(_))}}function de(a,t){let n=!0;return a==="always"||a!=="never"&&t!=="never"||(n=!1),n}class Te{constructor(t,n,o){const c=this.boxCells=[],d=this.circleCells=[];this.xCellCount=Math.ceil(t/o),this.yCellCount=Math.ceil(n/o);for(let m=0;m<this.xCellCount*this.yCellCount;m++)c.push([]),d.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=n,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,n,o,c,d){this._forEachCell(n,o,c,d,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(c),this.bboxes.push(d)}insertCircle(t,n,o,c){this._forEachCell(n-c,o-c,n+c,o+c,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(n),this.circles.push(o),this.circles.push(c)}_insertBoxCell(t,n,o,c,d,m){this.boxCells[d].push(m)}_insertCircleCell(t,n,o,c,d,m){this.circleCells[d].push(m)}_query(t,n,o,c,d,m,y){if(o<0||t>this.width||c<0||n>this.height)return[];const _=[];if(t<=0&&n<=0&&this.width<=o&&this.height<=c){if(d)return[{key:null,x1:t,y1:n,x2:o,y2:c}];for(let v=0;v<this.boxKeys.length;v++)_.push({key:this.boxKeys[v],x1:this.bboxes[4*v],y1:this.bboxes[4*v+1],x2:this.bboxes[4*v+2],y2:this.bboxes[4*v+3]});for(let v=0;v<this.circleKeys.length;v++){const T=this.circles[3*v],C=this.circles[3*v+1],z=this.circles[3*v+2];_.push({key:this.circleKeys[v],x1:T-z,y1:C-z,x2:T+z,y2:C+z})}}else this._forEachCell(t,n,o,c,this._queryCell,_,{hitTest:d,overlapMode:m,seenUids:{box:{},circle:{}}},y);return _}query(t,n,o,c){return this._query(t,n,o,c,!1,null)}hitTest(t,n,o,c,d,m){return this._query(t,n,o,c,!0,d,m).length>0}hitTestCircle(t,n,o,c,d){const m=t-o,y=t+o,_=n-o,v=n+o;if(y<0||m>this.width||v<0||_>this.height)return!1;const T=[];return this._forEachCell(m,_,y,v,this._queryCellCircle,T,{hitTest:!0,overlapMode:c,circle:{x:t,y:n,radius:o},seenUids:{box:{},circle:{}}},d),T.length>0}_queryCell(t,n,o,c,d,m,y,_){const{seenUids:v,hitTest:T,overlapMode:C}=y,z=this.boxCells[d];if(z!==null){const B=this.bboxes;for(const R of z)if(!v.box[R]){v.box[R]=!0;const Z=4*R,K=this.boxKeys[R];if(t<=B[Z+2]&&n<=B[Z+3]&&o>=B[Z+0]&&c>=B[Z+1]&&(!_||_(K))&&(!T||!de(C,K.overlapMode))&&(m.push({key:K,x1:B[Z],y1:B[Z+1],x2:B[Z+2],y2:B[Z+3]}),T))return!0}}const F=this.circleCells[d];if(F!==null){const B=this.circles;for(const R of F)if(!v.circle[R]){v.circle[R]=!0;const Z=3*R,K=this.circleKeys[R];if(this._circleAndRectCollide(B[Z],B[Z+1],B[Z+2],t,n,o,c)&&(!_||_(K))&&(!T||!de(C,K.overlapMode))){const ee=B[Z],U=B[Z+1],se=B[Z+2];if(m.push({key:K,x1:ee-se,y1:U-se,x2:ee+se,y2:U+se}),T)return!0}}}return!1}_queryCellCircle(t,n,o,c,d,m,y,_){const{circle:v,seenUids:T,overlapMode:C}=y,z=this.boxCells[d];if(z!==null){const B=this.bboxes;for(const R of z)if(!T.box[R]){T.box[R]=!0;const Z=4*R,K=this.boxKeys[R];if(this._circleAndRectCollide(v.x,v.y,v.radius,B[Z+0],B[Z+1],B[Z+2],B[Z+3])&&(!_||_(K))&&!de(C,K.overlapMode))return m.push(!0),!0}}const F=this.circleCells[d];if(F!==null){const B=this.circles;for(const R of F)if(!T.circle[R]){T.circle[R]=!0;const Z=3*R,K=this.circleKeys[R];if(this._circlesCollide(B[Z],B[Z+1],B[Z+2],v.x,v.y,v.radius)&&(!_||_(K))&&!de(C,K.overlapMode))return m.push(!0),!0}}}_forEachCell(t,n,o,c,d,m,y,_){const v=this._convertToXCellCoord(t),T=this._convertToYCellCoord(n),C=this._convertToXCellCoord(o),z=this._convertToYCellCoord(c);for(let F=v;F<=C;F++)for(let B=T;B<=z;B++)if(d.call(this,t,n,o,c,this.xCellCount*B+F,m,y,_))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,n,o,c,d,m){const y=c-t,_=d-n,v=o+m;return v*v>y*y+_*_}_circleAndRectCollide(t,n,o,c,d,m,y){const _=(m-c)/2,v=Math.abs(t-(c+_));if(v>_+o)return!1;const T=(y-d)/2,C=Math.abs(n-(d+T));if(C>T+o)return!1;if(v<=_||C<=T)return!0;const z=v-_,F=C-T;return z*z+F*F<=o*o}}function jr(a,t,n,o,c){const d=h.create();return t?(h.scale(d,d,[1/c,1/c,1]),n||h.rotateZ(d,d,o.angle)):h.multiply(d,o.labelPlaneMatrix,a),d}function Xi(a,t,n,o,c){if(t){const d=h.clone(a);return h.scale(d,d,[c,c,1]),n||h.rotateZ(d,d,-o.angle),d}return o.glCoordMatrix}function lt(a,t,n){let o;n?(o=[a.x,a.y,n(a.x,a.y),1],h.transformMat4(o,o,t)):(o=[a.x,a.y,0,1],gr(o,o,t));const c=o[3];return{point:new h.pointGeometry(o[0]/c,o[1]/c),signedDistanceFromCamera:c}}function Ui(a,t){return .5+a/t*.5}function Ci(a,t){const n=a[0]/a[3],o=a[1]/a[3];return n>=-t[0]&&n<=t[0]&&o>=-t[1]&&o<=t[1]}function Ai(a,t,n,o,c,d,m,y,_,v){const T=o?a.textSizeData:a.iconSizeData,C=h.evaluateSizeForZoom(T,n.transform.zoom),z=[256/n.width*2+1,256/n.height*2+1],F=o?a.text.dynamicLayoutVertexArray:a.icon.dynamicLayoutVertexArray;F.clear();const B=a.lineVertexArray,R=o?a.text.placedSymbolArray:a.icon.placedSymbolArray,Z=n.transform.width/n.transform.height;let K=!1;for(let ee=0;ee<R.length;ee++){const U=R.get(ee);if(U.hidden||U.writingMode===h.WritingMode.vertical&&!K){He(U.numGlyphs,F);continue}let se;if(K=!1,v?(se=[U.anchorX,U.anchorY,v(U.anchorX,U.anchorY),1],h.transformMat4(se,se,t)):(se=[U.anchorX,U.anchorY,0,1],gr(se,se,t)),!Ci(se,z)){He(U.numGlyphs,F);continue}const te=Ui(n.transform.cameraToCenterDistance,se[3]),he=h.evaluateSizeForFeature(T,C,U),ue=m?he/te:he*te,ye=new h.pointGeometry(U.anchorX,U.anchorY),ce=lt(ye,c,v).point,ze={},be=Qe(U,ue,!1,y,t,c,d,a.glyphOffsetArray,B,F,ce,ye,ze,Z,_,v);K=be.useVertical,(be.notEnoughRoom||K||be.needsFlipping&&Qe(U,ue,!0,y,t,c,d,a.glyphOffsetArray,B,F,ce,ye,ze,Z,_,v).notEnoughRoom)&&He(U.numGlyphs,F)}o?a.text.dynamicLayoutVertexBuffer.updateData(F):a.icon.dynamicLayoutVertexBuffer.updateData(F)}function Pr(a,t,n,o,c,d,m,y,_,v,T,C,z){const F=y.glyphStartIndex+y.numGlyphs,B=y.lineStartIndex,R=y.lineStartIndex+y.lineLength,Z=t.getoffsetX(y.glyphStartIndex),K=t.getoffsetX(F-1),ee=ii(a*Z,n,o,c,d,m,y.segment,B,R,_,v,T,C,z);if(!ee)return null;const U=ii(a*K,n,o,c,d,m,y.segment,B,R,_,v,T,C,z);return U?{first:ee,last:U}:null}function ve(a,t,n,o){return a===h.WritingMode.horizontal&&Math.abs(n.y-t.y)>Math.abs(n.x-t.x)*o?{useVertical:!0}:(a===h.WritingMode.vertical?t.y<n.y:t.x>n.x)?{needsFlipping:!0}:null}function Qe(a,t,n,o,c,d,m,y,_,v,T,C,z,F,B,R){const Z=t/24,K=a.lineOffsetX*Z,ee=a.lineOffsetY*Z;let U;if(a.numGlyphs>1){const se=a.glyphStartIndex+a.numGlyphs,te=a.lineStartIndex,he=a.lineStartIndex+a.lineLength,ue=Pr(Z,y,K,ee,n,T,C,a,_,d,z,B,R);if(!ue)return{notEnoughRoom:!0};const ye=lt(ue.first.point,m,R).point,ce=lt(ue.last.point,m,R).point;if(o&&!n){const ze=ve(a.writingMode,ye,ce,F);if(ze)return ze}U=[ue.first];for(let ze=a.glyphStartIndex+1;ze<se-1;ze++)U.push(ii(Z*y.getoffsetX(ze),K,ee,n,T,C,a.segment,te,he,_,d,z,B,R));U.push(ue.last)}else{if(o&&!n){const te=lt(C,c,R).point,he=a.lineStartIndex+a.segment+1,ue=new h.pointGeometry(_.getx(he),_.gety(he)),ye=lt(ue,c,R),ce=ye.signedDistanceFromCamera>0?ye.point:Ke(C,ue,te,1,c,R),ze=ve(a.writingMode,te,ce,F);if(ze)return ze}const se=ii(Z*y.getoffsetX(a.glyphStartIndex),K,ee,n,T,C,a.segment,a.lineStartIndex,a.lineStartIndex+a.lineLength,_,d,z,B,R);if(!se)return{notEnoughRoom:!0};U=[se]}for(const se of U)h.addDynamicAttributes(v,se.point,se.angle);return{}}function Ke(a,t,n,o,c,d){const m=lt(a.add(a.sub(t)._unit()),c,d).point,y=n.sub(m);return n.add(y._mult(o/y.mag()))}function ii(a,t,n,o,c,d,m,y,_,v,T,C,z,F){const B=o?a-t:a+t;let R=B>0?1:-1,Z=0;o&&(R*=-1,Z=Math.PI),R<0&&(Z+=Math.PI);let K=R>0?y+m:y+m+1,ee=c,U=c,se=0,te=0;const he=Math.abs(B),ue=[];for(;se+te<=he;){if(K+=R,K<y||K>=_)return null;if(U=ee,ue.push(ee),ee=C[K],ee===void 0){const Me=new h.pointGeometry(v.getx(K),v.gety(K)),Ye=lt(Me,T,F);if(Ye.signedDistanceFromCamera>0)ee=C[K]=Ye.point;else{const tt=K-R;ee=Ke(se===0?d:new h.pointGeometry(v.getx(tt),v.gety(tt)),Me,U,he-se+1,T,F)}}se+=te,te=U.dist(ee)}const ye=(he-se)/te,ce=ee.sub(U),ze=ce.mult(ye)._add(U);ze._add(ce._unit()._perp()._mult(n*R));const be=Z+Math.atan2(ee.y-U.y,ee.x-U.x);return ue.push(ze),{point:ze,angle:z?be:0,path:ue}}const Dr=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function He(a,t){for(let n=0;n<a;n++){const o=t.length;t.resize(o+4),t.float32.set(Dr,3*o)}}function gr(a,t,n){const o=t[0],c=t[1];return a[0]=n[0]*o+n[4]*c+n[12],a[1]=n[1]*o+n[5]*c+n[13],a[3]=n[3]*o+n[7]*c+n[15],a}const Ht=100;class _n{constructor(t,n=new Te(t.width+200,t.height+200,25),o=new Te(t.width+200,t.height+200,25)){this.transform=t,this.grid=n,this.ignoredGrid=o,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Ht,this.screenBottomBoundary=t.height+Ht,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,n,o,c,d,m){const y=this.projectAndGetPerspectiveRatio(c,t.anchorPointX,t.anchorPointY,m),_=o*y.perspectiveRatio,v=t.x1*_+y.point.x,T=t.y1*_+y.point.y,C=t.x2*_+y.point.x,z=t.y2*_+y.point.y;return!this.isInsideGrid(v,T,C,z)||n!=="always"&&this.grid.hitTest(v,T,C,z,n,d)||y.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[v,T,C,z],offscreen:this.isOffscreen(v,T,C,z)}}placeCollisionCircles(t,n,o,c,d,m,y,_,v,T,C,z,F,B){const R=[],Z=new h.pointGeometry(n.anchorX,n.anchorY),K=lt(Z,m,B),ee=Ui(this.transform.cameraToCenterDistance,K.signedDistanceFromCamera),U=(T?d/ee:d*ee)/h.ONE_EM,se=lt(Z,y,B).point,te=Pr(U,c,n.lineOffsetX*U,n.lineOffsetY*U,!1,se,Z,n,o,y,{},!1,B);let he=!1,ue=!1,ye=!0;if(te){const ce=.5*z*ee+F,ze=new h.pointGeometry(-100,-100),be=new h.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Me=new fr,Ye=te.first,tt=te.last;let Ve=[];for(let ot=Ye.path.length-1;ot>=1;ot--)Ve.push(Ye.path[ot]);for(let ot=1;ot<tt.path.length;ot++)Ve.push(tt.path[ot]);const gt=2.5*ce;if(_){const ot=Ve.map(ut=>lt(ut,_,B));Ve=ot.some(ut=>ut.signedDistanceFromCamera<=0)?[]:ot.map(ut=>ut.point)}let yt=[];if(Ve.length>0){const ot=Ve[0].clone(),ut=Ve[0].clone();for(let vt=1;vt<Ve.length;vt++)ot.x=Math.min(ot.x,Ve[vt].x),ot.y=Math.min(ot.y,Ve[vt].y),ut.x=Math.max(ut.x,Ve[vt].x),ut.y=Math.max(ut.y,Ve[vt].y);yt=ot.x>=ze.x&&ut.x<=be.x&&ot.y>=ze.y&&ut.y<=be.y?[Ve]:ut.x<ze.x||ot.x>be.x||ut.y<ze.y||ot.y>be.y?[]:h.clipLine([Ve],ze.x,ze.y,be.x,be.y)}for(const ot of yt){Me.reset(ot,.25*ce);let ut=0;ut=Me.length<=.5*ce?1:Math.ceil(Me.paddedLength/gt)+1;for(let vt=0;vt<ut;vt++){const Kt=vt/Math.max(ut-1,1),or=Me.lerp(Kt),Wi=or.x+Ht,ar=or.y+Ht;R.push(Wi,ar,ce,0);const Vr=Wi-ce,Ni=ar-ce,bi=Wi+ce,xr=ar+ce;if(ye=ye&&this.isOffscreen(Vr,Ni,bi,xr),ue=ue||this.isInsideGrid(Vr,Ni,bi,xr),t!=="always"&&this.grid.hitTestCircle(Wi,ar,ce,t,C)&&(he=!0,!v))return{circles:[],offscreen:!1,collisionDetected:he}}}}return{circles:!v&&he||!ue||ee<this.perspectiveRatioCutoff?[]:R,offscreen:ye,collisionDetected:he}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const n=[];let o=1/0,c=1/0,d=-1/0,m=-1/0;for(const T of t){const C=new h.pointGeometry(T.x+Ht,T.y+Ht);o=Math.min(o,C.x),c=Math.min(c,C.y),d=Math.max(d,C.x),m=Math.max(m,C.y),n.push(C)}const y=this.grid.query(o,c,d,m).concat(this.ignoredGrid.query(o,c,d,m)),_={},v={};for(const T of y){const C=T.key;if(_[C.bucketInstanceId]===void 0&&(_[C.bucketInstanceId]={}),_[C.bucketInstanceId][C.featureIndex])continue;const z=[new h.pointGeometry(T.x1,T.y1),new h.pointGeometry(T.x2,T.y1),new h.pointGeometry(T.x2,T.y2),new h.pointGeometry(T.x1,T.y2)];h.polygonIntersectsPolygon(n,z)&&(_[C.bucketInstanceId][C.featureIndex]=!0,v[C.bucketInstanceId]===void 0&&(v[C.bucketInstanceId]=[]),v[C.bucketInstanceId].push(C.featureIndex))}return v}insertCollisionBox(t,n,o,c,d,m){(o?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:d,collisionGroupID:m,overlapMode:n},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,n,o,c,d,m){const y=o?this.ignoredGrid:this.grid,_={bucketInstanceId:c,featureIndex:d,collisionGroupID:m,overlapMode:n};for(let v=0;v<t.length;v+=4)y.insertCircle(_,t[v],t[v+1],t[v+2])}projectAndGetPerspectiveRatio(t,n,o,c){let d;return c?(d=[n,o,c(n,o),1],h.transformMat4(d,d,t)):(d=[n,o,0,1],gr(d,d,t)),{point:new h.pointGeometry((d[0]/d[3]+1)/2*this.transform.width+Ht,(-d[1]/d[3]+1)/2*this.transform.height+Ht),perspectiveRatio:.5+this.transform.cameraToCenterDistance/d[3]*.5}}isOffscreen(t,n,o,c){return o<Ht||t>=this.screenRightBoundary||c<Ht||n>this.screenBottomBoundary}isInsideGrid(t,n,o,c){return o>=0&&t<this.gridRightBoundary&&c>=0&&n<this.gridBottomBoundary}getViewportMatrix(){const t=h.identity([]);return h.translate(t,t,[-100,-100,0]),t}}function Vt(a,t,n){return t*(h.EXTENT/(a.tileSize*Math.pow(2,n-a.tileID.overscaledZ)))}class pi{constructor(t,n,o,c){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?n:-n))):c&&o?1:0,this.placed=o}isHidden(){return this.opacity===0&&!this.placed}}class xt{constructor(t,n,o,c,d){this.text=new pi(t?t.text:null,n,o,d),this.icon=new pi(t?t.icon:null,n,c,d)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class xn{constructor(t,n,o){this.text=t,this.icon=n,this.skipFade=o}}class rr{constructor(){this.invProjMatrix=h.create(),this.viewportMatrix=h.create(),this.circles=[]}}class Zr{constructor(t,n,o,c,d){this.bucketInstanceId=t,this.featureIndex=n,this.sourceLayerIndex=o,this.bucketIndex=c,this.tileID=d}}class Xr{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const n=++this.maxGroupID;this.collisionGroups[t]={ID:n,predicate:o=>o.collisionGroupID===n}}return this.collisionGroups[t]}}function vn(a,t,n,o,c){const{horizontalAlign:d,verticalAlign:m}=h.getAnchorAlignment(a),y=-(d-.5)*t,_=-(m-.5)*n,v=h.evaluateVariableOffset(a,o);return new h.pointGeometry(y+v[0]*c,_+v[1]*c)}function Hr(a,t,n,o,c,d){const{x1:m,x2:y,y1:_,y2:v,anchorPointX:T,anchorPointY:C}=a,z=new h.pointGeometry(t,n);return o&&z._rotate(c?d:-d),{x1:m+z.x,y1:_+z.y,x2:y+z.x,y2:v+z.y,anchorPointX:T,anchorPointY:C}}class L{constructor(t,n,o,c,d){this.transform=t.clone(),this.terrain=n,this.collisionIndex=new _n(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=o,this.retainedQueryData={},this.collisionGroups=new Xr(c),this.collisionCircleArrays={},this.prevPlacement=d,d&&(d.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,n,o,c){const d=o.getBucket(n),m=o.latestFeatureIndex;if(!d||!m||n.id!==d.layerIds[0])return;const y=o.collisionBoxArray,_=d.layers[0].layout,v=Math.pow(2,this.transform.zoom-o.tileID.overscaledZ),T=o.tileSize/h.EXTENT,C=this.transform.calculatePosMatrix(o.tileID.toUnwrapped()),z=_.get("text-pitch-alignment")==="map",F=_.get("text-rotation-alignment")==="map",B=Vt(o,1,this.transform.zoom),R=jr(C,z,F,this.transform,B);let Z=null;if(z){const ee=Xi(C,z,F,this.transform,B);Z=h.multiply([],this.transform.labelPlaneMatrix,ee)}this.retainedQueryData[d.bucketInstanceId]=new Zr(d.bucketInstanceId,m,d.sourceLayerIndex,d.index,o.tileID);const K={bucket:d,layout:_,posMatrix:C,textLabelPlaneMatrix:R,labelToScreenMatrix:Z,scale:v,textPixelRatio:T,holdingForFade:o.holdingForFade(),collisionBoxArray:y,partiallyEvaluatedTextSize:h.evaluateSizeForZoom(d.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(d.sourceID)};if(c)for(const ee of d.sortKeyRanges){const{sortKey:U,symbolInstanceStart:se,symbolInstanceEnd:te}=ee;t.push({sortKey:U,symbolInstanceStart:se,symbolInstanceEnd:te,parameters:K})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:d.symbolInstances.length,parameters:K})}attemptAnchorPlacement(t,n,o,c,d,m,y,_,v,T,C,z,F,B,R,Z){const K=[z.textOffset0,z.textOffset1],ee=vn(t,o,c,K,d),U=this.collisionIndex.placeCollisionBox(Hr(n,ee.x,ee.y,m,y,this.transform.angle),C,_,v,T.predicate,Z);if((!R||this.collisionIndex.placeCollisionBox(Hr(R,ee.x,ee.y,m,y,this.transform.angle),C,_,v,T.predicate,Z).box.length!==0)&&U.box.length>0){let se;if(this.prevPlacement&&this.prevPlacement.variableOffsets[z.crossTileID]&&this.prevPlacement.placements[z.crossTileID]&&this.prevPlacement.placements[z.crossTileID].text&&(se=this.prevPlacement.variableOffsets[z.crossTileID].anchor),z.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[z.crossTileID]={textOffset:K,width:o,height:c,anchor:t,textBoxScale:d,prevAnchor:se},this.markUsedJustification(F,t,z,B),F.allowVerticalPlacement&&(this.markUsedOrientation(F,B,z),this.placedOrientations[z.crossTileID]=B),{shift:ee,placedGlyphBoxes:U}}}placeLayerBucketPart(t,n,o){const{bucket:c,layout:d,posMatrix:m,textLabelPlaneMatrix:y,labelToScreenMatrix:_,textPixelRatio:v,holdingForFade:T,collisionBoxArray:C,partiallyEvaluatedTextSize:z,collisionGroup:F}=t.parameters,B=d.get("text-optional"),R=d.get("icon-optional"),Z=h.getOverlapMode(d,"text-overlap","text-allow-overlap"),K=Z==="always",ee=h.getOverlapMode(d,"icon-overlap","icon-allow-overlap"),U=ee==="always",se=d.get("text-rotation-alignment")==="map",te=d.get("text-pitch-alignment")==="map",he=d.get("icon-text-fit")!=="none",ue=d.get("symbol-z-order")==="viewport-y",ye=K&&(U||!c.hasIconData()||R),ce=U&&(K||!c.hasTextData()||B);!c.collisionArrays&&C&&c.deserializeCollisionBoxes(C);const ze=(be,Me)=>{if(n[be.crossTileID])return;if(T)return void(this.placements[be.crossTileID]=new xn(!1,!1,!1));let Ye=!1,tt=!1,Ve=!0,gt=null,yt={box:null,offscreen:null},ot={box:null,offscreen:null},ut=null,vt=null,Kt=null,or=0,Wi=0,ar=0;Me.textFeatureIndex?or=Me.textFeatureIndex:be.useRuntimeCollisionCircles&&(or=be.featureIndex),Me.verticalTextFeatureIndex&&(Wi=Me.verticalTextFeatureIndex);const Vr=this.retainedQueryData[c.bucketInstanceId].tileID,Ni=this.terrain?(jt,rt)=>this.terrain.getElevation(Vr,jt,rt):null;for(const jt of["textBox","verticalTextBox","iconBox","verticalIconBox"]){const rt=Me[jt];rt&&(rt.elevation=Ni?Ni(rt.anchorPointX,rt.anchorPointY):0)}const bi=Me.textBox;if(bi){const jt=ft=>{let Yt=h.WritingMode.horizontal;if(c.allowVerticalPlacement&&!ft&&this.prevPlacement){const Jt=this.prevPlacement.placedOrientations[be.crossTileID];Jt&&(this.placedOrientations[be.crossTileID]=Jt,Yt=Jt,this.markUsedOrientation(c,Yt,be))}return Yt},rt=(ft,Yt)=>{if(c.allowVerticalPlacement&&be.numVerticalGlyphVertices>0&&Me.verticalTextBox){for(const Jt of c.writingModes)if(Jt===h.WritingMode.vertical?(yt=Yt(),ot=yt):yt=ft(),yt&&yt.box&&yt.box.length)break}else yt=ft()};if(d.get("text-variable-anchor")){let ft=d.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[be.crossTileID]){const kt=this.prevPlacement.variableOffsets[be.crossTileID];ft.indexOf(kt.anchor)>0&&(ft=ft.filter($i=>$i!==kt.anchor),ft.unshift(kt.anchor))}const Yt=(kt,$i,en)=>{const Ao=kt.x2-kt.x1,Dn=kt.y2-kt.y1,Pa=be.textBoxScale,zo=he&&ee==="never"?$i:null;let Nr={box:[],offscreen:!1};const tn=Z!=="never"?2*ft.length:ft.length;for(let rn=0;rn<tn;++rn){const Us=this.attemptAnchorPlacement(ft[rn%ft.length],kt,Ao,Dn,Pa,se,te,v,m,F,rn>=ft.length?Z:"never",be,c,en,zo,Ni);if(Us&&(Nr=Us.placedGlyphBoxes,Nr&&Nr.box&&Nr.box.length)){Ye=!0,gt=Us.shift;break}}return Nr};rt(()=>Yt(bi,Me.iconBox,h.WritingMode.horizontal),()=>{const kt=Me.verticalTextBox;return c.allowVerticalPlacement&&!(yt&&yt.box&&yt.box.length)&&be.numVerticalGlyphVertices>0&&kt?Yt(kt,Me.verticalIconBox,h.WritingMode.vertical):{box:null,offscreen:null}}),yt&&(Ye=yt.box,Ve=yt.offscreen);const Jt=jt(yt&&yt.box);if(!Ye&&this.prevPlacement){const kt=this.prevPlacement.variableOffsets[be.crossTileID];kt&&(this.variableOffsets[be.crossTileID]=kt,this.markUsedJustification(c,kt.anchor,be,Jt))}}else{const ft=(Yt,Jt)=>{const kt=this.collisionIndex.placeCollisionBox(Yt,Z,v,m,F.predicate,Ni);return kt&&kt.box&&kt.box.length&&(this.markUsedOrientation(c,Jt,be),this.placedOrientations[be.crossTileID]=Jt),kt};rt(()=>ft(bi,h.WritingMode.horizontal),()=>{const Yt=Me.verticalTextBox;return c.allowVerticalPlacement&&be.numVerticalGlyphVertices>0&&Yt?ft(Yt,h.WritingMode.vertical):{box:null,offscreen:null}}),jt(yt&&yt.box&&yt.box.length)}}if(ut=yt,Ye=ut&&ut.box&&ut.box.length>0,Ve=ut&&ut.offscreen,be.useRuntimeCollisionCircles){const jt=c.text.placedSymbolArray.get(be.centerJustifiedTextSymbolIndex),rt=h.evaluateSizeForFeature(c.textSizeData,z,jt),ft=d.get("text-padding");vt=this.collisionIndex.placeCollisionCircles(Z,jt,c.lineVertexArray,c.glyphOffsetArray,rt,m,y,_,o,te,F.predicate,be.collisionCircleDiameter,ft,Ni),vt.circles.length&&vt.collisionDetected&&!o&&h.warnOnce("Collisions detected, but collision boxes are not shown"),Ye=K||vt.circles.length>0&&!vt.collisionDetected,Ve=Ve&&vt.offscreen}if(Me.iconFeatureIndex&&(ar=Me.iconFeatureIndex),Me.iconBox){const jt=rt=>{const ft=he&&gt?Hr(rt,gt.x,gt.y,se,te,this.transform.angle):rt;return this.collisionIndex.placeCollisionBox(ft,ee,v,m,F.predicate,Ni)};ot&&ot.box&&ot.box.length&&Me.verticalIconBox?(Kt=jt(Me.verticalIconBox),tt=Kt.box.length>0):(Kt=jt(Me.iconBox),tt=Kt.box.length>0),Ve=Ve&&Kt.offscreen}const xr=B||be.numHorizontalGlyphVertices===0&&be.numVerticalGlyphVertices===0,Os=R||be.numIconVertices===0;if(xr||Os?Os?xr||(tt=tt&&Ye):Ye=tt&&Ye:tt=Ye=tt&&Ye,Ye&&ut&&ut.box&&this.collisionIndex.insertCollisionBox(ut.box,Z,d.get("text-ignore-placement"),c.bucketInstanceId,ot&&ot.box&&Wi?Wi:or,F.ID),tt&&Kt&&this.collisionIndex.insertCollisionBox(Kt.box,ee,d.get("icon-ignore-placement"),c.bucketInstanceId,ar,F.ID),vt&&(Ye&&this.collisionIndex.insertCollisionCircles(vt.circles,Z,d.get("text-ignore-placement"),c.bucketInstanceId,or,F.ID),o)){const jt=c.bucketInstanceId;let rt=this.collisionCircleArrays[jt];rt===void 0&&(rt=this.collisionCircleArrays[jt]=new rr);for(let ft=0;ft<vt.circles.length;ft+=4)rt.circles.push(vt.circles[ft+0]),rt.circles.push(vt.circles[ft+1]),rt.circles.push(vt.circles[ft+2]),rt.circles.push(vt.collisionDetected?1:0)}if(be.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(c.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[be.crossTileID]=new xn(Ye||ye,tt||ce,Ve||c.justReloaded),n[be.crossTileID]=!0};if(ue){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const be=c.getSortedSymbolIndexes(this.transform.angle);for(let Me=be.length-1;Me>=0;--Me){const Ye=be[Me];ze(c.symbolInstances.get(Ye),c.collisionArrays[Ye])}}else for(let be=t.symbolInstanceStart;be<t.symbolInstanceEnd;be++)ze(c.symbolInstances.get(be),c.collisionArrays[be]);if(o&&c.bucketInstanceId in this.collisionCircleArrays){const be=this.collisionCircleArrays[c.bucketInstanceId];h.invert(be.invProjMatrix,m),be.viewportMatrix=this.collisionIndex.getViewportMatrix()}c.justReloaded=!1}markUsedJustification(t,n,o,c){let d;d=c===h.WritingMode.vertical?o.verticalPlacedTextSymbolIndex:{left:o.leftJustifiedTextSymbolIndex,center:o.centerJustifiedTextSymbolIndex,right:o.rightJustifiedTextSymbolIndex}[h.getAnchorJustification(n)];const m=[o.leftJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.rightJustifiedTextSymbolIndex,o.verticalPlacedTextSymbolIndex];for(const y of m)y>=0&&(t.text.placedSymbolArray.get(y).crossTileID=d>=0&&y!==d?0:o.crossTileID)}markUsedOrientation(t,n,o){const c=n===h.WritingMode.horizontal||n===h.WritingMode.horizontalOnly?n:0,d=n===h.WritingMode.vertical?n:0,m=[o.leftJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.rightJustifiedTextSymbolIndex];for(const y of m)t.text.placedSymbolArray.get(y).placedOrientation=c;o.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(o.verticalPlacedTextSymbolIndex).placedOrientation=d)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const n=this.prevPlacement;let o=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;const c=n?n.symbolFadeChange(t):1,d=n?n.opacities:{},m=n?n.variableOffsets:{},y=n?n.placedOrientations:{};for(const _ in this.placements){const v=this.placements[_],T=d[_];T?(this.opacities[_]=new xt(T,c,v.text,v.icon),o=o||v.text!==T.text.placed||v.icon!==T.icon.placed):(this.opacities[_]=new xt(null,c,v.text,v.icon,v.skipFade),o=o||v.text||v.icon)}for(const _ in d){const v=d[_];if(!this.opacities[_]){const T=new xt(v,c,!1,!1);T.isHidden()||(this.opacities[_]=T,o=o||v.text.placed||v.icon.placed)}}for(const _ in m)this.variableOffsets[_]||!this.opacities[_]||this.opacities[_].isHidden()||(this.variableOffsets[_]=m[_]);for(const _ in y)this.placedOrientations[_]||!this.opacities[_]||this.opacities[_].isHidden()||(this.placedOrientations[_]=y[_]);if(n&&n.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");o?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:t)}updateLayerOpacities(t,n){const o={};for(const c of n){const d=c.getBucket(t);d&&c.latestFeatureIndex&&t.id===d.layerIds[0]&&this.updateBucketOpacities(d,o,c.collisionBoxArray)}}updateBucketOpacities(t,n,o){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const c=t.layers[0].layout,d=new xt(null,0,!1,!1,!0),m=c.get("text-allow-overlap"),y=c.get("icon-allow-overlap"),_=c.get("text-variable-anchor"),v=c.get("text-rotation-alignment")==="map",T=c.get("text-pitch-alignment")==="map",C=c.get("icon-text-fit")!=="none",z=new xt(null,0,m&&(y||!t.hasIconData()||c.get("icon-optional")),y&&(m||!t.hasTextData()||c.get("text-optional")),!0);!t.collisionArrays&&o&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(o);const F=(B,R,Z)=>{for(let K=0;K<R/4;K++)B.opacityVertexArray.emplaceBack(Z)};for(let B=0;B<t.symbolInstances.length;B++){const R=t.symbolInstances.get(B),{numHorizontalGlyphVertices:Z,numVerticalGlyphVertices:K,crossTileID:ee}=R;let U=this.opacities[ee];n[ee]?U=d:U||(U=z,this.opacities[ee]=U),n[ee]=!0;const se=R.numIconVertices>0,te=this.placedOrientations[R.crossTileID],he=te===h.WritingMode.vertical,ue=te===h.WritingMode.horizontal||te===h.WritingMode.horizontalOnly;if(Z>0||K>0){const ye=W(U.text);F(t.text,Z,he?le:ye),F(t.text,K,ue?le:ye);const ce=U.text.isHidden();[R.rightJustifiedTextSymbolIndex,R.centerJustifiedTextSymbolIndex,R.leftJustifiedTextSymbolIndex].forEach(Me=>{Me>=0&&(t.text.placedSymbolArray.get(Me).hidden=ce||he?1:0)}),R.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(R.verticalPlacedTextSymbolIndex).hidden=ce||ue?1:0);const ze=this.variableOffsets[R.crossTileID];ze&&this.markUsedJustification(t,ze.anchor,R,te);const be=this.placedOrientations[R.crossTileID];be&&(this.markUsedJustification(t,"left",R,be),this.markUsedOrientation(t,be,R))}if(se){const ye=W(U.icon),ce=!(C&&R.verticalPlacedIconSymbolIndex&&he);R.placedIconSymbolIndex>=0&&(F(t.icon,R.numIconVertices,ce?ye:le),t.icon.placedSymbolArray.get(R.placedIconSymbolIndex).hidden=U.icon.isHidden()),R.verticalPlacedIconSymbolIndex>=0&&(F(t.icon,R.numVerticalIconVertices,ce?le:ye),t.icon.placedSymbolArray.get(R.verticalPlacedIconSymbolIndex).hidden=U.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const ye=t.collisionArrays[B];if(ye){let ce=new h.pointGeometry(0,0);if(ye.textBox||ye.verticalTextBox){let be=!0;if(_){const Me=this.variableOffsets[ee];Me?(ce=vn(Me.anchor,Me.width,Me.height,Me.textOffset,Me.textBoxScale),v&&ce._rotate(T?this.transform.angle:-this.transform.angle)):be=!1}ye.textBox&&b(t.textCollisionBox.collisionVertexArray,U.text.placed,!be||he,ce.x,ce.y),ye.verticalTextBox&&b(t.textCollisionBox.collisionVertexArray,U.text.placed,!be||ue,ce.x,ce.y)}const ze=Boolean(!ue&&ye.verticalIconBox);ye.iconBox&&b(t.iconCollisionBox.collisionVertexArray,U.icon.placed,ze,C?ce.x:0,C?ce.y:0),ye.verticalIconBox&&b(t.iconCollisionBox.collisionVertexArray,U.icon.placed,!ze,C?ce.x:0,C?ce.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const B=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=B.invProjMatrix,t.placementViewportMatrix=B.viewportMatrix,t.collisionCircleArray=B.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,n){const o=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*o>t}setStale(){this.stale=!0}}function b(a,t,n,o,c){a.emplaceBack(t?1:0,n?1:0,o||0,c||0),a.emplaceBack(t?1:0,n?1:0,o||0,c||0),a.emplaceBack(t?1:0,n?1:0,o||0,c||0),a.emplaceBack(t?1:0,n?1:0,o||0,c||0)}const S=Math.pow(2,25),P=Math.pow(2,24),D=Math.pow(2,17),$=Math.pow(2,16),H=Math.pow(2,9),j=Math.pow(2,8),G=Math.pow(2,1);function W(a){if(a.opacity===0&&!a.placed)return 0;if(a.opacity===1&&a.placed)return 4294967295;const t=a.placed?1:0,n=Math.floor(127*a.opacity);return n*S+t*P+n*D+t*$+n*H+t*j+n*G+t}const le=0;class ge{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,n,o,c,d){const m=this._bucketParts;for(;this._currentTileIndex<t.length;)if(n.getBucketParts(m,c,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,d())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,m.sort((y,_)=>y.sortKey-_.sortKey));this._currentPartIndex<m.length;)if(n.placeLayerBucketPart(m[this._currentPartIndex],this._seenCrossTileIDs,o),this._currentPartIndex++,d())return!0;return!1}}class ae{constructor(t,n,o,c,d,m,y,_){this.placement=new L(t,n,m,y,_),this._currentPlacementIndex=o.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=d,this._done=!1}isDone(){return this._done}continuePlacement(t,n,o){const c=h.exported.now(),d=()=>{const m=h.exported.now()-c;return!this._forceFullPlacement&&m>2};for(;this._currentPlacementIndex>=0;){const m=n[t[this._currentPlacementIndex]],y=this.placement.collisionIndex.transform.zoom;if(m.type==="symbol"&&(!m.minzoom||m.minzoom<=y)&&(!m.maxzoom||m.maxzoom>y)){if(this._inProgressLayer||(this._inProgressLayer=new ge(m)),this._inProgressLayer.continuePlacement(o[m.source],this.placement,this._showCollisionBoxes,m,d))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Le=512/h.EXTENT/2;class Fe{constructor(t,n,o){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=o;for(let c=0;c<n.length;c++){const d=n.get(c),m=d.key;this.indexedSymbolInstances[m]||(this.indexedSymbolInstances[m]=[]),this.indexedSymbolInstances[m].push({crossTileID:d.crossTileID,coord:this.getScaledCoordinates(d,t)})}}getScaledCoordinates(t,n){const o=Le/Math.pow(2,n.canonical.z-this.tileID.canonical.z);return{x:Math.floor((n.canonical.x*h.EXTENT+t.anchorX)*o),y:Math.floor((n.canonical.y*h.EXTENT+t.anchorY)*o)}}findMatches(t,n,o){const c=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z);for(let d=0;d<t.length;d++){const m=t.get(d);if(m.crossTileID)continue;const y=this.indexedSymbolInstances[m.key];if(!y)continue;const _=this.getScaledCoordinates(m,n);for(const v of y)if(Math.abs(v.coord.x-_.x)<=c&&Math.abs(v.coord.y-_.y)<=c&&!o[v.crossTileID]){o[v.crossTileID]=!0,m.crossTileID=v.crossTileID;break}}}}class Ae{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class $e{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const n=Math.round((t-this.lng)/360);if(n!==0)for(const o in this.indexes){const c=this.indexes[o],d={};for(const m in c){const y=c[m];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+n),d[y.tileID.key]=y}this.indexes[o]=d}this.lng=t}addBucket(t,n,o){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let d=0;d<n.symbolInstances.length;d++)n.symbolInstances.get(d).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const c=this.usedCrossTileIDs[t.overscaledZ];for(const d in this.indexes){const m=this.indexes[d];if(Number(d)>t.overscaledZ)for(const y in m){const _=m[y];_.tileID.isChildOf(t)&&_.findMatches(n.symbolInstances,t,c)}else{const y=m[t.scaledTo(Number(d)).key];y&&y.findMatches(n.symbolInstances,t,c)}}for(let d=0;d<n.symbolInstances.length;d++){const m=n.symbolInstances.get(d);m.crossTileID||(m.crossTileID=o.generate(),c[m.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Fe(t,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(t,n){for(const o in n.indexedSymbolInstances)for(const c of n.indexedSymbolInstances[o])delete this.usedCrossTileIDs[t][c.crossTileID]}removeStaleBuckets(t){let n=!1;for(const o in this.indexes){const c=this.indexes[o];for(const d in c)t[c[d].bucketInstanceId]||(this.removeBucketCrossTileIDs(o,c[d]),delete c[d],n=!0)}return n}}class qe{constructor(){this.layerIndexes={},this.crossTileIDs=new Ae,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,n,o){let c=this.layerIndexes[t.id];c===void 0&&(c=this.layerIndexes[t.id]=new $e);let d=!1;const m={};c.handleWrapJump(o);for(const y of n){const _=y.getBucket(t);_&&t.id===_.layerIds[0]&&(_.bucketInstanceId||(_.bucketInstanceId=++this.maxBucketInstanceId),c.addBucket(y.tileID,_,this.crossTileIDs)&&(d=!0),m[_.bucketInstanceId]=!0)}return c.removeStaleBuckets(m)&&(d=!0),d}pruneUnusedLayers(t){const n={};t.forEach(o=>{n[o]=!0});for(const o in this.layerIndexes)n[o]||delete this.layerIndexes[o]}}var ct=h.createLayout([{name:"a_pos",type:"Int16",components:2}]);class Xe extends h.Evented{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.renderHistory=[],this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,this.renderHistorySize=t._cache.max,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null;for(const t in this._tiles){const n=this._tiles[t];n.textures.forEach(o=>o.destroy()),n.textures=[]}}update(t,n){this.sourceCache.update(t,n),this._renderableTilesKeys=[];for(const o of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:n}))this._renderableTilesKeys.push(o.key),this._tiles[o.key]||(o.posMatrix=new Float64Array(16),h.ortho(o.posMatrix,0,h.EXTENT,0,h.EXTENT,0,1),this._tiles[o.key]=new Sr(o,this.tileSize))}removeOutdated(t){const n={};this.renderHistory=this.renderHistory.filter((o,c)=>this.renderHistory.indexOf(o)===c).slice(0,this.renderHistorySize);for(const o of this._renderableTilesKeys)n[o]=!0;for(const o of this.renderHistory)n[o]=!0;for(const o in this._tiles)n[o]||(this._tiles[o].clearTextures(t),delete this._tiles[o])}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const n={};for(const o of this._renderableTilesKeys){const c=this._tiles[o].tileID;if(c.canonical.equals(t.canonical)){const d=t.clone();d.posMatrix=new Float64Array(16),h.ortho(d.posMatrix,0,h.EXTENT,0,h.EXTENT,0,1),n[o]=d}else if(c.canonical.isChildOf(t.canonical)){const d=t.clone();d.posMatrix=new Float64Array(16);const m=c.canonical.z-t.canonical.z,y=c.canonical.x-(c.canonical.x>>m<<m),_=c.canonical.y-(c.canonical.y>>m<<m),v=h.EXTENT>>m;h.ortho(d.posMatrix,0,v,0,v,0,1),h.translate(d.posMatrix,d.posMatrix,[-y*v,-_*v,0]),n[o]=d}else if(t.canonical.isChildOf(c.canonical)){const d=t.clone();d.posMatrix=new Float64Array(16);const m=t.canonical.z-c.canonical.z,y=t.canonical.x-(t.canonical.x>>m<<m),_=t.canonical.y-(t.canonical.y>>m<<m),v=h.EXTENT>>m;h.ortho(d.posMatrix,0,h.EXTENT,0,h.EXTENT,0,1),h.translate(d.posMatrix,d.posMatrix,[y*v,_*v,0]),h.scale(d.posMatrix,d.posMatrix,[1/2**m,1/2**m,0]),n[o]=d}}return n}getSourceTile(t,n){const o=this.sourceCache._source;let c=t.overscaledZ-this.deltaZoom;if(c>o.maxzoom&&(c=o.maxzoom),c<o.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(c).key);let d=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!d||!d.dem)&&n)for(;c>=o.minzoom&&(!d||!d.dem);)d=this.sourceCache.getTileByID(t.scaledTo(c--).key);return d}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(n=>n.timeLoaded>=t)}}class et{constructor(t,n,o){this.style=t,this.sourceCache=new Xe(n),this.options=o,this.exaggeration=typeof o.exaggeration=="number"?o.exaggeration:1,this.elevationOffset=typeof o.elevationOffset=="number"?o.elevationOffset:450,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024,this.clearRerenderCache()}getDEMElevation(t,n,o,c=h.EXTENT){if(!(n>=0&&n<c&&o>=0&&o<c))return this.elevationOffset;let d=0;const m=this.getTerrainData(t);if(m.tile&&m.tile.dem){const y=h.transformMat4$1([],[n/c*h.EXTENT,o/c*h.EXTENT],m.u_terrain_matrix),_=[y[0]*m.tile.dem.dim,y[1]*m.tile.dem.dim],v=[Math.floor(_[0]),Math.floor(_[1])],T=m.tile.dem.get(v[0],v[1]),C=m.tile.dem.get(v[0],v[1]+1),z=m.tile.dem.get(v[0]+1,v[1]),F=m.tile.dem.get(v[0]+1,v[1]+1);d=h.number(h.number(T,C,_[0]-v[0]),h.number(z,F,_[0]-v[0]),_[1]-v[1])}return d}rememberForRerender(t,n){for(const o in this.sourceCache._tiles){const c=this.sourceCache._tiles[o];(c.tileID.equals(n)||c.tileID.isChildOf(n))&&(t===this.sourceCache.sourceCache.id&&(c.timeLoaded=Date.now()),this._rerender[t]=this._rerender[t]||{},this._rerender[t][c.tileID.key]=!0)}}needsRerender(t,n){return this._rerender[t]&&this._rerender[t][n.key]}clearRerenderCache(){this._rerender={}}getElevation(t,n,o,c=h.EXTENT){return(this.getDEMElevation(t,n,o,c)+this.elevationOffset)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const c=this.style.map.painter.context,d=new h.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new dt(c,d,c.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new dt(c,new h.RGBAImage({width:1,height:1}),c.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=h.identity([])}const n=this.sourceCache.getSourceTile(t,!0);if(n&&n.dem&&(!n.demTexture||n.needsTerrainPrepare)){const c=this.style.map.painter.context;n.demTexture=this.style.map.painter.getTileTexture(n.dem.stride),n.demTexture?n.demTexture.update(n.dem.getPixels(),{premultiply:!1}):n.demTexture=new dt(c,n.dem.getPixels(),c.gl.RGBA,{premultiply:!1}),n.demTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),n.needsTerrainPrepare=!1}const o=n&&n+n.tileID.key+t.key;if(o&&!this._demMatrixCache[o]){const c=this.sourceCache.sourceCache._source.maxzoom;let d=t.canonical.z-n.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=c?d=t.canonical.z-c:h.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const m=t.canonical.x-(t.canonical.x>>d<<d),y=t.canonical.y-(t.canonical.y>>d<<d),_=h.fromScaling(new Float64Array(16),[1/(h.EXTENT<<d),1/(h.EXTENT<<d),0]);h.translate(_,_,[m*h.EXTENT,y*h.EXTENT,0]),this._demMatrixCache[t.key]={matrix:_,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:n&&n.dem&&n.dem.dim||1,u_terrain_matrix:o?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:n&&n.dem&&n.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_offset:this.elevationOffset,u_terrain_exaggeration:this.exaggeration,texture:(n&&n.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:n}}getRTTFramebuffer(){const t=this.style.map.painter;if(!this._rttFramebuffer){const n=this.sourceCache.tileSize*this.qualityFactor;this._rttFramebuffer=t.context.createFramebuffer(n,n,!0),this._rttFramebuffer.depthAttachment.set(t.context.createRenderbuffer(t.context.gl.DEPTH_COMPONENT16,n,n))}return this._rttFramebuffer}getFramebuffer(t){const n=this.style.map.painter,o=n.width/devicePixelRatio,c=n.height/devicePixelRatio;return!this._fbo||this._fbo.width===o&&this._fbo.height===c||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new dt(n.context,{width:o,height:c,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new dt(n.context,{width:o,height:c,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=n.context.createFramebuffer(o,c,!0),this._fbo.depthAttachment.set(n.context.createRenderbuffer(n.context.gl.DEPTH_COMPONENT16,o,c))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.style.map.painter.context;if(this._coordsTexture)return this._coordsTexture;const n=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let d=0,m=0;d<this._coordsTextureSize;d++)for(let y=0;y<this._coordsTextureSize;y++,m+=4)n[m+0]=255&y,n[m+1]=255&d,n[m+2]=y>>8<<4|d>>8,n[m+3]=0;const o=new h.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(n.buffer)),c=new dt(t,o,t.gl.RGBA,{premultiply:!1});return c.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=c,c}pointCoordinate(t){const n=new Uint8Array(4),o=this.style.map.painter,c=o.context,d=c.gl;c.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),d.readPixels(t.x,o.height/devicePixelRatio-t.y-1,1,1,d.RGBA,d.UNSIGNED_BYTE,n),c.bindFramebuffer.set(null);const m=n[0]+(n[2]>>4<<8),y=n[1]+((15&n[2])<<8),_=this.coordsIndex[255-n[3]],v=_&&this.sourceCache.getTileByID(_);if(!v)return null;const T=this._coordsTextureSize,C=(1<<v.tileID.canonical.z)*T;return new h.MercatorCoordinate((v.tileID.canonical.x*T+m)/C,(v.tileID.canonical.y*T+y)/C,this.getElevation(v.tileID,m,y,T))}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.style.map.painter.context,n=new h.PosArray,o=new h.TriangleIndexArray,c=this.meshSize,d=h.EXTENT/c,m=c*c;for(let y=0;y<=c;y++)for(let _=0;_<=c;_++)n.emplaceBack(_*d,y*d);for(let y=0;y<m;y+=c+1)for(let _=0;_<c;_++)o.emplaceBack(_+y,c+_+y+1,c+_+y+2),o.emplaceBack(_+y,c+_+y+2,_+y+1);return this._mesh={indexBuffer:t.createIndexBuffer(o),vertexBuffer:t.createVertexBuffer(n,ct.members),segments:h.SegmentVector.simpleSegment(0,0,n.length,o.length)},this._mesh}getMinMaxElevation(t){const n=this.getTerrainData(t).tile,o={minElevation:null,maxElevation:null};return n&&n.dem&&(o.minElevation=(n.dem.min+this.elevationOffset)*this.exaggeration,o.maxElevation=(n.dem.max+this.elevationOffset)*this.exaggeration),o}}const ht=(a,t)=>h.emitValidationErrors(a,t&&t.filter(n=>n.identifier!=="source.canvas")),bt=h.pick(at,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Wt=h.pick(at,["setCenter","setZoom","setBearing","setPitch"]),Ct=function(){const a={},t=h.spec.$version;for(const n in h.spec.$root){const o=h.spec.$root[n];if(o.required){let c=null;c=n==="version"?t:o.type==="array"?[]:{},c!=null&&(a[n]=c)}}return a}();class ai extends h.Evented{constructor(t,n={}){super(),this.map=t,this.dispatcher=new qi(fn(),this),this.imageManager=new ti,this.imageManager.setEventedParent(this),this.glyphManager=new Rt(t._requestManager,n.localIdeographFontFamily),this.lineAtlas=new hn(256,512),this.crossTileSymbolIndex=new qe,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new h.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",h.getReferrer());const o=this;this._rtlTextPluginCallback=ai.registerForPluginStateChange(c=>{o.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:c.pluginStatus,pluginURL:c.pluginURL},(d,m)=>{if(h.triggerPluginCompletionEvent(d),m&&m.every(y=>y))for(const y in o.sourceCaches)o.sourceCaches[y].reload()})}),this.on("data",c=>{if(c.dataType!=="source"||c.sourceDataType!=="metadata")return;const d=this.sourceCaches[c.sourceId];if(!d)return;const m=d.getSource();if(m&&m.vectorLayerIds)for(const y in this._layers){const _=this._layers[y];_.source===m.id&&this._validateLayer(_)}})}loadURL(t,n={}){this.fire(new h.Event("dataloading",{dataType:"style"}));const o=typeof n.validate!="boolean"||n.validate,c=this.map._requestManager.transformRequest(t,h.ResourceType.Style);this._request=h.getJSON(c,(d,m)=>{this._request=null,d?this.fire(new h.ErrorEvent(d)):m&&this._load(m,o)})}loadJSON(t,n={}){this.fire(new h.Event("dataloading",{dataType:"style"})),this._request=h.exported.frame(()=>{this._request=null,this._load(t,n.validate!==!1)})}loadEmpty(){this.fire(new h.Event("dataloading",{dataType:"style"})),this._load(Ct,!1)}_load(t,n){if(n&&ht(this,h.validateStyle(t)))return;this._loaded=!0,this.stylesheet=t;for(const c in t.sources)this.addSource(c,t.sources[c],{validate:!1});t.sprite?this._loadSprite(t.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(t.glyphs);const o=$n(this.stylesheet.layers);this._order=o.map(c=>c.id),this._layers={},this._serializedLayers={};for(let c of o)c=h.createStyleLayer(c),c.setEventedParent(this,{layer:{id:c.id}}),this._layers[c.id]=c,this._serializedLayers[c.id]=c.serialize();this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new di(this.stylesheet.light),this.setTerrain(this.stylesheet.terrain),this.fire(new h.Event("data",{dataType:"style"})),this.fire(new h.Event("style.load"))}_loadSprite(t){this._spriteRequest=function(n,o,c,d){let m,y,_;const v=c>1?"@2x":"";let T=h.getJSON(o.transformRequest(o.normalizeSpriteURL(n,v,".json"),h.ResourceType.SpriteJSON),(F,B)=>{T=null,_||(_=F,m=B,z())}),C=h.getImage(o.transformRequest(o.normalizeSpriteURL(n,v,".png"),h.ResourceType.SpriteImage),(F,B)=>{C=null,_||(_=F,y=B,z())});function z(){if(_)d(_);else if(m&&y){const F=h.exported.getImageData(y),B={};for(const R in m){const{width:Z,height:K,x:ee,y:U,sdf:se,pixelRatio:te,stretchX:he,stretchY:ue,content:ye}=m[R],ce=new h.RGBAImage({width:Z,height:K});h.RGBAImage.copy(F,ce,{x:ee,y:U},{x:0,y:0},{width:Z,height:K}),B[R]={data:ce,pixelRatio:te,sdf:se,stretchX:he,stretchY:ue,content:ye}}d(null,B)}}return{cancel(){T&&(T.cancel(),T=null),C&&(C.cancel(),C=null)}}}(t,this.map._requestManager,this.map.getPixelRatio(),(n,o)=>{if(this._spriteRequest=null,n)this.fire(new h.ErrorEvent(n));else if(o)for(const c in o)this.imageManager.addImage(c,o[c]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new h.Event("data",{dataType:"style"}))})}_validateLayer(t){const n=this.sourceCaches[t.source];if(!n)return;const o=t.sourceLayer;if(!o)return;const c=n.getSource();(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(o)===-1)&&this.fire(new h.ErrorEvent(new Error(`Source layer "${o}" does not exist on source "${c.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(t){const n=[];for(const o of t){const c=this._layers[o];c.type!=="custom"&&n.push(c.serialize())}return n}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const n=this._changed;if(this._changed){const c=Object.keys(this._updatedLayers),d=Object.keys(this._removedLayers);(c.length||d.length)&&this._updateWorkerLayers(c,d);for(const m in this._updatedSources){const y=this._updatedSources[m];if(y==="reload")this._reloadSource(m);else{if(y!=="clear")throw new Error(`Invalid action ${y}`);this._clearSource(m)}}this._updateTilesForChangedImages();for(const m in this._updatedPaintProps)this._layers[m].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}const o={};for(const c in this.sourceCaches){const d=this.sourceCaches[c];o[c]=d.used,d.used=!1}for(const c of this._order){const d=this._layers[c];d.recalculate(t,this._availableImages),!d.isHidden(t.zoom)&&d.source&&(this.sourceCaches[d.source].used=!0)}for(const c in o){const d=this.sourceCaches[c];o[c]!==d.used&&d.fire(new h.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:c}))}this.light.recalculate(t),this.z=t.zoom,n&&this.fire(new h.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const n in this.sourceCaches)this.sourceCaches[n].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateWorkerLayers(t,n){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:n})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setTerrain(t){if(this._checkLoaded(),this._terrainDataCallback&&this.off("data",this._terrainDataCallback),this._terrainfreezeElevationCallback&&this.map.off("freezeElevation",this._terrainfreezeElevationCallback),t){const n=this.sourceCaches[t.source];if(!n)throw new Error(`cannot load terrain, because there exists no source with ID: ${t.source}`);this.terrain=new et(this,n,t),this.map.transform.updateElevation(this.terrain),this._terrainfreezeElevationCallback=o=>{o.freeze?this.map.transform.freezeElevation=!0:(this.map.transform.freezeElevation=!1,this.map.transform.recalculateZoom(this.terrain))},this._terrainDataCallback=o=>{o.tile&&(o.sourceId===t.source?(this.map.transform.updateElevation(this.terrain),this.terrain.rememberForRerender(o.sourceId,o.tile.tileID)):o.source.type==="geojson"&&this.terrain.rememberForRerender(o.sourceId,o.tile.tileID))},this.on("data",this._terrainDataCallback),this.map.on("freezeElevation",this._terrainfreezeElevationCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.map.transform.updateElevation(this.terrain);this.map.fire(new h.Event("terrain",{terrain:t}))}setState(t){if(this._checkLoaded(),ht(this,h.validateStyle(t)))return!1;(t=h.clone$1(t)).layers=$n(t.layers);const n=function(c,d){if(!c)return[{command:at.setStyle,args:[d]}];let m=[];try{if(!Re(c.version,d.version))return[{command:at.setStyle,args:[d]}];Re(c.center,d.center)||m.push({command:at.setCenter,args:[d.center]}),Re(c.zoom,d.zoom)||m.push({command:at.setZoom,args:[d.zoom]}),Re(c.bearing,d.bearing)||m.push({command:at.setBearing,args:[d.bearing]}),Re(c.pitch,d.pitch)||m.push({command:at.setPitch,args:[d.pitch]}),Re(c.sprite,d.sprite)||m.push({command:at.setSprite,args:[d.sprite]}),Re(c.glyphs,d.glyphs)||m.push({command:at.setGlyphs,args:[d.glyphs]}),Re(c.transition,d.transition)||m.push({command:at.setTransition,args:[d.transition]}),Re(c.light,d.light)||m.push({command:at.setLight,args:[d.light]});const y={},_=[];(function(T,C,z,F){let B;for(B in C=C||{},T=T||{})Object.prototype.hasOwnProperty.call(T,B)&&(Object.prototype.hasOwnProperty.call(C,B)||Mr(B,z,F));for(B in C)Object.prototype.hasOwnProperty.call(C,B)&&(Object.prototype.hasOwnProperty.call(T,B)?Re(T[B],C[B])||(T[B].type==="geojson"&&C[B].type==="geojson"&&Gn(T,C,B)?z.push({command:at.setGeoJSONSourceData,args:[B,C[B].data]}):kr(B,C,z,F)):ir(B,C,z))})(c.sources,d.sources,_,y);const v=[];c.layers&&c.layers.forEach(T=>{y[T.source]?m.push({command:at.removeLayer,args:[T.id]}):v.push(T)}),m=m.concat(_),function(T,C,z){C=C||[];const F=(T=T||[]).map(mr),B=C.map(mr),R=T.reduce(yn,{}),Z=C.reduce(yn,{}),K=F.slice(),ee=Object.create(null);let U,se,te,he,ue,ye,ce;for(U=0,se=0;U<F.length;U++)te=F[U],Object.prototype.hasOwnProperty.call(Z,te)?se++:(z.push({command:at.removeLayer,args:[te]}),K.splice(K.indexOf(te,se),1));for(U=0,se=0;U<B.length;U++)te=B[B.length-1-U],K[K.length-1-U]!==te&&(Object.prototype.hasOwnProperty.call(R,te)?(z.push({command:at.removeLayer,args:[te]}),K.splice(K.lastIndexOf(te,K.length-se),1)):se++,ye=K[K.length-U],z.push({command:at.addLayer,args:[Z[te],ye]}),K.splice(K.length-U,0,te),ee[te]=!0);for(U=0;U<B.length;U++)if(te=B[U],he=R[te],ue=Z[te],!ee[te]&&!Re(he,ue))if(Re(he.source,ue.source)&&Re(he["source-layer"],ue["source-layer"])&&Re(he.type,ue.type)){for(ce in pr(he.layout,ue.layout,z,te,null,at.setLayoutProperty),pr(he.paint,ue.paint,z,te,null,at.setPaintProperty),Re(he.filter,ue.filter)||z.push({command:at.setFilter,args:[te,ue.filter]}),Re(he.minzoom,ue.minzoom)&&Re(he.maxzoom,ue.maxzoom)||z.push({command:at.setLayerZoomRange,args:[te,ue.minzoom,ue.maxzoom]}),he)Object.prototype.hasOwnProperty.call(he,ce)&&ce!=="layout"&&ce!=="paint"&&ce!=="filter"&&ce!=="metadata"&&ce!=="minzoom"&&ce!=="maxzoom"&&(ce.indexOf("paint.")===0?pr(he[ce],ue[ce],z,te,ce.slice(6),at.setPaintProperty):Re(he[ce],ue[ce])||z.push({command:at.setLayerProperty,args:[te,ce,ue[ce]]}));for(ce in ue)Object.prototype.hasOwnProperty.call(ue,ce)&&!Object.prototype.hasOwnProperty.call(he,ce)&&ce!=="layout"&&ce!=="paint"&&ce!=="filter"&&ce!=="metadata"&&ce!=="minzoom"&&ce!=="maxzoom"&&(ce.indexOf("paint.")===0?pr(he[ce],ue[ce],z,te,ce.slice(6),at.setPaintProperty):Re(he[ce],ue[ce])||z.push({command:at.setLayerProperty,args:[te,ce,ue[ce]]}))}else z.push({command:at.removeLayer,args:[te]}),ye=K[K.lastIndexOf(te)+1],z.push({command:at.addLayer,args:[ue,ye]})}(v,d.layers,m)}catch(y){console.warn("Unable to compute style diff:",y),m=[{command:at.setStyle,args:[d]}]}return m}(this.serialize(),t).filter(c=>!(c.command in Wt));if(n.length===0)return!1;const o=n.filter(c=>!(c.command in bt));if(o.length>0)throw new Error(`Unimplemented: ${o.map(c=>c.command).join(", ")}.`);return n.forEach(c=>{c.command!=="setTransition"&&this[c.command].apply(this,c.args)}),this.stylesheet=t,!0}addImage(t,n){if(this.getImage(t))return this.fire(new h.ErrorEvent(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,n),this._afterImageUpdated(t)}updateImage(t,n){this.imageManager.updateImage(t,n)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new h.ErrorEvent(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new h.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,n,o={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(h.validateStyle.source,`sources.${t}`,n,null,o))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const c=this.sourceCaches[t]=new xi(t,n,this.dispatcher);c.style=this,c.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:c.serialize(),sourceId:t})),c.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const o in this._layers)if(this._layers[o].source===t)return this.fire(new h.ErrorEvent(new Error(`Source "${t}" cannot be removed while layer "${o}" is using it.`)));const n=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],n.fire(new h.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),n.setEventedParent(null),n.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,n){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const o=this.sourceCaches[t].getSource();if(o.type!=="geojson")throw new Error(`geojsonSource.type is ${o.type}, which is !== 'geojson`);o.setData(n),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,n,o={}){this._checkLoaded();const c=t.id;if(this.getLayer(c))return void this.fire(new h.ErrorEvent(new Error(`Layer "${c}" already exists on this map.`)));let d;if(t.type==="custom"){if(ht(this,h.validateCustomStyleLayer(t)))return;d=h.createStyleLayer(t)}else{if(typeof t.source=="object"&&(this.addSource(c,t.source),t=h.clone$1(t),t=h.extend(t,{source:c})),this._validate(h.validateStyle.layer,`layers.${c}`,t,{arrayIndex:-1},o))return;d=h.createStyleLayer(t),this._validateLayer(d),d.setEventedParent(this,{layer:{id:c}}),this._serializedLayers[d.id]=d.serialize()}const m=n?this._order.indexOf(n):this._order.length;if(n&&m===-1)this.fire(new h.ErrorEvent(new Error(`Cannot add layer "${c}" before non-existing layer "${n}".`)));else{if(this._order.splice(m,0,c),this._layerOrderChanged=!0,this._layers[c]=d,this._removedLayers[c]&&d.source&&d.type!=="custom"){const y=this._removedLayers[c];delete this._removedLayers[c],y.type!==d.type?this._updatedSources[d.source]="clear":(this._updatedSources[d.source]="reload",this.sourceCaches[d.source].pause())}this._updateLayer(d),d.onAdd&&d.onAdd(this.map)}}moveLayer(t,n){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new h.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===n)return;const o=this._order.indexOf(t);this._order.splice(o,1);const c=n?this._order.indexOf(n):this._order.length;n&&c===-1?this.fire(new h.ErrorEvent(new Error(`Cannot move layer "${t}" before non-existing layer "${n}".`))):(this._order.splice(c,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const n=this._layers[t];if(!n)return void this.fire(new h.ErrorEvent(new Error(`Cannot remove non-existing layer "${t}".`)));n.setEventedParent(null);const o=this._order.indexOf(t);this._order.splice(o,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=n,delete this._layers[t],delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],n.onRemove&&n.onRemove(this.map)}getLayer(t){return this._layers[t]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,n,o){this._checkLoaded();const c=this.getLayer(t);c?c.minzoom===n&&c.maxzoom===o||(n!=null&&(c.minzoom=n),o!=null&&(c.maxzoom=o),this._updateLayer(c)):this.fire(new h.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,n,o={}){this._checkLoaded();const c=this.getLayer(t);if(c){if(!Re(c.filter,n))return n==null?(c.filter=void 0,void this._updateLayer(c)):void(this._validate(h.validateStyle.filter,`layers.${c.id}.filter`,n,null,o)||(c.filter=h.clone$1(n),this._updateLayer(c)))}else this.fire(new h.ErrorEvent(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return h.clone$1(this.getLayer(t).filter)}setLayoutProperty(t,n,o,c={}){this._checkLoaded();const d=this.getLayer(t);d?Re(d.getLayoutProperty(n),o)||(d.setLayoutProperty(n,o,c),this._updateLayer(d)):this.fire(new h.ErrorEvent(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,n){const o=this.getLayer(t);if(o)return o.getLayoutProperty(n);this.fire(new h.ErrorEvent(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,n,o,c={}){this._checkLoaded();const d=this.getLayer(t);d?Re(d.getPaintProperty(n),o)||(d.setPaintProperty(n,o,c)&&this._updateLayer(d),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new h.ErrorEvent(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,n){return this.getLayer(t).getPaintProperty(n)}setFeatureState(t,n){this._checkLoaded();const o=t.source,c=t.sourceLayer,d=this.sourceCaches[o];if(d===void 0)return void this.fire(new h.ErrorEvent(new Error(`The source '${o}' does not exist in the map's style.`)));const m=d.getSource().type;m==="geojson"&&c?this.fire(new h.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):m!=="vector"||c?(t.id===void 0&&this.fire(new h.ErrorEvent(new Error("The feature id parameter must be provided."))),d.setFeatureState(c,t.id,n)):this.fire(new h.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,n){this._checkLoaded();const o=t.source,c=this.sourceCaches[o];if(c===void 0)return void this.fire(new h.ErrorEvent(new Error(`The source '${o}' does not exist in the map's style.`)));const d=c.getSource().type,m=d==="vector"?t.sourceLayer:void 0;d!=="vector"||m?n&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new h.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):c.removeFeatureState(m,t.id,n):this.fire(new h.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const n=t.source,o=t.sourceLayer,c=this.sourceCaches[n];if(c!==void 0)return c.getSource().type!=="vector"||o?(t.id===void 0&&this.fire(new h.ErrorEvent(new Error("The feature id parameter must be provided."))),c.getFeatureState(o,t.id)):void this.fire(new h.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new h.ErrorEvent(new Error(`The source '${n}' does not exist in the map's style.`)))}getTransition(){return h.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){return h.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:h.mapObject(this.sourceCaches,t=>t.serialize()),layers:this._serializeLayers(this._order)},t=>t!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._changed=!0}_flattenAndSortRenderedFeatures(t){const n=m=>this._layers[m].type==="fill-extrusion",o={},c=[];for(let m=this._order.length-1;m>=0;m--){const y=this._order[m];if(n(y)){o[y]=m;for(const _ of t){const v=_[y];if(v)for(const T of v)c.push(T)}}}c.sort((m,y)=>y.intersectionZ-m.intersectionZ);const d=[];for(let m=this._order.length-1;m>=0;m--){const y=this._order[m];if(n(y))for(let _=c.length-1;_>=0;_--){const v=c[_].feature;if(o[v.layer.id]<m)break;d.push(v),c.pop()}else for(const _ of t){const v=_[y];if(v)for(const T of v)d.push(T.feature)}}return d}queryRenderedFeatures(t,n,o){n&&n.filter&&this._validate(h.validateStyle.filter,"queryRenderedFeatures.filter",n.filter,null,n);const c={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new h.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const m of n.layers){const y=this._layers[m];if(!y)return this.fire(new h.ErrorEvent(new Error(`The layer '${m}' does not exist in the map's style and cannot be queried for features.`))),[];c[y.source]=!0}}const d=[];n.availableImages=this._availableImages;for(const m in this.sourceCaches)n.layers&&!c[m]||d.push(pn(this.sourceCaches[m],this._layers,this._serializedLayers,t,n,o));return this.placement&&d.push(function(m,y,_,v,T,C,z){const F={},B=C.queryRenderedSymbols(v),R=[];for(const Z of Object.keys(B).map(Number))R.push(z[Z]);R.sort(tr);for(const Z of R){const K=Z.featureIndex.lookupSymbolFeatures(B[Z.bucketInstanceId],y,Z.bucketIndex,Z.sourceLayerIndex,T.filter,T.layers,T.availableImages,m);for(const ee in K){const U=F[ee]=F[ee]||[],se=K[ee];se.sort((te,he)=>{const ue=Z.featureSortOrder;if(ue){const ye=ue.indexOf(te.featureIndex);return ue.indexOf(he.featureIndex)-ye}return he.featureIndex-te.featureIndex});for(const te of se)U.push(te)}}for(const Z in F)F[Z].forEach(K=>{const ee=K.feature,U=_[m[Z].source].getFeatureState(ee.layer["source-layer"],ee.id);ee.source=ee.layer.source,ee.layer["source-layer"]&&(ee.sourceLayer=ee.layer["source-layer"]),ee.state=U});return F}(this._layers,this._serializedLayers,this.sourceCaches,t,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(d)}querySourceFeatures(t,n){n&&n.filter&&this._validate(h.validateStyle.filter,"querySourceFeatures.filter",n.filter,null,n);const o=this.sourceCaches[t];return o?function(c,d){const m=c.getRenderableIds().map(v=>c.getTileByID(v)),y=[],_={};for(let v=0;v<m.length;v++){const T=m[v],C=T.tileID.canonical.key;_[C]||(_[C]=!0,T.querySourceFeatures(y,d))}return y}(o,n):[]}addSourceType(t,n,o){return ai.getSourceType(t)?o(new Error(`A source type called "${t}" already exists.`)):(ai.setSourceType(t,n),n.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:n.workerSourceURL},o):o(null,null))}getLight(){return this.light.getLight()}setLight(t,n={}){this._checkLoaded();const o=this.light.getLight();let c=!1;for(const m in t)if(!Re(t[m],o[m])){c=!0;break}if(!c)return;const d={now:h.exported.now(),transition:h.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,n),this.light.updateTransitions(d)}_validate(t,n,o,c,d={}){return(!d||d.validate!==!1)&&ht(this,t.call(h.validateStyle,h.extend({key:n,style:this.serialize(),value:o,styleSpec:h.spec},c)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),h.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._layers)this._layers[t].setEventedParent(null);for(const t in this.sourceCaches){const n=this.sourceCaches[t];n.setEventedParent(null),n.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const n in this.sourceCaches)this.sourceCaches[n].update(t,this.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,n,o,c,d=!1){let m=!1,y=!1;const _={};for(const v of this._order){const T=this._layers[v];if(T.type!=="symbol")continue;if(!_[T.source]){const z=this.sourceCaches[T.source];_[T.source]=z.getRenderableIds(!0).map(F=>z.getTileByID(F)).sort((F,B)=>B.tileID.overscaledZ-F.tileID.overscaledZ||(F.tileID.isLessThan(B.tileID)?-1:1))}const C=this.crossTileSymbolIndex.addLayer(T,_[T.source],t.center.lng);m=m||C}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((d=d||this._layerOrderChanged||o===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(h.exported.now(),t.zoom))&&(this.pauseablePlacement=new ae(t,this.terrain,this._order,d,n,o,c,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,_),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(h.exported.now()),y=!0),m&&this.pauseablePlacement.placement.setStale()),y||m)for(const v of this._order){const T=this._layers[v];T.type==="symbol"&&this.placement.updateLayerOpacities(T,_[T.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(h.exported.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,n,o){this.imageManager.getImages(n.icons,o),this._updateTilesForChangedImages();const c=this.sourceCaches[n.source];c&&c.setDependencies(n.tileID.key,n.type,n.icons)}getGlyphs(t,n,o){this.glyphManager.getGlyphs(n.stacks,o)}getResource(t,n,o){return h.makeRequest(n,o)}}ai.getSourceType=function(a){return un[a]},ai.setSourceType=function(a,t){un[a]=t},ai.registerForPluginStateChange=h.registerForPluginStateChange;var bn="attribute vec2 a_pos;uniform mat4 u_matrix;varying vec2 v_texture_pos;varying float v_depth;void main() {v_texture_pos=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);v_depth=gl_Position.z/gl_Position.w;}";const qn={prelude:wt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_offset;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return (elevation+u_terrain_offset)*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:wt(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:wt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:wt(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:wt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:wt(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:wt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:wt("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:wt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:wt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:wt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:wt(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:wt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:wt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:wt(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:wt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:wt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:wt(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:wt(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:wt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:wt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:wt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:wt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:wt(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:wt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:wt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:wt("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",bn),terrainDepth:wt("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",bn),terrainCoords:wt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",bn)};function wt(a,t){const n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,o=t.match(/attribute ([\w]+) ([\w]+)/g),c=a.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),d=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),m=d?d.concat(c):c,y={};return{fragmentSource:a=a.replace(n,(_,v,T,C,z)=>(y[z]=!0,v==="define"?`
#ifndef HAS_UNIFORM_u_${z}
varying ${T} ${C} ${z};
#else
uniform ${T} ${C} u_${z};
#endif
`:`
#ifdef HAS_UNIFORM_u_${z}
    ${T} ${C} ${z} = u_${z};
#endif
`)),vertexSource:t=t.replace(n,(_,v,T,C,z)=>{const F=C==="float"?"vec2":"vec4",B=z.match(/color/)?"color":F;return y[z]?v==="define"?`
#ifndef HAS_UNIFORM_u_${z}
uniform lowp float u_${z}_t;
attribute ${T} ${F} a_${z};
varying ${T} ${C} ${z};
#else
uniform ${T} ${C} u_${z};
#endif
`:B==="vec4"?`
#ifndef HAS_UNIFORM_u_${z}
    ${z} = a_${z};
#else
    ${T} ${C} ${z} = u_${z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${z}
    ${z} = unpack_mix_${B}(a_${z}, u_${z}_t);
#else
    ${T} ${C} ${z} = u_${z};
#endif
`:v==="define"?`
#ifndef HAS_UNIFORM_u_${z}
uniform lowp float u_${z}_t;
attribute ${T} ${F} a_${z};
#else
uniform ${T} ${C} u_${z};
#endif
`:B==="vec4"?`
#ifndef HAS_UNIFORM_u_${z}
    ${T} ${C} ${z} = a_${z};
#else
    ${T} ${C} ${z} = u_${z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${z}
    ${T} ${C} ${z} = unpack_mix_${B}(a_${z}, u_${z}_t);
#else
    ${T} ${C} ${z} = u_${z};
#endif
`}),staticAttributes:o,staticUniforms:m}}class Ws{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,n,o,c,d,m,y,_,v){this.context=t;let T=this.boundPaintVertexBuffers.length!==c.length;for(let C=0;!T&&C<c.length;C++)this.boundPaintVertexBuffers[C]!==c[C]&&(T=!0);t.extVertexArrayObject&&this.vao&&this.boundProgram===n&&this.boundLayoutVertexBuffer===o&&!T&&this.boundIndexBuffer===d&&this.boundVertexOffset===m&&this.boundDynamicVertexBuffer===y&&this.boundDynamicVertexBuffer2===_&&this.boundDynamicVertexBuffer3===v?(t.bindVertexArrayOES.set(this.vao),y&&y.bind(),d&&d.dynamicDraw&&d.bind(),_&&_.bind(),v&&v.bind()):this.freshBind(n,o,c,d,m,y,_,v)}freshBind(t,n,o,c,d,m,y,_){let v;const T=t.numAttributes,C=this.context,z=C.gl;if(C.extVertexArrayObject)this.vao&&this.destroy(),this.vao=C.extVertexArrayObject.createVertexArrayOES(),C.bindVertexArrayOES.set(this.vao),v=0,this.boundProgram=t,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=o,this.boundIndexBuffer=c,this.boundVertexOffset=d,this.boundDynamicVertexBuffer=m,this.boundDynamicVertexBuffer2=y,this.boundDynamicVertexBuffer3=_;else{v=C.currentNumAttributes||0;for(let F=T;F<v;F++)z.disableVertexAttribArray(F)}n.enableAttributes(z,t);for(const F of o)F.enableAttributes(z,t);m&&m.enableAttributes(z,t),y&&y.enableAttributes(z,t),_&&_.enableAttributes(z,t),n.bind(),n.setVertexAttribPointers(z,t,d);for(const F of o)F.bind(),F.setVertexAttribPointers(z,t,d);m&&(m.bind(),m.setVertexAttribPointers(z,t,d)),c&&c.bind(),y&&(y.bind(),y.setVertexAttribPointers(z,t,d)),_&&(_.bind(),_.setVertexAttribPointers(z,t,d)),C.currentNumAttributes=T}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Ks(a){const t=[];for(let n=0;n<a.length;n++){if(a[n]===null)continue;const o=a[n].split(" ");t.push(o.pop())}return t}class Ho{constructor(t,n,o,c,d,m,y){const _=t.gl;this.program=_.createProgram();const v=Ks(o.staticAttributes),T=c?c.getBinderAttributes():[],C=v.concat(T),z=qn.prelude.staticUniforms?Ks(qn.prelude.staticUniforms):[],F=o.staticUniforms?Ks(o.staticUniforms):[],B=c?c.getBinderUniforms():[],R=z.concat(F).concat(B),Z=[];for(const ue of R)Z.indexOf(ue)<0&&Z.push(ue);const K=c?c.defines():[];m&&K.push("#define OVERDRAW_INSPECTOR;"),y&&K.push("#define TERRAIN3D;");const ee=K.concat(qn.prelude.fragmentSource,o.fragmentSource).join(`
`),U=K.concat(qn.prelude.vertexSource,o.vertexSource).join(`
`),se=_.createShader(_.FRAGMENT_SHADER);if(_.isContextLost())return void(this.failedToCreate=!0);_.shaderSource(se,ee),_.compileShader(se),_.attachShader(this.program,se);const te=_.createShader(_.VERTEX_SHADER);if(_.isContextLost())return void(this.failedToCreate=!0);_.shaderSource(te,U),_.compileShader(te),_.attachShader(this.program,te),this.attributes={};const he={};this.numAttributes=C.length;for(let ue=0;ue<this.numAttributes;ue++)C[ue]&&(_.bindAttribLocation(this.program,ue,C[ue]),this.attributes[C[ue]]=ue);_.linkProgram(this.program),_.deleteShader(te),_.deleteShader(se);for(let ue=0;ue<Z.length;ue++){const ye=Z[ue];if(ye&&!he[ye]){const ce=_.getUniformLocation(this.program,ye);ce&&(he[ye]=ce)}}this.fixedUniforms=d(t,he),this.terrainUniforms=((ue,ye)=>({u_depth:new h.Uniform1i(ue,ye.u_depth),u_terrain:new h.Uniform1i(ue,ye.u_terrain),u_terrain_dim:new h.Uniform1f(ue,ye.u_terrain_dim),u_terrain_matrix:new h.UniformMatrix4f(ue,ye.u_terrain_matrix),u_terrain_unpack:new h.Uniform4f(ue,ye.u_terrain_unpack),u_terrain_offset:new h.Uniform1f(ue,ye.u_terrain_offset),u_terrain_exaggeration:new h.Uniform1f(ue,ye.u_terrain_exaggeration)}))(t,he),this.binderUniforms=c?c.getUniforms(t,he):[]}draw(t,n,o,c,d,m,y,_,v,T,C,z,F,B,R,Z,K,ee){const U=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(o),t.setStencilMode(c),t.setColorMode(d),t.setCullFace(m),_){t.activeTexture.set(U.TEXTURE2),U.bindTexture(U.TEXTURE_2D,_.depthTexture),t.activeTexture.set(U.TEXTURE3),U.bindTexture(U.TEXTURE_2D,_.texture);for(const te in this.terrainUniforms)this.terrainUniforms[te].set(_[te])}for(const te in this.fixedUniforms)this.fixedUniforms[te].set(y[te]);R&&R.setUniforms(t,this.binderUniforms,F,{zoom:B});let se=0;switch(n){case U.LINES:se=2;break;case U.TRIANGLES:se=3;break;case U.LINE_STRIP:se=1}for(const te of z.get()){const he=te.vaos||(te.vaos={});(he[v]||(he[v]=new Ws)).bind(t,this,T,R?R.getPaintVertexBuffers():[],C,te.vertexOffset,Z,K,ee),U.drawElements(n,te.primitiveLength*se,U.UNSIGNED_SHORT,te.primitiveOffset*se*2)}}}function Wo(a,t,n){const o=1/Vt(n,1,t.transform.tileZoom),c=Math.pow(2,n.tileID.overscaledZ),d=n.tileSize*Math.pow(2,t.transform.tileZoom)/c,m=d*(n.tileID.canonical.x+n.tileID.wrap*c),y=d*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[o,a.fromScale,a.toScale],u_fade:a.t,u_pixel_coord_upper:[m>>16,y>>16],u_pixel_coord_lower:[65535&m,65535&y]}}const Ys=(a,t,n,o)=>{const c=t.style.light,d=c.properties.get("position"),m=[d.x,d.y,d.z],y=h.create$1();c.properties.get("anchor")==="viewport"&&h.fromRotation(y,-t.transform.angle),h.transformMat3(m,m,y);const _=c.properties.get("color");return{u_matrix:a,u_lightpos:m,u_lightintensity:c.properties.get("intensity"),u_lightcolor:[_.r,_.g,_.b],u_vertical_gradient:+n,u_opacity:o}},rl=(a,t,n,o,c,d,m)=>h.extend(Ys(a,t,n,o),Wo(d,t,m),{u_height_factor:-Math.pow(2,c.overscaledZ)/m.tileSize/8}),xs=a=>({u_matrix:a}),Js=(a,t,n,o)=>h.extend(xs(a),Wo(n,t,o)),Ko=(a,t)=>({u_matrix:a,u_world:t}),Yo=(a,t,n,o,c)=>h.extend(Js(a,t,n,o),{u_world:c}),Jo=(a,t,n,o)=>{const c=a.transform;let d,m;if(o.paint.get("circle-pitch-alignment")==="map"){const y=Vt(n,1,c.zoom);d=!0,m=[y,y]}else d=!1,m=c.pixelsToGLUnits;return{u_camera_to_center_distance:c.cameraToCenterDistance,u_scale_with_map:+(o.paint.get("circle-pitch-scale")==="map"),u_matrix:a.translatePosMatrix(t.posMatrix,n,o.paint.get("circle-translate"),o.paint.get("circle-translate-anchor")),u_pitch_with_map:+d,u_device_pixel_ratio:a.pixelRatio,u_extrude_scale:m}},Wr=(a,t,n)=>{const o=Vt(n,1,t.zoom),c=Math.pow(2,t.zoom-n.tileID.overscaledZ),d=n.tileID.overscaleFactor();return{u_matrix:a,u_camera_to_center_distance:t.cameraToCenterDistance,u_pixels_to_tile_units:o,u_extrude_scale:[t.pixelsToGLUnits[0]/(o*c),t.pixelsToGLUnits[1]/(o*c)],u_overscale_factor:d}},jn=(a,t,n=1)=>({u_matrix:a,u_color:t,u_overlay:0,u_overlay_scale:n}),wn=a=>({u_matrix:a}),vs=(a,t,n,o)=>({u_matrix:a,u_extrude_scale:Vt(t,1,n),u_intensity:o});function bs(a,t){const n=Math.pow(2,t.canonical.z),o=t.canonical.y;return[new h.MercatorCoordinate(0,o/n).toLngLat().lat,new h.MercatorCoordinate(0,(o+1)/n).toLngLat().lat]}const Tn=(a,t,n,o)=>{const c=a.transform;return{u_matrix:Xn(a,t,n,o),u_ratio:1/Vt(t,1,c.zoom),u_device_pixel_ratio:a.pixelRatio,u_units_to_pixels:[1/c.pixelsToGLUnits[0],1/c.pixelsToGLUnits[1]]}},Qs=(a,t,n,o,c)=>h.extend(Tn(a,t,n,c),{u_image:0,u_image_height:o}),ws=(a,t,n,o,c)=>{const d=a.transform,m=At(t,d);return{u_matrix:Xn(a,t,n,c),u_texsize:t.imageAtlasTexture.size,u_ratio:1/Vt(t,1,d.zoom),u_device_pixel_ratio:a.pixelRatio,u_image:0,u_scale:[m,o.fromScale,o.toScale],u_fade:o.t,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},Zn=(a,t,n,o,c,d)=>{const m=a.lineAtlas,y=At(t,a.transform),_=n.layout.get("line-cap")==="round",v=m.getDash(o.from,_),T=m.getDash(o.to,_),C=v.width*c.fromScale,z=T.width*c.toScale;return h.extend(Tn(a,t,n,d),{u_patternscale_a:[y/C,-v.height/2],u_patternscale_b:[y/z,-T.height/2],u_sdfgamma:m.width/(256*Math.min(C,z)*a.pixelRatio)/2,u_image:0,u_tex_y_a:v.y,u_tex_y_b:T.y,u_mix:c.t})};function At(a,t){return 1/Vt(a,1,t.tileZoom)}function Xn(a,t,n,o){return a.translatePosMatrix(o?o.posMatrix:t.tileID.posMatrix,t,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const Qo=(a,t,n,o,c)=>{return{u_matrix:a,u_tl_parent:t,u_scale_parent:n,u_buffer_scale:1,u_fade_t:o.mix,u_opacity:o.opacity*c.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:c.paint.get("raster-brightness-min"),u_brightness_high:c.paint.get("raster-brightness-max"),u_saturation_factor:(m=c.paint.get("raster-saturation"),m>0?1-1/(1.001-m):-m),u_contrast_factor:(d=c.paint.get("raster-contrast"),d>0?1/(1-d):1+d),u_spin_weights:ea(c.paint.get("raster-hue-rotate"))};var d,m};function ea(a){a*=Math.PI/180;const t=Math.sin(a),n=Math.cos(a);return[(2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3]}const eo=(a,t,n,o,c,d,m,y,_,v)=>{const T=c.transform;return{u_is_size_zoom_constant:+(a==="constant"||a==="source"),u_is_size_feature_constant:+(a==="constant"||a==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:T.cameraToCenterDistance,u_pitch:T.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:T.width/T.height,u_fade_change:c.options.fadeDuration?c.symbolFadeChange:1,u_matrix:d,u_label_plane_matrix:m,u_coord_matrix:y,u_is_text:+_,u_pitch_with_map:+o,u_texsize:v,u_texture:0}},Ts=(a,t,n,o,c,d,m,y,_,v,T)=>{const C=c.transform;return h.extend(eo(a,t,n,o,c,d,m,y,_,v),{u_gamma_scale:o?Math.cos(C._pitch)*C.cameraToCenterDistance:1,u_device_pixel_ratio:c.pixelRatio,u_is_halo:+T})},ta=(a,t,n,o,c,d,m,y,_,v)=>h.extend(Ts(a,t,n,o,c,d,m,y,!0,_,!0),{u_texsize_icon:v,u_texture_icon:1}),nl=(a,t,n)=>({u_matrix:a,u_opacity:t,u_color:n}),sl=(a,t,n,o,c,d)=>h.extend(function(m,y,_,v){const T=_.imageManager.getPattern(m.from.toString()),C=_.imageManager.getPattern(m.to.toString()),{width:z,height:F}=_.imageManager.getPixelSize(),B=Math.pow(2,v.tileID.overscaledZ),R=v.tileSize*Math.pow(2,_.transform.tileZoom)/B,Z=R*(v.tileID.canonical.x+v.tileID.wrap*B),K=R*v.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:T.tl,u_pattern_br_a:T.br,u_pattern_tl_b:C.tl,u_pattern_br_b:C.br,u_texsize:[z,F],u_mix:y.t,u_pattern_size_a:T.displaySize,u_pattern_size_b:C.displaySize,u_scale_a:y.fromScale,u_scale_b:y.toScale,u_tile_units_to_pixels:1/Vt(v,1,_.transform.tileZoom),u_pixel_coord_upper:[Z>>16,K>>16],u_pixel_coord_lower:[65535&Z,65535&K]}}(o,d,n,c),{u_matrix:a,u_opacity:t}),to={fillExtrusion:(a,t)=>({u_matrix:new h.UniformMatrix4f(a,t.u_matrix),u_lightpos:new h.Uniform3f(a,t.u_lightpos),u_lightintensity:new h.Uniform1f(a,t.u_lightintensity),u_lightcolor:new h.Uniform3f(a,t.u_lightcolor),u_vertical_gradient:new h.Uniform1f(a,t.u_vertical_gradient),u_opacity:new h.Uniform1f(a,t.u_opacity)}),fillExtrusionPattern:(a,t)=>({u_matrix:new h.UniformMatrix4f(a,t.u_matrix),u_lightpos:new h.Uniform3f(a,t.u_lightpos),u_lightintensity:new h.Uniform1f(a,t.u_lightintensity),u_lightcolor:new h.Uniform3f(a,t.u_lightcolor),u_vertical_gradient:new h.Uniform1f(a,t.u_vertical_gradient),u_height_factor:new h.Uniform1f(a,t.u_height_factor),u_image:new h.Uniform1i(a,t.u_image),u_texsize:new h.Uniform2f(a,t.u_texsize),u_pixel_coord_upper:new h.Uniform2f(a,t.u_pixel_coord_upper),u_pixel_coord_lower:new h.Uniform2f(a,t.u_pixel_coord_lower),u_scale:new h.Uniform3f(a,t.u_scale),u_fade:new h.Uniform1f(a,t.u_fade),u_opacity:new h.Uniform1f(a,t.u_opacity)}),fill:(a,t)=>({u_matrix:new h.UniformMatrix4f(a,t.u_matrix)}),fillPattern:(a,t)=>({u_matrix:new h.UniformMatrix4f(a,t.u_matrix),u_image:new h.Uniform1i(a,t.u_image),u_texsize:new h.Uniform2f(a,t.u_texsize),u_pixel_coord_upper:new h.Uniform2f(a,t.u_pixel_coord_upper),u_pixel_coord_lower:new h.Uniform2f(a,t.u_pixel_coord_lower),u_scale:new h.Uniform3f(a,t.u_scale),u_fade:new h.Uniform1f(a,t.u_fade)}),fillOutline:(a,t)=>({u_matrix:new h.UniformMatrix4f(a,t.u_matrix),u_world:new h.Uniform2f(a,t.u_world)}),fillOutlinePattern:(a,t)=>({u_matrix:new h.UniformMatrix4f(a,t.u_matrix),u_world:new h.Uniform2f(a,t.u_world),u_image:new h.Uniform1i(a,t.u_image),u_texsize:new h.Uniform2f(a,t.u_texsize),u_pixel_coord_upper:new h.Uniform2f(a,t.u_pixel_coord_upper),u_pixel_coord_lower:new h.Uniform2f(a,t.u_pixel_coord_lower),u_scale:new h.Uniform3f(a,t.u_scale),u_fade:new h.Uniform1f(a,t.u_fade)}),circle:(a,t)=>({u_camera_to_center_distance:new h.Uniform1f(a,t.u_camera_to_center_distance),u_scale_with_map:new h.Uniform1i(a,t.u_scale_with_map),u_pitch_with_map:new h.Uniform1i(a,t.u_pitch_with_map),u_extrude_scale:new h.Uniform2f(a,t.u_extrude_scale),u_device_pixel_ratio:new h.Uniform1f(a,t.u_device_pixel_ratio),u_matrix:new h.UniformMatrix4f(a,t.u_matrix)}),collisionBox:(a,t)=>({u_matrix:new h.UniformMatrix4f(a,t.u_matrix),u_camera_to_center_distance:new h.Uniform1f(a,t.u_camera_to_center_distance),u_pixels_to_tile_units:new h.Uniform1f(a,t.u_pixels_to_tile_units),u_extrude_scale:new h.Uniform2f(a,t.u_extrude_scale),u_overscale_factor:new h.Uniform1f(a,t.u_overscale_factor)}),collisionCircle:(a,t)=>({u_matrix:new h.UniformMatrix4f(a,t.u_matrix),u_inv_matrix:new h.UniformMatrix4f(a,t.u_inv_matrix),u_camera_to_center_distance:new h.Uniform1f(a,t.u_camera_to_center_distance),u_viewport_size:new h.Uniform2f(a,t.u_viewport_size)}),debug:(a,t)=>({u_color:new h.UniformColor(a,t.u_color),u_matrix:new h.UniformMatrix4f(a,t.u_matrix),u_overlay:new h.Uniform1i(a,t.u_overlay),u_overlay_scale:new h.Uniform1f(a,t.u_overlay_scale)}),clippingMask:(a,t)=>({u_matrix:new h.UniformMatrix4f(a,t.u_matrix)}),heatmap:(a,t)=>({u_extrude_scale:new h.Uniform1f(a,t.u_extrude_scale),u_intensity:new h.Uniform1f(a,t.u_intensity),u_matrix:new h.UniformMatrix4f(a,t.u_matrix)}),heatmapTexture:(a,t)=>({u_matrix:new h.UniformMatrix4f(a,t.u_matrix),u_world:new h.Uniform2f(a,t.u_world),u_image:new h.Uniform1i(a,t.u_image),u_color_ramp:new h.Uniform1i(a,t.u_color_ramp),u_opacity:new h.Uniform1f(a,t.u_opacity)}),hillshade:(a,t)=>({u_matrix:new h.UniformMatrix4f(a,t.u_matrix),u_image:new h.Uniform1i(a,t.u_image),u_latrange:new h.Uniform2f(a,t.u_latrange),u_light:new h.Uniform2f(a,t.u_light),u_shadow:new h.UniformColor(a,t.u_shadow),u_highlight:new h.UniformColor(a,t.u_highlight),u_accent:new h.UniformColor(a,t.u_accent)}),hillshadePrepare:(a,t)=>({u_matrix:new h.UniformMatrix4f(a,t.u_matrix),u_image:new h.Uniform1i(a,t.u_image),u_dimension:new h.Uniform2f(a,t.u_dimension),u_zoom:new h.Uniform1f(a,t.u_zoom),u_unpack:new h.Uniform4f(a,t.u_unpack)}),line:(a,t)=>({u_matrix:new h.UniformMatrix4f(a,t.u_matrix),u_ratio:new h.Uniform1f(a,t.u_ratio),u_device_pixel_ratio:new h.Uniform1f(a,t.u_device_pixel_ratio),u_units_to_pixels:new h.Uniform2f(a,t.u_units_to_pixels)}),lineGradient:(a,t)=>({u_matrix:new h.UniformMatrix4f(a,t.u_matrix),u_ratio:new h.Uniform1f(a,t.u_ratio),u_device_pixel_ratio:new h.Uniform1f(a,t.u_device_pixel_ratio),u_units_to_pixels:new h.Uniform2f(a,t.u_units_to_pixels),u_image:new h.Uniform1i(a,t.u_image),u_image_height:new h.Uniform1f(a,t.u_image_height)}),linePattern:(a,t)=>({u_matrix:new h.UniformMatrix4f(a,t.u_matrix),u_texsize:new h.Uniform2f(a,t.u_texsize),u_ratio:new h.Uniform1f(a,t.u_ratio),u_device_pixel_ratio:new h.Uniform1f(a,t.u_device_pixel_ratio),u_image:new h.Uniform1i(a,t.u_image),u_units_to_pixels:new h.Uniform2f(a,t.u_units_to_pixels),u_scale:new h.Uniform3f(a,t.u_scale),u_fade:new h.Uniform1f(a,t.u_fade)}),lineSDF:(a,t)=>({u_matrix:new h.UniformMatrix4f(a,t.u_matrix),u_ratio:new h.Uniform1f(a,t.u_ratio),u_device_pixel_ratio:new h.Uniform1f(a,t.u_device_pixel_ratio),u_units_to_pixels:new h.Uniform2f(a,t.u_units_to_pixels),u_patternscale_a:new h.Uniform2f(a,t.u_patternscale_a),u_patternscale_b:new h.Uniform2f(a,t.u_patternscale_b),u_sdfgamma:new h.Uniform1f(a,t.u_sdfgamma),u_image:new h.Uniform1i(a,t.u_image),u_tex_y_a:new h.Uniform1f(a,t.u_tex_y_a),u_tex_y_b:new h.Uniform1f(a,t.u_tex_y_b),u_mix:new h.Uniform1f(a,t.u_mix)}),raster:(a,t)=>({u_matrix:new h.UniformMatrix4f(a,t.u_matrix),u_tl_parent:new h.Uniform2f(a,t.u_tl_parent),u_scale_parent:new h.Uniform1f(a,t.u_scale_parent),u_buffer_scale:new h.Uniform1f(a,t.u_buffer_scale),u_fade_t:new h.Uniform1f(a,t.u_fade_t),u_opacity:new h.Uniform1f(a,t.u_opacity),u_image0:new h.Uniform1i(a,t.u_image0),u_image1:new h.Uniform1i(a,t.u_image1),u_brightness_low:new h.Uniform1f(a,t.u_brightness_low),u_brightness_high:new h.Uniform1f(a,t.u_brightness_high),u_saturation_factor:new h.Uniform1f(a,t.u_saturation_factor),u_contrast_factor:new h.Uniform1f(a,t.u_contrast_factor),u_spin_weights:new h.Uniform3f(a,t.u_spin_weights)}),symbolIcon:(a,t)=>({u_is_size_zoom_constant:new h.Uniform1i(a,t.u_is_size_zoom_constant),u_is_size_feature_constant:new h.Uniform1i(a,t.u_is_size_feature_constant),u_size_t:new h.Uniform1f(a,t.u_size_t),u_size:new h.Uniform1f(a,t.u_size),u_camera_to_center_distance:new h.Uniform1f(a,t.u_camera_to_center_distance),u_pitch:new h.Uniform1f(a,t.u_pitch),u_rotate_symbol:new h.Uniform1i(a,t.u_rotate_symbol),u_aspect_ratio:new h.Uniform1f(a,t.u_aspect_ratio),u_fade_change:new h.Uniform1f(a,t.u_fade_change),u_matrix:new h.UniformMatrix4f(a,t.u_matrix),u_label_plane_matrix:new h.UniformMatrix4f(a,t.u_label_plane_matrix),u_coord_matrix:new h.UniformMatrix4f(a,t.u_coord_matrix),u_is_text:new h.Uniform1i(a,t.u_is_text),u_pitch_with_map:new h.Uniform1i(a,t.u_pitch_with_map),u_texsize:new h.Uniform2f(a,t.u_texsize),u_texture:new h.Uniform1i(a,t.u_texture)}),symbolSDF:(a,t)=>({u_is_size_zoom_constant:new h.Uniform1i(a,t.u_is_size_zoom_constant),u_is_size_feature_constant:new h.Uniform1i(a,t.u_is_size_feature_constant),u_size_t:new h.Uniform1f(a,t.u_size_t),u_size:new h.Uniform1f(a,t.u_size),u_camera_to_center_distance:new h.Uniform1f(a,t.u_camera_to_center_distance),u_pitch:new h.Uniform1f(a,t.u_pitch),u_rotate_symbol:new h.Uniform1i(a,t.u_rotate_symbol),u_aspect_ratio:new h.Uniform1f(a,t.u_aspect_ratio),u_fade_change:new h.Uniform1f(a,t.u_fade_change),u_matrix:new h.UniformMatrix4f(a,t.u_matrix),u_label_plane_matrix:new h.UniformMatrix4f(a,t.u_label_plane_matrix),u_coord_matrix:new h.UniformMatrix4f(a,t.u_coord_matrix),u_is_text:new h.Uniform1i(a,t.u_is_text),u_pitch_with_map:new h.Uniform1i(a,t.u_pitch_with_map),u_texsize:new h.Uniform2f(a,t.u_texsize),u_texture:new h.Uniform1i(a,t.u_texture),u_gamma_scale:new h.Uniform1f(a,t.u_gamma_scale),u_device_pixel_ratio:new h.Uniform1f(a,t.u_device_pixel_ratio),u_is_halo:new h.Uniform1i(a,t.u_is_halo)}),symbolTextAndIcon:(a,t)=>({u_is_size_zoom_constant:new h.Uniform1i(a,t.u_is_size_zoom_constant),u_is_size_feature_constant:new h.Uniform1i(a,t.u_is_size_feature_constant),u_size_t:new h.Uniform1f(a,t.u_size_t),u_size:new h.Uniform1f(a,t.u_size),u_camera_to_center_distance:new h.Uniform1f(a,t.u_camera_to_center_distance),u_pitch:new h.Uniform1f(a,t.u_pitch),u_rotate_symbol:new h.Uniform1i(a,t.u_rotate_symbol),u_aspect_ratio:new h.Uniform1f(a,t.u_aspect_ratio),u_fade_change:new h.Uniform1f(a,t.u_fade_change),u_matrix:new h.UniformMatrix4f(a,t.u_matrix),u_label_plane_matrix:new h.UniformMatrix4f(a,t.u_label_plane_matrix),u_coord_matrix:new h.UniformMatrix4f(a,t.u_coord_matrix),u_is_text:new h.Uniform1i(a,t.u_is_text),u_pitch_with_map:new h.Uniform1i(a,t.u_pitch_with_map),u_texsize:new h.Uniform2f(a,t.u_texsize),u_texsize_icon:new h.Uniform2f(a,t.u_texsize_icon),u_texture:new h.Uniform1i(a,t.u_texture),u_texture_icon:new h.Uniform1i(a,t.u_texture_icon),u_gamma_scale:new h.Uniform1f(a,t.u_gamma_scale),u_device_pixel_ratio:new h.Uniform1f(a,t.u_device_pixel_ratio),u_is_halo:new h.Uniform1i(a,t.u_is_halo)}),background:(a,t)=>({u_matrix:new h.UniformMatrix4f(a,t.u_matrix),u_opacity:new h.Uniform1f(a,t.u_opacity),u_color:new h.UniformColor(a,t.u_color)}),backgroundPattern:(a,t)=>({u_matrix:new h.UniformMatrix4f(a,t.u_matrix),u_opacity:new h.Uniform1f(a,t.u_opacity),u_image:new h.Uniform1i(a,t.u_image),u_pattern_tl_a:new h.Uniform2f(a,t.u_pattern_tl_a),u_pattern_br_a:new h.Uniform2f(a,t.u_pattern_br_a),u_pattern_tl_b:new h.Uniform2f(a,t.u_pattern_tl_b),u_pattern_br_b:new h.Uniform2f(a,t.u_pattern_br_b),u_texsize:new h.Uniform2f(a,t.u_texsize),u_mix:new h.Uniform1f(a,t.u_mix),u_pattern_size_a:new h.Uniform2f(a,t.u_pattern_size_a),u_pattern_size_b:new h.Uniform2f(a,t.u_pattern_size_b),u_scale_a:new h.Uniform1f(a,t.u_scale_a),u_scale_b:new h.Uniform1f(a,t.u_scale_b),u_pixel_coord_upper:new h.Uniform2f(a,t.u_pixel_coord_upper),u_pixel_coord_lower:new h.Uniform2f(a,t.u_pixel_coord_lower),u_tile_units_to_pixels:new h.Uniform1f(a,t.u_tile_units_to_pixels)}),terrain:(a,t)=>({u_matrix:new h.UniformMatrix4f(a,t.u_matrix),u_texture:new h.Uniform1i(a,t.u_texture)}),terrainDepth:(a,t)=>({u_matrix:new h.UniformMatrix4f(a,t.u_matrix)}),terrainCoords:(a,t)=>({u_matrix:new h.UniformMatrix4f(a,t.u_matrix),u_texture:new h.Uniform1i(a,t.u_texture),u_terrain_coords_id:new h.Uniform1f(a,t.u_terrain_coords_id)})};class io{constructor(t,n,o){this.context=t;const c=t.gl;this.buffer=c.createBuffer(),this.dynamicDraw=Boolean(o),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),c.bufferData(c.ELEMENT_ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?c.DYNAMIC_DRAW:c.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const n=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ro={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class no{constructor(t,n,o,c){this.length=n.length,this.attributes=o,this.itemSize=n.bytesPerElement,this.dynamicDraw=c,this.context=t;const d=t.gl;this.buffer=d.createBuffer(),t.bindVertexBuffer.set(this.buffer),d.bufferData(d.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,n){for(let o=0;o<this.attributes.length;o++){const c=n.attributes[this.attributes[o].name];c!==void 0&&t.enableVertexAttribArray(c)}}setVertexAttribPointers(t,n,o){for(let c=0;c<this.attributes.length;c++){const d=this.attributes[c],m=n.attributes[d.name];m!==void 0&&t.vertexAttribPointer(m,d.components,t[ro[d.type]],!1,this.itemSize,d.offset+this.itemSize*(o||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class pt{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ia extends pt{getDefault(){return h.Color.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class ol extends pt{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Hn extends pt{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Wn extends pt{getDefault(){return[!0,!0,!0,!0]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class ra extends pt{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class zi extends pt{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class so extends pt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const n=this.current;(t.func!==n.func||t.ref!==n.ref||t.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Is extends pt{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Es extends pt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=t,this.dirty=!1}}class oo extends pt{getDefault(){return[0,1]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class ao extends pt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=t,this.dirty=!1}}class Ss extends pt{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class lo extends pt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.BLEND):n.disable(n.BLEND),this.current=t,this.dirty=!1}}class co extends pt{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class Cs extends pt{getDefault(){return h.Color.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class na extends pt{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class sa extends pt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=t,this.dirty=!1}}class In extends pt{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class al extends pt{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class ll extends pt{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class cl extends pt{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class hl extends pt{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class ul extends pt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class dl extends pt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class ho extends pt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindTexture(n.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class As extends pt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class uo extends pt{getDefault(){return null}set(t){const n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class po extends pt{constructor(t){super(t),this.vao=t.extVertexArrayObject}getDefault(){return null}set(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)}}class En extends pt{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class oa extends pt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class aa extends pt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class zs extends pt{constructor(t,n){super(t),this.context=t,this.parent=n}getDefault(){return null}}class Kr extends zs{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class la extends zs{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Sn{constructor(t,n,o,c){this.context=t,this.width=n,this.height=o;const d=t.gl,m=this.framebuffer=d.createFramebuffer();if(this.colorAttachment=new Kr(t,m),c&&(this.depthAttachment=new la(t,m)),d.checkFramebufferStatus(d.FRAMEBUFFER)!==d.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,n=this.colorAttachment.get();if(n&&t.deleteTexture(n),this.depthAttachment){const o=this.depthAttachment.get();o&&t.deleteRenderbuffer(o)}t.deleteFramebuffer(this.framebuffer)}}class Et{constructor(t,n,o){this.blendFunction=t,this.blendColor=n,this.mask=o}}Et.Replace=[1,0],Et.disabled=new Et(Et.Replace,h.Color.transparent,[!1,!1,!1,!1]),Et.unblended=new Et(Et.Replace,h.Color.transparent,[!0,!0,!0,!0]),Et.alphaBlended=new Et([1,771],h.Color.transparent,[!0,!0,!0,!0]);class ca{constructor(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new ia(this),this.clearDepth=new ol(this),this.clearStencil=new Hn(this),this.colorMask=new Wn(this),this.depthMask=new ra(this),this.stencilMask=new zi(this),this.stencilFunc=new so(this),this.stencilOp=new Is(this),this.stencilTest=new Es(this),this.depthRange=new oo(this),this.depthTest=new ao(this),this.depthFunc=new Ss(this),this.blend=new lo(this),this.blendFunc=new co(this),this.blendColor=new Cs(this),this.blendEquation=new na(this),this.cullFace=new sa(this),this.cullFaceSide=new In(this),this.frontFace=new al(this),this.program=new ll(this),this.activeTexture=new cl(this),this.viewport=new hl(this),this.bindFramebuffer=new ul(this),this.bindRenderbuffer=new dl(this),this.bindTexture=new ho(this),this.bindVertexBuffer=new As(this),this.bindElementBuffer=new uo(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new po(this),this.pixelStoreUnpack=new En(this),this.pixelStoreUnpackPremultiplyAlpha=new oa(this),this.pixelStoreUnpackFlipY=new aa(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(t.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,n){return new io(this,t,n)}createVertexBuffer(t,n,o){return new no(this,t,n,o)}createRenderbuffer(t,n,o){const c=this.gl,d=c.createRenderbuffer();return this.bindRenderbuffer.set(d),c.renderbufferStorage(c.RENDERBUFFER,t,n,o),this.bindRenderbuffer.set(null),d}createFramebuffer(t,n,o){return new Sn(this,t,n,o)}clear({color:t,depth:n}){const o=this.gl;let c=0;t&&(c|=o.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),n!==void 0&&(c|=o.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),o.clear(c)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){Re(t.blendFunction,Et.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class st{constructor(t,n,o){this.func=t,this.mask=n,this.range=o}}st.ReadOnly=!1,st.ReadWrite=!0,st.disabled=new st(519,st.ReadOnly,[0,1]);const mt=7680;class It{constructor(t,n,o,c,d,m){this.test=t,this.ref=n,this.mask=o,this.fail=c,this.depthFail=d,this.pass=m}}It.disabled=new It({func:519,mask:0},0,0,mt,mt,mt);class zt{constructor(t,n,o){this.enable=t,this.mode=n,this.frontFace=o}}let Kn;function Cn(a,t,n,o,c,d,m){const y=a.context,_=y.gl,v=a.useProgram("collisionBox"),T=[];let C=0,z=0;for(let U=0;U<o.length;U++){const se=o[U],te=t.getTile(se),he=te.getBucket(n);if(!he)continue;let ue=se.posMatrix;c[0]===0&&c[1]===0||(ue=a.translatePosMatrix(se.posMatrix,te,c,d));const ye=m?he.textCollisionBox:he.iconCollisionBox,ce=he.collisionCircleArray;if(ce.length>0){const ze=h.create(),be=ue;h.mul(ze,he.placementInvProjMatrix,a.transform.glCoordMatrix),h.mul(ze,ze,he.placementViewportMatrix),T.push({circleArray:ce,circleOffset:z,transform:be,invTransform:ze,coord:se}),C+=ce.length/4,z=C}ye&&v.draw(y,_.LINES,st.disabled,It.disabled,a.colorModeForRenderPass(),zt.disabled,Wr(ue,a.transform,te),a.style.terrain&&a.style.terrain.getTerrainData(se),n.id,ye.layoutVertexBuffer,ye.indexBuffer,ye.segments,null,a.transform.zoom,null,null,ye.collisionVertexBuffer)}if(!m||!T.length)return;const F=a.useProgram("collisionCircle"),B=new h.CollisionCircleLayoutArray;B.resize(4*C),B._trim();let R=0;for(const U of T)for(let se=0;se<U.circleArray.length/4;se++){const te=4*se,he=U.circleArray[te+0],ue=U.circleArray[te+1],ye=U.circleArray[te+2],ce=U.circleArray[te+3];B.emplace(R++,he,ue,ye,ce,0),B.emplace(R++,he,ue,ye,ce,1),B.emplace(R++,he,ue,ye,ce,2),B.emplace(R++,he,ue,ye,ce,3)}(!Kn||Kn.length<2*C)&&(Kn=function(U){const se=2*U,te=new h.QuadTriangleArray;te.resize(se),te._trim();for(let he=0;he<se;he++){const ue=6*he;te.uint16[ue+0]=4*he+0,te.uint16[ue+1]=4*he+1,te.uint16[ue+2]=4*he+2,te.uint16[ue+3]=4*he+2,te.uint16[ue+4]=4*he+3,te.uint16[ue+5]=4*he+0}return te}(C));const Z=y.createIndexBuffer(Kn,!0),K=y.createVertexBuffer(B,h.collisionCircleLayout.members,!0);for(const U of T){const se={u_matrix:U.transform,u_inv_matrix:U.invTransform,u_camera_to_center_distance:(ee=a.transform).cameraToCenterDistance,u_viewport_size:[ee.width,ee.height]};F.draw(y,_.TRIANGLES,st.disabled,It.disabled,a.colorModeForRenderPass(),zt.disabled,se,a.style.terrain&&a.style.terrain.getTerrainData(U.coord),n.id,K,Z,h.SegmentVector.simpleSegment(0,2*U.circleOffset,U.circleArray.length,U.circleArray.length/2),null,a.transform.zoom,null,null,null)}var ee;K.destroy(),Z.destroy()}zt.disabled=new zt(!1,1029,2305),zt.backCCW=new zt(!0,1029,2305);const pl=h.identity(new Float32Array(16));function ml(a,t,n,o,c,d){const{horizontalAlign:m,verticalAlign:y}=h.getAnchorAlignment(a),_=-(m-.5)*t,v=-(y-.5)*n,T=h.evaluateVariableOffset(a,o);return new h.pointGeometry((_/c+T[0])*d,(v/c+T[1])*d)}function ha(a,t,n,o,c,d,m,y,_,v,T){const C=a.text.placedSymbolArray,z=a.text.dynamicLayoutVertexArray,F=a.icon.dynamicLayoutVertexArray,B={};z.clear();for(let R=0;R<C.length;R++){const Z=C.get(R),K=a.allowVerticalPlacement&&!Z.placedOrientation,ee=Z.hidden||!Z.crossTileID||K?null:o[Z.crossTileID];if(ee){const U=new h.pointGeometry(Z.anchorX,Z.anchorY),se=lt(U,n?m:d,T),te=Ui(c.cameraToCenterDistance,se.signedDistanceFromCamera);let he=h.evaluateSizeForFeature(a.textSizeData,_,Z)*te/h.ONE_EM;n&&(he*=a.tilePixelRatio/y);const{width:ue,height:ye,anchor:ce,textOffset:ze,textBoxScale:be}=ee,Me=ml(ce,ue,ye,ze,be,he),Ye=n?lt(U.add(Me),d,T).point:se.point.add(t?Me.rotate(-c.angle):Me),tt=a.allowVerticalPlacement&&Z.placedOrientation===h.WritingMode.vertical?Math.PI/2:0;for(let Ve=0;Ve<Z.numGlyphs;Ve++)h.addDynamicAttributes(z,Ye,tt);v&&Z.associatedIconIndex>=0&&(B[Z.associatedIconIndex]={shiftedAnchor:Ye,angle:tt})}else He(Z.numGlyphs,z)}if(v){F.clear();const R=a.icon.placedSymbolArray;for(let Z=0;Z<R.length;Z++){const K=R.get(Z);if(K.hidden)He(K.numGlyphs,F);else{const ee=B[Z];if(ee)for(let U=0;U<K.numGlyphs;U++)h.addDynamicAttributes(F,ee.shiftedAnchor,ee.angle);else He(K.numGlyphs,F)}}a.icon.dynamicLayoutVertexBuffer.updateData(F)}a.text.dynamicLayoutVertexBuffer.updateData(z)}function fl(a,t,n){return n.iconsInText&&t?"symbolTextAndIcon":a?"symbolSDF":"symbolIcon"}function Ms(a,t,n,o,c,d,m,y,_,v,T,C){const z=a.context,F=z.gl,B=a.transform,R=y==="map",Z=_==="map",K=y!=="viewport"&&n.layout.get("symbol-placement")!=="point",ee=R&&!Z&&!K,U=!n.layout.get("symbol-sort-key").isConstant();let se=!1;const te=a.depthModeForSublayer(0,st.ReadOnly),he=n.layout.get("text-variable-anchor"),ue=[];for(const ye of o){const ce=t.getTile(ye),ze=ce.getBucket(n);if(!ze)continue;const be=c?ze.text:ze.icon;if(!be||!be.segments.get().length)continue;const Me=be.programConfigurations.get(n.id),Ye=c||ze.sdfIcons,tt=c?ze.textSizeData:ze.iconSizeData,Ve=Z||B.pitch!==0,gt=a.useProgram(fl(Ye,c,ze),Me),yt=h.evaluateSizeForZoom(tt,B.zoom),ot=a.style.terrain&&a.style.terrain.getTerrainData(ye);let ut,vt,Kt,or,Wi=[0,0],ar=null;if(c){if(vt=ce.glyphAtlasTexture,Kt=F.LINEAR,ut=ce.glyphAtlasTexture.size,ze.iconsInText){Wi=ce.imageAtlasTexture.size,ar=ce.imageAtlasTexture;const $i=tt.kind==="composite"||tt.kind==="camera";or=Ve||a.options.rotating||a.options.zooming||$i?F.LINEAR:F.NEAREST}}else{const $i=n.layout.get("icon-size").constantOr(0)!==1||ze.iconsNeedLinear;vt=ce.imageAtlasTexture,Kt=Ye||a.options.rotating||a.options.zooming||$i||Ve?F.LINEAR:F.NEAREST,ut=ce.imageAtlasTexture.size}const Vr=Vt(ce,1,a.transform.zoom),Ni=jr(ye.posMatrix,Z,R,a.transform,Vr),bi=Xi(ye.posMatrix,Z,R,a.transform,Vr),xr=he&&ze.hasTextData(),Os=n.layout.get("icon-text-fit")!=="none"&&xr&&ze.hasIconData();if(K){const $i=a.style.terrain?(Ao,Dn)=>a.style.terrain.getElevation(ye,Ao,Dn):null,en=n.layout.get("text-rotation-alignment")==="map";Ai(ze,ye.posMatrix,a,c,Ni,bi,Z,v,en,$i)}const jt=a.translatePosMatrix(ye.posMatrix,ce,d,m),rt=K||c&&he||Os?pl:Ni,ft=a.translatePosMatrix(bi,ce,d,m,!0),Yt=Ye&&n.paint.get(c?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Jt;Jt=Ye?ze.iconsInText?ta(tt.kind,yt,ee,Z,a,jt,rt,ft,ut,Wi):Ts(tt.kind,yt,ee,Z,a,jt,rt,ft,c,ut,!0):eo(tt.kind,yt,ee,Z,a,jt,rt,ft,c,ut);const kt={program:gt,buffers:be,uniformValues:Jt,atlasTexture:vt,atlasTextureIcon:ar,atlasInterpolation:Kt,atlasInterpolationIcon:or,isSDF:Ye,hasHalo:Yt};if(U&&ze.canOverlap){se=!0;const $i=be.segments.get();for(const en of $i)ue.push({segments:new h.SegmentVector([en]),sortKey:en.sortKey,state:kt,terrainData:ot})}else ue.push({segments:be.segments,sortKey:0,state:kt,terrainData:ot})}se&&ue.sort((ye,ce)=>ye.sortKey-ce.sortKey);for(const ye of ue){const ce=ye.state;if(z.activeTexture.set(F.TEXTURE0),ce.atlasTexture.bind(ce.atlasInterpolation,F.CLAMP_TO_EDGE),ce.atlasTextureIcon&&(z.activeTexture.set(F.TEXTURE1),ce.atlasTextureIcon&&ce.atlasTextureIcon.bind(ce.atlasInterpolationIcon,F.CLAMP_TO_EDGE)),ce.isSDF){const ze=ce.uniformValues;ce.hasHalo&&(ze.u_is_halo=1,Yn(ce.buffers,ye.segments,n,a,ce.program,te,T,C,ze,ye.terrainData)),ze.u_is_halo=0}Yn(ce.buffers,ye.segments,n,a,ce.program,te,T,C,ce.uniformValues,ye.terrainData)}}function Yn(a,t,n,o,c,d,m,y,_,v){const T=o.context;c.draw(T,T.gl.TRIANGLES,d,m,y,zt.disabled,_,v,n.id,a.layoutVertexBuffer,a.indexBuffer,t,n.paint,o.transform.zoom,a.programConfigurations.get(n.id),a.dynamicLayoutVertexBuffer,a.opacityVertexBuffer)}function Jn(a,t,n,o,c,d,m){const y=a.context.gl,_=n.paint.get("fill-pattern"),v=_&&_.constantOr(1),T=n.getCrossfadeParameters();let C,z,F,B,R;m?(z=v&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",C=y.LINES):(z=v?"fillPattern":"fill",C=y.TRIANGLES);for(const Z of o){const K=t.getTile(Z);if(v&&!K.patternsLoaded())continue;const ee=K.getBucket(n);if(!ee)continue;const U=ee.programConfigurations.get(n.id),se=a.useProgram(z,U),te=a.style.terrain&&a.style.terrain.getTerrainData(Z);v&&(a.context.activeTexture.set(y.TEXTURE0),K.imageAtlasTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),U.updatePaintBuffers(T));const he=_.constantOr(null);if(he&&K.imageAtlas){const ce=K.imageAtlas,ze=ce.patternPositions[he.to.toString()],be=ce.patternPositions[he.from.toString()];ze&&be&&U.setConstantPatternPositions(ze,be)}const ue=te?Z:null,ye=a.translatePosMatrix(ue?ue.posMatrix:Z.posMatrix,K,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));if(m){B=ee.indexBuffer2,R=ee.segments2;const ce=[y.drawingBufferWidth,y.drawingBufferHeight];F=z==="fillOutlinePattern"&&v?Yo(ye,a,T,K,ce):Ko(ye,ce)}else B=ee.indexBuffer,R=ee.segments,F=v?Js(ye,a,T,K):xs(ye);se.draw(a.context,C,c,a.stencilModeForClipping(Z),d,zt.disabled,F,te,n.id,ee.layoutVertexBuffer,B,R,n.paint,a.transform.zoom,U)}}function Qn(a,t,n,o,c,d,m){const y=a.context,_=y.gl,v=n.paint.get("fill-extrusion-pattern"),T=v.constantOr(1),C=n.getCrossfadeParameters(),z=n.paint.get("fill-extrusion-opacity");for(const F of o){const B=t.getTile(F),R=B.getBucket(n);if(!R)continue;const Z=a.style.terrain&&a.style.terrain.getTerrainData(F),K=R.programConfigurations.get(n.id),ee=a.useProgram(T?"fillExtrusionPattern":"fillExtrusion",K);T&&(a.context.activeTexture.set(_.TEXTURE0),B.imageAtlasTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE),K.updatePaintBuffers(C));const U=v.constantOr(null);if(U&&B.imageAtlas){const ue=B.imageAtlas,ye=ue.patternPositions[U.to.toString()],ce=ue.patternPositions[U.from.toString()];ye&&ce&&K.setConstantPatternPositions(ye,ce)}const se=a.translatePosMatrix(F.posMatrix,B,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),te=n.paint.get("fill-extrusion-vertical-gradient"),he=T?rl(se,a,te,z,F,C,B):Ys(se,a,te,z);ee.draw(y,y.gl.TRIANGLES,c,d,m,zt.backCCW,he,Z,n.id,R.layoutVertexBuffer,R.indexBuffer,R.segments,n.paint,a.transform.zoom,K,a.style.terrain&&R.centroidVertexBuffer)}}function mo(a,t,n,o,c,d,m){const y=a.context,_=y.gl,v=n.fbo;if(!v)return;const T=a.useProgram("hillshade"),C=a.style.terrain&&a.style.terrain.getTerrainData(t);y.activeTexture.set(_.TEXTURE0),_.bindTexture(_.TEXTURE_2D,v.colorAttachment.get()),T.draw(y,_.TRIANGLES,c,d,m,zt.disabled,((z,F,B,R)=>{const Z=B.paint.get("hillshade-shadow-color"),K=B.paint.get("hillshade-highlight-color"),ee=B.paint.get("hillshade-accent-color");let U=B.paint.get("hillshade-illumination-direction")*(Math.PI/180);B.paint.get("hillshade-illumination-anchor")==="viewport"&&(U-=z.transform.angle);const se=!z.options.moving;return{u_matrix:R?R.posMatrix:z.transform.calculatePosMatrix(F.tileID.toUnwrapped(),se),u_image:0,u_latrange:bs(0,F.tileID),u_light:[B.paint.get("hillshade-exaggeration"),U],u_shadow:Z,u_highlight:K,u_accent:ee}})(a,n,o,C?t:null),C,o.id,a.rasterBoundsBuffer,a.quadTriangleIndexBuffer,a.rasterBoundsSegments)}function ua(a,t,n,o,c,d){const m=a.context,y=m.gl,_=t.dem;if(_&&_.data){const v=_.dim,T=_.stride,C=_.getPixels();if(m.activeTexture.set(y.TEXTURE1),m.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||a.getTileTexture(T),t.demTexture){const F=t.demTexture;F.update(C,{premultiply:!1}),F.bind(y.NEAREST,y.CLAMP_TO_EDGE)}else t.demTexture=new dt(m,C,y.RGBA,{premultiply:!1}),t.demTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE);m.activeTexture.set(y.TEXTURE0);let z=t.fbo;if(!z){const F=new dt(m,{width:v,height:v,data:null},y.RGBA);F.bind(y.LINEAR,y.CLAMP_TO_EDGE),z=t.fbo=m.createFramebuffer(v,v,!0),z.colorAttachment.set(F.texture)}m.bindFramebuffer.set(z.framebuffer),m.viewport.set([0,0,v,v]),a.useProgram("hillshadePrepare").draw(m,y.TRIANGLES,o,c,d,zt.disabled,((F,B)=>{const R=B.stride,Z=h.create();return h.ortho(Z,0,h.EXTENT,-h.EXTENT,0,0,1),h.translate(Z,Z,[0,-h.EXTENT,0]),{u_matrix:Z,u_image:1,u_dimension:[R,R],u_zoom:F.overscaledZ,u_unpack:B.getUnpackVector()}})(t.tileID,_),null,n.id,a.rasterBoundsBuffer,a.quadTriangleIndexBuffer,a.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function ks(a,t,n,o,c,d){const m=o.paint.get("raster-fade-duration");if(!d&&m>0){const y=h.exported.now(),_=(y-a.timeAdded)/m,v=t?(y-t.timeAdded)/m:-1,T=n.getSource(),C=c.coveringZoomLevel({tileSize:T.tileSize,roundZoom:T.roundZoom}),z=!t||Math.abs(t.tileID.overscaledZ-C)>Math.abs(a.tileID.overscaledZ-C),F=z&&a.refreshedUponExpiration?1:h.clamp(z?_:1-v,0,1);return a.refreshedUponExpiration&&_>=1&&(a.refreshedUponExpiration=!1),t?{opacity:1,mix:1-F}:{opacity:F,mix:0}}return{opacity:1,mix:0}}const Ps=new h.Color(1,0,0,1),Hi=new h.Color(0,1,0,1),da=new h.Color(0,0,1,1),fo=new h.Color(1,0,1,1),pa=new h.Color(0,1,1,1);function Yr(a,t,n,o){An(a,0,t+n/2,a.transform.width,n,o)}function es(a,t,n,o){An(a,t-n/2,0,n,a.transform.height,o)}function An(a,t,n,o,c,d){const m=a.context,y=m.gl;y.enable(y.SCISSOR_TEST),y.scissor(t*a.pixelRatio,n*a.pixelRatio,o*a.pixelRatio,c*a.pixelRatio),m.clear({color:d}),y.disable(y.SCISSOR_TEST)}function gl(a,t,n){const o=a.context,c=o.gl,d=n.posMatrix,m=a.useProgram("debug"),y=st.disabled,_=It.disabled,v=a.colorModeForRenderPass(),T="$debug",C=a.style.terrain&&a.style.terrain.getTerrainData(n);o.activeTexture.set(c.TEXTURE0),a.emptyTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE);const z=t.getTileByID(n.key).latestRawTileData,F=Math.floor((z&&z.byteLength||0)/1024),B=t.getTile(n).tileSize,R=512/Math.min(B,512)*(n.overscaledZ/a.transform.zoom)*.5;let Z=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(Z+=` => ${n.overscaledZ}`),function(K,ee){K.initDebugOverlayCanvas();const U=K.debugOverlayCanvas,se=K.context.gl,te=K.debugOverlayCanvas.getContext("2d");te.clearRect(0,0,U.width,U.height),te.shadowColor="white",te.shadowBlur=2,te.lineWidth=1.5,te.strokeStyle="white",te.textBaseline="top",te.font="bold 36px Open Sans, sans-serif",te.fillText(ee,5,5),te.strokeText(ee,5,5),K.debugOverlayTexture.update(U),K.debugOverlayTexture.bind(se.LINEAR,se.CLAMP_TO_EDGE)}(a,`${Z} ${F}kB`),m.draw(o,c.TRIANGLES,y,_,Et.alphaBlended,zt.disabled,jn(d,h.Color.transparent,R),null,T,a.debugBuffer,a.quadTriangleIndexBuffer,a.debugSegments),m.draw(o,c.LINE_STRIP,y,_,v,zt.disabled,jn(d,h.Color.red),C,T,a.debugBuffer,a.tileBorderIndexBuffer,a.debugSegments)}function Ds(a,t,n){const o=a.context,c=o.gl,d=a.colorModeForRenderPass(),m=new st(c.LEQUAL,st.ReadWrite,a.depthRangeFor3D),y=a.useProgram("terrain"),_=t.getTerrainMesh(),v=t.getTerrainData(n.tileID);o.bindFramebuffer.set(null),o.viewport.set([0,0,a.width,a.height]),o.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,t.getRTTFramebuffer().colorAttachment.get());const T=a.transform.calculatePosMatrix(n.tileID.toUnwrapped());y.draw(o,c.TRIANGLES,m,It.disabled,d,zt.backCCW,{u_matrix:T,u_texture:0},v,"terrain",_.vertexBuffer,_.indexBuffer,_.segments)}function ma(a,t,n,o){const c=a.context,d=n.tileSize*t.qualityFactor;n.textures[o]||(n.textures[o]=a.getTileTexture(d)||new dt(c,{width:d,height:d,data:null},c.gl.RGBA),n.textures[o].bind(c.gl.LINEAR,c.gl.CLAMP_TO_EDGE),o===0&&t.sourceCache.renderHistory.unshift(n.tileID.key));const m=t.getRTTFramebuffer();m.colorAttachment.set(n.textures[o].texture),c.bindFramebuffer.set(m.framebuffer),c.viewport.set([0,0,d,d])}class fa{constructor(t){this._coordsDescendingInv={},this._coordsDescendingInvStr={},this.painter=t,this._renderToTexture={background:!0,fill:!0,line:!0,raster:!0},this._coordsDescendingInv={},this._coordsDescendingInvStr={},this._stacks=[],this._prevType=null,this._rerender={},this._renderableTiles=t.style.terrain.sourceCache.getRenderableTiles(),this._init()}_init(){const t=this.painter.style,n=t.terrain;for(const o in t.sourceCaches){this._coordsDescendingInv[o]={};const c=t.sourceCaches[o].getVisibleCoordinates();for(const d of c){const m=n.sourceCache.getTerrainCoords(d);for(const y in m)this._coordsDescendingInv[o][y]||(this._coordsDescendingInv[o][y]=[]),this._coordsDescendingInv[o][y].push(m[y])}}for(const o of t._order){const c=t._layers[o],d=c.source;if(this._renderToTexture[c.type]&&!this._coordsDescendingInvStr[d]){this._coordsDescendingInvStr[d]={};for(const m in this._coordsDescendingInv[d])this._coordsDescendingInvStr[d][m]=this._coordsDescendingInv[d][m].map(y=>y.key).sort().join()}}return this._renderableTiles.forEach(o=>{for(const c in this._coordsDescendingInvStr){const d=this._coordsDescendingInvStr[c][o.tileID.key];d&&d!==o.textureCoords[c]&&o.clearTextures(this.painter),n.needsRerender(c,o.tileID)&&o.clearTextures(this.painter)}this._rerender[o.tileID.key]=!o.textures.length}),n.clearRerenderCache(),n.sourceCache.removeOutdated(this.painter),this}renderLayer(t){const n=t.type,o=this.painter,c=o.style._order,d=o.currentLayer,m=d+1===c.length;if(this._renderToTexture[n]&&(this._prevType&&this._renderToTexture[this._prevType]||this._stacks.push([]),this._prevType=n,this._stacks[this._stacks.length-1].push(c[d]),!m))return!0;if(this._renderToTexture[this._prevType]||n==="hillshade"||this._renderToTexture[n]&&m){this._prevType=n;const y=this._stacks.length-1,_=this._stacks[y]||[];for(const v of this._renderableTiles){if(ma(o,o.style.terrain,v,y),this._rerender[v.tileID.key]){o.context.clear({color:h.Color.transparent});for(let T=0;T<_.length;T++){const C=o.style._layers[_[T]],z=C.source?this._coordsDescendingInv[C.source][v.tileID.key]:[v.tileID];o._renderTileClippingMasks(C,z),o.renderLayer(o,o.style.sourceCaches[C.source],C,z),C.source&&(v.textureCoords[C.source]=this._coordsDescendingInvStr[C.source][v.tileID.key])}}Ds(o,o.style.terrain,v)}if(n==="hillshade"){this._stacks.push([c[d]]);for(const v of this._renderableTiles){const T=this._coordsDescendingInv[t.source][v.tileID.key];ma(o,o.style.terrain,v,this._stacks.length-1),o.context.clear({color:h.Color.transparent}),o._renderTileClippingMasks(t,T),o.renderLayer(o,o.style.sourceCaches[t.source],t,T),Ds(o,o.style.terrain,v)}return!0}return this._renderToTexture[n]}return!1}}const ts={symbol:function(a,t,n,o,c){if(a.renderPass!=="translucent")return;const d=It.disabled,m=a.colorModeForRenderPass();n.layout.get("text-variable-anchor")&&function(y,_,v,T,C,z,F){const B=_.transform,R=C==="map",Z=z==="map";for(const K of y){const ee=T.getTile(K),U=ee.getBucket(v);if(!U||!U.text||!U.text.segments.get().length)continue;const se=h.evaluateSizeForZoom(U.textSizeData,B.zoom),te=Vt(ee,1,_.transform.zoom),he=jr(K.posMatrix,Z,R,_.transform,te),ue=v.layout.get("icon-text-fit")!=="none"&&U.hasIconData();if(se){const ye=Math.pow(2,B.zoom-ee.tileID.overscaledZ);ha(U,R,Z,F,B,he,K.posMatrix,ye,se,ue,_.style.terrain?(ce,ze)=>_.style.terrain.getElevation(K,ce,ze):null)}}}(o,a,n,t,n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),c),n.paint.get("icon-opacity").constantOr(1)!==0&&Ms(a,t,n,o,!1,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),n.layout.get("icon-rotation-alignment"),n.layout.get("icon-pitch-alignment"),n.layout.get("icon-keep-upright"),d,m),n.paint.get("text-opacity").constantOr(1)!==0&&Ms(a,t,n,o,!0,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),n.layout.get("text-keep-upright"),d,m),t.map.showCollisionBoxes&&(Cn(a,t,n,o,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),!0),Cn(a,t,n,o,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),!1))},circle:function(a,t,n,o){if(a.renderPass!=="translucent")return;const c=n.paint.get("circle-opacity"),d=n.paint.get("circle-stroke-width"),m=n.paint.get("circle-stroke-opacity"),y=!n.layout.get("circle-sort-key").isConstant();if(c.constantOr(1)===0&&(d.constantOr(1)===0||m.constantOr(1)===0))return;const _=a.context,v=_.gl,T=a.depthModeForSublayer(0,st.ReadOnly),C=It.disabled,z=a.colorModeForRenderPass(),F=[];for(let B=0;B<o.length;B++){const R=o[B],Z=t.getTile(R),K=Z.getBucket(n);if(!K)continue;const ee=K.programConfigurations.get(n.id),U=a.useProgram("circle",ee),se=K.layoutVertexBuffer,te=K.indexBuffer,he=a.style.terrain&&a.style.terrain.getTerrainData(R),ue={programConfiguration:ee,program:U,layoutVertexBuffer:se,indexBuffer:te,uniformValues:Jo(a,R,Z,n),terrainData:he};if(y){const ye=K.segments.get();for(const ce of ye)F.push({segments:new h.SegmentVector([ce]),sortKey:ce.sortKey,state:ue})}else F.push({segments:K.segments,sortKey:0,state:ue})}y&&F.sort((B,R)=>B.sortKey-R.sortKey);for(const B of F){const{programConfiguration:R,program:Z,layoutVertexBuffer:K,indexBuffer:ee,uniformValues:U,terrainData:se}=B.state;Z.draw(_,v.TRIANGLES,T,C,z,zt.disabled,U,se,n.id,K,ee,B.segments,n.paint,a.transform.zoom,R)}},heatmap:function(a,t,n,o){if(n.paint.get("heatmap-opacity")!==0)if(a.renderPass==="offscreen"){const c=a.context,d=c.gl,m=It.disabled,y=new Et([d.ONE,d.ONE],h.Color.transparent,[!0,!0,!0,!0]);(function(_,v,T){const C=_.gl;_.activeTexture.set(C.TEXTURE1),_.viewport.set([0,0,v.width/4,v.height/4]);let z=T.heatmapFbo;if(z)C.bindTexture(C.TEXTURE_2D,z.colorAttachment.get()),_.bindFramebuffer.set(z.framebuffer);else{const F=C.createTexture();C.bindTexture(C.TEXTURE_2D,F),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_WRAP_S,C.CLAMP_TO_EDGE),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_WRAP_T,C.CLAMP_TO_EDGE),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_MIN_FILTER,C.LINEAR),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_MAG_FILTER,C.LINEAR),z=T.heatmapFbo=_.createFramebuffer(v.width/4,v.height/4,!1),function(B,R,Z,K){const ee=B.gl;ee.texImage2D(ee.TEXTURE_2D,0,ee.RGBA,R.width/4,R.height/4,0,ee.RGBA,B.extRenderToTextureHalfFloat?B.extTextureHalfFloat.HALF_FLOAT_OES:ee.UNSIGNED_BYTE,null),K.colorAttachment.set(Z)}(_,v,F,z)}})(c,a,n),c.clear({color:h.Color.transparent});for(let _=0;_<o.length;_++){const v=o[_];if(t.hasRenderableParent(v))continue;const T=t.getTile(v),C=T.getBucket(n);if(!C)continue;const z=C.programConfigurations.get(n.id),F=a.useProgram("heatmap",z),{zoom:B}=a.transform;F.draw(c,d.TRIANGLES,st.disabled,m,y,zt.disabled,vs(v.posMatrix,T,B,n.paint.get("heatmap-intensity")),null,n.id,C.layoutVertexBuffer,C.indexBuffer,C.segments,n.paint,a.transform.zoom,z)}c.viewport.set([0,0,a.width,a.height])}else a.renderPass==="translucent"&&(a.context.setColorMode(a.colorModeForRenderPass()),function(c,d){const m=c.context,y=m.gl,_=d.heatmapFbo;if(!_)return;m.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,_.colorAttachment.get()),m.activeTexture.set(y.TEXTURE1);let v=d.colorRampTexture;v||(v=d.colorRampTexture=new dt(m,d.colorRamp,y.RGBA)),v.bind(y.LINEAR,y.CLAMP_TO_EDGE),c.useProgram("heatmapTexture").draw(m,y.TRIANGLES,st.disabled,It.disabled,c.colorModeForRenderPass(),zt.disabled,((T,C,z,F)=>{const B=h.create();h.ortho(B,0,T.width,T.height,0,0,1);const R=T.context.gl;return{u_matrix:B,u_world:[R.drawingBufferWidth,R.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:C.paint.get("heatmap-opacity")}})(c,d),null,d.id,c.viewportBuffer,c.quadTriangleIndexBuffer,c.viewportSegments,d.paint,c.transform.zoom)}(a,n))},line:function(a,t,n,o){if(a.renderPass!=="translucent")return;const c=n.paint.get("line-opacity"),d=n.paint.get("line-width");if(c.constantOr(1)===0||d.constantOr(1)===0)return;const m=a.depthModeForSublayer(0,st.ReadOnly),y=a.colorModeForRenderPass(),_=n.paint.get("line-dasharray"),v=n.paint.get("line-pattern"),T=v.constantOr(1),C=n.paint.get("line-gradient"),z=n.getCrossfadeParameters(),F=T?"linePattern":_?"lineSDF":C?"lineGradient":"line",B=a.context,R=B.gl;let Z=!0;for(const K of o){const ee=t.getTile(K);if(T&&!ee.patternsLoaded())continue;const U=ee.getBucket(n);if(!U)continue;const se=U.programConfigurations.get(n.id),te=a.context.program.get(),he=a.useProgram(F,se),ue=Z||he.program!==te,ye=a.style.terrain&&a.style.terrain.getTerrainData(K),ce=v.constantOr(null);if(ce&&ee.imageAtlas){const Me=ee.imageAtlas,Ye=Me.patternPositions[ce.to.toString()],tt=Me.patternPositions[ce.from.toString()];Ye&&tt&&se.setConstantPatternPositions(Ye,tt)}const ze=ye?K:null,be=T?ws(a,ee,n,z,ze):_?Zn(a,ee,n,_,z,ze):C?Qs(a,ee,n,U.lineClipsArray.length,ze):Tn(a,ee,n,ze);if(T)B.activeTexture.set(R.TEXTURE0),ee.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),se.updatePaintBuffers(z);else if(_&&(ue||a.lineAtlas.dirty))B.activeTexture.set(R.TEXTURE0),a.lineAtlas.bind(B);else if(C){const Me=U.gradients[n.id];let Ye=Me.texture;if(n.gradientVersion!==Me.version){let tt=256;if(n.stepInterpolant){const Ve=t.getSource().maxzoom,gt=K.canonical.z===Ve?Math.ceil(1<<a.transform.maxZoom-K.canonical.z):1;tt=h.clamp(h.nextPowerOfTwo(U.maxLineLength/h.EXTENT*1024*gt),256,B.maxTextureSize)}Me.gradient=h.renderColorRamp({expression:n.gradientExpression(),evaluationKey:"lineProgress",resolution:tt,image:Me.gradient||void 0,clips:U.lineClipsArray}),Me.texture?Me.texture.update(Me.gradient):Me.texture=new dt(B,Me.gradient,R.RGBA),Me.version=n.gradientVersion,Ye=Me.texture}B.activeTexture.set(R.TEXTURE0),Ye.bind(n.stepInterpolant?R.NEAREST:R.LINEAR,R.CLAMP_TO_EDGE)}he.draw(B,R.TRIANGLES,m,a.stencilModeForClipping(K),y,zt.disabled,be,ye,n.id,U.layoutVertexBuffer,U.indexBuffer,U.segments,n.paint,a.transform.zoom,se,U.layoutVertexBuffer2),Z=!1}},fill:function(a,t,n,o){const c=n.paint.get("fill-color"),d=n.paint.get("fill-opacity");if(d.constantOr(1)===0)return;const m=a.colorModeForRenderPass(),y=n.paint.get("fill-pattern"),_=a.opaquePassEnabledForLayer()&&!y.constantOr(1)&&c.constantOr(h.Color.transparent).a===1&&d.constantOr(0)===1?"opaque":"translucent";if(a.renderPass===_){const v=a.depthModeForSublayer(1,a.renderPass==="opaque"?st.ReadWrite:st.ReadOnly);Jn(a,t,n,o,v,m,!1)}if(a.renderPass==="translucent"&&n.paint.get("fill-antialias")){const v=a.depthModeForSublayer(n.getPaintProperty("fill-outline-color")?2:0,st.ReadOnly);Jn(a,t,n,o,v,m,!0)}},"fill-extrusion":function(a,t,n,o){const c=n.paint.get("fill-extrusion-opacity");if(c!==0&&a.renderPass==="translucent"){const d=new st(a.context.gl.LEQUAL,st.ReadWrite,a.depthRangeFor3D);if(c!==1||n.paint.get("fill-extrusion-pattern").constantOr(1))Qn(a,t,n,o,d,It.disabled,Et.disabled),Qn(a,t,n,o,d,a.stencilModeFor3D(),a.colorModeForRenderPass());else{const m=a.colorModeForRenderPass();Qn(a,t,n,o,d,It.disabled,m)}}},hillshade:function(a,t,n,o){if(a.renderPass!=="offscreen"&&a.renderPass!=="translucent")return;const c=a.context,d=a.depthModeForSublayer(0,st.ReadOnly),m=a.colorModeForRenderPass(),[y,_]=a.renderPass==="translucent"?a.stencilConfigForOverlap(o):[{},o];for(const v of _){const T=t.getTile(v);T.needsHillshadePrepare!==void 0&&T.needsHillshadePrepare&&a.renderPass==="offscreen"?ua(a,T,n,d,It.disabled,m):a.renderPass==="translucent"&&mo(a,v,T,n,d,y[v.overscaledZ],m)}c.viewport.set([0,0,a.width,a.height])},raster:function(a,t,n,o){if(a.renderPass!=="translucent"||n.paint.get("raster-opacity")===0||!o.length)return;const c=a.context,d=c.gl,m=t.getSource(),y=a.useProgram("raster"),_=a.colorModeForRenderPass(),[v,T]=m instanceof ji?[{},o]:a.stencilConfigForOverlap(o),C=T[T.length-1].overscaledZ,z=!a.options.moving;for(const F of T){const B=a.depthModeForSublayer(F.overscaledZ-C,n.paint.get("raster-opacity")===1?st.ReadWrite:st.ReadOnly,d.LESS),R=t.getTile(F);R.registerFadeDuration(n.paint.get("raster-fade-duration"));const Z=t.findLoadedParent(F,0),K=ks(R,Z,t,n,a.transform,a.style.terrain);let ee,U;const se=n.paint.get("raster-resampling")==="nearest"?d.NEAREST:d.LINEAR;c.activeTexture.set(d.TEXTURE0),R.texture.bind(se,d.CLAMP_TO_EDGE,d.LINEAR_MIPMAP_NEAREST),c.activeTexture.set(d.TEXTURE1),Z?(Z.texture.bind(se,d.CLAMP_TO_EDGE,d.LINEAR_MIPMAP_NEAREST),ee=Math.pow(2,Z.tileID.overscaledZ-R.tileID.overscaledZ),U=[R.tileID.canonical.x*ee%1,R.tileID.canonical.y*ee%1]):R.texture.bind(se,d.CLAMP_TO_EDGE,d.LINEAR_MIPMAP_NEAREST);const te=a.style.terrain&&a.style.terrain.getTerrainData(F),he=te?F:null,ue=he?he.posMatrix:a.transform.calculatePosMatrix(F.toUnwrapped(),z),ye=Qo(ue,U||[0,0],ee||1,K,n);m instanceof ji?y.draw(c,d.TRIANGLES,B,It.disabled,_,zt.disabled,ye,te,n.id,m.boundsBuffer,a.quadTriangleIndexBuffer,m.boundsSegments):y.draw(c,d.TRIANGLES,B,v[F.overscaledZ],_,zt.disabled,ye,te,n.id,a.rasterBoundsBuffer,a.quadTriangleIndexBuffer,a.rasterBoundsSegments)}},background:function(a,t,n,o){const c=n.paint.get("background-color"),d=n.paint.get("background-opacity");if(d===0)return;const m=a.context,y=m.gl,_=a.transform,v=_.tileSize,T=n.paint.get("background-pattern");if(a.isPatternMissing(T))return;const C=!T&&c.a===1&&d===1&&a.opaquePassEnabledForLayer()?"opaque":"translucent";if(a.renderPass!==C)return;const z=It.disabled,F=a.depthModeForSublayer(0,C==="opaque"?st.ReadWrite:st.ReadOnly),B=a.colorModeForRenderPass(),R=a.useProgram(T?"backgroundPattern":"background"),Z=o||_.coveringTiles({tileSize:v,terrain:a.style.terrain});T&&(m.activeTexture.set(y.TEXTURE0),a.imageManager.bind(a.context));const K=n.getCrossfadeParameters();for(const ee of Z){const U=o?ee.posMatrix:a.transform.calculatePosMatrix(ee.toUnwrapped()),se=T?sl(U,d,a,T,{tileID:ee,tileSize:v},K):nl(U,d,c),te=a.style.terrain&&a.style.terrain.getTerrainData(ee);R.draw(m,y.TRIANGLES,F,z,B,zt.disabled,se,te,n.id,a.tileExtentBuffer,a.quadTriangleIndexBuffer,a.tileExtentSegments)}},debug:function(a,t,n){for(let o=0;o<n.length;o++)gl(a,t,n[o])},custom:function(a,t,n){const o=a.context,c=n.implementation;if(a.renderPass==="offscreen"){const d=c.prerender;d&&(a.setCustomLayerDefaults(),o.setColorMode(a.colorModeForRenderPass()),d.call(c,o.gl,a.transform.customLayerMatrix()),o.setDirty(),a.setBaseState())}else if(a.renderPass==="translucent"){a.setCustomLayerDefaults(),o.setColorMode(a.colorModeForRenderPass()),o.setStencilMode(It.disabled);const d=c.renderingMode==="3d"?new st(a.context.gl.LEQUAL,st.ReadWrite,a.depthRangeFor3D):a.depthModeForSublayer(0,st.ReadOnly);o.setDepthMode(d),c.render(o.gl,a.transform.customLayerMatrix()),o.setDirty(),a.setBaseState(),o.bindFramebuffer.set(null)}}};class go{constructor(t,n){this.context=new ca(t),this.transform=n,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:h.create(),renderTime:0},this.setup(),this.numSublayers=xi.maxUnderzooming+xi.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new qe,this.gpuTimers={}}resize(t,n,o){if(this.width=t*o,this.height=n*o,this.pixelRatio=o,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const c of this.style._order)this.style._layers[c].resize()}setup(){const t=this.context,n=new h.PosArray;n.emplaceBack(0,0),n.emplaceBack(h.EXTENT,0),n.emplaceBack(0,h.EXTENT),n.emplaceBack(h.EXTENT,h.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(n,ct.members),this.tileExtentSegments=h.SegmentVector.simpleSegment(0,0,4,2);const o=new h.PosArray;o.emplaceBack(0,0),o.emplaceBack(h.EXTENT,0),o.emplaceBack(0,h.EXTENT),o.emplaceBack(h.EXTENT,h.EXTENT),this.debugBuffer=t.createVertexBuffer(o,ct.members),this.debugSegments=h.SegmentVector.simpleSegment(0,0,4,5);const c=new h.RasterBoundsArray;c.emplaceBack(0,0,0,0),c.emplaceBack(h.EXTENT,0,h.EXTENT,0),c.emplaceBack(0,h.EXTENT,0,h.EXTENT),c.emplaceBack(h.EXTENT,h.EXTENT,h.EXTENT,h.EXTENT),this.rasterBoundsBuffer=t.createVertexBuffer(c,ur.members),this.rasterBoundsSegments=h.SegmentVector.simpleSegment(0,0,4,2);const d=new h.PosArray;d.emplaceBack(0,0),d.emplaceBack(1,0),d.emplaceBack(0,1),d.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(d,ct.members),this.viewportSegments=h.SegmentVector.simpleSegment(0,0,4,2);const m=new h.LineStripIndexArray;m.emplaceBack(0),m.emplaceBack(1),m.emplaceBack(3),m.emplaceBack(2),m.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(m);const y=new h.TriangleIndexArray;y.emplaceBack(0,1,2),y.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(y),this.emptyTexture=new dt(t,{width:1,height:1,data:new Uint8Array([0,0,0,0])},t.gl.RGBA);const _=this.context.gl;this.stencilClearMode=new It({func:_.ALWAYS,mask:0},0,255,_.ZERO,_.ZERO,_.ZERO)}clearStencil(){const t=this.context,n=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const o=h.create();h.ortho(o,0,this.width,this.height,0,0,1),h.scale(o,o,[n.drawingBufferWidth,n.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,n.TRIANGLES,st.disabled,this.stencilClearMode,Et.disabled,zt.disabled,wn(o),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,n){if(this.currentStencilSource===t.source||!t.isTileClipped()||!n||!n.length)return;this.currentStencilSource=t.source;const o=this.context,c=o.gl;this.nextStencilID+n.length>256&&this.clearStencil(),o.setColorMode(Et.disabled),o.setDepthMode(st.disabled);const d=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const m of n){const y=this._tileClippingMaskIDs[m.key]=this.nextStencilID++,_=this.style.terrain&&this.style.terrain.getTerrainData(m);d.draw(o,c.TRIANGLES,st.disabled,new It({func:c.ALWAYS,mask:0},y,255,c.KEEP,c.KEEP,c.REPLACE),Et.disabled,zt.disabled,wn(m.posMatrix),_,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,n=this.context.gl;return new It({func:n.NOTEQUAL,mask:255},t,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(t){const n=this.context.gl;return new It({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,n.KEEP,n.KEEP,n.REPLACE)}stencilConfigForOverlap(t){const n=this.context.gl,o=t.sort((m,y)=>y.overscaledZ-m.overscaledZ),c=o[o.length-1].overscaledZ,d=o[0].overscaledZ-c+1;if(d>1){this.currentStencilSource=void 0,this.nextStencilID+d>256&&this.clearStencil();const m={};for(let y=0;y<d;y++)m[y+c]=new It({func:n.GEQUAL,mask:255},y+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=d,[m,o]}return[{[c]:It.disabled},o]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Et([t.CONSTANT_COLOR,t.ONE],new h.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Et.unblended:Et.alphaBlended}depthModeForSublayer(t,n,o){if(!this.opaquePassEnabledForLayer())return st.disabled;const c=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new st(o||this.context.gl.LEQUAL,n,[c,c])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,n){this.style=t,this.options=n,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(h.exported.now()),this.imageManager.beginFrame();const o=this.style._order,c=this.style.sourceCaches,d=this.style.terrain&&new fa(this);for(const v in c){const T=c[v];T.used&&T.prepare(this.context)}const m={},y={},_={};for(const v in c){const T=c[v];m[v]=T.getVisibleCoordinates(),y[v]=m[v].slice().reverse(),_[v]=T.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let v=0;v<o.length;v++)if(this.style._layers[o[v]].is3D()){this.opaquePassCutoff=v;break}if(d){this.opaquePassCutoff=0;const v=this.style.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!h.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||v.length)&&(h.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(T,C){const z=T.context,F=z.gl,B=Et.unblended,R=new st(F.LEQUAL,st.ReadWrite,[0,1]),Z=C.getTerrainMesh(),K=C.sourceCache.getRenderableTiles(),ee=T.useProgram("terrainDepth");z.bindFramebuffer.set(C.getFramebuffer("depth").framebuffer),z.viewport.set([0,0,T.width/devicePixelRatio,T.height/devicePixelRatio]),z.clear({color:h.Color.transparent,depth:1});for(const U of K){const se=C.getTerrainData(U.tileID),te=T.transform.calculatePosMatrix(U.tileID.toUnwrapped());ee.draw(z,F.TRIANGLES,R,It.disabled,B,zt.backCCW,{u_matrix:te},se,"terrain",Z.vertexBuffer,Z.indexBuffer,Z.segments)}z.bindFramebuffer.set(null),z.viewport.set([0,0,T.width,T.height])}(this,this.style.terrain),function(T,C){const z=T.context,F=z.gl,B=Et.unblended,R=new st(F.LEQUAL,st.ReadWrite,[0,1]),Z=C.getTerrainMesh(),K=C.getCoordsTexture(),ee=C.sourceCache.getRenderableTiles(),U=T.useProgram("terrainCoords");z.bindFramebuffer.set(C.getFramebuffer("coords").framebuffer),z.viewport.set([0,0,T.width/devicePixelRatio,T.height/devicePixelRatio]),z.clear({color:h.Color.transparent,depth:1}),C.coordsIndex=[];for(const se of ee){const te=C.getTerrainData(se.tileID);z.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,K.texture);const he=T.transform.calculatePosMatrix(se.tileID.toUnwrapped());U.draw(z,F.TRIANGLES,R,It.disabled,B,zt.backCCW,{u_matrix:he,u_terrain_coords_id:(255-C.coordsIndex.length)/255,u_texture:0},te,"terrain",Z.vertexBuffer,Z.indexBuffer,Z.segments),C.coordsIndex.push(se.tileID.key)}z.bindFramebuffer.set(null),z.viewport.set([0,0,T.width,T.height])}(this,this.style.terrain))}this.renderPass="offscreen";for(const v of o){const T=this.style._layers[v];if(!T.hasOffscreenPass()||T.isHidden(this.transform.zoom))continue;const C=y[T.source];(T.type==="custom"||C.length)&&this.renderLayer(this,c[T.source],T,C)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?h.Color.black:h.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!d)for(this.renderPass="opaque",this.currentLayer=o.length-1;this.currentLayer>=0;this.currentLayer--){const v=this.style._layers[o[this.currentLayer]],T=c[v.source],C=m[v.source];this._renderTileClippingMasks(v,C),this.renderLayer(this,T,v,C)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<o.length;this.currentLayer++){const v=this.style._layers[o[this.currentLayer]],T=c[v.source];if(d&&d.renderLayer(v))continue;const C=(v.type==="symbol"?_:y)[v.source];this._renderTileClippingMasks(v,m[v.source]),this.renderLayer(this,T,v,C)}if(this.options.showTileBoundaries){let v,T;Object.values(this.style._layers).forEach(C=>{C.source&&!C.isHidden(this.transform.zoom)&&(C.source!==(T&&T.id)&&(T=this.style.sourceCaches[C.source]),(!v||v.getSource().maxzoom<T.getSource().maxzoom)&&(v=T))}),v&&ts.debug(this,v,v.getVisibleCoordinates())}this.options.showPadding&&function(v){const T=v.transform.padding;Yr(v,v.transform.height-(T.top||0),3,Ps),Yr(v,T.bottom||0,3,Hi),es(v,T.left||0,3,da),es(v,v.transform.width-(T.right||0),3,fo);const C=v.transform.centerPoint;(function(z,F,B,R){An(z,F-1,B-10,2,20,R),An(z,F-10,B-1,20,2,R)})(v,C.x,v.transform.height-C.y,pa)}(this),this.context.setDefault()}renderLayer(t,n,o,c){o.isHidden(this.transform.zoom)||(o.type==="background"||o.type==="custom"||(c||[]).length)&&(this.id=o.id,this.gpuTimingStart(o),ts[o.type](t,n,o,c,this.style.placement.variableOffsets),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const n=this.context.extTimerQuery;let o=this.gpuTimers[t.id];o||(o=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:n.createQueryEXT()}),o.calls++,n.beginQueryEXT(n.TIME_ELAPSED_EXT,o.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}queryGpuTimers(t){const n={};for(const o in t){const c=t[o],d=this.context.extTimerQuery,m=d.getQueryObjectEXT(c.query,d.QUERY_RESULT_EXT)/1e6;d.deleteQueryEXT(c.query),n[o]=m}return n}translatePosMatrix(t,n,o,c,d){if(!o[0]&&!o[1])return t;const m=d?c==="map"?this.transform.angle:0:c==="viewport"?-this.transform.angle:0;if(m){const v=Math.sin(m),T=Math.cos(m);o=[o[0]*T-o[1]*v,o[0]*v+o[1]*T]}const y=[d?o[0]:Vt(n,o[0],this.transform.zoom),d?o[1]:Vt(n,o[1],this.transform.zoom),0],_=new Float32Array(16);return h.translate(_,t,y),_}saveTileTexture(t){const n=this._tileTextures[t.size[0]];n?n.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const n=this._tileTextures[t];return n&&n.length>0?n.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const n=this.imageManager.getPattern(t.from.toString()),o=this.imageManager.getPattern(t.to.toString());return!n||!o}useProgram(t,n){this.cache=this.cache||{};const o=t+(n?n.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.terrain?"/terrain":"");return this.cache[o]||(this.cache[o]=new Ho(this.context,t,qn[t],n,to[t],this._showOverdrawInspector,this.style.terrain)),this.cache[o]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new dt(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class Ls{constructor(t,n){this.points=t,this.planes=n}static fromInvProjectionMatrix(t,n,o){const c=Math.pow(2,o),d=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(y=>{const _=1/(y=h.transformMat4([],y,t))[3]/n*c;return h.mul$1(y,y,[_,_,1/y[3],_])}),m=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(y=>{const _=h.sub([],d[y[0]],d[y[1]]),v=h.sub([],d[y[2]],d[y[1]]),T=h.normalize([],h.cross([],_,v)),C=-h.dot(T,d[y[1]]);return T.concat(C)});return new Ls(d,m)}}class is{constructor(t,n){this.min=t,this.max=n,this.center=h.scale$1([],h.add([],this.min,this.max),.5)}quadrant(t){const n=[t%2==0,t<2],o=h.clone$2(this.min),c=h.clone$2(this.max);for(let d=0;d<n.length;d++)o[d]=n[d]?this.min[d]:this.center[d],c[d]=n[d]?this.center[d]:this.max[d];return c[2]=this.max[2],new is(o,c)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const n=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let o=!0;for(let c=0;c<t.planes.length;c++){const d=t.planes[c];let m=0;for(let y=0;y<n.length;y++)h.dot$1(d,n[y])>=0&&m++;if(m===0)return 0;m!==n.length&&(o=!1)}if(o)return 2;for(let c=0;c<3;c++){let d=Number.MAX_VALUE,m=-Number.MAX_VALUE;for(let y=0;y<t.points.length;y++){const _=t.points[y][c]-this.min[c];d=Math.min(d,_),m=Math.max(m,_)}if(m<0||d>this.max[c]-this.min[c])return 0}return 1}}class zn{constructor(t=0,n=0,o=0,c=0){if(isNaN(t)||t<0||isNaN(n)||n<0||isNaN(o)||o<0||isNaN(c)||c<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=n,this.left=o,this.right=c}interpolate(t,n,o){return n.top!=null&&t.top!=null&&(this.top=h.number(t.top,n.top,o)),n.bottom!=null&&t.bottom!=null&&(this.bottom=h.number(t.bottom,n.bottom,o)),n.left!=null&&t.left!=null&&(this.left=h.number(t.left,n.left,o)),n.right!=null&&t.right!=null&&(this.right=h.number(t.right,n.right,o)),this}getCenter(t,n){const o=h.clamp((this.left+t-this.right)/2,0,t),c=h.clamp((this.top+n-this.bottom)/2,0,n);return new h.pointGeometry(o,c)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new zn(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class rs{constructor(t,n,o,c,d){this.tileSize=512,this.maxValidLatitude=85.051129,this.freezeElevation=!1,this._renderWorldCopies=d===void 0||!!d,this._minZoom=t||0,this._maxZoom=n||22,this._minPitch=o==null?0:o,this._maxPitch=c==null?60:c,this.setMaxBounds(),this.width=0,this.height=0,this._center=new h.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new zn,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const t=new rs(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t._center=this._center,t._elevation=this._elevation,t.zoom=this.zoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._calcMatrices(),t}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new h.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const n=-h.wrap(t,-180,180)*Math.PI/180;var o;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=(o=new h.ARRAY_TYPE(4),h.ARRAY_TYPE!=Float32Array&&(o[1]=0,o[2]=0),o[0]=1,o[3]=1,o),function(c,d,m){var y=d[0],_=d[1],v=d[2],T=d[3],C=Math.sin(m),z=Math.cos(m);c[0]=y*z+v*C,c[1]=_*z+T*C,c[2]=y*-C+v*z,c[3]=_*-C+T*z}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const n=h.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const n=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==n&&(this._unmodified=!1,this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom,this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,n,o){this._unmodified=!1,this._edgeInsets.interpolate(t,n,o),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const n=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,n)}getVisibleUnwrappedCoordinates(t){const n=[new h.UnwrappedTileID(0,t)];if(this._renderWorldCopies){const o=this.pointCoordinate(new h.pointGeometry(0,0)),c=this.pointCoordinate(new h.pointGeometry(this.width,0)),d=this.pointCoordinate(new h.pointGeometry(this.width,this.height)),m=this.pointCoordinate(new h.pointGeometry(0,this.height)),y=Math.floor(Math.min(o.x,c.x,d.x,m.x)),_=Math.floor(Math.max(o.x,c.x,d.x,m.x)),v=1;for(let T=y-v;T<=_+v;T++)T!==0&&n.push(new h.UnwrappedTileID(T,t))}return n}coveringTiles(t){var n,o;let c=this.coveringZoomLevel(t);const d=c;if(t.minzoom!==void 0&&c<t.minzoom)return[];t.maxzoom!==void 0&&c>t.maxzoom&&(c=t.maxzoom);const m=this.pointCoordinate(this.getCameraPoint()),y=h.MercatorCoordinate.fromLngLat(this.center),_=Math.pow(2,c),v=[_*m.x,_*m.y,0],T=[_*y.x,_*y.y,0],C=Ls.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c);let z=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(z=c);const F=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,B=U=>({aabb:new is([U*_,0,0],[(U+1)*_,_,0]),zoom:0,x:0,y:0,wrap:U,fullyVisible:!1}),R=[],Z=[],K=c,ee=t.reparseOverscaled?d:c;if(this._renderWorldCopies)for(let U=1;U<=3;U++)R.push(B(-U)),R.push(B(U));for(R.push(B(0));R.length>0;){const U=R.pop(),se=U.x,te=U.y;let he=U.fullyVisible;if(!he){const Me=U.aabb.intersects(C);if(Me===0)continue;he=Me===2}const ue=t.terrain?v:T,ye=U.aabb.distanceX(ue),ce=U.aabb.distanceY(ue),ze=Math.max(Math.abs(ye),Math.abs(ce)),be=F+(1<<K-U.zoom)-2;if(U.zoom===K||ze>be&&U.zoom>=z){const Me=K-U.zoom,Ye=v[0]-.5-(se<<Me),tt=v[1]-.5-(te<<Me);Z.push({tileID:new h.OverscaledTileID(U.zoom===K?ee:U.zoom,U.wrap,U.zoom,se,te),distanceSq:h.sqrLen([T[0]-.5-se,T[1]-.5-te]),tileDistanceToCamera:Math.sqrt(Ye*Ye+tt*tt)})}else for(let Me=0;Me<4;Me++){const Ye=(se<<1)+Me%2,tt=(te<<1)+(Me>>1),Ve=U.zoom+1;let gt=U.aabb.quadrant(Me);if(t.terrain){const yt=new h.OverscaledTileID(Ve,U.wrap,Ve,Ye,tt),ot=t.terrain.getMinMaxElevation(yt),ut=(n=ot.minElevation)!==null&&n!==void 0?n:this.elevation,vt=(o=ot.maxElevation)!==null&&o!==void 0?o:this.elevation;gt=new is([gt.min[0],gt.min[1],ut],[gt.max[0],gt.max[1],vt])}R.push({aabb:gt,zoom:Ve,x:Ye,y:tt,wrap:U.wrap,fullyVisible:he})}}return Z.sort((U,se)=>U.distanceSq-se.distanceSq).map(U=>U.tileID)}resize(t,n){this.width=t,this.height=n,this.pixelsToGLUnits=[2/t,-2/n],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const n=h.clamp(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new h.pointGeometry(h.mercatorXfromLng(t.lng)*this.worldSize,h.mercatorYfromLat(n)*this.worldSize)}unproject(t){return new h.MercatorCoordinate(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}updateElevation(t){this.freezeElevation||(this.elevation=t?this.getElevation(this._center,t):0)}getElevation(t,n){const o=h.MercatorCoordinate.fromLngLat(t),c=(1<<this.tileZoom)*h.EXTENT,d=o.x*c,m=o.y*c,y=Math.floor(d/h.EXTENT),_=Math.floor(m/h.EXTENT),v=new h.OverscaledTileID(this.tileZoom,0,this.tileZoom,y,_);return n.getElevation(v,d%h.EXTENT,m%h.EXTENT,h.EXTENT)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const n=this.pointLocation(this.centerPoint,t),o=this.getElevation(n,t);if(!(this.elevation-o))return;const c=this.getCameraPosition(),d=h.MercatorCoordinate.fromLngLat(c.lngLat,c.altitude),m=h.MercatorCoordinate.fromLngLat(n,o),y=d.x-m.x,_=d.y-m.y,v=d.z-m.z,T=Math.sqrt(y*y+_*_+v*v),C=this.scaleZoom(this.cameraToCenterDistance/T/this.tileSize);this._elevation=o,this._center=n,this.zoom=C}setLocationAtPoint(t,n){const o=this.pointCoordinate(n),c=this.pointCoordinate(this.centerPoint),d=this.locationCoordinate(t),m=new h.MercatorCoordinate(d.x-(o.x-c.x),d.y-(o.y-c.y));this.center=this.coordinateLocation(m),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,n){return n?this.coordinatePoint(this.locationCoordinate(t),this.getElevation(t,n),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,n){return this.coordinateLocation(this.pointCoordinate(t,n))}locationCoordinate(t){return h.MercatorCoordinate.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,n){if(n){const z=n.pointCoordinate(t);if(z!=null)return z}const o=[t.x,t.y,0,1],c=[t.x,t.y,1,1];h.transformMat4(o,o,this.pixelMatrixInverse),h.transformMat4(c,c,this.pixelMatrixInverse);const d=o[3],m=c[3],y=o[1]/d,_=c[1]/m,v=o[2]/d,T=c[2]/m,C=v===T?0:(0-v)/(T-v);return new h.MercatorCoordinate(h.number(o[0]/d,c[0]/m,C)/this.worldSize,h.number(y,_,C)/this.worldSize)}coordinatePoint(t,n=0,o=this.pixelMatrix){const c=[t.x*this.worldSize,t.y*this.worldSize,n,1];return h.transformMat4(c,c,o),new h.pointGeometry(c[0]/c[3],c[1]/c[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new h.LngLatBounds().extend(this.pointLocation(new h.pointGeometry(0,t))).extend(this.pointLocation(new h.pointGeometry(this.width,t))).extend(this.pointLocation(new h.pointGeometry(this.width,this.height))).extend(this.pointLocation(new h.pointGeometry(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new h.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(t,n=!1){const o=t.key,c=n?this._alignedPosMatrixCache:this._posMatrixCache;if(c[o])return c[o];const d=t.canonical,m=this.worldSize/this.zoomScale(d.z),y=d.x+Math.pow(2,d.z)*t.wrap,_=h.identity(new Float64Array(16));return h.translate(_,_,[y*m,d.y*m,0]),h.scale(_,_,[m/h.EXTENT,m/h.EXTENT,1]),h.multiply(_,n?this.alignedProjMatrix:this.projMatrix,_),c[o]=new Float32Array(_),c[o]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t,n,o,c,d=-90,m=90,y=-180,_=180;const v=this.size,T=this._unmodified;if(this.latRange){const F=this.latRange;d=h.mercatorYfromLat(F[1])*this.worldSize,m=h.mercatorYfromLat(F[0])*this.worldSize,t=m-d<v.y?v.y/(m-d):0}if(this.lngRange){const F=this.lngRange;y=h.wrap(h.mercatorXfromLng(F[0])*this.worldSize,0,this.worldSize),_=h.wrap(h.mercatorXfromLng(F[1])*this.worldSize,0,this.worldSize),_<y&&(_+=this.worldSize),n=_-y<v.x?v.x/(_-y):0}const C=this.point,z=Math.max(n||0,t||0);if(z)return this.center=this.unproject(new h.pointGeometry(n?(_+y)/2:C.x,t?(m+d)/2:C.y)),this.zoom+=this.scaleZoom(z),this._unmodified=T,void(this._constraining=!1);if(this.latRange){const F=C.y,B=v.y/2;F-B<d&&(c=d+B),F+B>m&&(c=m-B)}if(this.lngRange){const F=(y+_)/2,B=h.wrap(C.x,F-this.worldSize/2,F+this.worldSize/2),R=v.x/2;B-R<y&&(o=y+R),B+R>_&&(o=_-R)}o===void 0&&c===void 0||(this.center=this.unproject(new h.pointGeometry(o!==void 0?o:C.x,c!==void 0?c:C.y)).wrap()),this._unmodified=T,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,n=this.point.x,o=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=h.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let c=h.identity(new Float64Array(16));h.scale(c,c,[this.width/2,-this.height/2,1]),h.translate(c,c,[1,-1,0]),this.labelPlaneMatrix=c,c=h.identity(new Float64Array(16)),h.scale(c,c,[1,-1,1]),h.translate(c,c,[-1,-1,0]),h.scale(c,c,[2/this.width,2/this.height,1]),this.glCoordMatrix=c,this.cameraToSeaLevelDistance=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch);const d=Math.PI/2+this._pitch,m=this._fov*(.5+t.y/this.height),y=Math.sin(m)*this.cameraToSeaLevelDistance/Math.sin(h.clamp(Math.PI-d-m,.01,Math.PI-.01)),_=this.getHorizon(),v=2*Math.atan(_/this.cameraToCenterDistance)*(.5+t.y/(2*_)),T=Math.sin(v)*this.cameraToSeaLevelDistance/Math.sin(h.clamp(Math.PI-d-v,.01,Math.PI-.01)),C=Math.cos(Math.PI/2-this._pitch)*y+this.cameraToSeaLevelDistance,z=Math.cos(Math.PI/2-this._pitch)*T+this.cameraToSeaLevelDistance,F=1.01*Math.min(C,z),B=this.height/50;c=new Float64Array(16),h.perspective(c,this._fov,this.width/this.height,B,F),c[8]=2*-t.x/this.width,c[9]=2*t.y/this.height,h.scale(c,c,[1,-1,1]),h.translate(c,c,[0,0,-this.cameraToCenterDistance]),h.rotateX(c,c,this._pitch),h.rotateZ(c,c,this.angle),h.translate(c,c,[-n,-o,0]),this.mercatorMatrix=h.scale([],c,[this.worldSize,this.worldSize,this.worldSize]),h.scale(c,c,[1,1,this._pixelPerMeter]),this.pixelMatrix=h.multiply(new Float64Array(16),this.labelPlaneMatrix,c),h.translate(c,c,[0,0,-this.elevation]),this.projMatrix=c,this.invProjMatrix=h.invert([],c),this.pixelMatrix3D=h.multiply(new Float64Array(16),this.labelPlaneMatrix,c);const R=this.width%2/2,Z=this.height%2/2,K=Math.cos(this.angle),ee=Math.sin(this.angle),U=n-Math.round(n)+K*R+ee*Z,se=o-Math.round(o)+K*Z+ee*R,te=new Float64Array(c);if(h.translate(te,te,[U>.5?U-1:U,se>.5?se-1:se,0]),this.alignedProjMatrix=te,c=h.invert(new Float64Array(16),this.pixelMatrix),!c)throw new Error("failed to invert matrix");this.pixelMatrixInverse=c,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new h.pointGeometry(0,0)),n=[t.x*this.worldSize,t.y*this.worldSize,0,1];return h.transformMat4(n,n,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new h.pointGeometry(0,t))}getCameraQueryGeometry(t){const n=this.getCameraPoint();if(t.length===1)return[t[0],n];{let o=n.x,c=n.y,d=n.x,m=n.y;for(const y of t)o=Math.min(o,y.x),c=Math.min(c,y.y),d=Math.max(d,y.x),m=Math.max(m,y.y);return[new h.pointGeometry(o,c),new h.pointGeometry(d,c),new h.pointGeometry(d,m),new h.pointGeometry(o,m),new h.pointGeometry(o,c)]}}}class ga{constructor(t){this._hashName=t&&encodeURIComponent(t),h.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(n,o){let c=!1,d=null;const m=()=>{d=null,c&&(n(),d=setTimeout(m,300),c=!1)};return()=>(c=!0,d||m(),d)}(this._updateHashUnthrottled.bind(this))}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const n=this._map.getCenter(),o=Math.round(100*this._map.getZoom())/100,c=Math.ceil((o*Math.LN2+Math.log(512/360/.5))/Math.LN10),d=Math.pow(10,c),m=Math.round(n.lng*d)/d,y=Math.round(n.lat*d)/d,_=this._map.getBearing(),v=this._map.getPitch();let T="";if(T+=t?`/${m}/${y}/${o}`:`${o}/${y}/${m}`,(_||v)&&(T+="/"+Math.round(10*_)/10),v&&(T+=`/${Math.round(v)}`),this._hashName){const C=this._hashName;let z=!1;const F=window.location.hash.slice(1).split("&").map(B=>{const R=B.split("=")[0];return R===C?(z=!0,`${R}=${T}`):B}).filter(B=>B);return z||F.push(`${C}=${T}`),`#${F.join("&")}`}return`#${T}`}_getCurrentHash(){const t=window.location.hash.replace("#","");if(this._hashName){let n;return t.split("&").map(o=>o.split("=")).forEach(o=>{o[0]===this._hashName&&(n=o)}),(n&&n[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._getCurrentHash();if(t.length>=3&&!t.some(n=>isNaN(n))){const n=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(t[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:n,pitch:+(t[4]||0)}),!0}return!1}_updateHashUnthrottled(){const t=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,t)}catch{}}}const ns={linearity:.3,easing:h.bezier(0,0,.3,1)},ya=h.extend({deceleration:2500,maxSpeed:1400},ns),_a=h.extend({deceleration:20,maxSpeed:1400},ns),xa=h.extend({deceleration:1e3,maxSpeed:360},ns),Mn=h.extend({deceleration:1e3,maxSpeed:90},ns);class va{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:h.exported.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,n=h.exported.now();for(;t.length>0&&n-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const n={zoom:0,bearing:0,pitch:0,pan:new h.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:d}of this._inertiaBuffer)n.zoom+=d.zoomDelta||0,n.bearing+=d.bearingDelta||0,n.pitch+=d.pitchDelta||0,d.panDelta&&n.pan._add(d.panDelta),d.around&&(n.around=d.around),d.pinchAround&&(n.pinchAround=d.pinchAround);const o=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,c={};if(n.pan.mag()){const d=os(n.pan.mag(),o,h.extend({},ya,t||{}));c.offset=n.pan.mult(d.amount/n.pan.mag()),c.center=this._map.transform.center,ss(c,d)}if(n.zoom){const d=os(n.zoom,o,_a);c.zoom=this._map.transform.zoom+d.amount,ss(c,d)}if(n.bearing){const d=os(n.bearing,o,xa);c.bearing=this._map.transform.bearing+h.clamp(d.amount,-179,179),ss(c,d)}if(n.pitch){const d=os(n.pitch,o,Mn);c.pitch=this._map.transform.pitch+d.amount,ss(c,d)}if(c.zoom||c.bearing){const d=n.pinchAround===void 0?n.around:n.pinchAround;c.around=d?this._map.unproject(d):this._map.getCenter()}return this.clear(),h.extend(c,{noMoveStart:!0})}}function ss(a,t){(!a.duration||a.duration<t.duration)&&(a.duration=t.duration,a.easing=t.easing)}function os(a,t,n){const{maxSpeed:o,linearity:c,deceleration:d}=n,m=h.clamp(a*c/(t/1e3),-o,o),y=Math.abs(m)/(d*c);return{easing:n.easing,duration:1e3*y,amount:m*(y/2)}}class Mi extends h.Event{constructor(t,n,o,c={}){const d=re.mousePos(n.getCanvasContainer(),o),m=n.unproject(d);super(t,h.extend({point:d,lngLat:m,originalEvent:o},c)),this._defaultPrevented=!1,this.target=n}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class as extends h.Event{constructor(t,n,o){const c=t==="touchend"?o.changedTouches:o.touches,d=re.touchPos(n.getCanvasContainer(),c),m=d.map(_=>n.unproject(_)),y=d.reduce((_,v,T,C)=>_.add(v.div(C.length)),new h.pointGeometry(0,0));super(t,{points:d,point:y,lngLats:m,lngLat:n.unproject(y),originalEvent:o}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class ki extends h.Event{constructor(t,n,o){super(t,{originalEvent:o}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class yl{constructor(t,n){this._map=t,this._clickTolerance=n.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new ki(t.type,this._map,t))}mousedown(t,n){return this._mousedownPos=n,this._firePreventable(new Mi(t.type,this._map,t))}mouseup(t){this._map.fire(new Mi(t.type,this._map,t))}click(t,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||this._map.fire(new Mi(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Mi(t.type,this._map,t))}mouseover(t){this._map.fire(new Mi(t.type,this._map,t))}mouseout(t){this._map.fire(new Mi(t.type,this._map,t))}touchstart(t){return this._firePreventable(new as(t.type,this._map,t))}touchmove(t){this._map.fire(new as(t.type,this._map,t))}touchend(t){this._map.fire(new as(t.type,this._map,t))}touchcancel(t){this._map.fire(new as(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Lr{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Mi(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Mi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Mi(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ba{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,n){this.isEnabled()&&t.shiftKey&&t.button===0&&(re.disableDrag(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(t,n){if(!this._active)return;const o=n;if(this._lastPos.equals(o)||!this._box&&o.dist(this._startPos)<this._clickTolerance)return;const c=this._startPos;this._lastPos=o,this._box||(this._box=re.create("div","maplibregl-boxzoom mapboxgl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair","mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const d=Math.min(c.x,o.x),m=Math.max(c.x,o.x),y=Math.min(c.y,o.y),_=Math.max(c.y,o.y);re.setTransform(this._box,`translate(${d}px,${y}px)`),this._box.style.width=m-d+"px",this._box.style.height=_-y+"px"}mouseupWindow(t,n){if(!this._active||t.button!==0)return;const o=this._startPos,c=n;if(this.reset(),re.suppressClick(),o.x!==c.x||o.y!==c.y)return this._map.fire(new h.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:d=>d.fitScreenCoordinates(o,c,this._map.getBearing(),{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair","mapboxgl-crosshair"),this._box&&(re.remove(this._box),this._box=null),re.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,n){return this._map.fire(new h.Event(t,{originalEvent:n}))}}function yr(a,t){if(a.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${a.length}, points ${t.length}`);const n={};for(let o=0;o<a.length;o++)n[a[o].identifier]=t[o];return n}class ls{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,n,o){(this.centroid||o.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),o.length===this.numTouches&&(this.centroid=function(c){const d=new h.pointGeometry(0,0);for(const m of c)d._add(m);return d.div(c.length)}(n),this.touches=yr(o,n)))}touchmove(t,n,o){if(this.aborted||!this.centroid)return;const c=yr(o,n);for(const d in this.touches){const m=this.touches[d],y=c[d];(!y||y.dist(m)>30)&&(this.aborted=!0)}}touchend(t,n,o){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),o.length===0){const c=!this.aborted&&this.centroid;if(this.reset(),c)return c}}}class yo{constructor(t){this.singleTap=new ls(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,n,o){this.singleTap.touchstart(t,n,o)}touchmove(t,n,o){this.singleTap.touchmove(t,n,o)}touchend(t,n,o){const c=this.singleTap.touchend(t,n,o);if(c){const d=t.timeStamp-this.lastTime<500,m=!this.lastTap||this.lastTap.dist(c)<30;if(d&&m||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=c,this.count===this.numTaps)return this.reset(),c}}}class _l{constructor(){this._zoomIn=new yo({numTouches:1,numTaps:2}),this._zoomOut=new yo({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,n,o){this._zoomIn.touchstart(t,n,o),this._zoomOut.touchstart(t,n,o)}touchmove(t,n,o){this._zoomIn.touchmove(t,n,o),this._zoomOut.touchmove(t,n,o)}touchend(t,n,o){const c=this._zoomIn.touchend(t,n,o),d=this._zoomOut.touchend(t,n,o);return c?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:m=>m.easeTo({duration:300,zoom:m.getZoom()+1,around:m.unproject(c)},{originalEvent:t})}):d?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:m=>m.easeTo({duration:300,zoom:m.getZoom()-1,around:m.unproject(d)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const xl={0:1,2:2};class Bs{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(t,n){return!1}_move(t,n){return{}}mousedown(t,n){if(this._lastPoint)return;const o=re.mouseButton(t);this._correctButton(t,o)&&(this._lastPoint=n,this._eventButton=o)}mousemoveWindow(t,n){const o=this._lastPoint;if(o){if(t.preventDefault(),function(c,d){const m=xl[d];return c.buttons===void 0||(c.buttons&m)!==m}(t,this._eventButton))this.reset();else if(this._moved||!(n.dist(o)<this._clickTolerance))return this._moved=!0,this._lastPoint=n,this._move(o,n)}}mouseupWindow(t){this._lastPoint&&re.mouseButton(t)===this._eventButton&&(this._moved&&re.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class cs extends Bs{mousedown(t,n){super.mousedown(t,n),this._lastPoint&&(this._active=!0)}_correctButton(t,n){return n===0&&!t.ctrlKey}_move(t,n){return{around:n,panDelta:n.sub(t)}}}class _r extends Bs{_correctButton(t,n){return n===0&&t.ctrlKey||n===2}_move(t,n){const o=.8*(n.x-t.x);if(o)return this._active=!0,{bearingDelta:o}}contextmenu(t){t.preventDefault()}}class De extends Bs{_correctButton(t,n){return n===0&&t.ctrlKey||n===2}_move(t,n){const o=-.5*(n.y-t.y);if(o)return this._active=!0,{pitchDelta:o}}contextmenu(t){t.preventDefault()}}class wa{constructor(t,n){this._minTouches=t.cooperativeGestures?2:1,this._clickTolerance=t.clickTolerance||1,this._map=n,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new h.pointGeometry(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(t,n,o){return this._calculateTransform(t,n,o)}touchmove(t,n,o){if(this._map._cooperativeGestures&&(this._minTouches===2&&o.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(t,!1,o.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(o.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,n,o)}touchend(t,n,o){this._calculateTransform(t,n,o),this._active&&o.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,n,o){o.length>0&&(this._active=!0);const c=yr(o,n),d=new h.pointGeometry(0,0),m=new h.pointGeometry(0,0);let y=0;for(const v in c){const T=c[v],C=this._touches[v];C&&(d._add(T),m._add(T.sub(C)),y++,c[v]=T)}if(this._touches=c,y<this._minTouches||!m.mag())return;const _=m.div(y);return this._sum._add(_),this._sum.mag()<this._clickTolerance?void 0:{around:d.div(y),panDelta:_}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Jr{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(t){}_move(t,n,o){return{}}touchstart(t,n,o){this._firstTwoTouches||o.length<2||(this._firstTwoTouches=[o[0].identifier,o[1].identifier],this._start([n[0],n[1]]))}touchmove(t,n,o){if(!this._firstTwoTouches)return;t.preventDefault();const[c,d]=this._firstTwoTouches,m=Br(o,n,c),y=Br(o,n,d);if(!m||!y)return;const _=this._aroundCenter?null:m.add(y).div(2);return this._move([m,y],_,t)}touchend(t,n,o){if(!this._firstTwoTouches)return;const[c,d]=this._firstTwoTouches,m=Br(o,n,c),y=Br(o,n,d);m&&y||(this._active&&re.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Br(a,t,n){for(let o=0;o<a.length;o++)if(a[o].identifier===n)return t[o]}function _o(a,t){return Math.log(a/t)/Math.LN2}class Ee extends Jr{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,n){const o=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(_o(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:_o(this._distance,o),pinchAround:n}}}function Rs(a,t){return 180*a.angleWith(t)/Math.PI}class vl extends Jr{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,n){const o=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Rs(this._vector,o),pinchAround:n}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const n=25/(Math.PI*this._minDiameter)*360,o=Rs(t,this._startVector);return Math.abs(o)<n}}function xo(a){return Math.abs(a.y)>Math.abs(a.x)}class vo extends Jr{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,n,o){super.touchstart(t,n,o),this._currentTouchCount=o.length}_start(t){this._lastPoints=t,xo(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,n,o){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const c=t[0].sub(this._lastPoints[0]),d=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(c,d,o.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(c.y+d.y)/2*-.5}):void 0}gestureBeginsVertically(t,n,o){if(this._valid!==void 0)return this._valid;const c=t.mag()>=2,d=n.mag()>=2;if(!c&&!d)return;if(!c||!d)return this._firstMove===void 0&&(this._firstMove=o),o-this._firstMove<100&&void 0;const m=t.y>0==n.y>0;return xo(t)&&xo(n)&&m}}const Ta={panStep:100,bearingStep:15,pitchStep:10};class Ia{constructor(){const t=Ta;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let n=0,o=0,c=0,d=0,m=0;switch(t.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:t.shiftKey?o=-1:(t.preventDefault(),d=-1);break;case 39:t.shiftKey?o=1:(t.preventDefault(),d=1);break;case 38:t.shiftKey?c=1:(t.preventDefault(),m=-1);break;case 40:t.shiftKey?c=-1:(t.preventDefault(),m=1);break;default:return}return this._rotationDisabled&&(o=0,c=0),{cameraAnimation:y=>{const _=y.getZoom();y.easeTo({duration:300,easeId:"keyboardHandler",easing:bl,zoom:n?Math.round(_)+n*(t.shiftKey?2:1):_,bearing:y.getBearing()+o*this._bearingStep,pitch:y.getPitch()+c*this._pitchStep,offset:[-d*this._panStep,-m*this._panStep],center:y.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function bl(a){return a*(2-a)}const Ea=4.000244140625;class bo{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._handler=n,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,h.bindAll(["_onTimeout"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!this._map._metaPress)return;t.preventDefault()}let n=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const o=h.exported.now(),c=o-(this._lastWheelEventTime||0);this._lastWheelEventTime=o,n!==0&&n%Ea==0?this._type="wheel":n!==0&&Math.abs(n)<4?this._type="trackpad":c>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(c*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),t.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=t,this._delta-=n,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=re.mousePos(this._el,t);this._around=h.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(n)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;if(this._delta!==0){const y=this._type==="wheel"&&Math.abs(this._delta)>Ea?this._wheelZoomRate:this._defaultZoomRate;let _=2/(1+Math.exp(-Math.abs(this._delta*y)));this._delta<0&&_!==0&&(_=1/_);const v=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(v*_))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const n=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,o=this._startZoom,c=this._easing;let d,m=!1;if(this._type==="wheel"&&o&&c){const y=Math.min((h.exported.now()-this._lastWheelEventTime)/200,1),_=c(y);d=h.number(o,n,_),y<1?this._frameId||(this._frameId=!0):m=!0}else d=n,m=!0;return this._active=!0,m&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!m,zoomDelta:d-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let n=h.ease;if(this._prevEase){const o=this._prevEase,c=(h.exported.now()-o.start)/o.duration,d=o.easing(c+.01)-o.easing(c),m=.27/Math.sqrt(d*d+1e-4)*.01,y=Math.sqrt(.0729-m*m);n=h.bezier(m,y,.25,1)}return this._prevEase={start:h.exported.now(),duration:t,easing:n},n}reset(){this._active=!1}}class wo{constructor(t,n){this._clickZoom=t,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class To{constructor(){this.reset()}reset(){this._active=!1}dblclick(t,n){return t.preventDefault(),{cameraAnimation:o=>{o.easeTo({duration:300,zoom:o.getZoom()+(t.shiftKey?-1:1),around:o.unproject(n)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Io{constructor(){this._tap=new yo({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(t,n,o){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?o.length>0&&(this._swipePoint=n[0],this._swipeTouch=o[0].identifier):this._tap.touchstart(t,n,o))}touchmove(t,n,o){if(this._tapTime){if(this._swipePoint){if(o[0].identifier!==this._swipeTouch)return;const c=n[0],d=c.y-this._swipePoint.y;return this._swipePoint=c,t.preventDefault(),this._active=!0,{zoomDelta:d/128}}}else this._tap.touchmove(t,n,o)}touchend(t,n,o){this._tapTime?this._swipePoint&&o.length===0&&this.reset():this._tap.touchend(t,n,o)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vi{constructor(t,n,o){this._el=t,this._mousePan=n,this._touchPan=o}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Rr{constructor(t,n,o){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=n,this._mousePitch=o}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Sa{constructor(t,n,o,c){this._el=t,this._touchZoom=n,this._touchRotate=o,this._tapDragZoom=c,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const kn=a=>a.zoom||a.drag||a.pitch||a.rotate;class Eo extends h.Event{}function hs(a){return a.panDelta&&a.panDelta.mag()||a.zoomDelta||a.bearingDelta||a.pitchDelta}class Ca{constructor(t,n){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new va(t),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(n),h.bindAll(["handleEvent","handleWindowEvent"],this);const o=this._el;this._listeners=[[o,"touchstart",{passive:!0}],[o,"touchmove",{passive:!1}],[o,"touchend",void 0],[o,"touchcancel",void 0],[o,"mousedown",void 0],[o,"mousemove",void 0],[o,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[o,"mouseover",void 0],[o,"mouseout",void 0],[o,"dblclick",void 0],[o,"click",void 0],[o,"keydown",{capture:!1}],[o,"keyup",void 0],[o,"wheel",{passive:!1}],[o,"contextmenu",void 0],[window,"blur",void 0]];for(const[c,d,m]of this._listeners)re.addEventListener(c,d,c===document?this.handleWindowEvent:this.handleEvent,m)}destroy(){for(const[t,n,o]of this._listeners)re.removeEventListener(t,n,t===document?this.handleWindowEvent:this.handleEvent,o)}_addDefaultHandlers(t){const n=this._map,o=n.getCanvasContainer();this._add("mapEvent",new yl(n,t));const c=n.boxZoom=new ba(n,t);this._add("boxZoom",c);const d=new _l,m=new To;n.doubleClickZoom=new wo(m,d),this._add("tapZoom",d),this._add("clickZoom",m);const y=new Io;this._add("tapDragZoom",y);const _=n.touchPitch=new vo(n);this._add("touchPitch",_);const v=new _r(t),T=new De(t);n.dragRotate=new Rr(t,v,T),this._add("mouseRotate",v,["mousePitch"]),this._add("mousePitch",T,["mouseRotate"]);const C=new cs(t),z=new wa(t,n);n.dragPan=new vi(o,C,z),this._add("mousePan",C),this._add("touchPan",z,["touchZoom","touchRotate"]);const F=new vl,B=new Ee;n.touchZoomRotate=new Sa(o,B,F,y),this._add("touchRotate",F,["touchPan","touchZoom"]),this._add("touchZoom",B,["touchPan","touchRotate"]);const R=n.scrollZoom=new bo(n,this);this._add("scrollZoom",R,["mousePan"]);const Z=n.keyboard=new Ia;this._add("keyboard",Z),this._add("blockableMapEvent",new Lr(n));for(const K of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[K]&&n[K].enable(t[K])}_add(t,n,o){this._handlers.push({handlerName:t,handler:n,allowed:o}),this._handlersById[t]=n}stop(t){if(!this._updatingCamera){for(const{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(kn(this._eventsInProgress))||this.isZooming()}_blockedByActive(t,n,o){for(const c in t)if(c!==o&&(!n||n.indexOf(c)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const n=[];for(const o of t)this._el.contains(o.target)&&n.push(o);return n}handleEvent(t,n){if(t.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const o=t.type==="renderFrame"?void 0:t,c={needsRenderFrame:!1},d={},m={},y=t.touches,_=y?this._getMapTouches(y):void 0,v=_?re.touchPos(this._el,_):re.mousePos(this._el,t);for(const{handlerName:z,handler:F,allowed:B}of this._handlers){if(!F.isEnabled())continue;let R;this._blockedByActive(m,B,z)?F.reset():F[n||t.type]&&(R=F[n||t.type](t,v,_),this.mergeHandlerResult(c,d,R,z,o),R&&R.needsRenderFrame&&this._triggerRenderFrame()),(R||F.isActive())&&(m[z]=F)}const T={};for(const z in this._previousActiveHandlers)m[z]||(T[z]=o);this._previousActiveHandlers=m,(Object.keys(T).length||hs(c))&&(this._changes.push([c,d,T]),this._triggerRenderFrame()),(Object.keys(m).length||hs(c))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:C}=c;C&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],C(this._map))}mergeHandlerResult(t,n,o,c,d){if(!o)return;h.extend(t,o);const m={handlerName:c,originalEvent:o.originalEvent||d};o.zoomDelta!==void 0&&(n.zoom=m),o.panDelta!==void 0&&(n.drag=m),o.pitchDelta!==void 0&&(n.pitch=m),o.bearingDelta!==void 0&&(n.rotate=m)}_applyChanges(){const t={},n={},o={};for(const[c,d,m]of this._changes)c.panDelta&&(t.panDelta=(t.panDelta||new h.pointGeometry(0,0))._add(c.panDelta)),c.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+c.zoomDelta),c.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+c.bearingDelta),c.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+c.pitchDelta),c.around!==void 0&&(t.around=c.around),c.pinchAround!==void 0&&(t.pinchAround=c.pinchAround),c.noInertia&&(t.noInertia=c.noInertia),h.extend(n,d),h.extend(o,m);this._updateMapTransform(t,n,o),this._changes=[]}_updateMapTransform(t,n,o){const c=this._map,d=c.transform,m=c.style&&c.style.terrain;if(!(hs(t)||m&&this._drag))return this._fireEvents(n,o,!0);let{panDelta:y,zoomDelta:_,bearingDelta:v,pitchDelta:T,around:C,pinchAround:z}=t;z!==void 0&&(C=z),c._stop(!0),C=C||c.transform.centerPoint;const F=d.pointLocation(y?C.sub(y):C);v&&(d.bearing+=v),T&&(d.pitch+=T),_&&(d.zoom+=_),m?n.drag&&!this._drag?(this._drag={center:d.centerPoint,lngLat:d.pointLocation(C),point:C,handlerName:n.drag.handlerName},c.fire(new h.Event("freezeElevation",{freeze:!0}))):this._drag&&o[this._drag.handlerName]?(c.fire(new h.Event("freezeElevation",{freeze:!1})),this._drag=null):n.drag&&this._drag&&(d.center=d.pointLocation(d.centerPoint.sub(y))):d.setLocationAtPoint(F,C),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(n,o,!0)}_fireEvents(t,n,o){const c=kn(this._eventsInProgress),d=kn(t),m={};for(const T in t){const{originalEvent:C}=t[T];this._eventsInProgress[T]||(m[`${T}start`]=C),this._eventsInProgress[T]=t[T]}!c&&d&&this._fireEvent("movestart",d.originalEvent);for(const T in m)this._fireEvent(T,m[T]);d&&this._fireEvent("move",d.originalEvent);for(const T in t){const{originalEvent:C}=t[T];this._fireEvent(T,C)}const y={};let _;for(const T in this._eventsInProgress){const{handlerName:C,originalEvent:z}=this._eventsInProgress[T];this._handlersById[C].isActive()||(delete this._eventsInProgress[T],_=n[C]||z,y[`${T}end`]=_)}for(const T in y)this._fireEvent(T,y[T]);const v=kn(this._eventsInProgress);if(o&&(c||d)&&!v){this._updatingCamera=!0;const T=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),C=z=>z!==0&&-this._bearingSnap<z&&z<this._bearingSnap;T?(C(T.bearing||this._map.getBearing())&&(T.bearing=0),this._map.easeTo(T,{originalEvent:_})):(this._map.fire(new h.Event("moveend",{originalEvent:_})),C(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,n){this._map.fire(new h.Event(t,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new Eo("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Vi={extend:(a,...t)=>h.extend(a,...t),run(a){a()},logToElement(a,t=!1,n="log"){const o=window.document.getElementById(n);o&&(t&&(o.innerHTML=""),o.innerHTML+=`<br>${a}`)}};class Mt extends h.Evented{constructor(t,n){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=n.bearingSnap,h.bindAll(["_renderFrameCallback"],this)}getCenter(){return new h.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(t,n){return this.jumpTo({center:t},n)}panBy(t,n,o){return t=h.pointGeometry.convert(t).mult(-1),this.panTo(this.transform.center,h.extend({offset:t},n),o)}panTo(t,n,o){return this.easeTo(h.extend({center:t},n),o)}getZoom(){return this.transform.zoom}setZoom(t,n){return this.jumpTo({zoom:t},n),this}zoomTo(t,n,o){return this.easeTo(h.extend({zoom:t},n),o)}zoomIn(t,n){return this.zoomTo(this.getZoom()+1,t,n),this}zoomOut(t,n){return this.zoomTo(this.getZoom()-1,t,n),this}getBearing(){return this.transform.bearing}setBearing(t,n){return this.jumpTo({bearing:t},n),this}getPadding(){return this.transform.padding}setPadding(t,n){return this.jumpTo({padding:t},n),this}rotateTo(t,n,o){return this.easeTo(h.extend({bearing:t},n),o)}resetNorth(t,n){return this.rotateTo(0,h.extend({duration:1e3},t),n),this}resetNorthPitch(t,n){return this.easeTo(h.extend({bearing:0,pitch:0,duration:1e3},t),n),this}snapToNorth(t,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,n):this}getPitch(){return this.transform.pitch}setPitch(t,n){return this.jumpTo({pitch:t},n),this}cameraForBounds(t,n){t=h.LngLatBounds.convert(t);const o=n&&n.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),o,n)}_cameraForBoxAndBearing(t,n,o,c){const d={top:0,bottom:0,right:0,left:0};if(typeof(c=h.extend({padding:d,offset:[0,0],maxZoom:this.transform.maxZoom},c)).padding=="number"){const te=c.padding;c.padding={top:te,bottom:te,right:te,left:te}}c.padding=h.extend(d,c.padding);const m=this.transform,y=m.padding,_=m.project(h.LngLat.convert(t)),v=m.project(h.LngLat.convert(n)),T=_.rotate(-o*Math.PI/180),C=v.rotate(-o*Math.PI/180),z=new h.pointGeometry(Math.max(T.x,C.x),Math.max(T.y,C.y)),F=new h.pointGeometry(Math.min(T.x,C.x),Math.min(T.y,C.y)),B=z.sub(F),R=(m.width-(y.left+y.right+c.padding.left+c.padding.right))/B.x,Z=(m.height-(y.top+y.bottom+c.padding.top+c.padding.bottom))/B.y;if(Z<0||R<0)return void h.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const K=Math.min(m.scaleZoom(m.scale*Math.min(R,Z)),c.maxZoom),ee=h.pointGeometry.convert(c.offset),U=new h.pointGeometry((c.padding.left-c.padding.right)/2,(c.padding.top-c.padding.bottom)/2).rotate(o*Math.PI/180),se=ee.add(U).mult(m.scale/m.zoomScale(K));return{center:m.unproject(_.add(v).div(2).sub(se)),zoom:K,bearing:o}}fitBounds(t,n,o){return this._fitInternal(this.cameraForBounds(t,n),n,o)}fitScreenCoordinates(t,n,o,c,d){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(h.pointGeometry.convert(t)),this.transform.pointLocation(h.pointGeometry.convert(n)),o,c),c,d)}_fitInternal(t,n,o){return t?(delete(n=h.extend(t,n)).padding,n.linear?this.easeTo(n,o):this.flyTo(n,o)):this}jumpTo(t,n){this.stop();const o=this.transform;let c=!1,d=!1,m=!1;return"zoom"in t&&o.zoom!==+t.zoom&&(c=!0,o.zoom=+t.zoom),t.center!==void 0&&(o.center=h.LngLat.convert(t.center)),"bearing"in t&&o.bearing!==+t.bearing&&(d=!0,o.bearing=+t.bearing),"pitch"in t&&o.pitch!==+t.pitch&&(m=!0,o.pitch=+t.pitch),t.padding==null||o.isPaddingEqual(t.padding)||(o.padding=t.padding),this.fire(new h.Event("movestart",n)).fire(new h.Event("move",n)),c&&this.fire(new h.Event("zoomstart",n)).fire(new h.Event("zoom",n)).fire(new h.Event("zoomend",n)),d&&this.fire(new h.Event("rotatestart",n)).fire(new h.Event("rotate",n)).fire(new h.Event("rotateend",n)),m&&this.fire(new h.Event("pitchstart",n)).fire(new h.Event("pitch",n)).fire(new h.Event("pitchend",n)),this.fire(new h.Event("moveend",n))}calculateCameraOptionsFromTo(t,n,o,c=0){const d=h.MercatorCoordinate.fromLngLat(t,n),m=h.MercatorCoordinate.fromLngLat(o,c),y=m.x-d.x,_=m.y-d.y,v=m.z-d.z,T=Math.hypot(y,_,v);if(T===0)throw new Error("Can't calculate camera options with same From and To");const C=Math.hypot(y,_),z=this.transform.scaleZoom(this.transform.cameraToCenterDistance/T/this.transform.tileSize),F=180*Math.atan2(y,-_)/Math.PI;let B=180*Math.acos(C/T)/Math.PI;return B=v<0?90-B:90+B,{center:m.toLngLat(),zoom:z,pitch:B,bearing:F}}easeTo(t,n){this._stop(!1,t.easeId),((t=h.extend({offset:[0,0],duration:500,easing:h.ease},t)).animate===!1||!t.essential&&h.exported.prefersReducedMotion)&&(t.duration=0);const o=this.transform,c=this.getZoom(),d=this.getBearing(),m=this.getPitch(),y=this.getPadding(),_="zoom"in t?+t.zoom:c,v="bearing"in t?this._normalizeBearing(t.bearing,d):d,T="pitch"in t?+t.pitch:m,C="padding"in t?t.padding:o.padding,z=h.pointGeometry.convert(t.offset);let F=o.centerPoint.add(z);const B=o.pointLocation(F),R=h.LngLat.convert(t.center||B);this._normalizeCenter(R);const Z=o.project(B),K=o.project(R).sub(Z),ee=o.zoomScale(_-c);let U,se;t.around&&(U=h.LngLat.convert(t.around),se=o.locationPoint(U));const te={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||_!==c,this._rotating=this._rotating||d!==v,this._pitching=this._pitching||T!==m,this._padding=!o.isPaddingEqual(C),this._easeId=t.easeId,this._prepareEase(n,t.noMoveStart,te),this._ease(he=>{if(this._zooming&&(o.zoom=h.number(c,_,he)),this._rotating&&(o.bearing=h.number(d,v,he)),this._pitching&&(o.pitch=h.number(m,T,he)),this._padding&&(o.interpolatePadding(y,C,he),F=o.centerPoint.add(z)),U)o.setLocationAtPoint(U,se);else{const ue=o.zoomScale(o.zoom-c),ye=_>c?Math.min(2,ee):Math.max(.5,ee),ce=Math.pow(ye,1-he),ze=o.unproject(Z.add(K.mult(he*ce)).mult(ue));o.setLocationAtPoint(o.renderWorldCopies?ze.wrap():ze,F)}this._fireMoveEvents(n)},he=>{this._afterEase(n,he)},t),this}_prepareEase(t,n,o={}){this._moving=!0,this.fire(new h.Event("freezeElevation",{freeze:!0})),n||o.moving||this.fire(new h.Event("movestart",t)),this._zooming&&!o.zooming&&this.fire(new h.Event("zoomstart",t)),this._rotating&&!o.rotating&&this.fire(new h.Event("rotatestart",t)),this._pitching&&!o.pitching&&this.fire(new h.Event("pitchstart",t))}_fireMoveEvents(t){this.fire(new h.Event("move",t)),this._zooming&&this.fire(new h.Event("zoom",t)),this._rotating&&this.fire(new h.Event("rotate",t)),this._pitching&&this.fire(new h.Event("pitch",t))}_afterEase(t,n){if(this._easeId&&n&&this._easeId===n)return;delete this._easeId,this.fire(new h.Event("freezeElevation",{freeze:!1}));const o=this._zooming,c=this._rotating,d=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,o&&this.fire(new h.Event("zoomend",t)),c&&this.fire(new h.Event("rotateend",t)),d&&this.fire(new h.Event("pitchend",t)),this.fire(new h.Event("moveend",t))}flyTo(t,n){if(!t.essential&&h.exported.prefersReducedMotion){const Ve=h.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ve,n)}this.stop(),t=h.extend({offset:[0,0],speed:1.2,curve:1.42,easing:h.ease},t);const o=this.transform,c=this.getZoom(),d=this.getBearing(),m=this.getPitch(),y=this.getPadding(),_="zoom"in t?h.clamp(+t.zoom,o.minZoom,o.maxZoom):c,v="bearing"in t?this._normalizeBearing(t.bearing,d):d,T="pitch"in t?+t.pitch:m,C="padding"in t?t.padding:o.padding,z=o.zoomScale(_-c),F=h.pointGeometry.convert(t.offset);let B=o.centerPoint.add(F);const R=o.pointLocation(B),Z=h.LngLat.convert(t.center||R);this._normalizeCenter(Z);const K=o.project(R),ee=o.project(Z).sub(K);let U=t.curve;const se=Math.max(o.width,o.height),te=se/z,he=ee.mag();if("minZoom"in t){const Ve=h.clamp(Math.min(t.minZoom,c,_),o.minZoom,o.maxZoom),gt=se/o.zoomScale(Ve-c);U=Math.sqrt(gt/he*2)}const ue=U*U;function ye(Ve){const gt=(te*te-se*se+(Ve?-1:1)*ue*ue*he*he)/(2*(Ve?te:se)*ue*he);return Math.log(Math.sqrt(gt*gt+1)-gt)}function ce(Ve){return(Math.exp(Ve)-Math.exp(-Ve))/2}function ze(Ve){return(Math.exp(Ve)+Math.exp(-Ve))/2}const be=ye(0);let Me=function(Ve){return ze(be)/ze(be+U*Ve)},Ye=function(Ve){return se*((ze(be)*(ce(gt=be+U*Ve)/ze(gt))-ce(be))/ue)/he;var gt},tt=(ye(1)-be)/U;if(Math.abs(he)<1e-6||!isFinite(tt)){if(Math.abs(se-te)<1e-6)return this.easeTo(t,n);const Ve=te<se?-1:1;tt=Math.abs(Math.log(te/se))/U,Ye=function(){return 0},Me=function(gt){return Math.exp(Ve*U*gt)}}return t.duration="duration"in t?+t.duration:1e3*tt/("screenSpeed"in t?+t.screenSpeed/U:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=d!==v,this._pitching=T!==m,this._padding=!o.isPaddingEqual(C),this._prepareEase(n,!1),this._ease(Ve=>{const gt=Ve*tt,yt=1/Me(gt);o.zoom=Ve===1?_:c+o.scaleZoom(yt),this._rotating&&(o.bearing=h.number(d,v,Ve)),this._pitching&&(o.pitch=h.number(m,T,Ve)),this._padding&&(o.interpolatePadding(y,C,Ve),B=o.centerPoint.add(F));const ot=Ve===1?Z:o.unproject(K.add(ee.mult(Ye(gt))).mult(yt));o.setLocationAtPoint(o.renderWorldCopies?ot.wrap():ot,B),this._fireMoveEvents(n)},()=>this._afterEase(n),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,n){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const o=this._onEaseEnd;delete this._onEaseEnd,o.call(this,n)}if(!t){const o=this.handlers;o&&o.stop(!1)}return this}_ease(t,n,o){o.animate===!1||o.duration===0?(t(1),n()):(this._easeStart=h.exported.now(),this._easeOptions=o,this._onEaseFrame=t,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((h.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,n){t=h.wrap(t,-180,180);const o=Math.abs(t-n);return Math.abs(t-360-n)<o&&(t-=360),Math.abs(t+360-n)<o&&(t+=360),t}_normalizeCenter(t){const n=this.transform;if(!n.renderWorldCopies||n.lngRange)return;const o=t.lng-n.center.lng;t.lng+=o>180?-360:o<-180?360:0}}class us{constructor(t={}){this.options=t,h.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options&&this.options.compact,this._container=re.create("details","maplibregl-ctrl maplibregl-ctrl-attrib mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=re.create("summary","maplibregl-ctrl-attrib-button mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=re.create("div","maplibregl-ctrl-attrib-inner mapboxgl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){re.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,n){const o=this._map._getUIString(`AttributionControl.${n}`);t.title=o,t.setAttribute("aria-label",o)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")):(this._container.classList.add("maplibregl-compact-show","mapboxgl-compact-show"),this._container.removeAttribute("open")))}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"&&t.type!=="terrain"||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(c=>typeof c!="string"?"":c)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const c=this._map.style.stylesheet;this.styleOwner=c.owner,this.styleId=c.id}const n=this._map.style.sourceCaches;for(const c in n){const d=n[c];if(d.used||d.usedForTerrain){const m=d.getSource();m.attribution&&t.indexOf(m.attribution)<0&&t.push(m.attribution)}}t=t.filter(c=>String(c).trim()),t.sort((c,d)=>c.length-d.length),t=t.filter((c,d)=>{for(let m=d+1;m<t.length;m++)if(t[m].indexOf(c)>=0)return!1;return!0});const o=t.join(" | ");o!==this._attribHTML&&(this._attribHTML=o,t.length?(this._innerContainer.innerHTML=o,this._container.classList.remove("maplibregl-attrib-empty","mapboxgl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty","mapboxgl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","mapboxgl-compact","maplibregl-compact-show","mapboxgl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show","mapboxgl-compact","mapboxgl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")}}class Fs{constructor(t={}){this.options=t,h.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=re.create("div","maplibregl-ctrl mapboxgl-ctrl");const n=re.create("a","maplibregl-ctrl-logo mapboxgl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://maplibre.org/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){re.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){const t=this._container.children;if(t.length){const n=t[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&n.classList.add("maplibregl-compact","mapboxgl-compact"):n.classList.remove("maplibregl-compact","mapboxgl-compact")}}}class Aa{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const n=++this._id;return this._queue.push({callback:t,id:n,cancelled:!1}),n}remove(t){const n=this._currentlyRunning,o=n?this._queue.concat(n):this._queue;for(const c of o)if(c.id===t)return void(c.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const n=this._currentlyRunning=this._queue;this._queue=[];for(const o of n)if(!o.cancelled&&(o.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const za={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"},Ma={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},wl={showCompass:!0,showZoom:!0,visualizePitch:!1};class nr{constructor(t,n,o=!1){this._clickTolerance=10,this.element=n,this.mouseRotate=new _r({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,o&&(this.mousePitch=new De({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),h.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),re.addEventListener(n,"mousedown",this.mousedown),re.addEventListener(n,"touchstart",this.touchstart,{passive:!1}),re.addEventListener(n,"touchmove",this.touchmove),re.addEventListener(n,"touchend",this.touchend),re.addEventListener(n,"touchcancel",this.reset)}down(t,n){this.mouseRotate.mousedown(t,n),this.mousePitch&&this.mousePitch.mousedown(t,n),re.disableDrag()}move(t,n){const o=this.map,c=this.mouseRotate.mousemoveWindow(t,n);if(c&&c.bearingDelta&&o.setBearing(o.getBearing()+c.bearingDelta),this.mousePitch){const d=this.mousePitch.mousemoveWindow(t,n);d&&d.pitchDelta&&o.setPitch(o.getPitch()+d.pitchDelta)}}off(){const t=this.element;re.removeEventListener(t,"mousedown",this.mousedown),re.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),re.removeEventListener(t,"touchmove",this.touchmove),re.removeEventListener(t,"touchend",this.touchend),re.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){re.enableDrag(),re.removeEventListener(window,"mousemove",this.mousemove),re.removeEventListener(window,"mouseup",this.mouseup)}mousedown(t){this.down(h.extend({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),re.mousePos(this.element,t)),re.addEventListener(window,"mousemove",this.mousemove),re.addEventListener(window,"mouseup",this.mouseup)}mousemove(t){this.move(t,re.mousePos(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=re.touchPos(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=re.touchPos(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function ds(a,t,n){if(a=new h.LngLat(a.lng,a.lat),t){const o=new h.LngLat(a.lng-360,a.lat),c=new h.LngLat(a.lng+360,a.lat),d=n.locationPoint(a).distSqr(t);n.locationPoint(o).distSqr(t)<d?a=o:n.locationPoint(c).distSqr(t)<d&&(a=c)}for(;Math.abs(a.lng-n.center.lng)>180;){const o=n.locationPoint(a);if(o.x>=0&&o.y>=0&&o.x<=n.width&&o.y<=n.height)break;a.lng>n.center.lng?a.lng-=360:a.lng+=360}return a}const Oe={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ge(a,t,n){const o=a.classList;for(const c in Oe)o.remove(`maplibregl-${n}-anchor-${c}`,`mapboxgl-${n}-anchor-${c}`);o.add(`maplibregl-${n}-anchor-${t}`,`mapboxgl-${n}-anchor-${t}`)}class Pn extends h.Evented{constructor(t,n){if(super(),(t instanceof HTMLElement||n)&&(t=h.extend({element:t},n)),h.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,t&&t.element)this._element=t.element,this._offset=h.pointGeometry.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=re.create("div"),this._element.setAttribute("aria-label","Map marker");const o=re.createNS("http://www.w3.org/2000/svg","svg"),c=41,d=27;o.setAttributeNS(null,"display","block"),o.setAttributeNS(null,"height",`${c}px`),o.setAttributeNS(null,"width",`${d}px`),o.setAttributeNS(null,"viewBox",`0 0 ${d} ${c}`);const m=re.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"stroke","none"),m.setAttributeNS(null,"stroke-width","1"),m.setAttributeNS(null,"fill","none"),m.setAttributeNS(null,"fill-rule","evenodd");const y=re.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"fill-rule","nonzero");const _=re.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"transform","translate(3.0, 29.0)"),_.setAttributeNS(null,"fill","#000000");const v=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ee of v){const U=re.createNS("http://www.w3.org/2000/svg","ellipse");U.setAttributeNS(null,"opacity","0.04"),U.setAttributeNS(null,"cx","10.5"),U.setAttributeNS(null,"cy","5.80029008"),U.setAttributeNS(null,"rx",ee.rx),U.setAttributeNS(null,"ry",ee.ry),_.appendChild(U)}const T=re.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"fill",this._color);const C=re.createNS("http://www.w3.org/2000/svg","path");C.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),T.appendChild(C);const z=re.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"opacity","0.25"),z.setAttributeNS(null,"fill","#000000");const F=re.createNS("http://www.w3.org/2000/svg","path");F.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),z.appendChild(F);const B=re.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"transform","translate(6.0, 7.0)"),B.setAttributeNS(null,"fill","#FFFFFF");const R=re.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Z=re.createNS("http://www.w3.org/2000/svg","circle");Z.setAttributeNS(null,"fill","#000000"),Z.setAttributeNS(null,"opacity","0.25"),Z.setAttributeNS(null,"cx","5.5"),Z.setAttributeNS(null,"cy","5.5"),Z.setAttributeNS(null,"r","5.4999962");const K=re.createNS("http://www.w3.org/2000/svg","circle");K.setAttributeNS(null,"fill","#FFFFFF"),K.setAttributeNS(null,"cx","5.5"),K.setAttributeNS(null,"cy","5.5"),K.setAttributeNS(null,"r","5.4999962"),R.appendChild(Z),R.appendChild(K),y.appendChild(_),y.appendChild(T),y.appendChild(z),y.appendChild(B),y.appendChild(R),o.appendChild(y),o.setAttributeNS(null,"height",c*this._scale+"px"),o.setAttributeNS(null,"width",d*this._scale+"px"),this._element.appendChild(o),this._offset=h.pointGeometry.convert(t&&t.offset||[0,-14])}this._element.classList.add("maplibregl-marker","mapboxgl-marker"),this._element.addEventListener("dragstart",o=>{o.preventDefault()}),this._element.addEventListener("mousedown",o=>{o.preventDefault()}),Ge(this._element,this._anchor,"marker"),this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),re.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=h.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const c=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[c,-1*(38.1-13.5+c)],"bottom-right":[-c,-1*(38.1-13.5+c)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(t){const n=t.code,o=t.charCode||t.keyCode;n!=="Space"&&n!=="Enter"&&o!==32&&o!==13||this.togglePopup()}_onMapClick(t){const n=t.originalEvent.target,o=this._element;this._popup&&(n===o||o.contains(n))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this}_update(t){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=ds(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let n="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?n=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(n=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let o="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?o="rotateX(0deg)":this._pitchAlignment==="map"&&(o=`rotateX(${this._map.getPitch()}deg)`),t&&t.type!=="moveend"||(this._pos=this._pos.round()),re.setTransform(this._element,`${Oe[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${o} ${n}`),this._map.style&&this._map.style.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const c=this._map.unproject(this._pos),d=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=c.distanceTo(this._lngLat)>20*d?"0.2":"1.0",this._opacityTimeout=null},100))}getOffset(){return this._offset}setOffset(t){return this._offset=h.pointGeometry.convert(t),this._update(),this}_onMove(t){if(!this._isDragging){const n=this._clickTolerance||this._map._clickTolerance;this._isDragging=t.point.dist(this._pointerdownPos)>=n}this._isDragging&&(this._pos=t.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new h.Event("dragstart"))),this.fire(new h.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new h.Event("dragend")),this._state="inactive"}_addDragHandler(t){this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._offset),this._pointerdownPos=t.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const So={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Fr,ri=0,Or=!1;const sr={maxWidth:100,unit:"metric"};function ka(a,t,n){const o=n&&n.maxWidth||100,c=a._container.clientHeight/2,d=a.unproject([0,c]),m=a.unproject([o,c]),y=d.distanceTo(m);if(n&&n.unit==="imperial"){const _=3.2808*y;_>5280?Ur(t,o,_/5280,a._getUIString("ScaleControl.Miles")):Ur(t,o,_,a._getUIString("ScaleControl.Feet"))}else n&&n.unit==="nautical"?Ur(t,o,y/1852,a._getUIString("ScaleControl.NauticalMiles")):y>=1e3?Ur(t,o,y/1e3,a._getUIString("ScaleControl.Kilometers")):Ur(t,o,y,a._getUIString("ScaleControl.Meters"))}function Ur(a,t,n,o){const c=function(d){const m=Math.pow(10,`${Math.floor(d)}`.length-1);let y=d/m;return y=y>=10?10:y>=5?5:y>=3?3:y>=2?2:y>=1?1:function(_){const v=Math.pow(10,Math.ceil(-Math.log(_)/Math.LN10));return Math.round(_*v)/v}(y),m*y}(n);a.style.width=t*(c/n)+"px",a.innerHTML=`${c}&nbsp;${o}`}const Ft={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Nt=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Co(a){if(a){if(typeof a=="number"){const t=Math.round(Math.sqrt(.5*Math.pow(a,2)));return{center:new h.pointGeometry(0,0),top:new h.pointGeometry(0,a),"top-left":new h.pointGeometry(t,t),"top-right":new h.pointGeometry(-t,t),bottom:new h.pointGeometry(0,-a),"bottom-left":new h.pointGeometry(t,-t),"bottom-right":new h.pointGeometry(-t,-t),left:new h.pointGeometry(a,0),right:new h.pointGeometry(-a,0)}}if(a instanceof h.pointGeometry||Array.isArray(a)){const t=h.pointGeometry.convert(a);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:h.pointGeometry.convert(a.center||[0,0]),top:h.pointGeometry.convert(a.top||[0,0]),"top-left":h.pointGeometry.convert(a["top-left"]||[0,0]),"top-right":h.pointGeometry.convert(a["top-right"]||[0,0]),bottom:h.pointGeometry.convert(a.bottom||[0,0]),"bottom-left":h.pointGeometry.convert(a["bottom-left"]||[0,0]),"bottom-right":h.pointGeometry.convert(a["bottom-right"]||[0,0]),left:h.pointGeometry.convert(a.left||[0,0]),right:h.pointGeometry.convert(a.right||[0,0])}}return Co(new h.pointGeometry(0,0))}const Qr={supported:Pe,setRTLTextPlugin:h.setRTLTextPlugin,getRTLTextPluginStatus:h.getRTLTextPluginStatus,Map:class extends Mt{constructor(a){var t;if(h.PerformanceUtils.mark(h.PerformanceMarkers.create),(a=h.extend({},Ma,a)).minZoom!=null&&a.maxZoom!=null&&a.minZoom>a.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(a.minPitch!=null&&a.maxPitch!=null&&a.minPitch>a.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(a.minPitch!=null&&a.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(a.maxPitch!=null&&a.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new rs(a.minZoom,a.maxZoom,a.minPitch,a.maxPitch,a.renderWorldCopies),{bearingSnap:a.bearingSnap}),this._interactive=a.interactive,this._cooperativeGestures=a.cooperativeGestures,this._maxTileCacheSize=a.maxTileCacheSize,this._failIfMajorPerformanceCaveat=a.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=a.preserveDrawingBuffer,this._antialias=a.antialias,this._trackResize=a.trackResize,this._bearingSnap=a.bearingSnap,this._refreshExpiredTiles=a.refreshExpiredTiles,this._fadeDuration=a.fadeDuration,this._crossSourceCollisions=a.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=a.collectResourceTiming,this._renderTaskQueue=new Aa,this._controls=[],this._mapId=h.uniqueId(),this._locale=h.extend({},za,a.locale),this._clickTolerance=a.clickTolerance,this._pixelRatio=(t=a.pixelRatio)!==null&&t!==void 0?t:devicePixelRatio,this._requestManager=new Bt(a.transformRequest),typeof a.container=="string"){if(this._container=document.getElementById(a.container),!this._container)throw new Error(`Container '${a.container}' not found.`)}else{if(!(a.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=a.container}if(a.maxBounds&&this.setMaxBounds(a.maxBounds),h.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),typeof window<"u"&&(addEventListener("online",this._onWindowOnline,!1),addEventListener("resize",this._onWindowResize,!1),addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Ca(this,a),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=a.hash&&new ga(typeof a.hash=="string"&&a.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:a.center,zoom:a.zoom,bearing:a.bearing,pitch:a.pitch}),a.bounds&&(this.resize(),this.fitBounds(a.bounds,h.extend({},a.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=a.localIdeographFontFamily,a.style&&this.setStyle(a.style,{localIdeographFontFamily:a.localIdeographFontFamily}),a.attributionControl&&this.addControl(new us({customAttribution:a.customAttribution})),a.maplibreLogo&&this.addControl(new Fs,a.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",n=>{this._update(n.dataType==="style"),this.fire(new h.Event(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new h.Event(`${n.dataType}dataloading`,n))}),this.on("dataabort",n=>{this.fire(new h.Event("sourcedataabort",n))})}_getMapId(){return this._mapId}addControl(a,t){if(t===void 0&&(t=a.getDefaultPosition?a.getDefaultPosition():"top-right"),!a||!a.onAdd)return this.fire(new h.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=a.onAdd(this);this._controls.push(a);const o=this._controlPositions[t];return t.indexOf("bottom")!==-1?o.insertBefore(n,o.firstChild):o.appendChild(n),this}removeControl(a){if(!a||!a.onRemove)return this.fire(new h.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(a);return t>-1&&this._controls.splice(t,1),a.onRemove(this),this}hasControl(a){return this._controls.indexOf(a)>-1}calculateCameraOptionsFromTo(a,t,n,o){return o==null&&this.style.terrain&&(o=this.transform.getElevation(n,this.style.terrain)),super.calculateCameraOptionsFromTo(a,t,n,o)}resize(a){const t=this._containerDimensions(),n=t[0],o=t[1];this._resizeCanvas(n,o,this.getPixelRatio()),this.transform.resize(n,o),this.painter.resize(n,o,this.getPixelRatio());const c=!this._moving;return c&&(this.stop(),this.fire(new h.Event("movestart",a)).fire(new h.Event("move",a))),this.fire(new h.Event("resize",a)),c&&this.fire(new h.Event("moveend",a)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(a){const[t,n]=this._containerDimensions();this._pixelRatio=a,this._resizeCanvas(t,n,a),this.painter.resize(t,n,a)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(a){return this.transform.setMaxBounds(h.LngLatBounds.convert(a)),this._update()}setMinZoom(a){if((a=a==null?-2:a)>=-2&&a<=this.transform.maxZoom)return this.transform.minZoom=a,this._update(),this.getZoom()<a&&this.setZoom(a),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(a){if((a=a==null?22:a)>=this.transform.minZoom)return this.transform.maxZoom=a,this._update(),this.getZoom()>a&&this.setZoom(a),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(a){if((a=a==null?0:a)<0)throw new Error("minPitch must be greater than or equal to 0");if(a>=0&&a<=this.transform.maxPitch)return this.transform.minPitch=a,this._update(),this.getPitch()<a&&this.setPitch(a),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(a){if((a=a==null?60:a)>85)throw new Error("maxPitch must be less than or equal to 85");if(a>=this.transform.minPitch)return this.transform.maxPitch=a,this._update(),this.getPitch()>a&&this.setPitch(a),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(a){return this.transform.renderWorldCopies=a,this._update()}project(a){return this.transform.locationPoint(h.LngLat.convert(a),this.style&&this.style.terrain)}unproject(a){return this.transform.pointLocation(h.pointGeometry.convert(a),this.style&&this.style.terrain)}isMoving(){return this._moving||this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers.isRotating()}_createDelegatedListener(a,t,n){if(a==="mouseenter"||a==="mouseover"){let o=!1;return{layer:t,listener:n,delegates:{mousemove:d=>{const m=this.getLayer(t)?this.queryRenderedFeatures(d.point,{layers:[t]}):[];m.length?o||(o=!0,n.call(this,new Mi(a,this,d.originalEvent,{features:m}))):o=!1},mouseout:()=>{o=!1}}}}if(a==="mouseleave"||a==="mouseout"){let o=!1;return{layer:t,listener:n,delegates:{mousemove:m=>{(this.getLayer(t)?this.queryRenderedFeatures(m.point,{layers:[t]}):[]).length?o=!0:o&&(o=!1,n.call(this,new Mi(a,this,m.originalEvent)))},mouseout:m=>{o&&(o=!1,n.call(this,new Mi(a,this,m.originalEvent)))}}}}{const o=c=>{const d=this.getLayer(t)?this.queryRenderedFeatures(c.point,{layers:[t]}):[];d.length&&(c.features=d,n.call(this,c),delete c.features)};return{layer:t,listener:n,delegates:{[a]:o}}}}on(a,t,n){if(n===void 0)return super.on(a,t);const o=this._createDelegatedListener(a,t,n);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[a]=this._delegatedListeners[a]||[],this._delegatedListeners[a].push(o);for(const c in o.delegates)this.on(c,o.delegates[c]);return this}once(a,t,n){if(n===void 0)return super.once(a,t);const o=this._createDelegatedListener(a,t,n);for(const c in o.delegates)this.once(c,o.delegates[c]);return this}off(a,t,n){return n===void 0?super.off(a,t):(this._delegatedListeners&&this._delegatedListeners[a]&&(o=>{const c=this._delegatedListeners[a];for(let d=0;d<c.length;d++){const m=c[d];if(m.layer===t&&m.listener===n){for(const y in m.delegates)this.off(y,m.delegates[y]);return c.splice(d,1),this}}})(),this)}queryRenderedFeatures(a,t){if(!this.style)return[];let n;if(t!==void 0||a===void 0||a instanceof h.pointGeometry||Array.isArray(a)||(t=a,a=void 0),t=t||{},(a=a||[[0,0],[this.transform.width,this.transform.height]])instanceof h.pointGeometry||typeof a[0]=="number")n=[h.pointGeometry.convert(a)];else{const o=h.pointGeometry.convert(a[0]),c=h.pointGeometry.convert(a[1]);n=[o,new h.pointGeometry(c.x,o.y),c,new h.pointGeometry(o.x,c.y),o]}return this.style.queryRenderedFeatures(n,t,this.transform)}querySourceFeatures(a,t){return this.style.querySourceFeatures(a,t)}setStyle(a,t){return(t=h.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&a?(this._diffStyle(a,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(a,t))}setTransformRequest(a){return this._requestManager.setTransformRequest(a),this}_getUIString(a){const t=this._locale[a];if(t==null)throw new Error(`Missing UI string '${a}'`);return t}_updateStyle(a,t){return this.style&&(this.style.setEventedParent(null),this.style._remove()),a?(this.style=new ai(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof a=="string"?this.style.loadURL(a):this.style.loadJSON(a),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new ai(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(a,t){if(typeof a=="string"){const n=this._requestManager.transformRequest(a,h.ResourceType.Style);h.getJSON(n,(o,c)=>{o?this.fire(new h.ErrorEvent(o)):c&&this._updateDiff(c,t)})}else typeof a=="object"&&this._updateDiff(a,t)}_updateDiff(a,t){try{this.style.setState(a)&&this._update(!0)}catch(n){h.warnOnce(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(a,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():h.warnOnce("There is no style added to the map.")}addSource(a,t){return this._lazyInitEmptyStyle(),this.style.addSource(a,t),this._update(!0)}isSourceLoaded(a){const t=this.style&&this.style.sourceCaches[a];if(t!==void 0)return t.loaded();this.fire(new h.ErrorEvent(new Error(`There is no source with ID '${a}'`)))}setTerrain(a){return this.style.setTerrain(a),this}getTerrain(){return this.style.terrain&&this.style.terrain.options}areTilesLoaded(){const a=this.style&&this.style.sourceCaches;for(const t in a){const n=a[t]._tiles;for(const o in n){const c=n[o];if(c.state!=="loaded"&&c.state!=="errored")return!1}}return!0}addSourceType(a,t,n){return this._lazyInitEmptyStyle(),this.style.addSourceType(a,t,n)}removeSource(a){return this.style.removeSource(a),this._update(!0)}getSource(a){return this.style.getSource(a)}addImage(a,t,{pixelRatio:n=1,sdf:o=!1,stretchX:c,stretchY:d,content:m}={}){if(this._lazyInitEmptyStyle(),t instanceof HTMLImageElement||h.isImageBitmap(t)){const{width:y,height:_,data:v}=h.exported.getImageData(t);this.style.addImage(a,{data:new h.RGBAImage({width:y,height:_},v),pixelRatio:n,stretchX:c,stretchY:d,content:m,sdf:o,version:0})}else{if(t.width===void 0||t.height===void 0)return this.fire(new h.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:y,height:_,data:v}=t,T=t;this.style.addImage(a,{data:new h.RGBAImage({width:y,height:_},new Uint8Array(v)),pixelRatio:n,stretchX:c,stretchY:d,content:m,sdf:o,version:0,userImage:T}),T.onAdd&&T.onAdd(this,a)}}}updateImage(a,t){const n=this.style.getImage(a);if(!n)return this.fire(new h.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const o=t instanceof HTMLImageElement||h.isImageBitmap(t)?h.exported.getImageData(t):t,{width:c,height:d,data:m}=o;if(c===void 0||d===void 0)return this.fire(new h.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(c!==n.data.width||d!==n.data.height)return this.fire(new h.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const y=!(t instanceof HTMLImageElement||h.isImageBitmap(t));n.data.replace(m,y),this.style.updateImage(a,n)}hasImage(a){return a?!!this.style.getImage(a):(this.fire(new h.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(a){this.style.removeImage(a)}loadImage(a,t){h.getImage(this._requestManager.transformRequest(a,h.ResourceType.Image),t)}listImages(){return this.style.listImages()}addLayer(a,t){return this._lazyInitEmptyStyle(),this.style.addLayer(a,t),this._update(!0)}moveLayer(a,t){return this.style.moveLayer(a,t),this._update(!0)}removeLayer(a){return this.style.removeLayer(a),this._update(!0)}getLayer(a){return this.style.getLayer(a)}setLayerZoomRange(a,t,n){return this.style.setLayerZoomRange(a,t,n),this._update(!0)}setFilter(a,t,n={}){return this.style.setFilter(a,t,n),this._update(!0)}getFilter(a){return this.style.getFilter(a)}setPaintProperty(a,t,n,o={}){return this.style.setPaintProperty(a,t,n,o),this._update(!0)}getPaintProperty(a,t){return this.style.getPaintProperty(a,t)}setLayoutProperty(a,t,n,o={}){return this.style.setLayoutProperty(a,t,n,o),this._update(!0)}getLayoutProperty(a,t){return this.style.getLayoutProperty(a,t)}setLight(a,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(a,t),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(a,t){return this.style.setFeatureState(a,t),this._update()}removeFeatureState(a,t){return this.style.removeFeatureState(a,t),this._update()}getFeatureState(a){return this.style.getFeatureState(a)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let a=0,t=0;return this._container&&(a=this._container.clientWidth||400,t=this._container.clientHeight||300),[a,t]}_setupContainer(){const a=this._container;a.classList.add("maplibregl-map","mapboxgl-map");const t=this._canvasContainer=re.create("div","maplibregl-canvas-container mapboxgl-canvas-container",a);this._interactive&&t.classList.add("maplibregl-interactive","mapboxgl-interactive"),this._canvas=re.create("canvas","maplibregl-canvas mapboxgl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const n=this._containerDimensions();this._resizeCanvas(n[0],n[1],this.getPixelRatio());const o=this._controlContainer=re.create("div","maplibregl-control-container mapboxgl-control-container",a),c=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(d=>{c[d]=re.create("div",`maplibregl-ctrl-${d} mapboxgl-ctrl-${d}`,o)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){const a=this._container;this._metaPress=!1,this._cooperativeGesturesScreen=re.create("div","maplibregl-cooperative-gesture-screen",a);let t="Control",n=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(n=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use \u2318 + scroll to zoom the map",t="Meta"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${n}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,document.addEventListener("keydown",o=>{o.key===t&&(this._metaPress=!0)}),document.addEventListener("keyup",o=>{o.key===t&&(this._metaPress=!1)}),this._canvasContainer.addEventListener("wheel",o=>{this._onCooperativeGesture(o,this._metaPress,1)},!1),this._canvasContainer.classList.remove("mapboxgl-touch-drag-pan","maplibregl-touch-drag-pan")}_resizeCanvas(a,t,n){this._canvas.width=n*a,this._canvas.height=n*t,this._canvas.style.width=`${a}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const a=h.extend({},Pe.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl",a)||this._canvas.getContext("experimental-webgl",a);t?(this.painter=new go(t,this.transform),h.exported$1.testSupport(t)):this.fire(new h.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(a){a.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new h.Event("webglcontextlost",{originalEvent:a}))}_contextRestored(a){this._setupPainter(),this.resize(),this._update(),this.fire(new h.Event("webglcontextrestored",{originalEvent:a}))}_onMapScroll(a){if(a.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}_onCooperativeGesture(a,t,n){return!t&&n<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(a){return this.style?(this._styleDirty=this._styleDirty||a,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(a){return this._update(),this._renderTaskQueue.add(a)}_cancelRenderFrame(a){this._renderTaskQueue.remove(a)}_render(a){let t,n=0;const o=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(t=o.createQueryEXT(),o.beginQueryEXT(o.TIME_ELAPSED_EXT,t),n=h.exported.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(a),this._removed)return;let c=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const m=this.transform.zoom,y=h.exported.now();this.style.zoomHistory.update(m,y);const _=new h.EvaluationParameters(m,{now:y,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),v=_.crossFadingFactor();v===1&&v===this._crossFadingFactor||(c=!0,this._crossFadingFactor=v),this.style.update(_)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.style.terrain&&this.style.terrain.sourceCache.update(this.transform,this.style.terrain),this.transform.updateElevation(this.style.terrain),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new h.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,h.PerformanceUtils.mark(h.PerformanceMarkers.load),this.fire(new h.Event("load"))),this.style&&(this.style.hasTransitions()||c)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const m=h.exported.now()-n;o.endQueryEXT(o.TIME_ELAPSED_EXT,t),setTimeout(()=>{const y=o.getQueryObjectEXT(t,o.QUERY_RESULT_EXT)/1e6;o.deleteQueryEXT(t),this.fire(new h.Event("gpu-timing-frame",{cpuTime:m,gpuTime:y}))},50)}if(this.listens("gpu-timing-layer")){const m=this.painter.collectGpuTimers();setTimeout(()=>{const y=this.painter.queryGpuTimers(m);this.fire(new h.Event("gpu-timing-layer",{layerTimes:y}))},50)}const d=this._sourcesDirty||this._styleDirty||this._placementDirty;return d||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new h.Event("idle")),!this._loaded||this._fullyLoaded||d||(this._fullyLoaded=!0,h.PerformanceUtils.mark(h.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&(removeEventListener("resize",this._onWindowResize,!1),removeEventListener("orientationchange",this._onWindowResize,!1),removeEventListener("online",this._onWindowOnline,!1));const a=this.painter.context.gl.getExtension("WEBGL_lose_context");a&&a.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),re.remove(this._canvasContainer),re.remove(this._controlContainer),this._cooperativeGestures&&re.remove(this._cooperativeGesturesScreen),this._container.classList.remove("maplibregl-map","mapboxgl-map"),h.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new h.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=h.exported.frame(a=>{h.PerformanceUtils.frame(a),this._frame=null,this._render(a)}))}_onWindowOnline(){this._update()}_onWindowResize(a){this._trackResize&&this.resize({originalEvent:a})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(a){this._showTileBoundaries!==a&&(this._showTileBoundaries=a,this._update())}get showPadding(){return!!this._showPadding}set showPadding(a){this._showPadding!==a&&(this._showPadding=a,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(a){this._showCollisionBoxes!==a&&(this._showCollisionBoxes=a,a?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(a){this._showOverdrawInspector!==a&&(this._showOverdrawInspector=a,this._update())}get repaint(){return!!this._repaint}set repaint(a){this._repaint!==a&&(this._repaint=a,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(a){this._vertices=a,this._update()}_setCacheLimits(a,t){h.setCacheLimits(a,t)}get version(){return"2.4.0"}},NavigationControl:class{constructor(a){this.options=h.extend({},wl,a),this._container=re.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(h.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in mapboxgl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),re.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out mapboxgl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),re.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(h.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass mapboxgl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=re.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const a=this._map.getZoom(),t=a===this._map.getMaxZoom(),n=a===this._map.getMinZoom();this._zoomInButton.disabled=t,this._zoomOutButton.disabled=n,this._zoomInButton.setAttribute("aria-disabled",t.toString()),this._zoomOutButton.setAttribute("aria-disabled",n.toString())}_rotateCompassArrow(){const a=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=a}onAdd(a){return this._map=a,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new nr(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){re.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(a,t){const n=re.create("button",a,this._container);return n.type="button",n.addEventListener("click",t),n}_setButtonTitle(a,t){const n=this._map._getUIString(`NavigationControl.${t}`);a.title=n,a.setAttribute("aria-label",n)}},GeolocateControl:class extends h.Evented{constructor(a){super(),this.options=h.extend({},So,a),h.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(a){var t;return this._map=a,this._container=re.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),t=this._setupUI,Fr!==void 0?t(Fr):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(n=>{Fr=n.state!=="denied",t(Fr)}):(Fr=!!window.navigator.geolocation,t(Fr)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),re.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ri=0,Or=!1}_isOutOfMapMaxBounds(a){const t=this._map.getMaxBounds(),n=a.coords;return t&&(n.longitude<t.getWest()||n.longitude>t.getEast()||n.latitude<t.getSouth()||n.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_onSuccess(a){if(this._map){if(this._isOutOfMapMaxBounds(a))return this._setErrorState(),this.fire(new h.Event("outofmaxbounds",a)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=a,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(a),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(a),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new h.Event("geolocate",a)),this._finish()}}_updateCamera(a){const t=new h.LngLat(a.coords.longitude,a.coords.latitude),n=a.coords.accuracy,o=this._map.getBearing(),c=h.extend({bearing:o},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(n),c,{geolocateSource:!0})}_updateMarker(a){if(a){const t=new h.LngLat(a.coords.longitude,a.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=a.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const a=this._map._container.clientHeight/2,t=this._map.unproject([0,a]),n=this._map.unproject([1,a]),o=t.distanceTo(n),c=Math.ceil(2*this._accuracy/o);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(a){if(this._map){if(this.options.trackUserLocation)if(a.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(a.code===3&&Or)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new h.Event("error",a)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(a){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=re.create("button","maplibregl-ctrl-geolocate mapboxgl-ctrl-geolocate",this._container),re.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",a===!1){h.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=re.create("div","maplibregl-user-location-dot mapboxgl-user-location-dot"),this._userLocationDotMarker=new Pn(this._dotElement),this._circleElement=re.create("div","maplibregl-user-location-accuracy-circle mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Pn({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this.fire(new h.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return h.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new h.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ri--,Or=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this.fire(new h.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new h.Event("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let a;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ri++,ri>1?(a={maximumAge:6e5,timeout:0},Or=!0):(a=this.options.positionOptions,Or=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,a)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:us,LogoControl:Fs,ScaleControl:class{constructor(a){this.options=h.extend({},sr,a),h.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){ka(this._map,this._container,this.options)}onAdd(a){return this._map=a,this._container=re.create("div","maplibregl-ctrl maplibregl-ctrl-scale mapboxgl-ctrl mapboxgl-ctrl-scale",a.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){re.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(a){this.options.unit=a,ka(this._map,this._container,this.options)}},FullscreenControl:class{constructor(a){this._fullscreen=!1,a&&a.container&&(a.container instanceof HTMLElement?this._container=a.container:h.warnOnce("Full screen control 'container' must be a DOM element.")),h.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(a){return this._map=a,this._container||(this._container=this._map.getContainer()),this._controlContainer=re.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",h.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){re.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled)}_setupUI(){const a=this._fullscreenButton=re.create("button","maplibregl-ctrl-fullscreen mapboxgl-ctrl-fullscreen",this._controlContainer);re.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",a).setAttribute("aria-hidden","true"),a.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const a=this._getTitle();this._fullscreenButton.setAttribute("aria-label",a),this._fullscreenButton.title=a}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},TerrainControl:class{constructor(a){this.options=a,h.bindAll(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(a){return this._map=a,this._container=re.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._terrainButton=re.create("button","maplibregl-ctrl-terrain mapboxgl-ctrl-terrain",this._container),re.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){re.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._map.style.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))}},Popup:class extends h.Evented{constructor(a){super(),this.options=h.extend(Object.create(Ft),a),h.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(a){return this._map&&this.remove(),this._map=a,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new h.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&re.remove(this._content),this._container&&(re.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new h.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(a){return this._lngLat=h.LngLat.convert(a),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer","mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")),this}getElement(){return this._container}setText(a){return this.setDOMContent(document.createTextNode(a))}setHTML(a){const t=document.createDocumentFragment(),n=document.createElement("body");let o;for(n.innerHTML=a;o=n.firstChild,o;)t.appendChild(o);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(a){return this.options.maxWidth=a,this._update(),this}setDOMContent(a){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=re.create("div","maplibregl-popup-content mapboxgl-popup-content",this._container);return this._content.appendChild(a),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(a){this._container&&this._container.classList.add(a)}removeClassName(a){this._container&&this._container.classList.remove(a)}setOffset(a){return this.options.offset=a,this._update(),this}toggleClassName(a){if(this._container)return this._container.classList.toggle(a)}_createCloseButton(){this.options.closeButton&&(this._closeButton=re.create("button","maplibregl-popup-close-button mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(a){this._update(a.point)}_onMouseMove(a){this._update(a.point)}_onDrag(a){this._update(a.point)}_update(a){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=re.create("div","maplibregl-popup mapboxgl-popup",this._map.getContainer()),this._tip=re.create("div","maplibregl-popup-tip mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(d=>this._container.classList.add(d)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ds(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!a))return;const t=this._pos=this._trackPointer&&a?a:this._map.project(this._lngLat);let n=this.options.anchor;const o=Co(this.options.offset);if(!n){const d=this._container.offsetWidth,m=this._container.offsetHeight;let y;y=t.y+o.bottom.y<m?["top"]:t.y>this._map.transform.height-m?["bottom"]:[],t.x<d/2?y.push("left"):t.x>this._map.transform.width-d/2&&y.push("right"),n=y.length===0?"bottom":y.join("-")}const c=t.add(o[n]).round();re.setTransform(this._container,`${Oe[n]} translate(${c.x}px,${c.y}px)`),Ge(this._container,n,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const a=this._container.querySelector(Nt);a&&a.focus()}_onClose(){this.remove()}},Marker:Pn,Style:ai,LngLat:h.LngLat,LngLatBounds:h.LngLatBounds,Point:h.pointGeometry,MercatorCoordinate:h.MercatorCoordinate,Evented:h.Evented,AJAXError:h.AJAXError,config:h.config,CanvasSource:qr,GeoJSONSource:hr,ImageSource:ji,RasterDEMTileSource:je,RasterTileSource:er,VectorTileSource:Ir,VideoSource:Zi,prewarm:function(){fn().acquire(dr)},clearPrewarmedResources:function(){const a=zr;a&&(a.isPreloaded()&&a.numActive()===1?(a.release(dr),zr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get version(){return"2.4.0"},get workerCount(){return Si.workerCount},set workerCount(a){Si.workerCount=a},get maxParallelImageRequests(){return h.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(a){h.config.MAX_PARALLEL_IMAGE_REQUESTS=a},clearStorage(a){h.clearTileCache(a)},workerUrl:"",addProtocol(a,t){h.config.REGISTERED_PROTOCOLS[a]=t},removeProtocol(a){delete h.config.REGISTERED_PROTOCOLS[a]}};return Vi.extend(Qr,{isSafari:h.isSafari,getPerformanceMetrics:h.PerformanceUtils.getPerformanceMetrics}),Qr});var fe=X;return fe})})(Lh);const Xo=Lh.exports,kh=document.getElementById("js-menu-scroll"),tl=document.getElementById("js-menu-toggle"),il=document.getElementById("js-menu-close");[...document.querySelectorAll("section")];tl&&il&&(tl.addEventListener("click",Q=>{Q.preventDefault(),Q.stopPropagation(),kh.classList.add("visible"),il.classList.add("c-scroll-menu__close--visible"),tl.classList.add("c-menu-toggle--visible")}),il.addEventListener("click",Q=>{Q.preventDefault(),Q.stopPropagation(),kh.classList.remove("visible"),il.classList.remove("c-scroll-menu__close--visible"),tl.classList.remove("c-menu-toggle--visible")}));window.onscroll=function(){Pd()};function Pd(){document.body.scrollTop>50||document.documentElement.scrollTop>50?document.querySelector(".js-menu__logo--desk").style.height="70px":document.querySelector(".js-menu__logo--desk").style.height="200px"}document.querySelectorAll(".js-gallery").forEach(Q=>{Md(Q,{speed:500})});var Ph=document.querySelector(".js-map");if(Ph){let E=function(q,X,ie,fe,h){let Pe=new Xo.Marker().setLngLat([q,X]).addTo(ac),Ze=new Xo.Popup({offset:25,closeButton:!1,className:"c-map-popup"}).setHTML(`
      <a class="c-map-popup__link" href="`+fe+'" target="_blank" class="c-map-popup">'+ie+`</a>
      <p class="c-map-popup__date">`+h+`</p>
      `);Pe.setPopup(Ze),Pe.getElement().classList.add("c-map-marker")};var createMarker=E,ac=new Xo.Map({container:Ph,style:"https://api.maptiler.com/maps/hybrid/style.json?key=zGOAhHI04onwS7U5LJKD",center:[-15.31769,13.01526],zoom:7.75,scrollZoom:!1});ac.addControl(new Xo.NavigationControl);let Q=new Xo.LngLatBounds;document.querySelectorAll(".js-projectcard").forEach(q=>{let X=q.getAttribute("data-long"),ie=q.getAttribute("data-lat"),fe=q.getAttribute("data-name"),h=q.getAttribute("data-link"),Pe=q.getAttribute("data-date");E(X,ie,fe,h,Pe),Q.extend([X,ie])}),ac.fitBounds(Q,{padding:70})}
